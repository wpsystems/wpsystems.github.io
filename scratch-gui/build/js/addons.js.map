{"version":3,"file":"js/addons.js","sources":["webpack://GUI/./src/addons/addons/2d-color-picker/style.css","webpack://GUI/./src/addons/addons/block-palette-icons/userstyle.css","webpack://GUI/./src/addons/addons/clones/style.css","webpack://GUI/./src/addons/addons/color-picker/style.css","webpack://GUI/./src/addons/addons/custom-zoom/style.css","webpack://GUI/./src/addons/addons/debugger/style.css","webpack://GUI/./src/addons/addons/drag-drop/dragged-over.css","webpack://GUI/./src/addons/addons/editor-colored-context-menus/userscript.css","webpack://GUI/./src/addons/addons/editor-devtools/userscript.css","webpack://GUI/./src/addons/addons/editor-searchable-dropdowns/userscript.css","webpack://GUI/./src/addons/addons/editor-stage-left/stageleft.css","webpack://GUI/./src/addons/addons/editor-theme3/theme3.css","webpack://GUI/./src/addons/addons/folders/style.css","webpack://GUI/./src/addons/addons/gamepad/gamepadlib.css","webpack://GUI/./src/addons/addons/gamepad/style.css","webpack://GUI/./src/addons/addons/hide-flyout/style.css","webpack://GUI/./src/addons/addons/mediarecorder/style.css","webpack://GUI/./src/addons/addons/mouse-pos/style.css","webpack://GUI/./src/addons/addons/onion-skinning/style.css","webpack://GUI/./src/addons/addons/pause/style.css","webpack://GUI/./src/addons/addons/remove-curved-stage-border/remove-borders.css","webpack://GUI/./src/addons/addons/transparent-orphans/userstyle.css","webpack://GUI/./src/addons/addons/tw-interface-customization/remove-backpack.css","webpack://GUI/./src/addons/addons/variable-manager/style.css","webpack://GUI/./src/addons/addons eager ./node_modules/css-loader ^\\.\\/.*$ include: \\.css$ namespace object","webpack://GUI/./src/addons/addons eager ^\\.\\/.*$ include: \\.js$ namespace object","webpack://GUI/./src/addons/addons/2d-color-picker/assets/sv-gr.png","webpack://GUI/./src/addons/addons/2d-color-picker/paint-editor.js","webpack://GUI/./src/addons/addons/2d-color-picker/userscript.js","webpack://GUI/./src/addons/addons/bitmap-copy/userscript.js","webpack://GUI/./src/addons/addons/block-palette-icons/icons/block_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/control_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/events_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/list_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/looks_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/motion_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/operators_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/sensing_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/sound_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/tw_icon.svg","webpack://GUI/./src/addons/addons/block-palette-icons/icons/variables_icon.svg","webpack://GUI/./src/addons/addons/block-switching/blockToDom.js","webpack://GUI/./src/addons/addons/block-switching/userscript.js","webpack://GUI/./src/addons/addons/blocks2image/userscript.js","webpack://GUI/./src/addons/addons/cat-blocks/userscript.js","webpack://GUI/./src/addons/addons/clones/300cats.svg","webpack://GUI/./src/addons/addons/clones/cat.svg","webpack://GUI/./src/addons/addons/clones/userscript.js","webpack://GUI/./src/addons/addons/color-picker/code-editor.js","webpack://GUI/./src/addons/addons/color-picker/paint-editor.js","webpack://GUI/./src/addons/addons/color-picker/userscript.js","webpack://GUI/./src/addons/addons/custom-block-shape/userscript.js","webpack://GUI/./src/addons/addons/custom-zoom/userscript.js","webpack://GUI/./src/addons/addons/data-category-tweaks-v2/userscript.js","webpack://GUI/./src/addons/addons/debugger/add.svg","webpack://GUI/./src/addons/addons/debugger/debug-unread.svg","webpack://GUI/./src/addons/addons/debugger/debug.svg","webpack://GUI/./src/addons/addons/debugger/delete.svg","webpack://GUI/./src/addons/addons/debugger/download-white.svg","webpack://GUI/./src/addons/addons/debugger/error.svg","webpack://GUI/./src/addons/addons/debugger/play.svg","webpack://GUI/./src/addons/addons/debugger/userscript.js","webpack://GUI/./src/addons/addons/debugger/warning.svg","webpack://GUI/./src/addons/addons/drag-drop/userscript.js","webpack://GUI/./src/addons/addons/editor-colored-context-menus/userscript.js","webpack://GUI/./src/addons/addons/editor-devtools/BlockInstance.js","webpack://GUI/./src/addons/addons/editor-devtools/BlockItem.js","webpack://GUI/./src/addons/addons/editor-devtools/DevTools.js","webpack://GUI/./src/addons/addons/editor-devtools/DomHelpers.js","webpack://GUI/./src/addons/addons/editor-devtools/XML.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/BlockFlasher.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/UndoGroup.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/Utils.js","webpack://GUI/./src/addons/addons/editor-devtools/icon--close.svg","webpack://GUI/./src/addons/addons/editor-devtools/show-broadcast.js","webpack://GUI/./src/addons/addons/editor-devtools/userscript.js","webpack://GUI/./src/addons/addons/editor-searchable-dropdowns/userscript.js","webpack://GUI/./src/addons/addons/editor-sounds/userscript.js","webpack://GUI/./src/addons/addons/editor-stage-left/fix-share-the-love.js","webpack://GUI/./src/addons/addons/editor-theme3/theme3.js","webpack://GUI/./src/addons/addons/folders/folder.svg","webpack://GUI/./src/addons/addons/folders/userscript.js","webpack://GUI/./src/addons/addons/gamepad/active.png","webpack://GUI/./src/addons/addons/gamepad/close.svg","webpack://GUI/./src/addons/addons/gamepad/cursor.png","webpack://GUI/./src/addons/addons/gamepad/dot.svg","webpack://GUI/./src/addons/addons/gamepad/gamepad.svg","webpack://GUI/./src/addons/addons/gamepad/gamepadlib.js","webpack://GUI/./src/addons/addons/gamepad/userscript.js","webpack://GUI/./src/addons/addons/hide-flyout/lock.svg","webpack://GUI/./src/addons/addons/hide-flyout/unlock.svg","webpack://GUI/./src/addons/addons/hide-flyout/userscript.js","webpack://GUI/./src/addons/addons/initialise-sprite-position/userscript.js","webpack://GUI/./src/addons/addons/load-extensions/userscript.js","webpack://GUI/./src/addons/addons/mediarecorder/userscript.js","webpack://GUI/./src/addons/addons/mouse-pos/userscript.js","webpack://GUI/./src/addons/addons/mute-project/icon--mute.svg","webpack://GUI/./src/addons/addons/mute-project/userscript.js","webpack://GUI/./src/addons/addons/onion-skinning/decrement.svg","webpack://GUI/./src/addons/addons/onion-skinning/increment.svg","webpack://GUI/./src/addons/addons/onion-skinning/settings.svg","webpack://GUI/./src/addons/addons/onion-skinning/toggle.svg","webpack://GUI/./src/addons/addons/onion-skinning/userscript.js","webpack://GUI/./src/addons/addons/pause/module.js","webpack://GUI/./src/addons/addons/pause/pause.svg","webpack://GUI/./src/addons/addons/pause/play.svg","webpack://GUI/./src/addons/addons/pause/userscript.js","webpack://GUI/./src/addons/addons/remove-sprite-confirm/userscript.js","webpack://GUI/./src/addons/addons/tw-interface-customization/remove-backpack.js","webpack://GUI/./src/addons/addons/tw-project-info/blockcount.js","webpack://GUI/./src/addons/addons/variable-manager/icon.svg","webpack://GUI/./src/addons/addons/variable-manager/search.svg","webpack://GUI/./src/addons/addons/variable-manager/userscript.js","webpack://GUI/./src/addons/api.js","webpack://GUI/./src/addons/entry.js","webpack://GUI/./src/addons/libraries/common/cs/download-blob.js","webpack://GUI/./src/addons/libraries/common/cs/normalize-color.js","webpack://GUI/./src/addons/libraries/common/cs/rate-limiter.js","webpack://GUI/./src/addons/libraries/common/cs/text-color.esm.js","webpack://GUI/./src/addons/libraries/thirdparty/cs/tinycolor-min.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-2dcolor-picker {\\n  width: 150px;\\n  height: 150px;\\n  border-radius: 8px;\\n  margin: 8px;\\n  position: relative;\\n  user-select: none;\\n}\\n\\n.sa-2dcolor-picker-image {\\n  border-radius: 8px;\\n  width: 150px;\\n  height: 150px;\\n  user-select: none;\\n}\\n\", \"\"]);\n\n// exports\n","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".scratchCategoryItemBubble {\\n  background-position: center;\\n  background-repeat: no-repeat;\\n  background-size: 17px 17px;\\n  height: 22px;\\n  width: 22px;\\n}\\n\\n.scratchCategoryId-motion .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/motion_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-looks .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/looks_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-sound .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/sound_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-events .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/events_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-control .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/control_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-sensing .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/sensing_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-operators .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/operators_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-variables .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/variables_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-lists .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/list_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-myBlocks .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/block_icon.svg\")) + \");\\n}\\n\\n.scratchCategoryId-tw .scratchCategoryItemBubble {\\n  background-image: url(\" + escape(require(\"./icons/tw_icon.svg\")) + \");\\n}\\n\", \"\"]);\n\n// exports\n","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".clone-container-container {\\n  display: none;\\n  -webkit-box-align: center;\\n  -webkit-align-items: center;\\n  -ms-flex-align: center;\\n  align-items: center;\\n  padding: 0.25rem;\\n  -webkit-user-select: none;\\n  -moz-user-select: none;\\n  -ms-user-select: none;\\n  user-select: none;\\n  color: #a065ff;\\n}\\n\\n.clone-container {\\n  font-size: 0.625rem;\\n  font-weight: bold;\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\n  white-space: nowrap;\\n}\\n\\n.clone-icon {\\n  margin: 0.25rem;\\n  display: inline-block;\\n  background-image: url(\" + escape(require(\"./cat.svg\")) + \");\\n  height: 16px;\\n  width: 16px;\\n}\\n\\n.clone-container-container[data-count=\\\"0\\\"] {\\n  display: none;\\n}\\n\\n.clone-container-container[data-count=\\\"300\\\"] {\\n  color: #ff6680;\\n}\\n\\n.clone-container-container[data-count=\\\"300\\\"] .clone-icon {\\n  background-image: url(\" + escape(require(\"./300cats.svg\")) + \");\\n}\\n\\n.clone-count::after {\\n  content: attr(data-str);\\n}\\n\\n.sa-clones-small .clone-container-container {\\n  display: none !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-color-picker {\\n  display: flex;\\n}\\n\\n.sa-color-picker-code {\\n  margin: 8px 0;\\n}\\n\\n.sa-color-picker-paint {\\n  margin-top: 16px;\\n  margin-bottom: 4px;\\n}\\n\\n.sa-color-picker > .sa-color-picker-color {\\n  border: none;\\n  border-top-left-radius: 1rem;\\n  border-bottom-left-radius: 1rem;\\n  padding: 0;\\n  padding-left: 0.6rem;\\n  padding-right: 0.4rem;\\n  margin-left: 0.5rem;\\n  outline: none;\\n  box-sizing: border-box;\\n  width: 3rem;\\n  height: 2rem;\\n}\\n[theme=\\\"dark\\\"] .sa-color-picker > .sa-color-picker-color {\\n  background: var(--ui-secondary);\\n}\\n\\n.sa-color-picker > .sa-color-picker-text {\\n  box-sizing: border-box;\\n  width: calc(150px - 3rem);\\n  border-top-left-radius: 0;\\n  border-bottom-left-radius: 0;\\n}\\n\\n[dir=\\\"rtl\\\"] .sa-color-picker > .sa-color-picker-color {\\n  border-top-left-radius: 0;\\n  border-bottom-left-radius: 0;\\n  border-top-right-radius: 1rem;\\n  border-bottom-right-radius: 1rem;\\n  margin-left: 0;\\n  margin-right: 0.5rem;\\n}\\n\\n[dir=\\\"rtl\\\"] .sa-color-picker > .sa-color-picker-text {\\n  border-top-left-radius: 1rem;\\n  border-bottom-left-radius: 1rem;\\n  border-top-right-radius: 0;\\n  border-bottom-right-radius: 0;\\n}\\n\\nbody.sa-hide-eye-dropper-background div[class*=\\\"stage_color-picker-background\\\"] {\\n  /* Do not show eye dropper background if the color picker is \\\"fake\\\" */\\n  display: none;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-custom-zoom-area {\\n  position: absolute;\\n  bottom: 0;\\n  right: 0;\\n  width: 60px;\\n  height: 148px;\\n  pointer-events: none;\\n}\\n.blocklyZoom > * {\\n  transition: transform var(--sa-custom-zoom-speed, 0) ease-in-out;\\n}\\n.sa-custom-zoom-hidden > * {\\n  transform: translateX(80px);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-debugger-container {\\n  margin-right: 0.2rem;\\n}\\n\\n.debug {\\n  display: none;\\n}\\n.debug {\\n  position: absolute;\\n  z-index: 492;\\n  background-color: white;\\n  width: 400px;\\n  height: 25rem;\\n}\\n\\n.debug h1 {\\n  padding: 10px;\\n  cursor: move;\\n  z-index: 10;\\n  color: #fff !important;\\n  width: calc(100% - 20px);\\n  font-size: 20px;\\n}\\n\\n.sa-debugger-unpause {\\n  animation: unpauseBackground 2s infinite alternate;\\n}\\n@keyframes unpauseBackground /* Firefox */ {\\n  0% {\\n    background-color: rgba(0, 0, 0, 0.15);\\n  }\\n  100% {\\n    background-color: rgba(0, 0, 0, 0);\\n  }\\n}\\n.sa-debugger-unpause > img {\\n  width: 20px;\\n  height: 20px;\\n}\\n\\n.log {\\n  --message-border-color: rgba(0, 0, 0, 0.15);\\n  --warning-border-color: hsl(50deg 100% 88%);\\n  --error-border-color: hsl(0deg 100% 92%);\\n  --error-text-color: red;\\n  --monospace-font-size: 12px;\\n  --monospace-font-family: consolas, lucida console, courier new, monospace;\\n  --source-code-font-size: 12px;\\n  --source-code-font-family: consolas, lucida console, courier new, monospace;\\n  font-family: var(--monospace-font-family);\\n  font-size: var(--monospace-font-size) !important;\\n  word-wrap: break-word;\\n  user-select: text;\\n  box-sizing: border-box;\\n  min-width: 0;\\n  min-height: 0;\\n  display: flex;\\n  border-top: 1px solid var(--message-border-color);\\n  border-bottom: 1px solid var(--message-border-color);\\n  word-wrap: break-word;\\n  white-space: pre-wrap;\\n  flex: auto;\\n  line-height: 1.2;\\n  border-top-right-radius: revert;\\n  border-top-left-radius: revert;\\n  cursor: text;\\n  align-items: center;\\n  padding: 3px;\\n  color: #575e75;\\n  content-visibility: auto;\\n  contain-intrinsic-size: 1.2rem;\\n}\\n.warn {\\n  border-color: var(--warning-border-color);\\n  color: hsl(39deg 100% 18%);\\n  background-color: hsl(50deg 100% 95%);\\n}\\n.error {\\n  border-color: var(--error-border-color);\\n  color: var(--error-text-color);\\n  background-color: hsl(0deg 100% 95%);\\n}\\n.log:not(.warn):not(.error) + .log:not(.warn):not(.error),\\n.warn + .warn,\\n.error + .error {\\n  border-top-color: transparent;\\n}\\n.logs {\\n  border-radius: 0;\\n  padding: 0;\\n}\\n.extra-log-container {\\n  display: flex;\\n  flex-direction: column;\\n  overflow: auto;\\n  flex: 1;\\n  cursor: default;\\n  width: 100%;\\n}\\n.console-variable {\\n  padding: 4px;\\n  border-radius: 10px;\\n  color: white;\\n  margin-right: 5px;\\n}\\n.log > span:not(.console-variable) {\\n  flex-grow: 1;\\n}\\n.log a {\\n  color: inherit;\\n  opacity: 0.5;\\n  text-decoration: underline;\\n  float: right;\\n  text-align: right;\\n  max-width: 100%;\\n  padding-left: 4px;\\n  margin-right: 4px;\\n  margin-left: auto;\\n}\\n.log a:hover {\\n  color: #4d97ff;\\n  opacity: 1;\\n}\\n\\n.logLink.deletedTarget {\\n  pointer-events: none;\\n}\\n\\n.logIcon {\\n  width: 1rem;\\n  height: 1rem;\\n  margin: 0 0.25rem;\\n}\\n\\n.log:not(.warn):not(.error) {\\n  margin-left: 1.5rem;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* Based on the `stage-selector_raised` class */\\ndiv[class*=\\\"stage-selector_header_\\\"],\\ndiv[class*=\\\"sprite-selector_sprite-selector\\\"],\\ndiv[class*=\\\"sprite-info_sprite-info\\\"],\\ndiv[class*=\\\"monitor_list-body\\\"] {\\n  -webkit-transition: background-color 0.25s ease;\\n  -o-transition: background-color 0.25s ease;\\n  transition: background-color 0.25s ease;\\n}\\n.sa-dragged-over,\\n.sa-dragged-over div[class*=\\\"stage-selector_header_\\\"],\\n.sa-dragged-over div[class*=\\\"sprite-info_sprite-info\\\"],\\n.sa-dragged-over div[class*=\\\"monitor_list-body\\\"] {\\n  background-color: hsla(0, 100%, 77%, 1) !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".u-contextmenu-colored .blocklyContextMenu {\\n  background-color: var(--u-contextmenu-bg) !important;\\n  border-color: #0003;\\n}\\n.u-contextmenu-colored .blocklyContextMenu .goog-menuitem .goog-menuitem-content {\\n  color: white;\\n}\\n.u-contextmenu-colored .blocklyContextMenu .goog-menuitem:hover.goog-menuitem-highlight,\\n.s3dev-mi:hover {\\n  border-color: transparent;\\n}\\n.u-contextmenu-colored .blocklyContextMenu .goog-menuitem:hover {\\n  background-color: rgba(0, 0, 0, 0.2);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"#s3devToolBar {\\n  display: flex;\\n  white-space: nowrap;\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\n}\\n\\n.s3devLabel {\\n  display: flex;\\n  padding-right: 2em;\\n}\\n\\n[dir=\\\"rtl\\\"] .s3devLabel {\\n  padding-right: 0;\\n  padding-left: 2em;\\n}\\n\\n.s3devLabel > span:first-child {\\n  margin-left: 1.5em;\\n  margin-right: 1em;\\n  font-weight: bold;\\n  font-size: 0.625rem;\\n  user-select: none;\\n  cursor: default;\\n  white-space: nowrap;\\n  padding-top: 2px;\\n}\\n\\n[dir=\\\"rtl\\\"] .s3devLabel > span:first-child {\\n  margin-right: 1.5em;\\n  margin-left: 1em;\\n}\\n\\n.s3devAction {\\n  transition: opacity 200ms ease-in;\\n  /*font-weight: bold;*/\\n  opacity: 0;\\n}\\n\\n.s3devLabel:hover .s3devAction {\\n  opacity: 0.7;\\n}\\n\\n/* Wrapper around find button and drop down */\\n.s3devWrap {\\n  overflow: visible;\\n  /*margin-left:3em;*/\\n  position: relative;\\n}\\n\\n#s3devFind {\\n  height: 2rem;\\n}\\n\\n/* Find Input Box */\\ninput.s3devInp {\\n  min-width: 100%;\\n  box-sizing: border-box !important;\\n  /* !important required for extension, because CSS injection method (and hence order) differs from addon */\\n  height: 1.5rem;\\n\\n  /* Change Scratch default styles */\\n  border-radius: 0.25rem;\\n  font-size: 0.75rem;\\n  padding-left: 0.4em;\\n}\\n[theme=\\\"dark\\\"] input.s3devInp {\\n  color: #eee;\\n  background: #3333;\\n}\\n[theme=\\\"dark\\\"] input.s3devInp:hover {\\n  background: #333;\\n}\\n\\ninput.s3devInp:focus {\\n  /* Change Scratch default styles */\\n  box-shadow: none;\\n}\\n\\n/* Drop down from find button */\\n#s3devDDOut {\\n  top: -6px;\\n}\\n\\n/* Drop down from find button */\\ndiv.s3devDDOut {\\n  z-index: 100;\\n  left: 0;\\n  width: 16em;\\n  position: relative;\\n  /*padding: 2.2em 0 0;*/\\n  /*background-color: white;*/\\n  padding: 4px;\\n}\\n\\n/* Drop down from find button */\\nul.s3devDD {\\n  display: none;\\n  position: relative;\\n  padding: 0.2em 0;\\n  font-size: 0.75rem;\\n  line-height: 1;\\n  overflow-y: auto;\\n  min-height: 128px;\\n  max-height: 65vh;\\n  user-select: none;\\n  max-width: 100%;\\n}\\n\\ndiv.s3devDDOut.vis {\\n  /*box-shadow: 0 2px 3px rgba(0,0,0,0.3), 0 5px 8px rgba(0,0,0,0.2);*/\\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\\n  background-color: white;\\n  border: none;\\n  border-radius: 4px;\\n}\\n[theme=\\\"dark\\\"] div.s3devDDOut.vis {\\n  background-color: #111;\\n}\\n\\ndiv.s3devDDOut.vis ul.s3devDD {\\n  display: block;\\n  border: none;\\n}\\n\\n/* Drop down items */\\n.s3devDD > li {\\n  display: block;\\n  padding: 0.5em 0.3em;\\n  white-space: nowrap;\\n  margin: 0;\\n  font-weight: bold;\\n  text-overflow: ellipsis;\\n  overflow: hidden;\\n}\\n\\n.s3devDD > li > b {\\n  background-color: #aaffaa;\\n  color: black;\\n}\\n\\n/* Drop down items */\\n.s3devDD > li:hover,\\n.s3devDD > li.sel {\\n  color: white;\\n  cursor: pointer;\\n}\\n\\n#s3devDD > li::before {\\n  content: \\\"\\\\25CF   \\\"; /* ● */\\n}\\n\\n.define {\\n  color: rgb(255, 102, 128);\\n}\\n.define:hover,\\n.define.sel {\\n  background-color: rgb(255, 102, 128);\\n}\\n\\n.flag {\\n  color: #4cbf56;\\n}\\n.flag:hover,\\n.flag.sel {\\n  background-color: #4cbf56;\\n}\\n\\n.receive {\\n  color: rgb(255, 191, 0);\\n}\\n.receive:hover,\\n.receive.sel {\\n  background-color: rgb(255, 191, 0);\\n}\\n\\n.event {\\n  color: rgb(255, 191, 0);\\n}\\n.event:hover,\\n.event.sel {\\n  background-color: rgb(255, 191, 0);\\n}\\n\\n.var,\\n.VAR {\\n  color: rgb(255, 120, 26);\\n}\\n.var:hover,\\n.var.sel,\\n.VAR:hover,\\n.VAR.sel {\\n  background-color: rgb(255, 120, 26);\\n}\\n\\n.list,\\n.LIST {\\n  color: rgb(255, 102, 26);\\n}\\n.list:hover,\\n.list.sel,\\n.LIST:hover,\\n.LIST.sel {\\n  background-color: rgb(255, 102, 26);\\n}\\n\\n.costume {\\n  color: rgb(26, 66, 255);\\n}\\n.costume:hover,\\n.costume.sel {\\n  background-color: rgb(26, 66, 255);\\n}\\n\\n.operators {\\n  background-color: rgb(64, 191, 74);\\n  color: rgb(56, 148, 56);\\n}\\n.operators:hover,\\n.operators.sel {\\n  background-color: rgb(56, 148, 56);\\n}\\n\\n.data {\\n  background-color: rgb(255, 140, 26);\\n  color: rgb(219, 110, 0);\\n}\\n.data:hover,\\n.data.sel {\\n  background-color: rgb(219, 110, 0);\\n}\\n\\n.data-lists {\\n  background-color: rgb(255, 102, 26);\\n  color: rgb(255, 102, 26);\\n}\\n.data-lists:hover,\\n.data-lists.sel {\\n  background-color: rgb(207, 81, 20);\\n}\\n\\n.sensing {\\n  background-color: rgb(76, 191, 230);\\n  color: rgb(46, 142, 184);\\n}\\n.sensing:hover,\\n.sensing.sel {\\n  background-color: rgb(46, 142, 184);\\n}\\n\\n.looks {\\n  background-color: rgb(153, 102, 255);\\n  color: rgb(119, 77, 203);\\n}\\n.looks:hover,\\n.looks.sel {\\n  background-color: rgb(119, 77, 203);\\n}\\n\\n.sounds {\\n  background-color: rgb(214, 92, 214);\\n  color: rgb(189, 66, 189);\\n}\\n.sounds:hover,\\n.sounds.sel {\\n  background-color: rgb(189, 66, 189);\\n}\\n\\n.motion {\\n  background-color: rgb(76, 151, 255);\\n  color: rgb(51, 115, 204);\\n}\\n.motion:hover,\\n.motion.sel {\\n  background-color: rgb(51, 115, 204);\\n}\\n\\n.events {\\n  background-color: rgb(255, 213, 0);\\n  color: rgb(204, 153, 0);\\n}\\n.events:hover,\\n.events.sel {\\n  background-color: rgb(204, 153, 0);\\n}\\n\\n.control {\\n  background-color: rgb(255, 171, 25);\\n  color: rgb(207, 139, 23);\\n}\\n.control:hover,\\n.control.sel {\\n  background-color: rgb(207, 139, 23);\\n}\\n\\n.TurboWarp {\\n  background-color: #ff4c4c;\\n  color: rgb(207, 139, 23);\\n}\\n.TurboWarp:hover,\\n.TurboWarp.sel {\\n  background-color: #e64444;\\n}\\n\\n.null {\\n  background-color: rgb(255, 102, 128);\\n  color: rgb(255, 77, 106);\\n}\\n.null:hover,\\n.null.sel {\\n  background-color: rgb(255, 77, 106);\\n}\\n\\n.extension {\\n  background-color: rgb(15 189 140);\\n}\\n.extension:hover,\\n.extension.sel {\\n  background-color: rgb(11 158 117);\\n}\\n\\n/*.s3devDD>li.hat::before {                           content: '◠ ';}*/\\n/*.s3devDD>li.hat::before {                           content: '▲ ';}*/\\n/*.s3devDD>li.block::before {                         content: '■ ';}*/\\n/*.s3devDD>li.reporter::before {                      content: '● ';}*/\\n/*.s3devDD>li.boolean::before {                       content: '◆ ';}*/\\n\\n#s3devIDD > li {\\n  height: 19px;\\n  padding: 3px 8px;\\n  margin: 2px 0.3em;\\n  box-sizing: border-box;\\n  position: relative;\\n  color: white;\\n  font-weight: bold;\\n  width: min-content;\\n}\\n\\n.s3devDD > li.hat {\\n  border-radius: 14px 14px 3px 3px;\\n}\\n.s3devDD > li.block {\\n  border-radius: 3px;\\n}\\n.s3devDD > li.reporter {\\n  border-radius: 10px;\\n}\\n\\n.s3devDD > li.boolean {\\n  width: min-content;\\n}\\n.s3devDD > li.boolean::before {\\n  content: \\\"\\\";\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  width: 0;\\n  height: 0;\\n  border-right: 9px solid transparent;\\n  border-top: 9px solid white;\\n  border-bottom: 10px solid white;\\n}\\n.s3devDD > li.boolean::after {\\n  content: \\\"\\\";\\n  position: absolute;\\n  right: 0;\\n  top: 0;\\n  width: 0;\\n  height: 0;\\n  border-left: 9px solid transparent;\\n  border-top: 9px solid white;\\n  border-bottom: 10px solid white;\\n}\\n[theme=\\\"dark\\\"] .s3devDD > li.boolean::before {\\n  border-top-color: #111;\\n  border-bottom-color: #111;\\n}\\n[theme=\\\"dark\\\"] .s3devDD > li.boolean::after {\\n  border-top-color: #111;\\n  border-bottom-color: #111;\\n}\\n\\n#s3devOverlay {\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  background-color: rgba(80, 80, 80, 0.5);\\n  z-index: 9999;\\n  padding: 10em;\\n  color: white;\\n  font-weight: bold;\\n}\\n\\n.s3devMulti {\\n  font-weight: normal;\\n  position: absolute;\\n  right: 0;\\n  white-space: nowrap;\\n  background-color: inherit;\\n  z-index: 1;\\n  padding: 0;\\n}\\n\\n.s3devNav {\\n  padding: 0 6px;\\n}\\n\\n.s3devNav:hover {\\n  color: #ffff80;\\n}\\n\\n.s3devAction {\\n  margin-left: 2em;\\n  font-size: 12px;\\n  font-weight: bold;\\n  line-height: 2;\\n}\\n\\n@media screen and (max-width: 1180px) {\\n  .s3devAction {\\n    display: none;\\n  }\\n}\\n\\n.s3devHide {\\n  display: none;\\n}\\n\\n.s3dev-mi:hover {\\n  background-color: #d6e9f8;\\n}\\n[theme=\\\"dark\\\"] .s3dev-mi:hover {\\n  background-color: var(--ui-tertiary);\\n}\\n\\n#s3devHelpPop > div {\\n  box-sizing: border-box;\\n  width: 800px;\\n  height: 60vh;\\n  max-height: 800px;\\n  max-width: 85%;\\n  margin: auto;\\n  margin-top: 20vh;\\n}\\n\\n#s3devHelpPop [class*=\\\"modal_header-item-title\\\"] {\\n  margin: 0 -20rem 0 0;\\n}\\n#s3devHelpPop[dir=\\\"rtl\\\"] [class*=\\\"modal_header-item-title\\\"] {\\n  margin: 0 0 0 -20rem;\\n}\\n\\n#s3devHelpContent {\\n  height: calc(100% - 3.125rem);\\n  overflow-y: auto;\\n  padding: 1em 2em 4em;\\n  background-color: white;\\n  user-select: text;\\n}\\n[theme=\\\"dark\\\"] #s3devHelpPop > div {\\n  background: #111;\\n}\\n\\n#s3devFloatingBar {\\n  display: flex;\\n  white-space: nowrap;\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\n\\n  position: absolute;\\n  min-width: 128px;\\n  background-color: white;\\n  border-radius: 4px;\\n  box-shadow: rgba(0, 0, 0, 0.3) 0 0 3px, rgba(0, 0, 0, 0.2) 0 3px 10px;\\n\\n  z-index: 1000001;\\n}\\n[theme=\\\"dark\\\"] #s3devFloatingBar {\\n  background-color: #111;\\n}\\n\\n#s3devInsertLabel {\\n  padding: 0;\\n  align-items: center;\\n}\\n\\n/* Drop down from find button */\\nul#s3devIDD {\\n  max-height: 200px;\\n  margin-bottom: 0;\\n}\\n\\n#s3devIDD > li > b {\\n  background-color: rgba(0, 0, 0, 0.6);\\n  color: white;\\n}\\n\\n[data-highlighted=\\\"true\\\"] {\\n  background-color: hsla(30, 100%, 55%, 1) !important; /* orange */\\n  color: white !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".u-dropdown-searchbar {\\n  width: 100%;\\n  box-sizing: border-box;\\n  /* based on styles for the title input */\\n  color: white;\\n  background-color: hsla(0, 100%, 100%, 0.25);\\n  border: 1px dashed hsla(0, 0%, 0%, 0.15);\\n  padding: 0.5rem;\\n  outline: none;\\n  transition: 0.25s ease-out;\\n  font-size: 13px;\\n  font-weight: bold;\\n  border-radius: 4px;\\n}\\n.u-dropdown-searchbar:hover {\\n  background-color: hsla(0, 100%, 100%, 0.5);\\n}\\n.u-dropdown-searchbar:focus {\\n  background-color: white;\\n  color: black;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class^=\\\"stage-header_stage-button-icon\\\"] {\\n  transform: scaleX(-1);\\n}\\n[class^=\\\"target-pane_target-pane\\\"] {\\n  -webkit-flex-direction: row-reverse;\\n  -ms-flex-direction: row-reverse;\\n  flex-direction: row-reverse;\\n}\\n[dir=\\\"ltr\\\"] [class^=\\\"target-pane_stage-selector-wrapper\\\"] {\\n  margin-left: 0;\\n  margin-right: calc(0.5rem / 2);\\n}\\n[dir=\\\"ltr\\\"] [class^=\\\"sprite-selector_sprite-selector\\\"] {\\n  margin-left: calc(0.5rem / 2);\\n  margin-right: 0;\\n}\\n[dir=\\\"rtl\\\"] [class^=\\\"target-pane_stage-selector-wrapper\\\"] {\\n  margin-right: 0;\\n  margin-left: calc(0.5rem / 2);\\n}\\n[dir=\\\"rtl\\\"] [class^=\\\"sprite-selector_sprite-selector\\\"] {\\n  margin-right: calc(0.5rem / 2);\\n  margin-left: 0;\\n}\\n[class^=\\\"gui_flex-wrapper\\\"] {\\n  -webkit-flex-direction: row-reverse;\\n  -ms-flex-direction: row-reverse;\\n  flex-direction: row-reverse;\\n  overflow-x: hidden;\\n}\\n\\n[dir=\\\"ltr\\\"] [class^=\\\"backpack_backpack-header\\\"] {\\n  border-top-right-radius: 0;\\n  border-top-left-radius: 0.5rem;\\n}\\n[dir=\\\"ltr\\\"] [class^=\\\"blocks_blocks_C530M\\\"] .injectionDiv,\\n[dir=\\\"ltr\\\"] [class^=\\\"asset-panel_wrapper\\\"] {\\n  border-top-right-radius: 0;\\n  border-bottom-right-radius: 0;\\n  border-bottom-left-radius: 0.5rem;\\n}\\n[dir=\\\"ltr\\\"] [class^=\\\"gui_extension-button-container\\\"] {\\n  border-bottom-left-radius: 0.5rem;\\n}\\n\\n[dir=\\\"rtl\\\"] [class^=\\\"backpack_backpack-header\\\"] {\\n  border-top-left-radius: 0;\\n  border-top-right-radius: 0.5rem;\\n}\\n[dir=\\\"rtl\\\"] [class^=\\\"blocks_blocks_C530M\\\"] .injectionDiv,\\n[dir=\\\"rtl\\\"] [class^=\\\"asset-panel_wrapper\\\"] {\\n  border-top-left-radius: 0;\\n  border-bottom-left-radius: 0;\\n  border-bottom-right-radius: 0.5rem;\\n}\\n[dir=\\\"rtl\\\"] [class^=\\\"gui_extension-button-container\\\"] {\\n  border-bottom-right-radius: 0.5rem;\\n}\\n\\n.Popover {\\n  z-index: 40;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"path.blocklyBlockBackground[fill=\\\"#FF6680\\\"],\\npath.blocklyBlockBackground[fill=\\\"#5CB1D6\\\"],\\npath.blocklyBlockBackground[fill=\\\"#FFBF00\\\"],\\ng[data-category] > path.blocklyBlockBackground {\\n  stroke: #0003;\\n}\\ng[data-argument-type=\\\"dropdown\\\"] > path,\\ng[data-argument-type=\\\"dropdown\\\"] > rect,\\ng[data-argument-type=\\\"variable\\\"] > rect,\\ng[data-argument-type=\\\"variable\\\"] > path,\\ng[data-shapes=\\\"c-block c-1 hat\\\"] > g[data-shapes=\\\"stack\\\"]:not(.blocklyDraggable) > path,\\npath[data-argument-type=\\\"boolean\\\"] {\\n  stroke: #0003;\\n  fill: #0001;\\n}\\ng[data-argument-type*=\\\"text\\\"] > path,\\n[data-category] g > line {\\n  stroke: #0002;\\n}\\n.scratchCategoryItemBubble {\\n  border-color: #0003 !important;\\n}\\n\\n#s3devDD > li.extension {\\n  background-color: var(--editorTheme3-PenColor);\\n}\\n\\n.blocklyEditableText rect {\\n  fill: #0001;\\n}\\n\\n.fieldTextInput {\\n  border-color: #0003 !important;\\n}\\n\\n.blocklyBlockBackground[fill=\\\"#FFFFFF\\\"] {\\n  fill: var(--editorTheme3-inputColor);\\n}\\n.blocklyEditableText > text {\\n  fill: var(--editorTheme3-inputColor-text);\\n}\\n.blocklyHtmlInput {\\n  background-color: var(--editorTheme3-inputColor);\\n  color: var(--editorTheme3-inputColor-text);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-folders-contextmenu-container {\\n}\\n\\n.sa-folders-contextmenu-item {\\n  max-width: 250px;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n[sa-folders-context-type=\\\"folder\\\"] > :not(.sa-folders-contextmenu-container) {\\n  display: none;\\n}\\n\", \"\"]);\n\n// exports\n","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".gamepadlib-selector {\\n  width: 100%;\\n  margin-bottom: 3px;\\n}\\n\\n.gamepadlib-content {\\n  display: flex;\\n  flex-direction: row;\\n  flex-wrap: wrap;\\n}\\n.gamepadlib-content-buttons {\\n  padding-right: 10px;\\n}\\n.gamepadlib-content-axes {\\n}\\n\\n.gamepadlib-mapping {\\n  display: flex;\\n  align-items: center;\\n  margin-bottom: 3px;\\n}\\n.gamepadlib-mapping-label {\\n  width: 100px;\\n  text-align: center;\\n}\\n.gamepadlib-keyinput {\\n  text-align: center;\\n  width: 75px;\\n  height: 25px;\\n  border-radius: 0;\\n  border: 1px solid black;\\n  background: white;\\n  color: black;\\n  box-sizing: border-box;\\n  padding: 0;\\n  margin: 0;\\n}\\n.gamepadlib-mapping[data-value=\\\"1\\\"] .gamepadlib-keyinput {\\n  background: yellow;\\n}\\n.gamepadlib-keyinput[data-accepting-input=\\\"true\\\"] {\\n  background: #d6fff9;\\n}\\n.gamepadlib-keyinput[data-empty=\\\"true\\\"]:not([data-accepting-input=\\\"true\\\"]) {\\n  color: #aaa;\\n  font-style: italic;\\n}\\n\\n.gamepadlib-axis {\\n  margin-bottom: 8px;\\n  text-align: center;\\n}\\n.gamepadlib-axis-circle {\\n  position: relative;\\n  width: 150px;\\n  height: 150px;\\n  border: 1px solid black;\\n  overflow: hidden;\\n}\\n.gamepadlib-axis-dot {\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  background-image: url(\" + escape(require(\"./dot.svg\")) + \");\\n  width: 8px;\\n  height: 8px;\\n  transform: translate(-50%, -50%);\\n  pointer-events: none;\\n}\\n.gamepadlib-axis-mapping {\\n  width: 100%;\\n}\\n\\n.gamepadlib-axis-circle-overlay {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n}\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper {\\n  position: absolute;\\n}\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(1) {\\n  left: 50%;\\n  top: 0;\\n  transform: translateX(-50%);\\n}\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(2) {\\n  left: 0;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(3) {\\n  right: 0;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(4) {\\n  left: 50%;\\n  bottom: 0;\\n  transform: translateX(-50%);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-gamepad-container {\\n  margin-right: 0.2rem;\\n}\\n\\n.sa-gamepad-spacer {\\n  display: flex;\\n  width: 100%;\\n  justify-content: flex-end;\\n}\\n\\n.sa-gamepad-popup-outer {\\n  /* above fullscreen */\\n  z-index: 99999;\\n}\\n.sa-gamepad-popup {\\n  box-sizing: border-box;\\n  width: 700px;\\n  max-height: min(800px, 85vh);\\n  height: 100%;\\n  max-width: 85%;\\n  margin: 50px auto;\\n  display: flex;\\n  flex-direction: column;\\n}\\n.sa-gamepad-popup-content {\\n  background-color: white;\\n  padding: 1.5rem 2.25rem;\\n  height: 100%;\\n  overflow-y: auto;\\n}\\n\\n.sa-gamepad-popup [class*=\\\"modal_header-item-title\\\"] {\\n  margin: 0 -20rem 0 0;\\n}\\n\\n.sa-gamepad-cursor {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  z-index: 9999;\\n  user-select: none;\\n  pointer-events: none;\\n  will-change: transform;\\n  image-rendering: optimizeSpeed;\\n  image-rendering: crisp-edges;\\n  image-rendering: pixelated;\\n}\\n.sa-gamepad-cursor-down {\\n  filter: invert(100%);\\n}\\n\\n.sa-gamepad-small .sa-gamepad-container[data-editor-mode=\\\"editor\\\"] {\\n  display: none !important;\\n}\\n\\n.sa-gamepad-hide-cursor [class^=\\\"stage_stage_\\\"] {\\n  cursor: none;\\n}\\n\\n.sa-gamepad-browser-support-warning {\\n  font-weight: bold;\\n  margin-bottom: 10px;\\n}\\n\\n.sa-gamepad-store-settings {\\n  display: none;\\n}\\n.sa-gamepad-store-settings > input {\\n  margin-right: 4px;\\n}\\n.sa-gamepad-has-controller .sa-gamepad-store-settings {\\n  display: block;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".blocklyFlyout,\\n.blocklyFlyoutScrollbar,\\n.sa-lock-image {\\n  transition-property: transform;\\n}\\n\\n.blocklyFlyout.sa-flyoutClose {\\n  transform: translateX(-200px) !important;\\n}\\n\\n.blocklyFlyoutScrollbar.sa-flyoutClose {\\n  transform: translateX(35px) !important;\\n}\\n\\n.sa-lock-image.sa-flyoutClose {\\n  transform: translateX(-260px);\\n}\\n\\n.sa-flyout-placeHolder {\\n  position: absolute;\\n  left: 61px;\\n  top: 44px;\\n  height: 100%;\\n  width: 251px;\\n}\\n\\n.sa-lock-image {\\n  position: absolute;\\n  z-index: 20;\\n  width: 20px;\\n  cursor: pointer;\\n  top: 46px;\\n  left: 280px;\\n}\\n\\n.injectionDiv {\\n  overflow: hidden !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".mediaRecorderPopup {\\n  box-sizing: border-box;\\n  width: 700px;\\n  max-height: min(800px, 80vh);\\n  max-width: 85%;\\n  margin-top: 20vh;\\n  overflow-y: auto;\\n  margin-left: auto;\\n  margin-right: auto;\\n}\\n\\n.mediaRecorderPopup [class*=\\\"modal_header-item-title\\\"] {\\n  margin: 0; /* required because there is no close button */\\n}\\n\\n.mediaRecorderPopupContent {\\n  background-color: white;\\n  padding: 1.5rem 2.25rem;\\n}\\n[theme=\\\"dark\\\"] .mediaRecorderPopupContent {\\n  color: var(--text-primary);\\n  background-color: var(--ui-primary);\\n}\\n\\n.mediaRecorderPopup p {\\n  font-size: 1rem;\\n  margin: 1rem auto;\\n}\\n\\n.mediaRecorderPopup p :last-child {\\n  margin-left: 1rem;\\n}\\n\\n.mediaRecorderPopup[dir=\\\"rtl\\\"] p :last-child {\\n  margin-left: 0;\\n  margin-right: 1rem;\\n}\\n\\n#recordOptionSecondsInput {\\n  width: 6rem;\\n}\\n\\n.mediaRecorderPopupButtons {\\n  margin-top: 1.5rem;\\n}\\n\\n.mediaRecorderPopupButtons button {\\n  margin-left: 0.5rem;\\n}\\n\\n.mediaRecorderPopupButtons button:nth-of-type(1) {\\n  color: black;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".pos-container-container {\\n  display: -webkit-box;\\n  display: -webkit-flex;\\n  display: -ms-flexbox;\\n  display: flex;\\n  -webkit-box-align: center;\\n  -webkit-align-items: center;\\n  -ms-flex-align: center;\\n  align-items: center;\\n  padding: 0.25rem;\\n  -webkit-user-select: none;\\n  -moz-user-select: none;\\n  -ms-user-select: none;\\n  user-select: none;\\n}\\n\\n.pos-container {\\n  font-size: 0.6rem;\\n  font-weight: bold;\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\n  color: #5cb1d6;\\n  white-space: nowrap;\\n}\\n\\n/* Use pseudo elements to avoid firing mutation observers by just moving the cursor */\\n.pos-container > span::after {\\n  content: attr(data-content);\\n}\\n\\n.sa-mouse-pos-small .pos-container-container {\\n  display: none !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-onion-controls-container {\\n  display: flex;\\n  flex-direction: row;\\n  height: calc(1.95rem + 2px);\\n}\\n\\n.sa-onion-button {\\n  position: relative;\\n}\\n.sa-onion-button:focus-within {\\n  background-color: hsla(0, 100%, 65%, 0.2);\\n}\\n.sa-onion-button[data-enabled=\\\"true\\\"] {\\n  background-color: #ff4c4c;\\n}\\n\\n.sa-onion-settings {\\n  position: absolute;\\n  bottom: 0;\\n  right: 16px;\\n  /* based on the styles for the color dropdown */\\n  padding: 4px;\\n  border-radius: 4px;\\n  border: 1px solid #ddd;\\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\\n  transition-property: bottom, opacity;\\n  transition-duration: 500ms;\\n  transition-timing-function: cubic-bezier(0.23, 1, 0.32, 1);\\n  opacity: 0;\\n  pointer-events: none;\\n  background: white;\\n  color: black;\\n}\\n.sa-onion-settings[data-visible=\\\"true\\\"] {\\n  bottom: 16px;\\n  pointer-events: auto;\\n  opacity: 1;\\n}\\n[dir=\\\"rtl\\\"] .sa-onion-settings {\\n  right: initial;\\n  left: 24px;\\n}\\n.sa-onion-settings .sa-onion-button {\\n  border-color: #d9d9d9 !important; /* override dark mode */\\n}\\n\\n.sa-onion-settings-line {\\n  display: flex;\\n  justify-content: flex-end;\\n  align-items: baseline;\\n}\\n\\n.sa-onion-settings-input {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n  box-sizing: border-box;\\n  text-align: center;\\n  border: 0;\\n  background: transparent;\\n  -moz-appearance: textfield;\\n  border: 0;\\n  outline: 0;\\n}\\n\\n.sa-onion-settings-input::-webkit-outer-spin-button,\\n.sa-onion-settings-input::-webkit-inner-spin-button {\\n  -webkit-appearance: none;\\n  margin: 0;\\n}\\n\\n.sa-onion-settings-tip {\\n  position: absolute;\\n  bottom: 0;\\n  transform: translateY(100%);\\n  right: 101px;\\n}\\n[dir=\\\"rtl\\\"] .sa-onion-settings-tip {\\n  right: 118px;\\n}\\n.sa-onion-settings-polygon {\\n  fill: white;\\n  stroke: #ddd;\\n}\\n\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"settings\\\"] {\\n  filter: invert(1);\\n}\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"increment\\\"] {\\n  filter: none;\\n}\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"decrement\\\"] {\\n  filter: none;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".pause-btn {\\n  width: 2rem;\\n  height: 2rem;\\n  padding: 0.375rem;\\n  border-radius: 0.25rem;\\n  -webkit-user-select: none;\\n  -moz-user-select: none;\\n  -ms-user-select: none;\\n  user-select: none;\\n  user-drag: none;\\n  cursor: pointer;\\n}\\n\\n.pause-btn:hover {\\n  background-color: hsla(0, 100%, 65%, 0.15);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class*=\\\"stage_stage\\\"] {\\n  border-radius: 0rem !important;\\n}\\n\\n[class*=\\\"stage_green-flag-overlay-wrapper\\\"] {\\n  border-radius: 0rem !important;\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".blocklySvg > .blocklyWorkspace > .blocklyBlockCanvas > .blocklyDraggable[data-shapes*=\\\"hat\\\"],\\n.blocklyFlyout > .blocklyWorkspace > .blocklyBlockCanvas > .blocklyDraggable {\\n  opacity: calc(1 - var(--transparentOrphans-block) / 100);\\n}\\n.blocklyWsDragSurface > .blocklyBlockCanvas > .blocklyDraggable[data-shapes*=\\\"hat\\\"] {\\n  opacity: calc(1 - var(--transparentOrphans-block) / 100);\\n}\\n\\n.blocklySvg > .blocklyWorkspace > .blocklyBlockCanvas > .blocklyDraggable:not([data-shapes*=\\\"hat\\\"]) {\\n  opacity: calc(1 - var(--transparentOrphans-orphan) / 100);\\n}\\n.blocklyWsDragSurface > .blocklyBlockCanvas > .blocklyDraggable:not([data-shapes*=\\\"hat\\\"]) {\\n  opacity: calc(1 - var(--transparentOrphans-orphan) / 100);\\n}\\n\\n.blocklyBlockDragSurface {\\n  opacity: calc(1 - var(--transparentOrphans-dragged) / 100);\\n}\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class^=\\\"backpack_backpack-container\\\"] {\\n  display: none;\\n}\\n\", \"\"]);\n\n// exports\n","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* Change z-indexes to allow more than 3 tabs */\\n.gui_tab_27Unf.gui_is-selected_sHAiu {\\n  z-index: 10 !important;\\n}\\n.gui_tab_27Unf:nth-of-type(1) {\\n  z-index: 9;\\n}\\n.gui_tab_27Unf:nth-of-type(2) {\\n  z-index: 8;\\n}\\n.gui_tab_27Unf:nth-of-type(3) {\\n  z-index: 7;\\n}\\n.gui_tab_27Unf:nth-of-type(4) {\\n  z-index: 6;\\n}\\n\\n.sa-var-manager {\\n  display: block;\\n  padding: 18px;\\n  /* weird hack to fix scrolling??? */\\n  height: 50px;\\n  overflow-y: auto;\\n}\\n\\n.sa-var-manager-searchbox {\\n  background-image: url(\" + escape(require(\"./search.svg\")) + \");\\n  width: 25%;\\n  margin-bottom: 4px;\\n  padding: 8px;\\n  padding-right: 32px; /* for the text to not overlap the image */\\n  border-radius: 4px;\\n  background-repeat: no-repeat;\\n  background-size: 18px 18px;\\n  background-position: calc(100% - 7px) center;\\n  font-size: 0.75rem;\\n}\\n[theme=\\\"dark\\\"] .sa-var-manager-searchbox {\\n  border-color: #333;\\n}\\n\\n[dir=\\\"rtl\\\"] .sa-var-manager-searchbox {\\n  padding-right: 8px;\\n  padding-left: 32px;\\n  background-position: 7px center;\\n}\\n\\n.sa-var-manager.freeze .sa-var-manager-value *,\\n.sa-var-manager.freeze .sa-var-manager-name * {\\n  opacity: 0.5;\\n}\\n\\n.sa-var-manager.freeze input:focus,\\n.sa-var-manager.freeze textarea:focus {\\n  opacity: 1;\\n}\\n\\n.sa-var-manager-heading {\\n  display: block;\\n  font-weight: bold;\\n  font-size: large;\\n  margin-top: 6px;\\n  margin-bottom: 6px;\\n}\\n\\n.sa-var-manager-name {\\n  word-break: break-word;\\n}\\n\\n.sa-var-manager .sa-var-manager-value {\\n  width: 75%;\\n}\\n\\n.sa-var-manager * > input {\\n  background: none;\\n  border: none;\\n  padding: 8px;\\n  width: 100%;\\n  height: 100%;\\n}\\n\\n.sa-var-manager-value > textarea {\\n  background: none;\\n  border: none;\\n  padding: 8px;\\n  width: 100%;\\n  height: 100%;\\n  line-height: 2em;\\n  resize: none;\\n}\\n\\n.sa-var-manager table {\\n  border-radius: 5px;\\n  border-collapse: collapse;\\n  width: 100%;\\n}\\n\\n.sa-var-manager td {\\n  border: 1px solid rgba(0, 0, 0, 0.15);\\n  text-align: left;\\n}\\n[theme=\\\"dark\\\"] .sa-var-manager td {\\n  border-color: #333;\\n}\\n\\n/* tr:nth-child(even) {\\n    background-color: #dddddd;\\n} */\\n\", \"\"]);\n\n// exports\n","var map = {\n\t\"./2d-color-picker/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/2d-color-picker/style.css\",\n\t\"./block-palette-icons/userstyle.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/block-palette-icons/userstyle.css\",\n\t\"./clones/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/clones/style.css\",\n\t\"./color-picker/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/color-picker/style.css\",\n\t\"./custom-zoom/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/custom-zoom/style.css\",\n\t\"./debugger/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/debugger/style.css\",\n\t\"./drag-drop/dragged-over.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/drag-drop/dragged-over.css\",\n\t\"./editor-colored-context-menus/userscript.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/editor-colored-context-menus/userscript.css\",\n\t\"./editor-devtools/userscript.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/editor-devtools/userscript.css\",\n\t\"./editor-searchable-dropdowns/userscript.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/editor-searchable-dropdowns/userscript.css\",\n\t\"./editor-stage-left/stageleft.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/editor-stage-left/stageleft.css\",\n\t\"./editor-theme3/theme3.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/editor-theme3/theme3.css\",\n\t\"./folders/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/folders/style.css\",\n\t\"./gamepad/gamepadlib.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/gamepad/gamepadlib.css\",\n\t\"./gamepad/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/gamepad/style.css\",\n\t\"./hide-flyout/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/hide-flyout/style.css\",\n\t\"./mediarecorder/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/mediarecorder/style.css\",\n\t\"./mouse-pos/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/mouse-pos/style.css\",\n\t\"./onion-skinning/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/onion-skinning/style.css\",\n\t\"./pause/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/pause/style.css\",\n\t\"./remove-curved-stage-border/remove-borders.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/remove-curved-stage-border/remove-borders.css\",\n\t\"./transparent-orphans/userstyle.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/transparent-orphans/userstyle.css\",\n\t\"./tw-interface-customization/remove-backpack.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/tw-interface-customization/remove-backpack.css\",\n\t\"./variable-manager/style.css\": \"./node_modules/css-loader/index.js!./src/addons/addons/variable-manager/style.css\"\n};\n\n\nfunction webpackAsyncContext(req) {\n\treturn webpackAsyncContextResolve(req).then(function(id) {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nfunction webpackAsyncContextResolve(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\t\treturn map[req];\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.resolve = webpackAsyncContextResolve;\nwebpackAsyncContext.id = \"./src/addons/addons eager recursive ./!./node_modules/css-loader/index.js!./ ^\\\\.\\\\/.*$ include: \\\\.css$\";\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./2d-color-picker/paint-editor\": \"./src/addons/addons/2d-color-picker/paint-editor.js\",\n\t\"./2d-color-picker/paint-editor.js\": \"./src/addons/addons/2d-color-picker/paint-editor.js\",\n\t\"./2d-color-picker/userscript\": \"./src/addons/addons/2d-color-picker/userscript.js\",\n\t\"./2d-color-picker/userscript.js\": \"./src/addons/addons/2d-color-picker/userscript.js\",\n\t\"./bitmap-copy/userscript\": \"./src/addons/addons/bitmap-copy/userscript.js\",\n\t\"./bitmap-copy/userscript.js\": \"./src/addons/addons/bitmap-copy/userscript.js\",\n\t\"./block-switching/blockToDom\": \"./src/addons/addons/block-switching/blockToDom.js\",\n\t\"./block-switching/blockToDom.js\": \"./src/addons/addons/block-switching/blockToDom.js\",\n\t\"./block-switching/userscript\": \"./src/addons/addons/block-switching/userscript.js\",\n\t\"./block-switching/userscript.js\": \"./src/addons/addons/block-switching/userscript.js\",\n\t\"./blocks2image/userscript\": \"./src/addons/addons/blocks2image/userscript.js\",\n\t\"./blocks2image/userscript.js\": \"./src/addons/addons/blocks2image/userscript.js\",\n\t\"./cat-blocks/userscript\": \"./src/addons/addons/cat-blocks/userscript.js\",\n\t\"./cat-blocks/userscript.js\": \"./src/addons/addons/cat-blocks/userscript.js\",\n\t\"./clones/userscript\": \"./src/addons/addons/clones/userscript.js\",\n\t\"./clones/userscript.js\": \"./src/addons/addons/clones/userscript.js\",\n\t\"./color-picker/code-editor\": \"./src/addons/addons/color-picker/code-editor.js\",\n\t\"./color-picker/code-editor.js\": \"./src/addons/addons/color-picker/code-editor.js\",\n\t\"./color-picker/paint-editor\": \"./src/addons/addons/color-picker/paint-editor.js\",\n\t\"./color-picker/paint-editor.js\": \"./src/addons/addons/color-picker/paint-editor.js\",\n\t\"./color-picker/userscript\": \"./src/addons/addons/color-picker/userscript.js\",\n\t\"./color-picker/userscript.js\": \"./src/addons/addons/color-picker/userscript.js\",\n\t\"./custom-block-shape/userscript\": \"./src/addons/addons/custom-block-shape/userscript.js\",\n\t\"./custom-block-shape/userscript.js\": \"./src/addons/addons/custom-block-shape/userscript.js\",\n\t\"./custom-zoom/userscript\": \"./src/addons/addons/custom-zoom/userscript.js\",\n\t\"./custom-zoom/userscript.js\": \"./src/addons/addons/custom-zoom/userscript.js\",\n\t\"./data-category-tweaks-v2/userscript\": \"./src/addons/addons/data-category-tweaks-v2/userscript.js\",\n\t\"./data-category-tweaks-v2/userscript.js\": \"./src/addons/addons/data-category-tweaks-v2/userscript.js\",\n\t\"./debugger/userscript\": \"./src/addons/addons/debugger/userscript.js\",\n\t\"./debugger/userscript.js\": \"./src/addons/addons/debugger/userscript.js\",\n\t\"./drag-drop/userscript\": \"./src/addons/addons/drag-drop/userscript.js\",\n\t\"./drag-drop/userscript.js\": \"./src/addons/addons/drag-drop/userscript.js\",\n\t\"./editor-colored-context-menus/userscript\": \"./src/addons/addons/editor-colored-context-menus/userscript.js\",\n\t\"./editor-colored-context-menus/userscript.js\": \"./src/addons/addons/editor-colored-context-menus/userscript.js\",\n\t\"./editor-devtools/BlockInstance\": \"./src/addons/addons/editor-devtools/BlockInstance.js\",\n\t\"./editor-devtools/BlockInstance.js\": \"./src/addons/addons/editor-devtools/BlockInstance.js\",\n\t\"./editor-devtools/BlockItem\": \"./src/addons/addons/editor-devtools/BlockItem.js\",\n\t\"./editor-devtools/BlockItem.js\": \"./src/addons/addons/editor-devtools/BlockItem.js\",\n\t\"./editor-devtools/DevTools\": \"./src/addons/addons/editor-devtools/DevTools.js\",\n\t\"./editor-devtools/DevTools.js\": \"./src/addons/addons/editor-devtools/DevTools.js\",\n\t\"./editor-devtools/DomHelpers\": \"./src/addons/addons/editor-devtools/DomHelpers.js\",\n\t\"./editor-devtools/DomHelpers.js\": \"./src/addons/addons/editor-devtools/DomHelpers.js\",\n\t\"./editor-devtools/XML\": \"./src/addons/addons/editor-devtools/XML.js\",\n\t\"./editor-devtools/XML.js\": \"./src/addons/addons/editor-devtools/XML.js\",\n\t\"./editor-devtools/blockly/BlockFlasher\": \"./src/addons/addons/editor-devtools/blockly/BlockFlasher.js\",\n\t\"./editor-devtools/blockly/BlockFlasher.js\": \"./src/addons/addons/editor-devtools/blockly/BlockFlasher.js\",\n\t\"./editor-devtools/blockly/UndoGroup\": \"./src/addons/addons/editor-devtools/blockly/UndoGroup.js\",\n\t\"./editor-devtools/blockly/UndoGroup.js\": \"./src/addons/addons/editor-devtools/blockly/UndoGroup.js\",\n\t\"./editor-devtools/blockly/Utils\": \"./src/addons/addons/editor-devtools/blockly/Utils.js\",\n\t\"./editor-devtools/blockly/Utils.js\": \"./src/addons/addons/editor-devtools/blockly/Utils.js\",\n\t\"./editor-devtools/show-broadcast\": \"./src/addons/addons/editor-devtools/show-broadcast.js\",\n\t\"./editor-devtools/show-broadcast.js\": \"./src/addons/addons/editor-devtools/show-broadcast.js\",\n\t\"./editor-devtools/userscript\": \"./src/addons/addons/editor-devtools/userscript.js\",\n\t\"./editor-devtools/userscript.js\": \"./src/addons/addons/editor-devtools/userscript.js\",\n\t\"./editor-searchable-dropdowns/userscript\": \"./src/addons/addons/editor-searchable-dropdowns/userscript.js\",\n\t\"./editor-searchable-dropdowns/userscript.js\": \"./src/addons/addons/editor-searchable-dropdowns/userscript.js\",\n\t\"./editor-sounds/userscript\": \"./src/addons/addons/editor-sounds/userscript.js\",\n\t\"./editor-sounds/userscript.js\": \"./src/addons/addons/editor-sounds/userscript.js\",\n\t\"./editor-stage-left/fix-share-the-love\": \"./src/addons/addons/editor-stage-left/fix-share-the-love.js\",\n\t\"./editor-stage-left/fix-share-the-love.js\": \"./src/addons/addons/editor-stage-left/fix-share-the-love.js\",\n\t\"./editor-theme3/theme3\": \"./src/addons/addons/editor-theme3/theme3.js\",\n\t\"./editor-theme3/theme3.js\": \"./src/addons/addons/editor-theme3/theme3.js\",\n\t\"./folders/userscript\": \"./src/addons/addons/folders/userscript.js\",\n\t\"./folders/userscript.js\": \"./src/addons/addons/folders/userscript.js\",\n\t\"./gamepad/gamepadlib\": \"./src/addons/addons/gamepad/gamepadlib.js\",\n\t\"./gamepad/gamepadlib.js\": \"./src/addons/addons/gamepad/gamepadlib.js\",\n\t\"./gamepad/userscript\": \"./src/addons/addons/gamepad/userscript.js\",\n\t\"./gamepad/userscript.js\": \"./src/addons/addons/gamepad/userscript.js\",\n\t\"./hide-flyout/userscript\": \"./src/addons/addons/hide-flyout/userscript.js\",\n\t\"./hide-flyout/userscript.js\": \"./src/addons/addons/hide-flyout/userscript.js\",\n\t\"./initialise-sprite-position/userscript\": \"./src/addons/addons/initialise-sprite-position/userscript.js\",\n\t\"./initialise-sprite-position/userscript.js\": \"./src/addons/addons/initialise-sprite-position/userscript.js\",\n\t\"./load-extensions/userscript\": \"./src/addons/addons/load-extensions/userscript.js\",\n\t\"./load-extensions/userscript.js\": \"./src/addons/addons/load-extensions/userscript.js\",\n\t\"./mediarecorder/userscript\": \"./src/addons/addons/mediarecorder/userscript.js\",\n\t\"./mediarecorder/userscript.js\": \"./src/addons/addons/mediarecorder/userscript.js\",\n\t\"./mouse-pos/userscript\": \"./src/addons/addons/mouse-pos/userscript.js\",\n\t\"./mouse-pos/userscript.js\": \"./src/addons/addons/mouse-pos/userscript.js\",\n\t\"./mute-project/userscript\": \"./src/addons/addons/mute-project/userscript.js\",\n\t\"./mute-project/userscript.js\": \"./src/addons/addons/mute-project/userscript.js\",\n\t\"./onion-skinning/userscript\": \"./src/addons/addons/onion-skinning/userscript.js\",\n\t\"./onion-skinning/userscript.js\": \"./src/addons/addons/onion-skinning/userscript.js\",\n\t\"./pause/module\": \"./src/addons/addons/pause/module.js\",\n\t\"./pause/module.js\": \"./src/addons/addons/pause/module.js\",\n\t\"./pause/userscript\": \"./src/addons/addons/pause/userscript.js\",\n\t\"./pause/userscript.js\": \"./src/addons/addons/pause/userscript.js\",\n\t\"./remove-sprite-confirm/userscript\": \"./src/addons/addons/remove-sprite-confirm/userscript.js\",\n\t\"./remove-sprite-confirm/userscript.js\": \"./src/addons/addons/remove-sprite-confirm/userscript.js\",\n\t\"./tw-interface-customization/remove-backpack\": \"./src/addons/addons/tw-interface-customization/remove-backpack.js\",\n\t\"./tw-interface-customization/remove-backpack.js\": \"./src/addons/addons/tw-interface-customization/remove-backpack.js\",\n\t\"./tw-project-info/blockcount\": \"./src/addons/addons/tw-project-info/blockcount.js\",\n\t\"./tw-project-info/blockcount.js\": \"./src/addons/addons/tw-project-info/blockcount.js\",\n\t\"./variable-manager/userscript\": \"./src/addons/addons/variable-manager/userscript.js\",\n\t\"./variable-manager/userscript.js\": \"./src/addons/addons/variable-manager/userscript.js\"\n};\n\n\nfunction webpackAsyncContext(req) {\n\treturn webpackAsyncContextResolve(req).then(__webpack_require__);\n}\nfunction webpackAsyncContextResolve(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\t\treturn map[req];\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.resolve = webpackAsyncContextResolve;\nwebpackAsyncContext.id = \"./src/addons/addons eager recursive ^\\\\.\\\\/.*$ include: \\\\.js$\";\nmodule.exports = webpackAsyncContext;","module.exports = __webpack_public_path__ + \"static/assets/1d88d0fb1688305cd93cb879e0eb83da.png\";","/* inserted by pull.js */\nimport _twAsset0 from \"./assets/sv-gr.png\";\nconst _twGetAsset = (path) => {\n  if (path === \"/assets/sv-gr.png\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\n// this script was happily stolen from the color-picker addon, developed by Richie Bendall and apple502j\n\n// import required libraries\nimport { normalizeHex } from \"../../libraries/common/cs/normalize-color.js\";\nimport RateLimiter from \"../../libraries/common/cs/rate-limiter.js\";\nimport tinycolor from \"../../libraries/thirdparty/cs/tinycolor-min.js\";\n\nexport default async ({ addon, console, msg }) => {\n  let prevEventHandler;\n  // 250-ms rate limit\n  const rateLimiter = new RateLimiter(250);\n\n  // get the color from scratch\n  const getColor = (element) => {\n    let fillOrStroke;\n    const state = addon.tab.redux.state;\n    if (state.scratchPaint.modals.fillColor) {\n      fillOrStroke = \"fill\";\n    } else if (state.scratchPaint.modals.strokeColor) {\n      fillOrStroke = \"stroke\";\n    } else {\n      return;\n    }\n    const colorType = state.scratchPaint.fillMode.colorIndex;\n    const primaryOrSecondary = [\"primary\", \"secondary\"][colorType];\n    const color = state.scratchPaint.color[`${fillOrStroke}Color`][primaryOrSecondary];\n    if (color === null || color === \"scratch-paint/style-path/mixed\") return;\n    // This value can be arbitrary - it can be HEX, RGB, etc.\n    // Use tinycolor to convert them.\n    return tinycolor(color).toHex8();\n  };\n\n  // load the new color to scratch\n  const setColor = (hex, element) => {\n    hex = normalizeHex(hex);\n    if (!addon.tab.redux.state || !addon.tab.redux.state.scratchPaint) return;\n    // The only way to reliably set color is to invoke eye dropper via click()\n    // then faking that the eye dropper reported the value.\n    const onEyeDropperOpened = ({ detail }) => {\n      if (detail.action.type !== \"scratch-paint/eye-dropper/ACTIVATE_COLOR_PICKER\") return;\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperOpened);\n      setTimeout(() => {\n        const previousTool = addon.tab.redux.state.scratchPaint.color.eyeDropper.previousTool;\n        if (previousTool) previousTool.activate();\n        addon.tab.redux.state.scratchPaint.color.eyeDropper.callback(hex);\n        addon.tab.redux.dispatch({\n          type: \"scratch-paint/eye-dropper/DEACTIVATE_COLOR_PICKER\",\n        });\n      }, 50);\n    };\n    addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperOpened);\n    element.children[1].children[0].click();\n  };\n\n  // for the color picker's background color\n  const convertToGeneralColor = (hex) => {\n    let h = tinycolor(hex).toHsv();\n    h.s = 1;\n    h.v = 1;\n    return tinycolor(h).toHex();\n  };\n\n  // le loop\n  while (true) {\n    // wait for color dialog box appearance\n    const element = await addon.tab.waitForElement('div[class*=\"color-picker_swatch-row\"]', {\n      markAsSeen: true,\n      reduxCondition: (state) => state.scratchGui.editorTab.activeTabIndex === 1 && !state.scratchGui.mode.isPlayerOnly,\n    });\n    rateLimiter.abort(false);\n\n    // update the bg color of the picker\n    function updateColor() {\n      rateLimiter.limit(() => {\n        let c = getColor(element);\n        let chsv = tinycolor(c).toHsv();\n        updateHandleFinal(chsv.s, chsv.v);\n        saColorPicker.style.background = \"#\" + convertToGeneralColor(getColor(element));\n      });\n    }\n\n    // redux stuff\n    addon.tab.redux.initialize();\n    addon.tab.redux.addEventListener(\"statechanged\", (e) =>\n      e.detail.action.type === \"scratch-paint/fill-style/CHANGE_FILL_COLOR\" ||\n      e.detail.action.type === \"scratch-paint/fill-style/CHANGE_FILL_COLOR_2\" ||\n      e.detail.action.type === \"scratch-paint/stroke-style/CHANGE_STROKE_COLOR\" ||\n      e.detail.action.type === \"scratch-paint/stroke-style/CHANGE_STROKE_COLOR_2\"\n        ? updateColor()\n        : 0\n    );\n    if (addon.tab.redux && typeof prevEventHandler === \"function\") {\n      addon.tab.redux.removeEventListener(\"statechanged\", prevEventHandler);\n      prevEventHandler = null;\n    }\n\n    // get the color\n    if (addon.tab.editorMode !== \"editor\") continue;\n    let defaultColor = getColor(element);\n\n    // create the color picker element and all it's child elements\n    const saColorPicker = document.createElement(\"div\");\n    saColorPicker.className = \"sa-2dcolor-picker\";\n    saColorPicker.style.background = \"#\" + convertToGeneralColor(defaultColor || \"ff0000\");\n\n    const saColorPickerImage = Object.assign(document.createElement(\"img\"), {\n      className: \"sa-2dcolor-picker-image\",\n      src: _twGetAsset(\"/assets/sv-gr.png\"),\n      draggable: false,\n    });\n    const saColorPickerHandle = Object.assign(document.createElement(\"div\"), {\n      className: addon.tab.scratchClass(\"slider_handle\"),\n    });\n    saColorPickerHandle.style.pointerEvents = \"none\";\n\n    // create the label\n    const saColorLabel = document.createElement(\"div\");\n    saColorLabel.className = addon.tab.scratchClass(\"color-picker_row-header\", { others: \"sa-2dcolor-label\" });\n    const saColorLabelName = document.createElement(\"span\");\n    saColorLabelName.className = addon.tab.scratchClass(\"color-picker_label-name\", { others: \"sa-2dcolor-label-name\" });\n    saColorLabelName.innerText = msg(\"shade\");\n    const saColorLabelVal = document.createElement(\"span\");\n    saColorLabelVal.className = addon.tab.scratchClass(\"color-picker_label-readout\", {\n      others: \"sa-2dcolor-label-val\",\n    });\n    saColorLabel.appendChild(saColorLabelName);\n    saColorLabel.appendChild(saColorLabelVal);\n\n    let keyPressed = -1;\n    let originalPos = { x: 0, y: 0 };\n    window.addEventListener(\"keydown\", (e) => (keyPressed = e.keyCode));\n    window.addEventListener(\"keyup\", () => (keyPressed = -1));\n\n    let origHue = 0;\n    let el = null;\n\n    let mousemovefunc = function (e) {\n      updateHandle(e, keyPressed, originalPos);\n      return false;\n    };\n\n    let mouseupfunc = function (e) {\n      updateFinal(e, keyPressed, originalPos);\n    };\n\n    function updateHandle(e, keyPressed, originalPos) {\n      let cx = Math.min(Math.max(e.clientX - saColorPicker.getBoundingClientRect().x, 0), 150);\n      let cy = Math.min(Math.max(e.clientY - saColorPicker.getBoundingClientRect().y, 0), 150);\n      if (keyPressed === 16) {\n        if (Math.abs(cx - originalPos.x) > Math.abs(cy - originalPos.y)) cy = originalPos.y;\n        else cx = originalPos.x;\n      }\n      saColorPickerHandle.style.left = cx - 8 + \"px\";\n      saColorPickerHandle.style.top = cy - 8 + \"px\";\n      saColorLabelVal.innerText = `${Math.round((cx / 150) * 100)}, ${100 - Math.round((cy / 150) * 100)}`;\n\n      //update color in real-time (i only bothered to do that for solid colors)\n      if (\n        (!addon.tab.redux.state.scratchPaint.fillMode.gradientType ||\n          addon.tab.redux.state.scratchPaint.fillMode.gradientType === \"SOLID\") &&\n        el\n      ) {\n        let c = tinycolor({ h: origHue, s: cx / 150, v: 1 - cy / 150 }).toHex();\n        if (c.startsWith(\"#\")) el.style.background = c;\n        else el.style.background = \"#\" + c;\n      }\n    }\n\n    function updateHandleFinal(s, v) {\n      saColorPickerHandle.style.left = s * 150 - 8 + \"px\";\n      saColorPickerHandle.style.top = (1 - v) * 150 - 8 + \"px\";\n      saColorLabelVal.innerText = `${Math.round(s * 100)}, ${Math.round(v * 100)}`;\n    }\n\n    function updateFinal(e, keyPressed, originalPos) {\n      rateLimiter.limit(() => {\n        let ox = Math.min(Math.max(e.clientX - saColorPicker.getBoundingClientRect().x, 0), 150);\n        let oy = Math.min(Math.max(e.clientY - saColorPicker.getBoundingClientRect().y, 0), 150);\n        if (keyPressed === 16) {\n          if (Math.abs(ox - originalPos.x) > Math.abs(oy - originalPos.y)) oy = originalPos.y;\n          else ox = originalPos.x;\n        }\n\n        let color = tinycolor(getColor(element)).toHsv();\n        let s = ox / 150;\n        let v = 1 - oy / 150;\n        let newColor = tinycolor({ h: color.h, s: s, v: v, a: color.a }).toHex8();\n        setColor(newColor, element);\n        updateHandleFinal(s, v);\n      });\n\n      window.removeEventListener(\"pointermove\", mousemovefunc);\n      window.removeEventListener(\"pointerup\", mouseupfunc);\n    }\n\n    if (defaultColor) {\n      let defaultHexColor = tinycolor(defaultColor).toHsv();\n      updateHandleFinal(defaultHexColor.s, defaultHexColor.v);\n    } else updateHandleFinal(1, 1);\n\n    saColorPicker.addEventListener(\"pointerdown\", (e) => {\n      e.preventDefault();\n\n      originalPos = {\n        x: parseFloat(saColorPickerHandle.style.left) + 8,\n        y: parseFloat(saColorPickerHandle.style.top) + 8,\n      };\n\n      let fillOrStroke;\n      const state = addon.tab.redux.state;\n      if (state.scratchPaint.modals.fillColor) {\n        fillOrStroke = \"fill\";\n      } else if (state.scratchPaint.modals.strokeColor) {\n        fillOrStroke = \"stroke\";\n      } else {\n        fillOrStroke = \"wh\";\n      }\n\n      el = null;\n      if (fillOrStroke === \"fill\")\n        el = document.getElementsByClassName(addon.tab.scratchClass(\"color-button_color-button-swatch\"))[0];\n      else if (fillOrStroke === \"stroke\")\n        el = document.getElementsByClassName(addon.tab.scratchClass(\"color-button_color-button-swatch\"))[1];\n      if (el) origHue = tinycolor(el.style.background).toHsv().h;\n\n      updateHandle(e);\n\n      window.addEventListener(\"pointermove\", mousemovefunc);\n      window.addEventListener(\"pointerup\", mouseupfunc);\n    });\n    prevEventHandler = ({ detail }) => {\n      if (detail.action.type === \"scratch-paint/color-index/CHANGE_COLOR_INDEX\") {\n        setTimeout(() => {\n          updateColor();\n        }, 100);\n      }\n    };\n    addon.tab.redux.addEventListener(\"statechanged\", prevEventHandler);\n    saColorPicker.appendChild(saColorPickerImage);\n    saColorPicker.appendChild(saColorPickerHandle);\n\n    const [colorSlider, saturationSlider, brightnessSlider] = [\n      ...element.parentElement.querySelectorAll('[class^=\"color-picker_row-header\"]'),\n    ].map((i) => i.parentElement);\n    saturationSlider.style.display = \"none\";\n    brightnessSlider.style.display = \"none\";\n    colorSlider.insertAdjacentElement(\"afterend\", saColorPicker);\n    colorSlider.insertAdjacentElement(\"afterend\", saColorLabel);\n  }\n};\n","import paintEditorHandler from \"./paint-editor.js\";\n\nexport default async (api) => {\n  paintEditorHandler(api);\n};\n","export default async ({ addon, console }) => {\n  if (!addon.tab.redux.state) return console.warn(\"Redux is not available!\");\n  addon.tab.redux.initialize();\n  addon.tab.redux.addEventListener(\"statechanged\", ({ detail }) => {\n    const e = detail;\n    if (!e.action || e.action.type !== \"scratch-paint/clipboard/SET\") return;\n    const items = e.next.scratchPaint.clipboard.items;\n    if (items.length !== 1) return;\n    const firstItem = items[0];\n    // TODO vector support\n    if (!Array.isArray(firstItem) || firstItem[0] !== \"Raster\") return console.log(\"copied element is vector\");\n    const dataURL = firstItem[1].source;\n    addon.tab\n      .copyImage(dataURL)\n      .then(() => console.log(\"Image successfully copied\"))\n      .catch((e) => console.error(`Image could not be copied: ${e}`));\n  });\n};\n","module.exports = __webpack_public_path__ + \"static/assets/318e019bdee5ed02903aa5f22a9903f2.svg\";","module.exports = __webpack_public_path__ + \"static/assets/e1249124e702a974df36355af6aa2385.svg\";","module.exports = __webpack_public_path__ + \"static/assets/9d7acb2e5784a9a1d52e564af3d8469b.svg\";","module.exports = __webpack_public_path__ + \"static/assets/bd6d382729ecbd23c5181cf2b327072f.svg\";","module.exports = __webpack_public_path__ + \"static/assets/e008ee0cb1202de1137823150da1644a.svg\";","module.exports = __webpack_public_path__ + \"static/assets/c088896fb05dc466b45ecaa1d5c4d007.svg\";","module.exports = __webpack_public_path__ + \"static/assets/ab2c140af0ffba6b515eebc2156742e2.svg\";","module.exports = __webpack_public_path__ + \"static/assets/7601fa61034e5d7d542538e1e4338a4e.svg\";","module.exports = __webpack_public_path__ + \"static/assets/7b98085c05bdcd97dd0c6d4b34317793.svg\";","module.exports = __webpack_public_path__ + \"static/assets/ce8ffc09dce132288116ec7d5a2d5f56.svg\";","module.exports = __webpack_public_path__ + \"static/assets/4bfaa15915bc5fb88b40b3e1a537c3ea.svg\";","/**\n * This file is imported from https://github.com/LLK/scratch-blocks/\n * It has been cleaned up and unnecessary functions have been removed.\n * Original license is below.\n *\n * @license\n * Visual Blocks Editor\n *\n * Copyright 2012 Google Inc.\n * https://developers.google.com/blockly/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable */\n\nconst INPUT_VALUE = 1;\nconst NEXT_STATEMENT = 3;\nconst DUMMY_INPUT = 5;\n\n// Partially implements goog.dom.createDom.\nconst createDom = function (tagName, /* unused */ _params, children) {\n  const element = document.createElement(tagName);\n  if (children !== undefined) {\n    if (!Array.isArray(children)) {\n      children = [children];\n    }\n    for (const child of children) {\n      if (typeof child === \"string\") {\n        element.appendChild(document.createTextNode(child));\n      } else {\n        element.appendChild(child);\n      }\n    }\n  }\n  return element;\n};\n\n// Partially implements goog.dom.removeNode\nconst removeNode = (node) => {\n  if (node.parentNode) {\n    node.parentNode.removeChild(node);\n  }\n};\n\nconst fieldToDomVariable_ = function (field) {\n  // The field had not been initialized fully before being serialized.\n  // This can happen if a block is created directly through a call to\n  // workspace.newBlock instead of from XML.\n  // The new block will be serialized for the first time when firing a block\n  // creation event.\n  if (field.getValue() == null) {\n    field.initModel();\n  }\n  // Get the variable directly from the field, instead of doing a lookup.  This\n  // will work even if the variable has already been deleted.  This can happen\n  // because the flyout defers deleting blocks until the next time the flyout is\n  // opened.\n  var variable = field.getVariable();\n\n  if (!variable) {\n    throw Error(\"Tried to serialize a variable field with no variable.\");\n  }\n  var container = createDom(\"field\", null, variable.name);\n  container.setAttribute(\"name\", field.name);\n  container.setAttribute(\"id\", variable.getId());\n  container.setAttribute(\"variabletype\", variable.type);\n  return container;\n};\n\nconst fieldToDom_ = function (field) {\n  if (field.name && field.SERIALIZABLE) {\n    if (field.referencesVariables()) {\n      return fieldToDomVariable_(field);\n    } else {\n      var container = createDom(\"field\", null, field.getValue());\n      container.setAttribute(\"name\", field.name);\n      return container;\n    }\n  }\n  return null;\n};\n\nconst allFieldsToDom_ = function (block, element) {\n  for (var i = 0, input; (input = block.inputList[i]); i++) {\n    for (var j = 0, field; (field = input.fieldRow[j]); j++) {\n      var fieldDom = fieldToDom_(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n};\n\nconst blockToDom = function (block, opt_noId) {\n  var element = createDom(block.isShadow() ? \"shadow\" : \"block\");\n  element.setAttribute(\"type\", block.type);\n  if (!opt_noId) {\n    element.setAttribute(\"id\", block.id);\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    var mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom_(block, element);\n\n  scratchCommentToDom_(block, element);\n\n  if (block.data) {\n    var dataElement = createDom(\"data\", null, block.data);\n    element.appendChild(dataElement);\n  }\n\n  for (var i = 0, input; (input = block.inputList[i]); i++) {\n    var container;\n    var empty = true;\n    if (input.type == DUMMY_INPUT) {\n      continue;\n    } else {\n      var childBlock = input.connection.targetBlock();\n      if (input.type == INPUT_VALUE) {\n        container = createDom(\"value\");\n      } else if (input.type == NEXT_STATEMENT) {\n        container = createDom(\"statement\");\n      }\n      var shadow = input.connection.getShadowDom();\n      if (shadow && (!childBlock || !childBlock.isShadow())) {\n        var shadowClone = cloneShadow_(shadow);\n        // Remove the ID from the shadow dom clone if opt_noId\n        // is specified to true.\n        if (opt_noId && shadowClone.getAttribute(\"id\")) {\n          shadowClone.removeAttribute(\"id\");\n        }\n        container.appendChild(shadowClone);\n      }\n      if (childBlock) {\n        container.appendChild(blockToDom(childBlock, opt_noId));\n        empty = false;\n      }\n    }\n    container.setAttribute(\"name\", input.name);\n    if (!empty) {\n      element.appendChild(container);\n    }\n  }\n  if (block.inputsInlineDefault != block.inputsInline) {\n    element.setAttribute(\"inline\", block.inputsInline);\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute(\"collapsed\", true);\n  }\n  if (block.disabled) {\n    element.setAttribute(\"disabled\", true);\n  }\n  if (!block.isDeletable() && !block.isShadow()) {\n    element.setAttribute(\"deletable\", false);\n  }\n  if (!block.isMovable() && !block.isShadow()) {\n    element.setAttribute(\"movable\", false);\n  }\n  if (!block.isEditable()) {\n    element.setAttribute(\"editable\", false);\n  }\n\n  var nextBlock = block.getNextBlock();\n  if (nextBlock) {\n    var container = createDom(\"next\", null, blockToDom(nextBlock, opt_noId));\n    element.appendChild(container);\n  }\n  var shadow = block.nextConnection && block.nextConnection.getShadowDom();\n  if (shadow && (!nextBlock || !nextBlock.isShadow())) {\n    container.appendChild(cloneShadow_(shadow));\n  }\n\n  return element;\n};\n\nconst scratchCommentToDom_ = function (block, element) {\n  var commentText = block.getCommentText();\n  if (commentText) {\n    var commentElement = createDom(\"comment\", null, commentText);\n    if (typeof block.comment == \"object\") {\n      commentElement.setAttribute(\"id\", block.comment.id);\n      commentElement.setAttribute(\"pinned\", block.comment.isVisible());\n      var hw;\n      // TODO: scratch-blocks uses `block.comment instanceof Blockly.ScratchBlockComment`\n      if (block.comment.getHeightWidth) {\n        hw = block.comment.getHeightWidth();\n      } else {\n        hw = block.comment.getBubbleSize();\n      }\n      commentElement.setAttribute(\"h\", hw.height);\n      commentElement.setAttribute(\"w\", hw.width);\n      var xy = block.comment.getXY();\n      commentElement.setAttribute(\"x\", xy.x);\n      commentElement.setAttribute(\"y\", xy.y);\n      commentElement.setAttribute(\"minimized\", block.comment.isMinimized());\n    }\n    element.appendChild(commentElement);\n  }\n};\n\nconst cloneShadow_ = function (shadow) {\n  shadow = shadow.cloneNode(true);\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  var node = shadow;\n  var textNode;\n  while (node) {\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (textNode.nodeType == 3 && textNode.data.trim() == \"\" && node.firstChild != textNode) {\n          // Prune whitespace after a tag.\n          removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (textNode.nodeType == 3 && textNode.data.trim() == \"\") {\n          // Prune whitespace before a tag.\n          removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n};\n\nconst blockToDomWithXY = (block) => {\n  const xml = blockToDom(block, false);\n  const position = block.getRelativeToSurfaceXY();\n  xml.setAttribute(\"x\", Math.round(block.workspace.RTL ? -position.x : position.x));\n  xml.setAttribute(\"y\", Math.round(position.y));\n  return xml;\n};\n\nexport default blockToDomWithXY;\n","import blockToDom from \"./blockToDom.js\";\n\nexport default async function ({ addon, global, console, msg }) {\n  await addon.tab.traps.getBlockly();\n\n  const blockSwitches = {};\n\n  const noopSwitch = {\n    opcode: \"noop\",\n  };\n\n  if (addon.settings.get(\"motion\")) {\n    blockSwitches[\"motion_turnright\"] = [\n      noopSwitch,\n      {\n        opcode: \"motion_turnleft\",\n      },\n    ];\n    blockSwitches[\"motion_turnleft\"] = [\n      {\n        opcode: \"motion_turnright\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"motion_setx\"] = [\n      noopSwitch,\n      {\n        opcode: \"motion_changexby\",\n        remap: { X: \"DX\" },\n      },\n      {\n        opcode: \"motion_sety\",\n        remap: { X: \"Y\" },\n      },\n      {\n        opcode: \"motion_changeyby\",\n        remap: { X: \"DY\" },\n      },\n    ];\n    blockSwitches[\"motion_changexby\"] = [\n      {\n        opcode: \"motion_setx\",\n        remap: { DX: \"X\" },\n      },\n      noopSwitch,\n      {\n        opcode: \"motion_sety\",\n        remap: { DX: \"Y\" },\n      },\n      {\n        opcode: \"motion_changeyby\",\n        remap: { DX: \"DY\" },\n      },\n    ];\n    blockSwitches[\"motion_sety\"] = [\n      {\n        opcode: \"motion_setx\",\n        remap: { Y: \"X\" },\n      },\n      {\n        opcode: \"motion_changexby\",\n        remap: { Y: \"DX\" },\n      },\n      noopSwitch,\n      {\n        opcode: \"motion_changeyby\",\n        remap: { Y: \"DY\" },\n      },\n    ];\n    blockSwitches[\"motion_changeyby\"] = [\n      {\n        opcode: \"motion_setx\",\n        remap: { DY: \"X\" },\n      },\n      {\n        opcode: \"motion_changexby\",\n        remap: { DY: \"DX\" },\n      },\n      {\n        opcode: \"motion_sety\",\n        remap: { DY: \"Y\" },\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"motion_xposition\"] = [\n      noopSwitch,\n      {\n        opcode: \"motion_yposition\",\n      },\n    ];\n    blockSwitches[\"motion_yposition\"] = [\n      {\n        opcode: \"motion_xposition\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"looks\")) {\n    blockSwitches[\"looks_seteffectto\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_changeeffectby\",\n        remap: { VALUE: \"CHANGE\" },\n      },\n    ];\n    blockSwitches[\"looks_changeeffectby\"] = [\n      {\n        opcode: \"looks_seteffectto\",\n        remap: { CHANGE: \"VALUE\" },\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_setsizeto\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_changesizeby\",\n        remap: { SIZE: \"CHANGE\" },\n      },\n    ];\n    blockSwitches[\"looks_changesizeby\"] = [\n      {\n        opcode: \"looks_setsizeto\",\n        remap: { CHANGE: \"SIZE\" },\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_costumenumbername\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_backdropnumbername\",\n      },\n    ];\n    blockSwitches[\"looks_backdropnumbername\"] = [\n      {\n        opcode: \"looks_costumenumbername\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_show\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_hide\",\n      },\n    ];\n    blockSwitches[\"looks_hide\"] = [\n      {\n        opcode: \"looks_show\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_nextcostume\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_nextbackdrop\",\n      },\n    ];\n    blockSwitches[\"looks_nextbackdrop\"] = [\n      {\n        opcode: \"looks_nextcostume\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_think\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_say\",\n      },\n    ];\n    blockSwitches[\"looks_say\"] = [\n      {\n        opcode: \"looks_think\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_thinkforsecs\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_sayforsecs\",\n      },\n    ];\n    blockSwitches[\"looks_sayforsecs\"] = [\n      {\n        opcode: \"looks_thinkforsecs\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"looks_switchbackdropto\"] = [\n      noopSwitch,\n      {\n        opcode: \"looks_switchbackdroptoandwait\",\n      },\n    ];\n    blockSwitches[\"looks_switchbackdroptoandwait\"] = [\n      {\n        opcode: \"looks_switchbackdropto\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"sound\")) {\n    blockSwitches[\"sound_play\"] = [\n      noopSwitch,\n      {\n        opcode: \"sound_playuntildone\",\n      },\n    ];\n    blockSwitches[\"sound_playuntildone\"] = [\n      {\n        opcode: \"sound_play\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"sound_seteffectto\"] = [\n      noopSwitch,\n      {\n        opcode: \"sound_changeeffectby\",\n      },\n    ];\n    blockSwitches[\"sound_changeeffectby\"] = [\n      {\n        opcode: \"sound_seteffectto\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"sound_setvolumeto\"] = [\n      noopSwitch,\n      {\n        opcode: \"sound_changevolumeby\",\n      },\n    ];\n    blockSwitches[\"sound_changevolumeby\"] = [\n      {\n        opcode: \"sound_setvolumeto\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"event\")) {\n    blockSwitches[\"event_broadcast\"] = [\n      noopSwitch,\n      {\n        opcode: \"event_broadcastandwait\",\n      },\n    ];\n    blockSwitches[\"event_broadcastandwait\"] = [\n      {\n        opcode: \"event_broadcast\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"control\")) {\n    blockSwitches[\"control_if\"] = [\n      noopSwitch,\n      {\n        opcode: \"control_if_else\",\n      },\n    ];\n    blockSwitches[\"control_if_else\"] = [\n      {\n        opcode: \"control_if\",\n        remap: { SUBSTACK2: \"split\" },\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"control_repeat_until\"] = [\n      noopSwitch,\n      {\n        opcode: \"control_wait_until\",\n        remap: { SUBSTACK: \"split\" },\n      },\n      {\n        opcode: \"control_forever\",\n        remap: { CONDITION: \"split\" },\n      },\n    ];\n    blockSwitches[\"control_forever\"] = [\n      {\n        opcode: \"control_repeat_until\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"control_wait_until\"] = [\n      {\n        opcode: \"control_repeat_until\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"operator\")) {\n    blockSwitches[\"operator_equals\"] = [\n      {\n        opcode: \"operator_gt\",\n      },\n      noopSwitch,\n      {\n        opcode: \"operator_lt\",\n      },\n    ];\n    blockSwitches[\"operator_gt\"] = [\n      noopSwitch,\n      {\n        opcode: \"operator_equals\",\n      },\n      {\n        opcode: \"operator_lt\",\n      },\n    ];\n    blockSwitches[\"operator_lt\"] = [\n      {\n        opcode: \"operator_gt\",\n      },\n      {\n        opcode: \"operator_equals\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"operator_add\"] = [\n      noopSwitch,\n      {\n        opcode: \"operator_subtract\",\n      },\n      {\n        opcode: \"operator_multiply\",\n      },\n      {\n        opcode: \"operator_divide\",\n      },\n      {\n        opcode: \"operator_mod\",\n      },\n    ];\n    blockSwitches[\"operator_subtract\"] = [\n      {\n        opcode: \"operator_add\",\n      },\n      noopSwitch,\n      {\n        opcode: \"operator_multiply\",\n      },\n      {\n        opcode: \"operator_divide\",\n      },\n      {\n        opcode: \"operator_mod\",\n      },\n    ];\n    blockSwitches[\"operator_multiply\"] = [\n      {\n        opcode: \"operator_add\",\n      },\n      {\n        opcode: \"operator_subtract\",\n      },\n      noopSwitch,\n      {\n        opcode: \"operator_divide\",\n      },\n      {\n        opcode: \"operator_mod\",\n      },\n    ];\n    blockSwitches[\"operator_divide\"] = [\n      {\n        opcode: \"operator_add\",\n      },\n      {\n        opcode: \"operator_subtract\",\n      },\n      {\n        opcode: \"operator_multiply\",\n      },\n      noopSwitch,\n      {\n        opcode: \"operator_mod\",\n      },\n    ];\n    blockSwitches[\"operator_mod\"] = [\n      {\n        opcode: \"operator_add\",\n      },\n      {\n        opcode: \"operator_subtract\",\n      },\n      {\n        opcode: \"operator_multiply\",\n      },\n      {\n        opcode: \"operator_divide\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"operator_and\"] = [\n      noopSwitch,\n      {\n        opcode: \"operator_or\",\n      },\n    ];\n    blockSwitches[\"operator_or\"] = [\n      {\n        opcode: \"operator_and\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"sensing\")) {\n    blockSwitches[\"sensing_mousex\"] = [\n      noopSwitch,\n      {\n        opcode: \"sensing_mousey\",\n      },\n    ];\n    blockSwitches[\"sensing_mousey\"] = [\n      {\n        opcode: \"sensing_mousex\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"data\")) {\n    blockSwitches[\"data_setvariableto\"] = [\n      noopSwitch,\n      {\n        opcode: \"data_changevariableby\",\n        remapValueType: { VALUE: \"math_number\" },\n      },\n    ];\n    blockSwitches[\"data_changevariableby\"] = [\n      {\n        opcode: \"data_setvariableto\",\n        remapValueType: { VALUE: \"text\" },\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"data_showvariable\"] = [\n      noopSwitch,\n      {\n        opcode: \"data_hidevariable\",\n      },\n    ];\n    blockSwitches[\"data_hidevariable\"] = [\n      {\n        opcode: \"data_showvariable\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"data_showlist\"] = [\n      noopSwitch,\n      {\n        opcode: \"data_hidelist\",\n      },\n    ];\n    blockSwitches[\"data_hidelist\"] = [\n      {\n        opcode: \"data_showlist\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"data_replaceitemoflist\"] = [\n      noopSwitch,\n      {\n        opcode: \"data_insertatlist\",\n      },\n    ];\n    blockSwitches[\"data_insertatlist\"] = [\n      {\n        opcode: \"data_replaceitemoflist\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  if (addon.settings.get(\"extension\")) {\n    blockSwitches[\"pen_penDown\"] = [\n      noopSwitch,\n      {\n        opcode: \"pen_penUp\",\n      },\n    ];\n    blockSwitches[\"pen_penUp\"] = [\n      {\n        opcode: \"pen_penDown\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"pen_setPenColorParamTo\"] = [\n      noopSwitch,\n      {\n        opcode: \"pen_changePenColorParamBy\",\n      },\n    ];\n    blockSwitches[\"pen_changePenColorParamBy\"] = [\n      {\n        opcode: \"pen_setPenColorParamTo\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"pen_setPenHueToNumber\"] = [\n      noopSwitch,\n      {\n        opcode: \"pen_changePenHueBy\",\n      },\n    ];\n    blockSwitches[\"pen_changePenHueBy\"] = [\n      {\n        opcode: \"pen_setPenHueToNumber\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"pen_setPenShadeToNumber\"] = [\n      noopSwitch,\n      {\n        opcode: \"pen_changePenShadeBy\",\n      },\n    ];\n    blockSwitches[\"pen_changePenShadeBy\"] = [\n      {\n        opcode: \"pen_setPenShadeToNumber\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"pen_setPenSizeTo\"] = [\n      noopSwitch,\n      {\n        opcode: \"pen_changePenSizeBy\",\n      },\n    ];\n    blockSwitches[\"pen_changePenSizeBy\"] = [\n      {\n        opcode: \"pen_setPenSizeTo\",\n      },\n      noopSwitch,\n    ];\n    blockSwitches[\"music_setTempo\"] = [\n      noopSwitch,\n      {\n        opcode: \"music_changeTempo\",\n      },\n    ];\n    blockSwitches[\"music_changeTempo\"] = [\n      {\n        opcode: \"music_setTempo\",\n      },\n      noopSwitch,\n    ];\n  }\n\n  // Switching for these is implemented by Scratch. We only define them here to optionally add a border.\n  // Because we don't implement the switching ourselves, this is not controlled by the data category option.\n  blockSwitches[\"data_variable\"] = [];\n  blockSwitches[\"data_listcontents\"] = [];\n\n  let addBorderToContextMenuItem = -1;\n\n  const genuid = () => {\n    const CHARACTERS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%()*+,-./:;=?@[]^_`{|}~\";\n    let result = \"\";\n    for (let i = 0; i < 20; i++) {\n      result += CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];\n    }\n    return result;\n  };\n\n  const menuCallbackFactory = (block, opcodeData) => () => {\n    if (opcodeData.opcode === \"noop\") {\n      return;\n    }\n\n    const workspace = block.workspace;\n\n    // Make a copy of the block with the proper type set.\n    // It doesn't seem to be possible to change a Block's type after it's created, so we'll just make a new block instead.\n    const xml = blockToDom(block);\n    xml.setAttribute(\"type\", opcodeData.opcode);\n\n    const id = block.id;\n    const parent = block.getParent();\n\n    let parentConnection;\n    let blockConnectionType;\n    if (parent) {\n      // If the block has a parent, find the parent -> child connection that will be reattached later.\n      const parentConnections = parent.getConnections_();\n      parentConnection = parentConnections.find((c) => c.targetConnection && c.targetConnection.sourceBlock_ === block);\n      // There's two types of connections from child -> parent. We need to figure out which one is used.\n      const blockConnections = block.getConnections_();\n      const blockToParentConnection = blockConnections.find(\n        (c) => c.targetConnection && c.targetConnection.sourceBlock_ === parent\n      );\n      blockConnectionType = blockToParentConnection.type;\n    }\n\n    const pasteSeparately = [];\n    // Apply input remappings.\n    if (opcodeData.remap) {\n      for (const child of Array.from(xml.children)) {\n        const oldName = child.getAttribute(\"name\");\n        const newName = opcodeData.remap[oldName];\n        if (newName) {\n          if (newName === \"split\") {\n            // This input will be split off into its own script.\n            const inputXml = child.firstChild;\n            const inputId = inputXml.id;\n            const inputBlock = workspace.getBlockById(inputId);\n\n            const position = inputBlock.getRelativeToSurfaceXY();\n            inputXml.setAttribute(\"x\", Math.round(workspace.RTL ? -position.x : position.x));\n            inputXml.setAttribute(\"y\", Math.round(position.y));\n\n            pasteSeparately.push(inputXml);\n            xml.removeChild(child);\n          } else {\n            child.setAttribute(\"name\", newName);\n          }\n        }\n      }\n    }\n    if (opcodeData.remapValueType) {\n      for (const child of Array.from(xml.children)) {\n        const name = child.getAttribute(\"name\");\n        const newType = opcodeData.remapValueType[name];\n        if (newType) {\n          const valueNode = child.firstChild;\n          const fieldNode = valueNode.firstChild;\n          valueNode.setAttribute(\"type\", newType);\n          fieldNode.setAttribute(\"name\", newType === \"text\" ? \"TEXT\" : \"NUM\");\n        }\n      }\n    }\n\n    // Mark the latest event in the undo stack.\n    // This will be used later to group all of our events.\n    const undoStack = workspace.undoStack_;\n    if (undoStack.length) {\n      undoStack[undoStack.length - 1]._blockswitchingLastUndo = true;\n    }\n\n    // Remove the old block and insert the new one.\n    block.dispose();\n    workspace.paste(xml);\n    for (const separateBlock of pasteSeparately) {\n      workspace.paste(separateBlock);\n    }\n\n    // The new block will have the same ID as the old one.\n    const newBlock = workspace.getBlockById(id);\n\n    if (parentConnection) {\n      // Search for the same type of connection on the new block as on the old block.\n      const newBlockConnections = newBlock.getConnections_();\n      const newBlockConnection = newBlockConnections.find((c) => c.type === blockConnectionType);\n      newBlockConnection.connect(parentConnection);\n    }\n\n    // Events (responsible for undoStack updates) are delayed with a setTimeout(f, 0)\n    // https://github.com/LLK/scratch-blocks/blob/f159a1779e5391b502d374fb2fdd0cb5ca43d6a2/core/events.js#L182\n    setTimeout(() => {\n      const group = genuid();\n      for (let i = undoStack.length - 1; i >= 0 && !undoStack[i]._blockswitchingLastUndo; i--) {\n        undoStack[i].group = group;\n      }\n    }, 0);\n  };\n\n  const customContextMenuHandler = function (options) {\n    if (addon.self.disabled) return;\n\n    if (addon.settings.get(\"border\")) {\n      addBorderToContextMenuItem = options.length;\n    }\n\n    if (this._originalCustomContextMenu) {\n      this._originalCustomContextMenu.call(this, options);\n    }\n\n    const switches = blockSwitches[this.type];\n    for (const opcodeData of switches) {\n      const isNoop = opcodeData.opcode === \"noop\";\n      if (isNoop && !addon.settings.get(\"noop\")) {\n        continue;\n      }\n      const translationOpcode = isNoop ? this.type : opcodeData.opcode;\n      const translation = msg(translationOpcode);\n      options.push({\n        enabled: true,\n        text: translation,\n        callback: menuCallbackFactory(this, opcodeData),\n      });\n    }\n  };\n\n  const injectCustomContextMenu = (block) => {\n    const type = block.type;\n    if (!Object.prototype.hasOwnProperty.call(blockSwitches, type)) {\n      return;\n    }\n\n    if (block._customContextMenuInjected) {\n      return;\n    }\n    block._customContextMenuInjected = true;\n\n    if (block.customContextMenu) {\n      block._originalCustomContextMenu = block.customContextMenu;\n    }\n\n    block.customContextMenu = customContextMenuHandler;\n  };\n\n  const changeListener = (change) => {\n    if (change.type !== \"create\") {\n      return;\n    }\n\n    for (const id of change.ids) {\n      const block = Blockly.getMainWorkspace().getBlockById(id);\n      if (!block) continue;\n      injectCustomContextMenu(block);\n    }\n  };\n\n  const mutationObserverCallback = (mutations) => {\n    if (addon.self.disabled) return;\n    for (const mutation of mutations) {\n      for (const node of mutation.addedNodes) {\n        if (node.classList.contains(\"blocklyContextMenu\")) {\n          if (addBorderToContextMenuItem === -1) {\n            continue;\n          }\n          const children = node.children;\n          const item = children[addBorderToContextMenuItem];\n          if (item) {\n            item.style.paddingTop = \"2px\";\n            item.style.borderTop = \"1px solid hsla(0, 0%, 0%, 0.15)\";\n          }\n          addBorderToContextMenuItem = -1;\n        }\n      }\n    }\n  };\n\n  const inject = () => {\n    const workspace = Blockly.getMainWorkspace();\n    if (workspace._blockswitchingInjected) {\n      return;\n    }\n    mutationObserver.observe(document.querySelector(\".blocklyWidgetDiv\"), {\n      childList: true,\n    });\n    workspace._blockswitchingInjected = true;\n    workspace.getAllBlocks().forEach(injectCustomContextMenu);\n    workspace.addChangeListener(changeListener);\n    const languageSelector = document.querySelector('[class^=\"language-selector_language-select\"]');\n    if (languageSelector) {\n      languageSelector.addEventListener(\"change\", () => {\n        setTimeout(inject);\n      });\n    }\n  };\n\n  const mutationObserver = new MutationObserver(mutationObserverCallback);\n\n  if (addon.tab.editorMode === \"editor\") {\n    const interval = setInterval(() => {\n      if (Blockly.getMainWorkspace()) {\n        inject();\n        clearInterval(interval);\n      }\n    }, 100);\n  }\n  addon.tab.addEventListener(\"urlChange\", () => addon.tab.editorMode === \"editor\" && inject());\n}\n","export default async function ({ addon, global, console, msg }) {\n  const buttonItem = [\n    msg(\"export_selected_to_SVG\"),\n    msg(\"export_all_to_SVG\"),\n    msg(\"export_selected_to_PNG\"),\n    msg(\"export_all_to_PNG\"),\n  ];\n\n  function eventMouseDown(e) {\n    if (e.button === 2) {\n      let blockSvg = e.target.closest(\"[data-id]\");\n      let isBackground = !blockSvg && e.target.closest(\"svg.blocklySvg\");\n      if (blockSvg || isBackground) {\n        let dataId = blockSvg && blockSvg.getAttribute(\"data-id\");\n        if (dataId || isBackground) {\n          setTimeout(async () => {\n            let widget = document.querySelector(\"div.blocklyWidgetDiv\");\n            if (!widget) {\n              return;\n            }\n            let blocklyContextMenu = widget.querySelector(\"div.blocklyContextMenu\");\n            if (!blocklyContextMenu) {\n              return;\n            }\n            if (isBackground) {\n              buttonItem.forEach((item, index) => {\n                const wrapperItem = document.createElement(\"div\");\n                wrapperItem.id = `blocks2imgCommand${index + 1}`;\n                wrapperItem.classList.add(\"goog-menuitem\", \"blocks2img\");\n                if (addon.tab.direction === \"rtl\") wrapperItem.classList.add(\"goog-menuitem-rtl\");\n                wrapperItem.onmouseenter = () => wrapperItem.classList.add(\"goog-menuitem-highlight\");\n                wrapperItem.onmouseleave = () => wrapperItem.classList.remove(\"goog-menuitem-highlight\");\n                wrapperItem.style.userSelect = \"none\";\n                if (index === 0) {\n                  wrapperItem.style.borderTop = \"1px solid hsla(0, 0%, 0%, 0.15)\";\n                  // resolve borderTop style conflict with goog-menuitem-highlight class\n                  wrapperItem.style.borderBottom = \"none\";\n                  wrapperItem.style.paddingTop = \"4px\";\n                  wrapperItem.style.paddingBottom = \"3px\";\n                }\n                const menuItem = document.createElement(\"div\");\n                menuItem.classList.add(\"goog-menuitem-content\");\n                menuItem.style.userSelect = \"user-select: none\";\n                menuItem.textContent = item;\n                wrapperItem.append(menuItem);\n                wrapperItem.onclick = () => {\n                  hidePopups();\n                  exportBlock({ command: \"export\" + (index + 1) });\n                };\n                blocklyContextMenu.append(wrapperItem);\n              });\n            }\n\n            if (blocklyContextMenu.children.length < 15) {\n              blocklyContextMenu.style.maxHeight = \"none\";\n              widget.style.height = blocklyContextMenu.getBoundingClientRect().height + 12 + \"px\";\n              blocklyContextMenu.style.maxHeight = \"\";\n            }\n\n            function hidePopups() {\n              const currentWorkspace = Blockly.getMainWorkspace();\n              const element = currentWorkspace.getToolbox().HtmlDiv;\n              element.dispatchEvent(new MouseEvent(\"mousedown\", { relatedTarget: element, bubbles: true }));\n              element.dispatchEvent(new MouseEvent(\"mouseup\", { relatedTarget: element, bubbles: true }));\n            }\n          }, 1);\n        }\n      }\n    }\n  }\n\n  document.addEventListener(\n    \"mousedown\",\n    (e) => {\n      if (e.target.closest(\"g.blocklyWorkspace\")) {\n        eventMouseDown(e);\n      }\n    },\n    true\n  );\n\n  function exportBlock(request, sender, sendMessage) {\n    // console.log(request)\n    let isExportPNG = request.command === \"export3\" || request.command === \"export4\";\n    // blocks-media as base64 for svg inline image\n    let blocksMedia = new Map();\n    blocksMedia.set(\n      \"repeat.svg\",\n      \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9InJlcGVhdCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDI0IDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPgo8dGl0bGU+cmVwZWF0PC90aXRsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTIzLjMsMTFjLTAuMywwLjYtMC45LDEtMS41LDFoLTEuNmMtMC4xLDEuMy0wLjUsMi41LTEuMSwzLjZjLTAuOSwxLjctMi4zLDMuMi00LjEsNC4xCgljLTEuNywwLjktMy42LDEuMi01LjUsMC45Yy0xLjgtMC4zLTMuNS0xLjEtNC45LTIuM2MtMC43LTAuNy0wLjctMS45LDAtMi42YzAuNi0wLjYsMS42LTAuNywyLjMtMC4ySDdjMC45LDAuNiwxLjksMC45LDIuOSwwLjkKCXMxLjktMC4zLDIuNy0wLjljMS4xLTAuOCwxLjgtMi4xLDEuOC0zLjVoLTEuNWMtMC45LDAtMS43LTAuNy0xLjctMS43YzAtMC40LDAuMi0wLjksMC41LTEuMmw0LjQtNC40YzAuNy0wLjYsMS43LTAuNiwyLjQsMEwyMyw5LjIKCUMyMy41LDkuNywyMy42LDEwLjQsMjMuMywxMXoiLz4KPHBhdGggY2xhc3M9InN0MSIgZD0iTTIxLjgsMTFoLTIuNmMwLDEuNS0wLjMsMi45LTEsNC4yYy0wLjgsMS42LTIuMSwyLjgtMy43LDMuNmMtMS41LDAuOC0zLjMsMS4xLTQuOSwwLjhjLTEuNi0wLjItMy4yLTEtNC40LTIuMQoJYy0wLjQtMC4zLTAuNC0wLjktMC4xLTEuMmMwLjMtMC40LDAuOS0wLjQsMS4yLTAuMWwwLDBjMSwwLjcsMi4yLDEuMSwzLjQsMS4xczIuMy0wLjMsMy4zLTFjMC45LTAuNiwxLjYtMS41LDItMi42CgljMC4zLTAuOSwwLjQtMS44LDAuMi0yLjhoLTIuNGMtMC40LDAtMC43LTAuMy0wLjctMC43YzAtMC4yLDAuMS0wLjMsMC4yLTAuNGw0LjQtNC40YzAuMy0wLjMsMC43LTAuMywwLjksMEwyMiw5LjgKCWMwLjMsMC4zLDAuNCwwLjYsMC4zLDAuOVMyMiwxMSwyMS44LDExeiIvPgo8L3N2Zz4K\"\n    );\n    blocksMedia.set(\n      \"green-flag.svg\",\n      \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImdyZWVuZmxhZyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDI0IDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM0NTk5M0Q7fQoJLnN0MXtmaWxsOiM0Q0JGNTY7fQo8L3N0eWxlPgo8dGl0bGU+Z3JlZW5mbGFnPC90aXRsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTIwLjgsMy43Yy0wLjQtMC4yLTAuOS0wLjEtMS4yLDAuMmMtMiwxLjYtNC44LDEuNi02LjgsMGMtMi4zLTEuOS01LjYtMi4zLTguMy0xVjIuNWMwLTAuNi0wLjUtMS0xLTEKCXMtMSwwLjQtMSwxdjE4LjhjMCwwLjUsMC41LDEsMSwxaDAuMWMwLjUsMCwxLTAuNSwxLTF2LTYuNGMxLTAuNywyLjEtMS4yLDMuNC0xLjNjMS4yLDAsMi40LDAuNCwzLjQsMS4yYzIuOSwyLjMsNywyLjMsOS44LDAKCWMwLjMtMC4yLDAuNC0wLjUsMC40LTAuOVY0LjdDMjEuNiw0LjIsMjEuMywzLjgsMjAuOCwzLjd6IE0yMC41LDEzLjlDMjAuNSwxMy45LDIwLjUsMTMuOSwyMC41LDEzLjlDMTgsMTYsMTQuNCwxNiwxMS45LDE0CgljLTEuMS0wLjktMi41LTEuNC00LTEuNGMtMS4yLDAuMS0yLjMsMC41LTMuNCwxLjFWNEM3LDIuNiwxMCwyLjksMTIuMiw0LjZjMi40LDEuOSw1LjcsMS45LDguMSwwYzAuMSwwLDAuMSwwLDAuMiwwCgljMCwwLDAuMSwwLjEsMC4xLDAuMUwyMC41LDEzLjl6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yMC42LDQuOGwtMC4xLDkuMWMwLDAsMCwwLjEsMCwwLjFjLTIuNSwyLTYuMSwyLTguNiwwYy0xLjEtMC45LTIuNS0xLjQtNC0xLjRjLTEuMiwwLjEtMi4zLDAuNS0zLjQsMS4xVjQKCUM3LDIuNiwxMCwyLjksMTIuMiw0LjZjMi40LDEuOSw1LjcsMS45LDguMSwwYzAuMSwwLDAuMSwwLDAuMiwwQzIwLjUsNC43LDIwLjYsNC43LDIwLjYsNC44eiIvPgo8L3N2Zz4K\"\n    );\n    blocksMedia.set(\n      \"rotate-left.svg\",\n      \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIGlkPSJyb3RhdGUtY2xvY2t3aXNlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHN0eWxlPi5jbHMtMXtmaWxsOiMzZDc5Y2M7fS5jbHMtMntmaWxsOiNmZmY7fTwvc3R5bGU+PHRpdGxlPnJvdGF0ZS1jbG9ja3dpc2U8L3RpdGxlPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTIwLjM0LDE4LjIxYTEwLjI0LDEwLjI0LDAsMCwxLTguMSw0LjIyLDIuMjYsMi4yNiwwLDAsMS0uMTYtNC41MmgwYTUuNTgsNS41OCwwLDAsMCw0LjI1LTIuNTMsNS4wNiw1LjA2LDAsMCwwLC41NC00LjYyQTQuMjUsNC4yNSwwLDAsMCwxNS41NSw5YTQuMzEsNC4zMSwwLDAsMC0yLS44QTQuODIsNC44MiwwLDAsMCwxMC40LDlsMS4xMiwxLjQxQTEuNTksMS41OSwwLDAsMSwxMC4zNiwxM0gyLjY3YTEuNTYsMS41NiwwLDAsMS0xLjI2LS42M0ExLjU0LDEuNTQsMCwwLDEsMS4xMywxMUwyLjg1LDMuNTdBMS41OSwxLjU5LDAsMCwxLDQuMzgsMi40LDEuNTcsMS41NywwLDAsMSw1LjYyLDNMNi43LDQuMzVhMTAuNjYsMTAuNjYsMCwwLDEsNy43Mi0xLjY4QTkuODgsOS44OCwwLDAsMSwxOSw0LjgxLDkuNjEsOS42MSwwLDAsMSwyMS44Myw5LDEwLjA4LDEwLjA4LDAsMCwxLDIwLjM0LDE4LjIxWiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTE5LjU2LDE3LjY1YTkuMjksOS4yOSwwLDAsMS03LjM1LDMuODMsMS4zMSwxLjMxLDAsMCwxLS4wOC0yLjYyLDYuNTMsNi41MywwLDAsMCw1LTIuOTIsNi4wNSw2LjA1LDAsMCwwLC42Ny01LjUxLDUuMzIsNS4zMiwwLDAsMC0xLjY0LTIuMTYsNS4yMSw1LjIxLDAsMCwwLTIuNDgtMUE1Ljg2LDUuODYsMCwwLDAsOSw4Ljg0TDEwLjc0LDExYS41OS41OSwwLDAsMS0uNDMsMUgyLjdhLjYuNiwwLDAsMS0uNi0uNzVMMy44MSwzLjgzYS41OS41OSwwLDAsMSwxLS4yMWwxLjY3LDIuMWE5LjcxLDkuNzEsMCwwLDEsNy43NS0yLjA3LDguODQsOC44NCwwLDAsMSw0LjEyLDEuOTIsOC42OCw4LjY4LDAsMCwxLDIuNTQsMy43MkE5LjE0LDkuMTQsMCwwLDEsMTkuNTYsMTcuNjVaIi8+PC9zdmc+\"\n    );\n    blocksMedia.set(\n      \"rotate-right.svg\",\n      \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIGlkPSJyb3RhdGUtY291bnRlci1jbG9ja3dpc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6IzNkNzljYzt9LmNscy0ye2ZpbGw6I2ZmZjt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPnJvdGF0ZS1jb3VudGVyLWNsb2Nrd2lzZTwvdGl0bGU+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNMjIuNjgsMTIuMmExLjYsMS42LDAsMCwxLTEuMjcuNjNIMTMuNzJhMS41OSwxLjU5LDAsMCwxLTEuMTYtMi41OGwxLjEyLTEuNDFhNC44Miw0LjgyLDAsMCwwLTMuMTQtLjc3LDQuMzEsNC4zMSwwLDAsMC0yLC44LDQuMjUsNC4yNSwwLDAsMC0xLjM0LDEuNzMsNS4wNiw1LjA2LDAsMCwwLC41NCw0LjYyQTUuNTgsNS41OCwwLDAsMCwxMiwxNy43NGgwYTIuMjYsMi4yNiwwLDAsMS0uMTYsNC41MkExMC4yNSwxMC4yNSwwLDAsMSwzLjc0LDE4LDEwLjE0LDEwLjE0LDAsMCwxLDIuMjUsOC43OCw5LjcsOS43LDAsMCwxLDUuMDgsNC42NCw5LjkyLDkuOTIsMCwwLDEsOS42NiwyLjVhMTAuNjYsMTAuNjYsMCwwLDEsNy43MiwxLjY4bDEuMDgtMS4zNWExLjU3LDEuNTcsMCwwLDEsMS4yNC0uNiwxLjYsMS42LDAsMCwxLDEuNTQsMS4yMWwxLjcsNy4zN0ExLjU3LDEuNTcsMCwwLDEsMjIuNjgsMTIuMloiLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik0yMS4zOCwxMS44M0gxMy43N2EuNTkuNTksMCwwLDEtLjQzLTFsMS43NS0yLjE5YTUuOSw1LjksMCwwLDAtNC43LTEuNTgsNS4wNyw1LjA3LDAsMCwwLTQuMTEsMy4xN0E2LDYsMCwwLDAsNywxNS43N2E2LjUxLDYuNTEsMCwwLDAsNSwyLjkyLDEuMzEsMS4zMSwwLDAsMS0uMDgsMi42Miw5LjMsOS4zLDAsMCwxLTcuMzUtMy44MkE5LjE2LDkuMTYsMCwwLDEsMy4xNyw5LjEyLDguNTEsOC41MSwwLDAsMSw1LjcxLDUuNCw4Ljc2LDguNzYsMCwwLDEsOS44MiwzLjQ4YTkuNzEsOS43MSwwLDAsMSw3Ljc1LDIuMDdsMS42Ny0yLjFhLjU5LjU5LDAsMCwxLDEsLjIxTDIyLDExLjA4QS41OS41OSwwLDAsMSwyMS4zOCwxMS44M1oiLz48L3N2Zz4=\"\n    );\n    blocksMedia.set(\n      \"dropdown-arrow.svg\",\n      \"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=\"\n    );\n\n    let svg = document.createElement(\"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"xmlns:html\", \"http://www.w3.org/1999/xhtml\");\n    svg.setAttribute(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    let style = document.createElement(\"style\");\n    style.textContent = `\n    .blocklyText {\n        fill: #fff;\n        font-family: \"Helvetica Neue\", Helvetica, sans-serif;\n        font-size: 12pt;\n        font-weight: 500;\n    }\n    .blocklyNonEditableText>text, .blocklyEditableText>text {\n        fill: #575E75;\n    }\n    .blocklyDropdownText {\n        fill: #fff !important;\n    }\n    `;\n    if (request.command === \"export1\" || request.command === \"export3\") {\n      svg = selectedBlocks(svg, style, isExportPNG);\n    } else {\n      svg = allBlocks(svg, style, isExportPNG);\n    }\n    // resolve nbsp whitespace\n    let texts = Array.from(svg.getElementsByTagName(\"text\"));\n    texts.forEach((text) => {\n      text.innerHTML = text.innerHTML.replace(/&nbsp;/g, \" \");\n    });\n    // resolve image path\n    let images = Array.from(svg.getElementsByTagName(\"image\"));\n    let scratchURL = window.location.origin;\n\n    images.forEach((item) => {\n      let builtinSvgData = blocksMedia.get(\n        item.getAttribute(\"xlink:href\").substring(item.getAttribute(\"xlink:href\").lastIndexOf(\"/\") + 1)\n      );\n      if (builtinSvgData) {\n        // replace svg file path (official) to inline svg\n        item.setAttribute(\"xlink:href\", builtinSvgData);\n      } else if (item.getAttribute(\"xlink:href\").indexOf(\"/static/\") === 0) {\n        // replace link path for third party website\n        item.setAttribute(\"xlink:href\", scratchURL + item.getAttribute(\"xlink:href\").slice(0));\n      } else if (item.getAttribute(\"xlink:href\").indexOf(\"./static/\") === 0) {\n        item.setAttribute(\"xlink:href\", scratchURL + item.getAttribute(\"xlink:href\").slice(1));\n      } else if (item.getAttribute(\"xlink:href\").indexOf(\"static/\") === 0) {\n        item.setAttribute(\"xlink:href\", scratchURL + \"/\" + item.getAttribute(\"xlink:href\"));\n      }\n    });\n    let tmp = document.createElement(\"div\");\n    tmp.appendChild(svg);\n    if (request.command === \"export1\" || request.command === \"export2\") {\n      exportData(tmp.innerHTML);\n    } else {\n      exportPNG(svg);\n    }\n  }\n\n  function selectedBlocks(svg, style, isExportPNG) {\n    let svgchild = document.querySelector(\"svg.blocklySvg g.blocklySelected\");\n    if (!svgchild) {\n      alert(msg(\"error_blocks_unselected\"));\n      throw new Error(\"Can not found selected blocks\");\n    }\n    svgchild = svgchild.cloneNode(true);\n    let dataShapes = svgchild.getAttribute(\"data-shapes\");\n    svgchild.setAttribute(\n      \"transform\",\n      `translate(0,${dataShapes === \"hat\" ? \"18\" : \"0\"}) ${isExportPNG ? \"scale(2)\" : \"\"}`\n    );\n    svg.append(style);\n    svg.append(svgchild);\n    return svg;\n  }\n\n  function allBlocks(svg, style, isExportPNG) {\n    let svgchild = document.querySelector(\"svg.blocklySvg g.blocklyBlockCanvas\");\n    svgchild = svgchild.cloneNode(true);\n\n    let xArr = [];\n    let yArr = [];\n    if (!svgchild?.childNodes?.length) {\n      alert(msg(\"error_blocks_not_added\"));\n      throw new Error(\"Workspace is empty\");\n    }\n    svgchild.childNodes.forEach((g) => {\n      let x = g.getAttribute(\"transform\").match(/translate\\((.*?),(.*?)\\)/)[1] || 0;\n      let y = g.getAttribute(\"transform\").match(/translate\\((.*?),(.*?)\\)/)[2] || 0;\n      xArr.push(x * (isExportPNG ? 2 : 1));\n      yArr.push(y * (isExportPNG ? 2 : 1));\n      g.style.display = \"\"; // because of TW scratch-blocks changes\n    });\n\n    svgchild.setAttribute(\n      \"transform\",\n      `translate(${-Math.min(...xArr)},${-Math.min(...yArr) + 18 * (isExportPNG ? 2 : 1)}) ${\n        isExportPNG ? \"scale(2)\" : \"\"\n      }`\n    );\n    svg.append(style);\n    svg.append(svgchild);\n    return svg;\n  }\n\n  function exportData(text) {\n    const saveLink = document.createElement(\"a\");\n    document.body.appendChild(saveLink);\n\n    const data = new Blob([text], { type: \"text\" });\n    const url = window.URL.createObjectURL(data);\n    saveLink.href = url;\n\n    // File name: project-DATE-TIME\n    const date = new Date();\n    const timestamp = `${date.toLocaleDateString()}-${date.toLocaleTimeString()}`;\n    saveLink.download = `block_${timestamp}.svg`;\n    saveLink.click();\n    window.URL.revokeObjectURL(url);\n    document.body.removeChild(saveLink);\n  }\n\n  function exportPNG(svg) {\n    const div = document.createElement(\"div\");\n    div.appendChild(svg);\n\n    const iframe = document.createElement(\"iframe\");\n    // iframe.style.display = \"none\"\n    document.body.append(iframe);\n    iframe.contentDocument.write(div.innerHTML);\n    let { width, height } = iframe.contentDocument.body.querySelector(\"svg g\").getBoundingClientRect();\n    height = height + 20 * 2; //  hat block height restore\n    svg.setAttribute(\"width\", width + \"px\");\n    svg.setAttribute(\"height\", height + \"px\");\n\n    let canvas = document.createElement(\"canvas\");\n    let ctx = canvas.getContext(\"2d\");\n\n    let img = document.createElement(\"img\");\n\n    img.setAttribute(\"src\", \"data:image/svg+xml;base64,\" + btoa(unescape(encodeURIComponent(div.innerHTML))));\n    img.onload = function () {\n      canvas.height = img.height;\n      canvas.width = img.width;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      // Now is done\n      let dataURL = canvas.toDataURL(\"image/png\");\n      let link = document.createElement(\"a\");\n      const date = new Date();\n      const timestamp = `${date.toLocaleDateString()}-${date.toLocaleTimeString()}`;\n\n      link.download = `block_${timestamp}.png`;\n      link.href = dataURL;\n      link.click();\n      iframe.remove();\n    };\n  }\n}\n","/**\n * Based on https://github.com/LLK/scratch-blocks/compare/hotfix/totally-normal-2021 (Apache 2.0)\n * It has been modified to work properly in our environment and fix some bugs.\n */\n\nexport default async function ({ addon, global, console }) {\n  const Blockly = await addon.tab.traps.getBlockly();\n\n  const shouldWatchMouseCursor = addon.settings.get(\"watch\");\n\n  Blockly.BlockSvg.START_HAT_HEIGHT = 31;\n\n  Blockly.BlockSvg.START_HAT_PATH =\n    \"c2.6,-2.3 5.5,-4.3 8.5,-6.2\" +\n    \"c-1,-12.5 5.3,-23.3 8.4,-24.8c3.7,-1.8 16.5,13.1 18.4,15.4\" +\n    \"c8.4,-1.3 17,-1.3 25.4,0c1.9,-2.3 14.7,-17.2 18.4,-15.4\" +\n    \"c3.1,1.5 9.4,12.3 8.4,24.8c3,1.8 5.9,3.9 8.5,6.1\";\n\n  Blockly.BlockSvg.TOP_LEFT_CORNER_DEFINE_HAT =\n    \"c0,-7.1 3.7,-13.3 9.3,-16.9c1.7,-7.5 5.4,-13.2 7.6,-14.2\" +\n    \"c2.6,-1.3 10,6 14.6,11.1h33c4.6,-5.1 11.9,-12.4 14.6,-11.1\" +\n    \"c1.9,0.9 4.9,5.2 6.8,11.1c2.6,0,5.2,0,7.8,0\";\n\n  Blockly.BlockSvg.prototype.renderCatFace_ = function () {\n    this.catPath_.svgFace.setAttribute(\"fill\", \"#000000\");\n\n    var closedEye = Blockly.utils.createSvgElement(\"path\", {}, this.svgFace_);\n    closedEye.setAttribute(\n      \"d\",\n      \"M25.2-1.1c0.1,0,0.2,0,0.2,0l8.3-2.1l-7-4.8\" +\n        \"c-0.5-0.3-1.1-0.2-1.4,0.3s-0.2,1.1,0.3,1.4L29-4.1l-4,1\" +\n        \"c-0.5,0.1-0.9,0.7-0.7,1.2C24.3-1.4,24.7-1.1,25.2-1.1z\"\n    );\n    closedEye.setAttribute(\"fill-opacity\", \"0\");\n    this.catPath_.svgFace.closedEye = closedEye;\n\n    var closedEye2 = Blockly.utils.createSvgElement(\"path\", {}, this.svgFace_);\n    closedEye2.setAttribute(\n      \"d\",\n      \"M62.4-1.1c-0.1,0-0.2,0-0.2,0l-8.3-2.1l7-4.8\" +\n        \"c0.5-0.3,1.1-0.2,1.4,0.3s0.2,1.1-0.3,1.4l-3.4,2.3l4,1\" +\n        \"c0.5,0.1,0.9,0.7,0.7,1.2C63.2-1.4,62.8-1.1,62.4-1.1z\"\n    );\n    closedEye2.setAttribute(\"fill-opacity\", \"0\");\n    this.catPath_.svgFace.closedEye2 = closedEye2;\n\n    var eye = Blockly.utils.createSvgElement(\"circle\", {}, this.svgFace_);\n    eye.setAttribute(\"cx\", \"59.2\");\n    eye.setAttribute(\"cy\", \"-3.3\");\n    eye.setAttribute(\"r\", \"3.4\");\n    eye.setAttribute(\"fill-opacity\", \"0.6\");\n    this.catPath_.svgFace.eye = eye;\n\n    var eye2 = Blockly.utils.createSvgElement(\"circle\", {}, this.svgFace_);\n    eye2.setAttribute(\"cx\", \"29.1\");\n    eye2.setAttribute(\"cy\", \"-3.3\");\n    eye2.setAttribute(\"r\", \"3.4\");\n    eye2.setAttribute(\"fill-opacity\", \"0.6\");\n    this.catPath_.svgFace.eye2 = eye2;\n\n    var mouth = Blockly.utils.createSvgElement(\"path\", {}, this.svgFace_);\n    mouth.setAttribute(\n      \"d\",\n      \"M45.6,0.1c-0.9,0-1.7-0.3-2.3-0.9\" +\n        \"c-0.6,0.6-1.3,0.9-2.2,0.9c-0.9,0-1.8-0.3-2.3-0.9c-1-1.1-1.1-2.6-1.1-2.8\" +\n        \"c0-0.5,0.5-1,1-1l0,0c0.6,0,1,0.5,1,1c0,0.4,0.1,1.7,1.4,1.7\" +\n        \"c0.5,0,0.7-0.2,0.8-0.3c0.3-0.3,0.4-1,0.4-1.3c0-0.1,0-0.1,0-0.2\" +\n        \"c0-0.5,0.5-1,1-1l0,0c0.5,0,1,0.4,1,1c0,0,0,0.1,0,0.2\" +\n        \"c0,0.3,0.1,0.9,0.4,1.2C44.8-2.2,45-2,45.5-2s0.7-0.2,0.8-0.3\" +\n        \"c0.3-0.4,0.4-1.1,0.3-1.3c0-0.5,0.4-1,0.9-1.1c0.5,0,1,0.4,1.1,0.9\" +\n        \"c0,0.2,0.1,1.8-0.8,2.8C47.5-0.4,46.8,0.1,45.6,0.1z\"\n    );\n    mouth.setAttribute(\"fill-opacity\", \"0.6\");\n\n    this.catPath_.ear.setAttribute(\n      \"d\",\n      \"M73.1-15.6c1.7-4.2,4.5-9.1,5.8-8.5\" +\n        \"c1.6,0.8,5.4,7.9,5,15.4c0,0.6-0.7,0.7-1.1,0.5c-3-1.6-6.4-2.8-8.6-3.6\" +\n        \"C72.8-12.3,72.4-13.7,73.1-15.6z\"\n    );\n    this.catPath_.ear.setAttribute(\"fill\", \"#FFD5E6\");\n\n    this.catPath_.ear2.setAttribute(\n      \"d\",\n      \"M22.4-15.6c-1.7-4.2-4.5-9.1-5.8-8.5\" +\n        \"c-1.6,0.8-5.4,7.9-5,15.4c0,0.6,0.7,0.7,1.1,0.5c3-1.6,6.4-2.8,8.6-3.6\" +\n        \"C22.8-12.3,23.2-13.7,22.4-15.6z\"\n    );\n    this.catPath_.ear2.setAttribute(\"fill\", \"#FFD5E6\");\n  };\n\n  Blockly.BlockSvg.prototype.initCatStuff = function () {\n    if (this.hasInitCatStuff) return;\n    this.hasInitCatStuff = true;\n\n    // Ear part of the SVG path for hat blocks\n    var LEFT_EAR_UP = \"c-1,-12.5 5.3,-23.3 8.4,-24.8c3.7,-1.8 16.5,13.1 18.4,15.4\";\n    var LEFT_EAR_DOWN = \"c-5.8,-4.8 -8,-18 -4.9,-19.5c3.7,-1.8 24.5,11.1 31.7,10.1\";\n    var RIGHT_EAR_UP = \"c1.9,-2.3 14.7,-17.2 18.4,-15.4c3.1,1.5 9.4,12.3 8.4,24.8\";\n    var RIGHT_EAR_DOWN = \"c7.2,1 28,-11.9 31.7,-10.1c3.1,1.5 0.9,14.7 -4.9,19.5\";\n    // Ears look slightly different for define hat blocks\n    var DEFINE_HAT_LEFT_EAR_UP = \"c0,-7.1 3.7,-13.3 9.3,-16.9c1.7,-7.5 5.4,-13.2 7.6,-14.2c2.6,-1.3 10,6 14.6,11.1\";\n    var DEFINE_HAT_RIGHT_EAR_UP = \"h33c4.6,-5.1 11.9,-12.4 14.6,-11.1c1.9,0.9 4.9,5.2 6.8,11.1c2.6,0,5.2,0,7.8,0\";\n    var DEFINE_HAT_LEFT_EAR_DOWN =\n      \"c0,-4.6 1.6,-8.9 4.3,-12.3c-2.4,-5.6 -2.9,-12.4 -0.7,-13.4c2.1,-1 9.6,2.6 17,5.8\" + \"c2.6,0 6.2,0 10.9,0\";\n    var DEFINE_HAT_RIGHT_EAR_DOWN = \"c0,0 25.6,0 44,0c7.4,-3.2 14.8,-6.8 16.9,-5.8c1.2,0.6 1.6,2.9 1.3,5.8\";\n\n    var that = this;\n    this.catPath_.ear = Blockly.utils.createSvgElement(\"path\", {}, this.catPath_);\n    this.catPath_.ear2 = Blockly.utils.createSvgElement(\"path\", {}, this.catPath_);\n    if (this.RTL) {\n      // Mirror the ears.\n      this.catPath_.ear.setAttribute(\"transform\", \"scale(-1 1)\");\n      this.catPath_.ear2.setAttribute(\"transform\", \"scale(-1 1)\");\n    }\n    this.catPath_.addEventListener(\"mouseenter\", function (event) {\n      clearTimeout(that.blinkFn);\n      // blink\n      if (event.target.svgFace.eye) {\n        event.target.svgFace.eye.setAttribute(\"fill-opacity\", \"0\");\n        event.target.svgFace.eye2.setAttribute(\"fill-opacity\", \"0\");\n        event.target.svgFace.closedEye.setAttribute(\"fill-opacity\", \"0.6\");\n        event.target.svgFace.closedEye2.setAttribute(\"fill-opacity\", \"0.6\");\n      }\n\n      // reset after a short delay\n      that.blinkFn = setTimeout(function () {\n        if (event.target.svgFace.eye) {\n          event.target.svgFace.eye.setAttribute(\"fill-opacity\", \"0.6\");\n          event.target.svgFace.eye2.setAttribute(\"fill-opacity\", \"0.6\");\n          event.target.svgFace.closedEye.setAttribute(\"fill-opacity\", \"0\");\n          event.target.svgFace.closedEye2.setAttribute(\"fill-opacity\", \"0\");\n        }\n      }, 100);\n    });\n\n    this.catPath_.ear.addEventListener(\"mouseenter\", function () {\n      clearTimeout(that.earFn);\n      clearTimeout(that.ear2Fn);\n      // ear flick\n      that.catPath_.ear.setAttribute(\"fill-opacity\", \"0\");\n      that.catPath_.ear2.setAttribute(\"fill-opacity\", \"\");\n      var bodyPath = that.catPath_.svgBody.getAttribute(\"d\");\n      bodyPath = bodyPath.replace(RIGHT_EAR_UP, RIGHT_EAR_DOWN);\n      bodyPath = bodyPath.replace(DEFINE_HAT_RIGHT_EAR_UP, DEFINE_HAT_RIGHT_EAR_DOWN);\n      bodyPath = bodyPath.replace(LEFT_EAR_DOWN, LEFT_EAR_UP);\n      bodyPath = bodyPath.replace(DEFINE_HAT_LEFT_EAR_DOWN, DEFINE_HAT_LEFT_EAR_UP);\n      that.catPath_.svgBody.setAttribute(\"d\", bodyPath);\n\n      // reset after a short delay\n      that.earFn = setTimeout(function () {\n        that.catPath_.ear.setAttribute(\"fill-opacity\", \"\");\n        var bodyPath = that.catPath_.svgBody.getAttribute(\"d\");\n        bodyPath = bodyPath.replace(RIGHT_EAR_DOWN, RIGHT_EAR_UP);\n        bodyPath = bodyPath.replace(DEFINE_HAT_RIGHT_EAR_DOWN, DEFINE_HAT_RIGHT_EAR_UP);\n        that.catPath_.svgBody.setAttribute(\"d\", bodyPath);\n      }, 50);\n    });\n    this.catPath_.ear2.addEventListener(\"mouseenter\", function () {\n      clearTimeout(that.earFn);\n      clearTimeout(that.ear2Fn);\n      // ear flick\n      that.catPath_.ear2.setAttribute(\"fill-opacity\", \"0\");\n      that.catPath_.ear.setAttribute(\"fill-opacity\", \"\");\n      var bodyPath = that.catPath_.svgBody.getAttribute(\"d\");\n      bodyPath = bodyPath.replace(LEFT_EAR_UP, LEFT_EAR_DOWN);\n      bodyPath = bodyPath.replace(DEFINE_HAT_LEFT_EAR_UP, DEFINE_HAT_LEFT_EAR_DOWN);\n      bodyPath = bodyPath.replace(RIGHT_EAR_DOWN, RIGHT_EAR_UP);\n      bodyPath = bodyPath.replace(DEFINE_HAT_RIGHT_EAR_DOWN, DEFINE_HAT_RIGHT_EAR_UP);\n      that.catPath_.svgBody.setAttribute(\"d\", bodyPath);\n\n      // reset after a short delay\n      that.ear2Fn = setTimeout(function () {\n        that.catPath_.ear2.setAttribute(\"fill-opacity\", \"\");\n        var bodyPath = that.catPath_.svgBody.getAttribute(\"d\");\n        bodyPath = bodyPath.replace(LEFT_EAR_DOWN, LEFT_EAR_UP);\n        bodyPath = bodyPath.replace(DEFINE_HAT_LEFT_EAR_DOWN, DEFINE_HAT_LEFT_EAR_UP);\n        that.catPath_.svgBody.setAttribute(\"d\", bodyPath);\n      }, 50);\n    });\n    if (this.RTL) {\n      // Set to the correct initial position\n      this.svgFace_.style.transform = \"translate(-87px, 0px)\";\n    }\n    if (this.shouldWatchMouse()) {\n      this.windowListener = function (event) {\n        var time = Date.now();\n        if (time < that.lastCallTime + that.CALL_FREQUENCY_MS) return;\n        that.lastCallTime = time;\n        if (!that.shouldWatchMouse()) return;\n\n        // mouse watching\n        if (that.workspace) {\n          // not disposed\n          var xy = that.getCatFacePosition();\n          var mouseLocation = {\n            x: event.x / that.workspace.scale,\n            y: event.y / that.workspace.scale,\n          };\n\n          var dx = mouseLocation.x - xy.x;\n          var dy = mouseLocation.y - xy.y;\n          var theta = Math.atan2(dx, dy);\n\n          // Map the vector from the cat face to the mouse location to a much shorter\n          // vector in the same direction, which will be the translation vector for\n          // the cat face\n          var delta = Math.sqrt(dx * dx + dy * dy);\n          var scaleFactor = delta / (delta + 1);\n\n          // Equation for radius of ellipse at theta for axes with length a and b\n          var a = 2;\n          var b = 5;\n          var r = (a * b) / Math.sqrt(Math.pow(b * Math.cos(theta), 2) + Math.pow(a * Math.sin(theta), 2));\n\n          // Convert polar coordinate back to x, y coordinate\n          dx = r * scaleFactor * Math.sin(theta);\n          dy = r * scaleFactor * Math.cos(theta);\n\n          if (that.RTL) dx -= 87; // Translate face over\n          that.svgFace_.style.transform = \"translate(\" + dx + \"px, \" + dy + \"px)\";\n        }\n      };\n      document.addEventListener(\"mousemove\", this.windowListener);\n    }\n  };\n\n  let workspacePositionRect = null;\n  Blockly.BlockSvg.prototype.getCatFacePosition = function () {\n    // getBoundingClientRect is not performant\n    //var offset = that.workspace.getParentSvg().getBoundingClientRect();\n    if (!workspacePositionRect) {\n      workspacePositionRect = this.workspace.getParentSvg().getBoundingClientRect();\n    }\n    var offset = { x: workspacePositionRect.x, y: workspacePositionRect.y };\n\n    if (!this.isInFlyout && this.workspace.getFlyout()) {\n      offset.x += this.workspace.getFlyout().getWidth();\n    }\n\n    offset.x += this.workspace.scrollX;\n    offset.y += this.workspace.scrollY;\n\n    var xy = this.getRelativeToSurfaceXY(this.svgGroup_);\n    if (this.RTL) {\n      xy.x = this.workspace.getWidth() - xy.x - this.width;\n    }\n    // convert to workspace units\n    xy.x += offset.x / this.workspace.scale;\n    xy.y += offset.y / this.workspace.scale;\n    // distance to center of face\n    xy.x -= 43.5;\n    xy.y -= 4;\n    // flyout category offset\n    xy.x += 60;\n    if (this.RTL) {\n      // We've been calculating from the right edge. Convert x to from left edge.\n      xy.x = screen.width - xy.x;\n    }\n    return xy;\n  };\n\n  Blockly.BlockSvg.prototype.shouldWatchMouse = function () {\n    if (!shouldWatchMouseCursor) return false;\n    // if (window.vmLoadHigh || !window.CAT_CHASE_MOUSE) return false;\n    var xy = this.getCatFacePosition();\n    const MARGIN = 50;\n    var blockXOnScreen = xy.x > -MARGIN && xy.x - MARGIN < screen.width / this.workspace.scale;\n    var blockYOnScreen = xy.y > -MARGIN && xy.y - MARGIN < screen.height / this.workspace.scale;\n    return this.startHat_ && !this.isGlowingStack_ && blockXOnScreen && blockYOnScreen;\n  };\n\n  const originalRenderDraw = Blockly.BlockSvg.prototype.renderDraw_;\n  Blockly.BlockSvg.prototype.renderDraw_ = function (...args) {\n    if (!this.svgFace_) {\n      this.sa_catBlockConstructor();\n    }\n    const r = originalRenderDraw.call(this, ...args);\n    if (!this.outputConnection && !this.previousConnection) {\n      this.initCatStuff();\n    }\n    if (this.startHat_ && !this.svgFace_.firstChild) {\n      this.renderCatFace_();\n    }\n    return r;\n  };\n\n  const originalDispose = Blockly.BlockSvg.prototype.dispose;\n  Blockly.BlockSvg.prototype.dispose = function (...args) {\n    clearTimeout(this.blinkFn);\n    clearTimeout(this.earFn);\n    clearTimeout(this.ear2Fn);\n    if (this.windowListener) {\n      document.removeEventListener(\"mousemove\", this.windowListener);\n    }\n    return originalDispose.call(this, ...args);\n  };\n\n  const originalSetGlowStack = Blockly.BlockSvg.prototype.setGlowStack;\n  Blockly.BlockSvg.prototype.setGlowStack = function (isGlowingStack) {\n    if (this.windowListener) {\n      if (isGlowingStack) {\n        // For performance, don't follow the mouse when the stack is glowing\n        document.removeEventListener(\"mousemove\", this.windowListener);\n        if (this.workspace && this.svgFace_.style) {\n          // reset face direction\n          if (this.RTL) {\n            this.svgFace_.style.transform = \"translate(-87px, 0px)\";\n          } else {\n            this.svgFace_.style.transform = \"\";\n          }\n        }\n      } else {\n        document.addEventListener(\"mousemove\", this.windowListener);\n      }\n    }\n    return originalSetGlowStack.call(this, isGlowingStack);\n  };\n\n  Blockly.BlockSvg.prototype.sa_catBlockConstructor = function () {\n    this.catPath_ = Blockly.utils.createSvgElement(\"g\", {}, this.svgGroup_);\n\n    this.svgFace_ = Blockly.utils.createSvgElement(\"g\", {}, this.catPath_);\n    this.catPath_.svgFace = this.svgFace_;\n    this.catPath_.svgBody = this.svgPath_;\n    this.lastCallTime = 0;\n    this.CALL_FREQUENCY_MS = 60;\n  };\n\n  const workspace = Blockly.getMainWorkspace();\n  if (workspace) {\n    const vm = addon.tab.traps.vm;\n    if (vm.editingTarget) {\n      vm.emitWorkspaceUpdate();\n    }\n    const flyout = workspace.getFlyout();\n    if (flyout) {\n      const flyoutWorkspace = flyout.getWorkspace();\n      Blockly.Xml.clearWorkspaceAndLoadFromXml(Blockly.Xml.workspaceToDom(flyoutWorkspace), flyoutWorkspace);\n      workspace.getToolbox().refreshSelection();\n      workspace.toolboxRefreshEnabled_ = true;\n    }\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/60fb267c5ab0c6f4ed9ab4a891ca7dd5.svg\";","module.exports = __webpack_public_path__ + \"static/assets/8a30520407ffdf5b0e7e06e490db9c1d.svg\";","export default async function ({ addon, global, console, msg }) {\n  const vm = addon.tab.traps.vm;\n\n  if (addon.tab.redux.state && addon.tab.redux.state.scratchGui.stageSize.stageSize === \"small\") {\n    document.body.classList.add(\"sa-clones-small\");\n  }\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      if (e.target.closest(\"[class*='stage-header_stage-button-first']\")) {\n        document.body.classList.add(\"sa-clones-small\");\n      } else if (e.target.closest(\"[class*='stage-header_stage-button-last']\")) {\n        document.body.classList.remove(\"sa-clones-small\");\n      }\n    },\n    { capture: true }\n  );\n\n  let countContainerContainer = document.createElement(\"div\");\n  addon.tab.displayNoneWhileDisabled(countContainerContainer);\n\n  let countContainer = document.createElement(\"div\");\n  let count = document.createElement(\"span\");\n  let icon = document.createElement(\"span\");\n\n  countContainerContainer.className = \"clone-container-container\";\n  countContainer.className = \"clone-container\";\n  count.className = \"clone-count\";\n  icon.className = \"clone-icon\";\n\n  countContainerContainer.appendChild(icon);\n  countContainerContainer.appendChild(countContainer);\n  countContainer.appendChild(count);\n\n  let lastChecked = 0;\n\n  const cache = Array(301)\n    .fill()\n    .map((_, i) => msg(\"clones\", { cloneCount: i }));\n\n  function doCloneChecks() {\n    const v = vm.runtime._cloneCounter;\n    // performance\n    if (v === lastChecked) return;\n    countContainerContainer.dataset.count = lastChecked = v;\n    count.dataset.str = cache[v] || msg(\"clones\", { cloneCount: v });\n\n    if (v === 0) countContainerContainer.style.display = \"none\";\n    else countContainerContainer.style.display = \"flex\";\n  }\n\n  vm.runtime.on(\"targetWasRemoved\", (t) => {\n    // Fix bug with inaccurate clone counter\n    if (t.isOriginal) vm.runtime.changeCloneCounter(1);\n  });\n  const oldStep = vm.runtime.constructor.prototype._step;\n  vm.runtime.constructor.prototype._step = function (...args) {\n    const ret = oldStep.call(this, ...args);\n    doCloneChecks();\n    return ret;\n  };\n\n  while (true) {\n    let bar = await addon.tab.waitForElement('[class*=\"controls_controls-container\"]', {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n    });\n\n    if (addon.tab.editorMode === \"editor\") {\n      bar.appendChild(countContainerContainer);\n    }\n  }\n}\n","import { normalizeHex, getHexRegex } from \"../../libraries/common/cs/normalize-color.js\";\nimport RateLimiter from \"../../libraries/common/cs/rate-limiter.js\";\nimport tinycolor from \"../../libraries/thirdparty/cs/tinycolor-min.js\";\n\nexport default async ({ addon, console, msg }) => {\n  // 250-ms rate limit\n  const rateLimiter = new RateLimiter(250);\n  const getColor = (element) => {\n    const { children } = element.parentElement;\n    // h: 0 - 360\n    const h = children[1].getAttribute(\"aria-valuenow\");\n    // s: 0 - 1\n    const s = children[3].getAttribute(\"aria-valuenow\");\n    // v: 0 - 255, divide by 255\n    const vMultipliedBy255 = children[5].getAttribute(\"aria-valuenow\");\n    const v = Number(vMultipliedBy255) / 255;\n    return tinycolor(`hsv(${h}, ${s}, ${v || 0})`).toHexString();\n  };\n  const setColor = (hex, element) => {\n    hex = normalizeHex(hex);\n    if (!addon.tab.redux.state || !addon.tab.redux.state.scratchGui) return;\n    // The only way to reliably set color is to invoke eye dropper via click()\n    // then faking that the eye dropper reported the value.\n    const onEyeDropperClosed = ({ detail }) => {\n      if (detail.action.type !== \"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER\") return;\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperClosed);\n      setTimeout(() => {\n        document.body.classList.remove(\"sa-hide-eye-dropper-background\");\n      }, 50);\n    };\n    const onEyeDropperOpened = ({ detail }) => {\n      if (detail.action.type !== \"scratch-gui/color-picker/ACTIVATE_COLOR_PICKER\") return;\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperOpened);\n      addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperClosed);\n      setTimeout(() => {\n        addon.tab.redux.dispatch({\n          type: \"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER\",\n          color: hex,\n        });\n      }, 50);\n    };\n    addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperOpened);\n    document.body.classList.add(\"sa-hide-eye-dropper-background\");\n    element.click();\n  };\n  const addColorPicker = () => {\n    const element = document.querySelector(\"button.scratchEyedropper\");\n    rateLimiter.abort(false);\n    addon.tab.redux.initialize();\n    const defaultColor = getColor(element);\n    const saColorPicker = Object.assign(document.createElement(\"div\"), {\n      className: \"sa-color-picker sa-color-picker-code\",\n    });\n    const saColorPickerColor = Object.assign(document.createElement(\"input\"), {\n      className: \"sa-color-picker-color sa-color-picker-code-color\",\n      type: \"color\",\n      value: defaultColor || \"#000000\",\n    });\n    const saColorPickerText = Object.assign(document.createElement(\"input\"), {\n      className: addon.tab.scratchClass(\"input_input-form\", {\n        others: \"sa-color-picker-text sa-color-picker-code-text\",\n      }),\n      type: \"text\",\n      pattern: \"^#?([0-9a-fA-F]{3}){1,2}$\",\n      placeholder: msg(\"hex\"),\n      value: defaultColor || \"\",\n    });\n    saColorPickerColor.addEventListener(\"input\", () =>\n      rateLimiter.limit(() => setColor((saColorPickerText.value = saColorPickerColor.value), element))\n    );\n    saColorPickerText.addEventListener(\"change\", () => {\n      const { value } = saColorPickerText;\n      if (!getHexRegex().test(value)) return;\n      setColor((saColorPickerColor.value = normalizeHex(value)), element);\n    });\n    saColorPicker.appendChild(saColorPickerColor);\n    saColorPicker.appendChild(saColorPickerText);\n    element.parentElement.insertBefore(saColorPicker, element);\n  };\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\n  const originalShowEditor = ScratchBlocks.FieldColourSlider.prototype.showEditor_;\n  ScratchBlocks.FieldColourSlider.prototype.showEditor_ = function (...args) {\n    const r = originalShowEditor.call(this, ...args);\n    addColorPicker();\n    return r;\n  };\n};\n","import { normalizeHex, getHexRegex } from \"../../libraries/common/cs/normalize-color.js\";\nimport RateLimiter from \"../../libraries/common/cs/rate-limiter.js\";\nimport tinycolor from \"../../libraries/thirdparty/cs/tinycolor-min.js\";\n\nexport default async ({ addon, console, msg }) => {\n  let prevEventHandler;\n  // 250-ms rate limit\n  const rateLimiter = new RateLimiter(250);\n  const getColor = (element) => {\n    let fillOrStroke;\n    const state = addon.tab.redux.state;\n    if (state.scratchPaint.modals.fillColor) {\n      fillOrStroke = \"fill\";\n    } else if (state.scratchPaint.modals.strokeColor) {\n      fillOrStroke = \"stroke\";\n    } else {\n      // fillOrStroke = \"ihadastroke\";\n      return;\n    }\n    const colorType = state.scratchPaint.fillMode.colorIndex;\n    const primaryOrSecondary = [\"primary\", \"secondary\"][colorType];\n    const color = state.scratchPaint.color[`${fillOrStroke}Color`][primaryOrSecondary];\n    if (color === null || color === \"scratch-paint/style-path/mixed\") return;\n    // This value can be arbitrary - it can be HEX, RGB, etc.\n    // Use tinycolor to convert them.\n    return tinycolor(color).toHexString();\n  };\n  const setColor = (hex, element) => {\n    hex = normalizeHex(hex);\n    if (!addon.tab.redux.state || !addon.tab.redux.state.scratchPaint) return;\n    // The only way to reliably set color is to invoke eye dropper via click()\n    // then faking that the eye dropper reported the value.\n    const onEyeDropperOpened = ({ detail }) => {\n      if (detail.action.type !== \"scratch-paint/eye-dropper/ACTIVATE_COLOR_PICKER\") return;\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperOpened);\n      setTimeout(() => {\n        const previousTool = addon.tab.redux.state.scratchPaint.color.eyeDropper.previousTool;\n        if (previousTool) previousTool.activate();\n        addon.tab.redux.state.scratchPaint.color.eyeDropper.callback(hex);\n        addon.tab.redux.dispatch({\n          type: \"scratch-paint/eye-dropper/DEACTIVATE_COLOR_PICKER\",\n        });\n      }, 50);\n    };\n    addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperOpened);\n    element.children[1].children[0].click();\n  };\n  while (true) {\n    const element = await addon.tab.waitForElement('div[class*=\"color-picker_swatch-row\"]', {\n      markAsSeen: true,\n      reduxCondition: (state) => state.scratchGui.editorTab.activeTabIndex === 1 && !state.scratchGui.mode.isPlayerOnly,\n    });\n    rateLimiter.abort(false);\n    addon.tab.redux.initialize();\n    if (addon.tab.redux && typeof prevEventHandler === \"function\") {\n      addon.tab.redux.removeEventListener(\"statechanged\", prevEventHandler);\n      prevEventHandler = null;\n    }\n    if (addon.tab.editorMode !== \"editor\") continue;\n    const defaultColor = getColor(element);\n    const saColorPicker = Object.assign(document.createElement(\"div\"), {\n      className: \"sa-color-picker sa-color-picker-paint\",\n    });\n    const saColorPickerColor = Object.assign(document.createElement(\"input\"), {\n      className: \"sa-color-picker-color sa-color-picker-paint-color\",\n      type: \"color\",\n      value: defaultColor || \"#000000\",\n    });\n    const inputClass = document.querySelector('[class*=\"fixed-tools_costume-input\"]').className.split(\" \")[0];\n    const saColorPickerText = Object.assign(document.createElement(\"input\"), {\n      className: `sa-color-picker-text sa-color-picker-paint-text ${inputClass}`,\n      type: \"text\",\n      pattern: \"^#[0-9a-fA-F]{3,8}$\",\n      placeholder: msg(\"hex\"),\n      value: defaultColor || \"\",\n    });\n    saColorPickerColor.addEventListener(\"input\", () =>\n      rateLimiter.limit(() => setColor((saColorPickerText.value = saColorPickerColor.value), element))\n    );\n    saColorPickerText.addEventListener(\"change\", () => {\n      const { value } = saColorPickerText;\n      if (!getHexRegex().test(value)) return;\n      setColor((saColorPickerColor.value = normalizeHex(value)), element);\n    });\n    prevEventHandler = ({ detail }) => {\n      if (detail.action.type === \"scratch-paint/color-index/CHANGE_COLOR_INDEX\") {\n        setTimeout(() => {\n          const color = getColor(element);\n          saColorPickerColor.value = color || \"#000000\";\n          saColorPickerText.value = color || \"\";\n        }, 100);\n      }\n    };\n    addon.tab.redux.addEventListener(\"statechanged\", prevEventHandler);\n    saColorPicker.appendChild(saColorPickerColor);\n    saColorPicker.appendChild(saColorPickerText);\n    element.parentElement.insertBefore(saColorPicker, element);\n  }\n};\n","import codeEditorHandler from \"./code-editor.js\";\n\nexport default async (api) => {\n  codeEditorHandler(api);\n};\n","export default async function ({ addon, global, console }) {\n  var BlocklyInstance = await addon.tab.traps.getBlockly();\n\n  (function (Blockly) {\n    const BlockSvg = BlocklyInstance.BlockSvg;\n    var vm = addon.tab.traps.vm;\n\n    const { GRID_UNIT } = BlockSvg;\n    var multiplier;\n    var cornerSize;\n    var notchSize;\n\n    function updateAllBlocks() {\n      const workspace = Blockly.getMainWorkspace();\n      if (workspace) {\n        if (vm.editingTarget) {\n          vm.emitWorkspaceUpdate();\n        }\n        const flyout = workspace.getFlyout();\n        if (flyout) {\n          const flyoutWorkspace = flyout.getWorkspace();\n          Blockly.Xml.clearWorkspaceAndLoadFromXml(Blockly.Xml.workspaceToDom(flyoutWorkspace), flyoutWorkspace);\n          workspace.getToolbox().refreshSelection();\n          workspace.toolboxRefreshEnabled_ = true;\n        }\n      }\n    }\n\n    function applyChanges() {\n      multiplier = addon.settings.get(\"paddingSize\") / 100;\n      cornerSize = addon.settings.get(\"cornerSize\") / 100;\n      notchSize = addon.settings.get(\"notchSize\") / 100;\n      BlockSvg.SEP_SPACE_Y = 2 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_X = 16 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_X_OUTPUT = 12 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_X_SHADOW_OUTPUT = 10 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_Y = 12 * GRID_UNIT * multiplier;\n      BlockSvg.EXTRA_STATEMENT_ROW_Y = 8 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_X_WITH_STATEMENT = 40 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_Y_SINGLE_FIELD_OUTPUT = 8 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_BLOCK_Y_REPORTER = 10 * GRID_UNIT * multiplier;\n      BlockSvg.MIN_STATEMENT_INPUT_HEIGHT = 6 * GRID_UNIT * multiplier;\n      BlockSvg.NOTCH_WIDTH = 8 * GRID_UNIT * multiplier;\n      BlockSvg.NOTCH_HEIGHT = 2 * GRID_UNIT * multiplier * notchSize;\n      BlockSvg.NOTCH_START_PADDING = 3 * GRID_UNIT; //* multiplier\n      BlockSvg.ICON_SEPARATOR_HEIGHT = 10 * GRID_UNIT * multiplier;\n      BlockSvg.NOTCH_PATH_LEFT =\n        \"c 2,0 3,\" +\n        1 * notchSize +\n        \" 4,\" +\n        2 * notchSize +\n        \" l \" +\n        4 * multiplier * notchSize +\n        \",\" +\n        4 * multiplier * notchSize +\n        \" c 1,\" +\n        1 * notchSize +\n        \" 2,\" +\n        2 * notchSize +\n        \" 4,\" +\n        2 * notchSize +\n        \" h \" +\n        24 * (multiplier - 0.5) +\n        \" c 2,0 3,-\" +\n        1 * notchSize +\n        \" 4,-\" +\n        2 * notchSize +\n        \" l \" +\n        4 * multiplier * notchSize +\n        \",\" +\n        -4 * multiplier * notchSize +\n        \"c 1,-\" +\n        1 * notchSize +\n        \" 2,-\" +\n        2 * notchSize +\n        \" 4,-\" +\n        2 * notchSize;\n      BlockSvg.NOTCH_PATH_RIGHT =\n        \"h \" +\n        (-4 * (cornerSize - 1) - 5 * (1 - notchSize)) +\n        \"c -2,0 -3,\" +\n        1 * notchSize +\n        \" -4,\" +\n        2 * notchSize +\n        \" l \" +\n        -4 * multiplier * notchSize +\n        \",\" +\n        4 * multiplier * notchSize +\n        \" c -1,\" +\n        1 * notchSize +\n        \" -2,\" +\n        2 * notchSize +\n        \" -4,\" +\n        2 * notchSize +\n        \" h \" +\n        -24 * (multiplier - 0.5) +\n        \" c -2,0 -3,-\" +\n        1 * notchSize +\n        \" -4,-\" +\n        2 * notchSize +\n        \" l \" +\n        -4 * multiplier * notchSize +\n        \",\" +\n        -4 * multiplier * notchSize +\n        \"c -1,-\" +\n        1 * notchSize +\n        \" -2,-\" +\n        2 * notchSize +\n        \" -4,-\" +\n        2 * notchSize;\n      BlockSvg.INPUT_SHAPE_HEXAGONAL =\n        \"M \" +\n        4 * GRID_UNIT * multiplier +\n        \",0 \" +\n        \" h \" +\n        4 * GRID_UNIT +\n        \" l \" +\n        4 * GRID_UNIT * multiplier +\n        \",\" +\n        4 * GRID_UNIT * multiplier +\n        \" l \" +\n        -4 * GRID_UNIT * multiplier +\n        \",\" +\n        4 * GRID_UNIT * multiplier +\n        \" h \" +\n        -4 * GRID_UNIT +\n        \" l \" +\n        -4 * GRID_UNIT * multiplier +\n        \",\" +\n        -4 * GRID_UNIT * multiplier +\n        \" l \" +\n        4 * GRID_UNIT * multiplier +\n        \",\" +\n        -4 * GRID_UNIT * multiplier +\n        \" z\";\n      BlockSvg.INPUT_SHAPE_HEXAGONAL_WIDTH = 12 * GRID_UNIT * multiplier;\n      BlockSvg.INPUT_SHAPE_ROUND =\n        \"M \" +\n        4 * GRID_UNIT +\n        \",0\" +\n        \" h \" +\n        4 * GRID_UNIT +\n        \" a \" +\n        4 * GRID_UNIT +\n        \" \" +\n        4 * GRID_UNIT +\n        \" 0 0 1 0 \" +\n        8 * GRID_UNIT +\n        \" h \" +\n        -4 * GRID_UNIT +\n        \" a \" +\n        4 * GRID_UNIT +\n        \" \" +\n        4 * GRID_UNIT +\n        \" 0 0 1 0 -\" +\n        8 * GRID_UNIT +\n        \" z\";\n      BlockSvg.INPUT_SHAPE_ROUND_WIDTH = 12 * GRID_UNIT * multiplier;\n      BlockSvg.INPUT_SHAPE_HEIGHT = 8 * GRID_UNIT * multiplier;\n      BlockSvg.FIELD_HEIGHT = 8 * GRID_UNIT * multiplier; // NOTE: Determines string input heights\n      BlockSvg.FIELD_WIDTH = 6 * GRID_UNIT * Math.min(multiplier, 1) + 10 * GRID_UNIT * Math.max(multiplier - 1, 0);\n      BlockSvg.FIELD_DEFAULT_CORNER_RADIUS = 4 * GRID_UNIT * multiplier;\n      BlockSvg.EDITABLE_FIELD_PADDING = 1.5 * GRID_UNIT * multiplier;\n      BlockSvg.BOX_FIELD_PADDING = 2 * GRID_UNIT * multiplier;\n      BlockSvg.DROPDOWN_ARROW_PADDING = 2 * GRID_UNIT * multiplier;\n      BlockSvg.FIELD_WIDTH_MIN_EDIT = 8 * GRID_UNIT * multiplier;\n      BlockSvg.INPUT_AND_FIELD_MIN_X = 12 * GRID_UNIT * multiplier;\n      BlockSvg.INLINE_PADDING_Y = 1 * GRID_UNIT * multiplier; // For when reporters are inside reporters\n      BlockSvg.SHAPE_IN_SHAPE_PADDING[1][0] = 5 * GRID_UNIT * multiplier;\n      BlockSvg.SHAPE_IN_SHAPE_PADDING[1][2] = 5 * GRID_UNIT * multiplier;\n      BlockSvg.SHAPE_IN_SHAPE_PADDING[1][3] = 5 * GRID_UNIT * multiplier;\n\n      var originalDropdownObject = BlocklyInstance.FieldDropdown.prototype.positionArrow;\n      BlocklyInstance.FieldDropdown.prototype.positionArrow = function (x) {\n        this.arrowY_ = 11 * multiplier;\n        return originalDropdownObject.call(this, x);\n      };\n\n      //Corner setting\n      BlockSvg.CORNER_RADIUS = (1 * GRID_UNIT * addon.settings.get(\"cornerSize\")) / 100;\n\n      BlockSvg.TOP_LEFT_CORNER_START = \"m 0,\" + BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.TOP_LEFT_CORNER =\n        \"A \" + BlockSvg.CORNER_RADIUS + \",\" + BlockSvg.CORNER_RADIUS + \" 0 0,1 \" + BlockSvg.CORNER_RADIUS + \",0\";\n\n      BlockSvg.TOP_RIGHT_CORNER =\n        \"a \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS +\n        \" 0 0,1 \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.BOTTOM_RIGHT_CORNER =\n        \" a \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS +\n        \" 0 0,1 -\" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.BOTTOM_LEFT_CORNER =\n        \"a \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS +\n        \" 0 0,1 -\" +\n        BlockSvg.CORNER_RADIUS +\n        \",-\" +\n        BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.INNER_TOP_LEFT_CORNER =\n        \" a \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS +\n        \" 0 0,0 -\" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.INNER_BOTTOM_LEFT_CORNER =\n        \"a \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS +\n        \" 0 0,0 \" +\n        BlockSvg.CORNER_RADIUS +\n        \",\" +\n        BlockSvg.CORNER_RADIUS;\n\n      BlockSvg.TOP_RIGHT_CORNER_DEFINE_HAT =\n        \"a \" +\n        BlockSvg.DEFINE_HAT_CORNER_RADIUS +\n        \",\" +\n        BlockSvg.DEFINE_HAT_CORNER_RADIUS +\n        \" 0 0,1 \" +\n        BlockSvg.DEFINE_HAT_CORNER_RADIUS +\n        \",\" +\n        BlockSvg.DEFINE_HAT_CORNER_RADIUS +\n        \" v \" +\n        (1 * GRID_UNIT - BlockSvg.CORNER_RADIUS);\n\n      BlockSvg.STATEMENT_INPUT_INNER_SPACE = 2.8 * GRID_UNIT - 0.9 * GRID_UNIT * cornerSize;\n    }\n\n    function applyAndUpdate() {\n      applyChanges();\n      updateAllBlocks();\n    }\n\n    addon.settings.addEventListener(\"change\", function () {\n      applyAndUpdate();\n    });\n\n    applyAndUpdate();\n  })(window.Blockly);\n}\n","export default async function ({ addon, global, console }) {\n  await addon.tab.traps.getBlockly();\n\n  let controlsRect;\n  let previousIsHovered = false;\n  const speeds = {\n    none: \"0s\",\n    short: \"0.25s\",\n    default: \"0.5s\",\n    long: \"1s\",\n  };\n\n  const customZoomAreaElement = document.createElement(\"div\");\n  customZoomAreaElement.className = \"sa-custom-zoom-area\";\n\n  function update() {\n    document.removeEventListener(\"mousemove\", onMouseMove);\n\n    if (addon.tab.editorMode !== \"editor\") return;\n\n    Blockly.getMainWorkspace().options.zoomOptions.maxScale = addon.settings.get(\"maxZoom\") / 100;\n    Blockly.getMainWorkspace().options.zoomOptions.minScale = addon.settings.get(\"minZoom\") / 100;\n    Blockly.getMainWorkspace().options.zoomOptions.startScale = addon.settings.get(\"startZoom\") / 100;\n    Blockly.getMainWorkspace().options.zoomOptions.scaleSpeed = 1 + 0.2 * (addon.settings.get(\"zoomSpeed\") / 100);\n\n    const svgGroup = getZoomControls();\n    const autohide = addon.settings.get(\"autohide\");\n    if (svgGroup) svgGroup.classList.toggle(\"sa-custom-zoom-hidden\", autohide);\n    if (autohide) {\n      const injectionDiv = document.querySelector(\".injectionDiv\");\n      injectionDiv.appendChild(customZoomAreaElement);\n      updateRect();\n      document.addEventListener(\"mousemove\", onMouseMove);\n    }\n  }\n\n  function getZoomControls() {\n    const zoomControls = Blockly.getMainWorkspace().zoomControls_;\n    if (zoomControls) return zoomControls.svgGroup_;\n    return null;\n  }\n\n  function onMouseMove(e) {\n    const isHovered =\n      e.x > controlsRect.left && e.x < controlsRect.right && e.y > controlsRect.top && e.y < controlsRect.bottom;\n    if (isHovered !== previousIsHovered) {\n      previousIsHovered = isHovered;\n      const svgGroup = getZoomControls();\n      if (svgGroup) {\n        svgGroup.style.setProperty(\"--sa-custom-zoom-speed\", speeds[addon.settings.get(\"speed\")]);\n        svgGroup.classList.toggle(\"sa-custom-zoom-hidden\", !isHovered);\n      }\n    }\n  }\n\n  function updateRect() {\n    controlsRect = customZoomAreaElement.getBoundingClientRect();\n  }\n\n  function onResize() {\n    if (addon.tab.editorMode === \"editor\" && addon.settings.get(\"autohide\")) {\n      updateRect();\n    }\n  }\n\n  await addon.tab.waitForElement(\".blocklyZoom\");\n  if (document.querySelector('[class^=\"backpack_backpack-container\"]')) {\n    window.dispatchEvent(new Event(\"resize\"));\n  }\n  update();\n  addon.tab.addEventListener(\"urlChange\", update);\n  addon.settings.addEventListener(\"change\", update);\n  window.addEventListener(\"resize\", onResize);\n}\n","export default async function ({ addon, global, console, msg, safeMsg }) {\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\n\n  const SMALL_GAP = 8;\n  const BIG_GAP = 24;\n\n  const vm = addon.tab.traps.vm;\n\n  // Used in setting change handler. Updated in getBlocksXML.\n  // (Yes this is weird but it's how it was originally and I'm too scared to change it)\n  let hasSeparateListCategory = false;\n\n  const separateVariablesByType = (toolboxXML) => {\n    const listButtonIndex = toolboxXML.findIndex(\n      (i) => i.getAttribute(\"callbackkey\") === \"CREATE_LIST\" || i.getAttribute(\"type\") === \"data_addtolist\"\n    );\n    return {\n      variables: toolboxXML.slice(0, listButtonIndex),\n      lists: toolboxXML.slice(listButtonIndex, toolboxXML.length),\n    };\n  };\n\n  const separateLocalVariables = (workspace, toolboxXML) => {\n    const { variables, lists } = separateVariablesByType(toolboxXML);\n\n    const makeLabel = (l10n) => {\n      const label = document.createElement(\"label\");\n      label.setAttribute(\"text\", msg(l10n));\n      return label;\n    };\n\n    const fixGaps = (variables) => {\n      if (variables.length > 0) {\n        for (var i = 0; i < variables.length - 1; i++) {\n          variables[i].setAttribute(\"gap\", SMALL_GAP);\n        }\n        variables[i].setAttribute(\"gap\", BIG_GAP);\n      }\n    };\n\n    const separateVariablesByScope = (xml) => {\n      const before = [];\n      const global = [];\n      const local = [];\n      const after = [];\n\n      for (const blockXML of xml) {\n        if (blockXML.hasAttribute(\"id\")) {\n          const id = blockXML.getAttribute(\"id\");\n          const variable = workspace.getVariableById(id);\n          if (!variable || !variable.isLocal) {\n            global.push(blockXML);\n          } else {\n            local.push(blockXML);\n          }\n        } else if (global.length || local.length) {\n          after.push(blockXML);\n        } else {\n          before.push(blockXML);\n        }\n      }\n\n      const result = before;\n\n      if (global.length) {\n        result.push(makeLabel(\"for-all-sprites\"));\n        fixGaps(global);\n        result.push(...global);\n      }\n\n      if (local.length) {\n        result.push(makeLabel(\"for-this-sprite-only\"));\n        fixGaps(local);\n        result.push(...local);\n      }\n\n      return result.concat(after);\n    };\n\n    return separateVariablesByScope(variables).concat(separateVariablesByScope(lists));\n  };\n\n  const moveReportersDown = (toolboxXML) => {\n    const { variables, lists } = separateVariablesByType(toolboxXML);\n\n    const moveReportersToEnd = (xml) => {\n      const reporters = [];\n      const everythingElse = [];\n\n      for (const blockXML of xml) {\n        if (blockXML.hasAttribute(\"id\") || blockXML.tagName === \"BUTTON\") {\n          // Round reporters and the create variable button\n          reporters.push(blockXML);\n        } else {\n          // Everything else like \"change variable by 1\"\n          everythingElse.push(blockXML);\n        }\n      }\n\n      if (everythingElse.length) {\n        everythingElse[everythingElse.length - 1].setAttribute(\"gap\", BIG_GAP);\n      }\n\n      return everythingElse.concat(reporters);\n    };\n\n    return moveReportersToEnd(variables).concat(moveReportersToEnd(lists));\n  };\n\n  const DataCategory = ScratchBlocks.DataCategory;\n  let variableCategory;\n  let listCategory;\n  const variableCategoryCallback = (workspace) => {\n    let result = DataCategory(workspace);\n\n    if (addon.settings.get(\"moveReportersDown\")) {\n      result = moveReportersDown(result);\n    }\n\n    if (addon.settings.get(\"separateLocalVariables\")) {\n      result = separateLocalVariables(workspace, result);\n    }\n\n    if (!hasSeparateListCategory) {\n      return result;\n    }\n\n    const { variables, lists } = separateVariablesByType(result);\n    variableCategory = variables;\n    listCategory = lists;\n    return variableCategory;\n  };\n  const listCategoryCallback = () => {\n    // Computed in variable category callback, which should be called before this method.\n    return listCategory;\n  };\n\n  // Each time a new workspace is made, these callbacks are reset, so re-register whenever a flyout is shown.\n  // https://github.com/LLK/scratch-blocks/blob/61f02e4cac0f963abd93013842fe536ef24a0e98/core/flyout_base.js#L469\n  const oldShow = ScratchBlocks.Flyout.prototype.show;\n  ScratchBlocks.Flyout.prototype.show = function (xmlList) {\n    this.workspace_.registerToolboxCategoryCallback(\"VARIABLE\", variableCategoryCallback);\n    this.workspace_.registerToolboxCategoryCallback(\"LIST\", listCategoryCallback);\n    return oldShow.call(this, xmlList);\n  };\n\n  // Use Scratch's extension category mechanism to replace the data category with our own.\n  // https://github.com/LLK/scratch-gui/blob/ddd2fa06f2afa140a46ec03be91796ded861e65c/src/containers/blocks.jsx#L344\n  // https://github.com/LLK/scratch-gui/blob/2ceab00370ad7bd8ecdf5c490e70fd02152b3e2a/src/lib/make-toolbox-xml.js#L763\n  // https://github.com/LLK/scratch-vm/blob/a0c11d6d8664a4f2d55632e70630d09ec6e9ae28/src/engine/runtime.js#L1381\n  const originalGetBlocksXML = vm.runtime.getBlocksXML;\n  vm.runtime.getBlocksXML = function (target) {\n    const result = originalGetBlocksXML.call(this, target);\n    hasSeparateListCategory = addon.settings.get(\"separateListCategory\");\n    if (hasSeparateListCategory) {\n      result.push({\n        id: \"data\",\n        xml: `\n        <category\n          name=\"%{BKY_CATEGORY_VARIABLES}\"\n          id=\"variables\"\n          colour=\"#FF8C1A\"\n          secondaryColour=\"#DB6E00\"\n          custom=\"VARIABLE\">\n        </category>\n        <category\n          name=\"${safeMsg(\"list-category\")}\"\n          id=\"lists\"\n          colour=\"#FF661A\"\n          secondaryColour=\"#FF5500\"\n          custom=\"LIST\">\n        </category>`,\n      });\n    }\n    return result;\n  };\n\n  // If editingTarget is set, the editor has already rendered and we have to tell it to rerender.\n  if (vm.editingTarget) {\n    vm.emitWorkspaceUpdate();\n  }\n\n  addon.settings.addEventListener(\"change\", (e) => {\n    // When the separate list category option changes, we need to do a workspace update.\n    // For all other options, just refresh the toolbox.\n    // Always doing both of these in response to a settings change causes many issues.\n    if (addon.settings.get(\"separateListCategory\") !== hasSeparateListCategory) {\n      if (vm.editingTarget) {\n        vm.emitWorkspaceUpdate();\n      }\n    } else {\n      const workspace = Blockly.getMainWorkspace();\n      if (workspace) {\n        workspace.refreshToolboxSelection_();\n      }\n    }\n  });\n}\n","module.exports = __webpack_public_path__ + \"static/assets/455223e1a9618fe4f791df0e4551169d.svg\";","module.exports = __webpack_public_path__ + \"static/assets/d0441b753c807751826d68d84895782b.svg\";","module.exports = __webpack_public_path__ + \"static/assets/8d6ca9b4f4cc4dc9092037a605c33778.svg\";","module.exports = __webpack_public_path__ + \"static/assets/42331b999633094b4072c9c67e5d14e4.svg\";","module.exports = __webpack_public_path__ + \"static/assets/6c2d79195b3f2cc87e6155b166674a25.svg\";","module.exports = __webpack_public_path__ + \"static/assets/76b6cb627b95d79705c0b41664064f0e.svg\";","module.exports = __webpack_public_path__ + \"static/assets/22e4dbb6a50a0e9f7409245d5983a5c9.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./add.svg\";\nimport _twAsset1 from \"./debug-unread.svg\";\nimport _twAsset2 from \"./debug.svg\";\nimport _twAsset3 from \"./delete.svg\";\nimport _twAsset4 from \"./download-white.svg\";\nimport _twAsset5 from \"./error.svg\";\nimport _twAsset6 from \"./play.svg\";\nimport _twAsset7 from \"./warning.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/add.svg\") return _twAsset0;\n  if (path === \"/debug-unread.svg\") return _twAsset1;\n  if (path === \"/debug.svg\") return _twAsset2;\n  if (path === \"/delete.svg\") return _twAsset3;\n  if (path === \"/download-white.svg\") return _twAsset4;\n  if (path === \"/error.svg\") return _twAsset5;\n  if (path === \"/play.svg\") return _twAsset6;\n  if (path === \"/warning.svg\") return _twAsset7;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport downloadBlob from \"../../libraries/common/cs/download-blob.js\";\nimport { paused, setPaused, onPauseChanged } from \"./../pause/module.js\";\n\nexport default async function ({ addon, global, console, msg }) {\n  let showingConsole, ScratchBlocks;\n  const vm = addon.tab.traps.vm;\n\n  const container = document.createElement(\"div\");\n  container.className = \"sa-debugger-container\";\n  const buttonContainer = document.createElement(\"div\");\n  buttonContainer.className = addon.tab.scratchClass(\"button_outlined-button\", \"stage-header_stage-button\");\n  const buttonContent = document.createElement(\"div\");\n  buttonContent.className = addon.tab.scratchClass(\"button_content\");\n  const buttonImage = document.createElement(\"img\");\n  buttonImage.className = addon.tab.scratchClass(\"stage-header_stage-button-icon\");\n  buttonImage.draggable = false;\n  buttonImage.src = _twGetAsset(\"/debug.svg\");\n  buttonContent.appendChild(buttonImage);\n  buttonContainer.appendChild(buttonContent);\n  container.appendChild(buttonContainer);\n  buttonContainer.addEventListener(\"click\", () => toggleConsole(true));\n\n  const pause = () => {\n    setPaused(!paused);\n    const pauseAddonButton = document.querySelector(\".pause-btn\");\n    if (!pauseAddonButton || getComputedStyle(pauseAddonButton).display === \"none\") toggleConsole(true);\n  };\n  addon.tab.addBlock(\"\\u200B\\u200Bbreakpoint\\u200B\\u200B\", [], pause);\n  addon.tab.addBlock(\"\\u200B\\u200Blog\\u200B\\u200B %s\", [\"content\"], ({ content }, thread) => {\n    addItem(content, thread, \"log\");\n  });\n  addon.tab.addBlock(\"\\u200B\\u200Bwarn\\u200B\\u200B %s\", [\"content\"], ({ content }, thread) => {\n    addItem(content, thread, \"warn\");\n  });\n  addon.tab.addBlock(\"\\u200B\\u200Berror\\u200B\\u200B %s\", [\"content\"], ({ content }, thread) => {\n    addItem(content, thread, \"error\");\n  });\n\n  const consoleWrapper = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_card\", { others: \"debug\" }),\n  });\n  const consoleTitle = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_header-buttons\"),\n  });\n  const consoleText = Object.assign(document.createElement(\"h1\"), {\n    innerText: msg(\"console\"),\n  });\n  const extraContainer = Object.assign(document.createElement(\"div\"), {\n    className: `extra-log-container`,\n  });\n\n  const goToBlock = (targetId, blockId) => {\n    const workspace = Blockly.getMainWorkspace();\n\n    const offsetX = 32,\n      offsetY = 32;\n    if (targetId !== vm.editingTarget.id) {\n      // note: this is O(n) so don't call it if unnecessary!\n      if (vm.runtime.getTargetById(targetId)) {\n        vm.setEditingTarget(targetId);\n        // Should not cause recursion\n        setTimeout(() => goToBlock(targetId, blockId), 300);\n      }\n      return;\n    }\n    const block = workspace.getBlockById(blockId);\n    if (!block) return;\n\n    // Don't scroll to blocks in the flyout\n    if (block.workspace.isFlyout) return;\n\n    // Make sure the code tab is active\n    if (addon.tab.redux.state.scratchGui.editorTab.activeTabIndex !== 0) {\n      addon.tab.redux.dispatch({\n        type: \"scratch-gui/navigation/ACTIVATE_TAB\",\n        activeTabIndex: 0,\n      });\n      setTimeout(() => goToBlock(targetId, blockId), 0);\n      return;\n    }\n\n    // Copied from devtools. If it's code gets improved for this function, bring those changes here too.\n    let root = block.getRootBlock();\n\n    let base = block;\n    while (base.getOutputShape() && base.getSurroundParent()) {\n      base = base.getSurroundParent();\n    }\n\n    let ePos = base.getRelativeToSurfaceXY(), // Align with the top of the block\n      rPos = root.getRelativeToSurfaceXY(), // Align with the left of the block 'stack'\n      scale = workspace.scale,\n      x = rPos.x * scale,\n      y = ePos.y * scale,\n      xx = block.width + x, // Turns out they have their x & y stored locally, and they are the actual size rather than scaled or including children...\n      yy = block.height + y,\n      s = workspace.getMetrics();\n    if (\n      x < s.viewLeft + offsetX - 4 ||\n      xx > s.viewLeft + s.viewWidth ||\n      y < s.viewTop + offsetY - 4 ||\n      yy > s.viewTop + s.viewHeight\n    ) {\n      let sx = x - s.contentLeft - offsetX,\n        sy = y - s.contentTop - offsetY;\n\n      workspace.scrollbar.set(sx, sy);\n    }\n    // Flashing\n    const myFlash = { block: null, timerID: null, colour: null };\n    if (myFlash.timerID > 0) {\n      clearTimeout(myFlash.timerID);\n      myFlash.block.setColour(myFlash.colour);\n    }\n\n    let count = 4;\n    let flashOn = true;\n    myFlash.colour = block.getColour();\n    myFlash.block = block;\n\n    function _flash() {\n      if (!myFlash.block.svgPath_) {\n        myFlash.timerID = count = 0;\n        flashOn = true;\n        return;\n      }\n      myFlash.block.svgPath_.style.fill = flashOn ? \"#ffff80\" : myFlash.colour;\n      flashOn = !flashOn;\n      count--;\n      if (count > 0) {\n        myFlash.timerID = setTimeout(_flash, 200);\n      } else {\n        myFlash.timerID = 0;\n      }\n    }\n\n    _flash();\n  };\n  extraContainer.addEventListener(\"click\", (e) => {\n    const elem = e.target;\n    if (elem.classList.contains(\"deletedTarget\")) return;\n    const targetId = elem.dataset.targetId;\n    const blockId = elem.dataset.blockId;\n    if (targetId && blockId) goToBlock(targetId, blockId);\n  });\n  const consoleList = Object.assign(document.createElement(\"div\"), {\n    className: \"logs\",\n  });\n  const buttons = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_header-buttons-right\"),\n  });\n\n  const unpauseButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\", { others: \"sa-debugger-unpause\" }),\n    draggable: false,\n  });\n  const unpauseImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/play.svg\"),\n  });\n  const unpauseText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"unpause\"),\n  });\n\n  const exportButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\"),\n    title: msg(\"export-desc\"),\n    draggable: false,\n  });\n  const exportImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/download-white.svg\"),\n  });\n  const exportText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"export\"),\n  });\n\n  const trashButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\"),\n    draggable: false,\n  });\n  const trashImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/delete.svg\"),\n  });\n  const trashText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"clear\"),\n  });\n\n  const closeButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_remove-button\"),\n    draggable: false,\n  });\n  const closeImg = Object.assign(document.createElement(\"img\"), {\n    className: addon.tab.scratchClass(\"close-button_close-icon\"),\n    src: _twGetAsset(\"/add.svg\"),\n  });\n  const closeText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"close\"),\n  });\n\n  consoleTitle.append(consoleText, buttons);\n  buttons.append(unpauseButton, exportButton, trashButton, closeButton);\n  trashButton.append(trashImg, trashText);\n  closeButton.append(closeImg, closeText);\n  exportButton.append(exportImg, exportText);\n  unpauseButton.append(unpauseImg, unpauseText);\n  extraContainer.append(consoleList);\n  consoleWrapper.append(consoleTitle, extraContainer);\n  document.body.append(consoleWrapper);\n\n  consoleTitle.addEventListener(\"mousedown\", dragMouseDown);\n\n  let isScrolledToEnd = true;\n  extraContainer.addEventListener(\n    \"wheel\",\n    (e) => {\n      // When user scrolls up, stop automatically scrolling down\n      if (e.deltaY < 0) {\n        isScrolledToEnd = false;\n      }\n    },\n    { passive: true }\n  );\n  extraContainer.addEventListener(\n    \"scroll\",\n    () => {\n      isScrolledToEnd = extraContainer.scrollTop + 5 >= extraContainer.scrollHeight - extraContainer.clientHeight;\n    },\n    { passive: true }\n  );\n\n  const getTargetInfo = (id, cache = null) => {\n    if (cache && cache[id]) return cache[id];\n    const target = vm.runtime.getTargetById(id);\n    let item;\n    if (target) {\n      item = { name: target.getName(), isDeleted: false };\n    } else {\n      item = { name: msg(\"deleted-sprite\"), isDeleted: true };\n    }\n    if (cache) cache[id] = item;\n    return item;\n  };\n\n  let mouseOffsetX = 0;\n  let mouseOffsetY = 0;\n  let lastX = 0;\n  let lastY = 0;\n\n  function dragMouseDown(e) {\n    e.preventDefault();\n    mouseOffsetX = e.clientX - consoleWrapper.offsetLeft;\n    mouseOffsetY = e.clientY - consoleWrapper.offsetTop;\n    lastX = e.clientX;\n    lastY = e.clientY;\n    document.addEventListener(\"mouseup\", closeDragElement);\n    document.addEventListener(\"mousemove\", elementDrag);\n  }\n\n  function dragConsole(x, y) {\n    lastX = x;\n    lastY = y;\n    const width = (document.documentElement.clientWidth || document.body.clientWidth) - 1;\n    const height = (document.documentElement.clientHeight || document.body.clientHeight) - 1;\n    const clampedX = Math.max(0, Math.min(x - mouseOffsetX, width - consoleWrapper.offsetWidth));\n    const clampedY = Math.max(0, Math.min(y - mouseOffsetY, height - consoleWrapper.offsetHeight));\n    consoleWrapper.style.left = clampedX + \"px\";\n    consoleWrapper.style.top = clampedY + \"px\";\n  }\n\n  function elementDrag(e) {\n    e.preventDefault();\n    dragConsole(e.clientX, e.clientY);\n  }\n\n  window.addEventListener(\"resize\", () => {\n    dragConsole(lastX, lastY);\n  });\n\n  function closeDragElement() {\n    // stop moving when mouse button is released:\n    document.removeEventListener(\"mouseup\", closeDragElement);\n    document.removeEventListener(\"mousemove\", elementDrag);\n  }\n\n  trashButton.addEventListener(\"click\", () => {\n    document.querySelectorAll(\".log\").forEach((log, i) => log.remove());\n    closeDragElement();\n    logs = [];\n    isScrolledToEnd = true;\n  });\n  trashButton.addEventListener(\"mouseup\", () => {\n    closeDragElement();\n  });\n  closeButton.addEventListener(\"click\", () => toggleConsole(false));\n  closeButton.addEventListener(\"mouseup\", () => closeDragElement());\n  let download = (filename, text) => downloadBlob(filename, new Blob([text], { type: \"text/plain\" }));\n\n  unpauseButton.addEventListener(\"click\", () => setPaused(false));\n  if (!paused) unpauseButton.style.display = \"none\";\n  onPauseChanged((newPauseValue) => (unpauseButton.style.display = newPauseValue ? \"\" : \"none\"));\n\n  exportButton.addEventListener(\"click\", (e) => {\n    const defaultFormat = \"{sprite}: {content} ({type})\";\n    const exportFormat = e.shiftKey ? prompt(msg(\"enter-format\"), defaultFormat) : defaultFormat;\n    if (!exportFormat) return;\n    closeDragElement();\n    const targetInfoCache = Object.create(null);\n    let file = logs\n      .map(({ targetId, type, content }) =>\n        exportFormat.replace(\n          /\\{(sprite|type|content)\\}/g,\n          (_, match) =>\n            ({\n              sprite: getTargetInfo(targetId, targetInfoCache).name,\n              type,\n              content,\n            }[match])\n        )\n      )\n      .join(\"\\n\");\n    download(\"logs.txt\", file);\n  });\n  let logs = [];\n  let scrollQueued = false;\n  const addItem = (content, thread, type) => {\n    const wrapper = document.createElement(\"div\");\n    const span = (text, cl = \"\") => {\n      let s = document.createElement(\"span\");\n      s.innerText = text;\n      s.className = cl;\n      return s;\n    };\n\n    const target = thread.target;\n    const parentTarget = target.isOriginal ? target : target.sprite.clones[0];\n    const targetId = parentTarget.id;\n    wrapper.className = \"log\";\n    wrapper.classList.add(type);\n    consoleList.append(wrapper);\n    if (type !== \"log\") {\n      const imageURL = _twGetAsset((type === \"error\" ? \"/error.svg\" : \"/warning.svg\"));\n      const icon = document.createElement(\"img\");\n      icon.src = imageURL;\n      icon.alt = icon.title = msg(\"icon-\" + type);\n      icon.className = \"logIcon\";\n      wrapper.appendChild(icon);\n    }\n\n    const blockId = thread.peekStack();\n    const block = target.blocks.getBlock(blockId);\n    if (block && ScratchBlocks) {\n      const inputId = Object.values(block.inputs)[0]?.block;\n      const inputBlock = target.blocks.getBlock(inputId);\n      if (inputBlock && inputBlock.opcode !== \"text\") {\n        let text, category;\n        if (inputBlock.opcode === \"data_variable\" || inputBlock.opcode === \"data_listcontents\") {\n          text = Object.values(inputBlock.fields)[0].value;\n          category = inputBlock.opcode === \"data_variable\" ? \"data\" : \"list\";\n        } else {\n          // Try to call things like https://github.com/LLK/scratch-blocks/blob/develop/blocks_vertical/operators.js\n          let jsonData;\n          const fakeBlock = {\n            jsonInit(data) {\n              jsonData = data;\n            },\n          };\n          const blockConstructor = ScratchBlocks.Blocks[inputBlock.opcode];\n          if (blockConstructor) {\n            try {\n              blockConstructor.init.call(fakeBlock);\n            } catch (e) {\n              // ignore\n            }\n          }\n          if (jsonData && jsonData.message0 && !jsonData.args0) {\n            text = jsonData.message0;\n            category = jsonData.category;\n          }\n        }\n        if (text && category) {\n          const inputSpan = document.createElement(\"span\");\n          inputSpan.textContent = text;\n          inputSpan.className = \"console-variable\";\n          inputSpan.dataset.category = category === \"list\" ? \"data-lists\" : category;\n          const blocklyColor = ScratchBlocks.Colours[category === \"list\" ? \"data_lists\" : category];\n          if (blocklyColor) {\n            inputSpan.style.backgroundColor = blocklyColor.primary;\n            wrapper.append(inputSpan);\n          }\n        }\n      }\n    }\n    logs.push({\n      targetId,\n      type,\n      content,\n    });\n    wrapper.append(span(content));\n\n    let link = document.createElement(\"a\");\n    link.textContent = target.isOriginal\n      ? target.getName()\n      : msg(\"clone-of\", {\n          spriteName: parentTarget.getName(),\n        });\n    link.className = \"logLink\";\n    link.dataset.blockId = blockId;\n    link.dataset.targetId = targetId;\n    if (!target.isOriginal) {\n      link.dataset.isClone = \"true\";\n    }\n\n    wrapper.appendChild(link);\n\n    if (!scrollQueued && isScrolledToEnd) {\n      scrollQueued = true;\n      queueMicrotask(scrollToEnd);\n    }\n    if (!showingConsole) {\n      const unreadImage = _twGetAsset(\"/debug-unread.svg\");\n      if (buttonImage.src !== unreadImage) buttonImage.src = unreadImage;\n    }\n  };\n  const scrollToEnd = () => {\n    scrollQueued = false;\n    extraContainer.scrollTop = extraContainer.scrollHeight;\n  };\n  const toggleConsole = (show = !showingConsole) => {\n    showingConsole = show;\n    consoleWrapper.style.display = show ? \"flex\" : \"\";\n    if (show) {\n      buttonImage.src = _twGetAsset(\"/debug.svg\");\n      const cacheObj = Object.create(null);\n      for (const logLinkElem of document.getElementsByClassName(\"logLink\")) {\n        const targetId = logLinkElem.dataset.targetId;\n        if (!targetId) return;\n        const tInfo = getTargetInfo(targetId, cacheObj);\n        logLinkElem.textContent = tInfo.name;\n        if (tInfo.isDeleted) {\n          logLinkElem.classList.add(\"deletedTarget\");\n        } else if (logLinkElem.dataset.isClone) {\n          logLinkElem.textContent = msg(\"clone-of\", { spriteName: tInfo.name });\n        }\n      }\n      if (isScrolledToEnd) {\n        scrollToEnd();\n      }\n    }\n  };\n\n  while (true) {\n    const stageHeaderSizeControls = await addon.tab.waitForElement('[class*=\"stage-header_stage-size-row\"]', {\n      markAsSeen: true,\n      reduxEvents: [\n        \"scratch-gui/mode/SET_PLAYER\",\n        \"scratch-gui/mode/SET_FULL_SCREEN\",\n        \"fontsLoaded/SET_FONTS_LOADED\",\n        \"scratch-gui/locales/SELECT_LOCALE\",\n      ],\n    });\n    if (addon.tab.editorMode === \"editor\") {\n      ScratchBlocks = await addon.tab.traps.getBlockly();\n      stageHeaderSizeControls.insertBefore(container, stageHeaderSizeControls.firstChild);\n    } else {\n      toggleConsole(false);\n    }\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/0e009d6e684951615b31a267baa37636.svg\";","export default async function ({ addon, global, console }) {\n  const DRAG_OVER_CLASS = \"sa-dragged-over\";\n\n  const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, \"value\").set;\n  const reactAwareSetValue = (el, value) => {\n    nativeInputValueSetter.call(el, value);\n    el.dispatchEvent(new Event(\"change\", { bubbles: true }));\n  };\n\n  const globalHandleDragOver = (e) => {\n    if (!e.dataTransfer.types.includes(\"Files\")) {\n      return;\n    }\n\n    let el;\n    let callback;\n    if (\n      (el = e.target.closest('div[class*=\"sprite-selector_sprite-selector\"]')) ||\n      (el = e.target.closest('div[class*=\"stage-selector_stage-selector\"]')) ||\n      (el = e.target.closest('div[class*=\"selector_wrapper\"]'))\n    ) {\n      callback = (files) => {\n        const fileInput = el.querySelector('input[class*=\"action-menu_file-input\"]');\n        fileInput.files = files;\n        fileInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n      };\n    } else if ((el = e.target.closest('div[class*=\"monitor_list-monitor\"]'))) {\n      callback = (files) => {\n        const contextMenuBefore = document.querySelector(\"body > .react-contextmenu.react-contextmenu--visible\");\n        // Simulate a right click on the list monitor\n        el.dispatchEvent(new MouseEvent(\"contextmenu\", { bubbles: true }));\n        // Get the right click menu that opened (monitor context menus are\n        // children of <body>)\n        const contextMenuAfter = document.querySelector(\"body > .react-contextmenu.react-contextmenu--visible\");\n        // `contextMenuAfter` is only null if the context menu was already open\n        // for the list monitor, in which case we can use the context menu from\n        // before the simulated right click\n        const contextMenu = contextMenuAfter === null ? contextMenuBefore : contextMenuAfter;\n        // Sometimes the menu flashes open, so force hide it.\n        contextMenu.style.display = \"none\";\n        // Override DOM methods to import the text file directly\n        // See: https://github.com/LLK/scratch-gui/blob/develop/src/lib/import-csv.js#L21-L22\n        const appendChild = document.body.appendChild;\n        document.body.appendChild = (fileInput) => {\n          // Restore appendChild to <body>\n          document.body.appendChild = appendChild;\n          if (fileInput instanceof HTMLInputElement) {\n            document.body.appendChild(fileInput);\n            // Prevent Scratch from opening the file input dialog\n            fileInput.click = () => {};\n            // Insert files from the drop event into the file input\n            fileInput.files = files;\n            fileInput.dispatchEvent(new Event(\"change\"));\n            window.requestAnimationFrame(() => {\n              window.requestAnimationFrame(() => {\n                contextMenu.style.display = null;\n                contextMenu.style.opacity = 0;\n                contextMenu.style.pointerEvents = \"none\";\n              });\n            });\n          } else {\n            // The next call for `appendChild` SHOULD be the file input, but if\n            // it's not, then make `appendChild` behave as normal.\n            console.error('File input was not immediately given to appendChild upon clicking \"Import\"!');\n            return appendChild(fileInput);\n          }\n        };\n        // Simulate clicking on the \"Import\" option\n        contextMenu.children[0].click();\n      };\n    } else if (\n      (el = e.target.closest('div[class*=\"question_question-input\"] > input[class*=\"input_input-form_l9eYg\"]'))\n    ) {\n      callback = async (files) => {\n        const text = (await Promise.all(Array.from(files, (file) => file.text())))\n          .join(\"\")\n          // Match pasting behaviour: remove all newline characters at the end\n          .replace(/[\\r\\n]+$/, \"\")\n          .replace(/\\r?\\n|\\r/g, \" \");\n        const selectionStart = el.selectionStart;\n        reactAwareSetValue(el, el.value.slice(0, selectionStart) + text + el.value.slice(el.selectionEnd));\n        el.setSelectionRange(selectionStart, selectionStart + text.length);\n      };\n    }\n    if (!el) {\n      return;\n    }\n\n    e.preventDefault();\n\n    if (el.classList.contains(DRAG_OVER_CLASS)) {\n      return;\n    }\n    el.classList.add(DRAG_OVER_CLASS);\n\n    const handleDrop = (e) => {\n      e.preventDefault();\n      cleanup();\n      if (e.dataTransfer.types.includes(\"Files\") && e.dataTransfer.files.length > 0) {\n        callback(e.dataTransfer.files);\n      }\n    };\n\n    const handleDragOver = (e) => {\n      e.preventDefault();\n    };\n\n    const handleDragLeave = (e) => {\n      e.preventDefault();\n      cleanup();\n    };\n\n    const cleanup = () => {\n      el.classList.remove(DRAG_OVER_CLASS);\n      el.removeEventListener(\"dragover\", handleDragOver);\n      el.removeEventListener(\"dragleave\", handleDragLeave);\n      el.removeEventListener(\"drop\", handleDrop);\n    };\n\n    el.addEventListener(\"dragover\", handleDragOver);\n    el.addEventListener(\"dragleave\", handleDragLeave);\n    el.addEventListener(\"drop\", handleDrop);\n  };\n\n  document.addEventListener(\"dragover\", globalHandleDragOver, true);\n}\n","export default async function ({ addon, global, console }) {\n  document.body.addEventListener(\"mousedown\", handleClick, true);\n}\n\nfunction handleClick(e) {\n  if (e.button !== 2) {\n    return;\n  }\n\n  const widgetDiv = document.querySelector(\".blocklyWidgetDiv\");\n  if (!widgetDiv) {\n    return;\n  }\n\n  let target = e.target;\n  if (target.closest(\".blocklyMainBackground\") || target.closest(\".blocklyBubbleCanvas\")) {\n    widgetDiv.classList.remove(\"u-contextmenu-colored\");\n    return;\n  }\n\n  let block = target.closest(\"[data-id]\");\n  if (!block) {\n    // When right clicking on the boundaries of a block in the flyout,\n    // the click event can happen on a background rectangle and not on the actual block for some reason.\n    // In this case, the block group should immediately follow the rect.\n    if (target.tagName === \"rect\") {\n      target = target.nextSibling;\n      block = target && target.closest(\"[data-id]\");\n    }\n    if (!block) {\n      return;\n    }\n  }\n\n  let blocklyBlock = Blockly.getMainWorkspace().getBlockById(block.dataset.id);\n  // Keep jumping to the parent block until we find a non-shadow block.\n  while (blocklyBlock && blocklyBlock.isShadow()) {\n    blocklyBlock = blocklyBlock.getParent();\n  }\n  if (!blocklyBlock) {\n    return;\n  }\n\n  const background = blocklyBlock.svgPath_;\n  if (!background) {\n    return;\n  }\n\n  const fill = window.getComputedStyle(background).getPropertyValue(\"fill\");\n  if (!fill) {\n    return;\n  }\n\n  const fillHex = fill.substr(1);\n  const rgb = parseInt(fillHex, 16);\n  const hsl = rgb2hsl(rgb);\n  hsl[2] = Math.max(hsl[2] - 15, 0);\n  const border = \"hsl(\" + hsl[0] + \", \" + hsl[1] + \"%, \" + hsl[2] + \"%)\";\n\n  widgetDiv.classList.add(\"u-contextmenu-colored\");\n  widgetDiv.style.setProperty(\"--u-contextmenu-bg\", fill);\n  widgetDiv.style.setProperty(\"--u-contextmenu-border\", border);\n}\n\nfunction rgb2hsl(rgb) {\n  const r = ((rgb >> 16) & 0xff) / 0xff;\n  const g = ((rgb >> 8) & 0xff) / 0xff;\n  const b = (rgb & 0xff) / 0xff;\n\n  const min = Math.min(r, g, b);\n  const max = Math.max(r, g, b);\n\n  if (min === max) {\n    return [0, 0, r * 100];\n  }\n\n  const c = max - min;\n  const l = (min + max) / 2;\n  const s = c / (1 - Math.abs(2 * l - 1));\n\n  var h;\n  switch (max) {\n    case r:\n      h = ((g - b) / c + 6) % 6;\n      break;\n    case g:\n      h = (b - r) / c + 2;\n      break;\n    case b:\n      h = (r - g) / c + 4;\n      break;\n  }\n  h *= 60;\n\n  return [h, s * 100, l * 100];\n}\n","/**\n * Encapsulates a block (either in this sprite or another / Blockly, or native JSON block\n */\nexport default class BlockInstance {\n  constructor(target, block) {\n    this.targetId = target.id;\n    this.id = block.id;\n  }\n}\n","export default class BlockItem {\n  constructor(cls, procCode, labelID, y) {\n    this.cls = cls;\n    this.procCode = procCode;\n    this.labelID = labelID;\n    this.y = y;\n    this.lower = procCode.toLowerCase();\n    /**\n     * An Array of block ids\n     * @type {Array.<string>}\n     */\n    this.clones = null;\n    this.eventName = null;\n  }\n\n  /**\n   * True if the blockID matches a black represented by this BlockItem\n   * @param id\n   * @returns {boolean}\n   */\n  matchesID(id) {\n    if (this.labelID === id) {\n      return true;\n    }\n    if (this.clones) {\n      for (const cloneID of this.clones) {\n        if (cloneID === id) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// import ShowBroadcast from \"./show-broadcast.js\";\nimport Utils from \"./blockly/Utils.js\";\nimport DomHelpers from \"./DomHelpers.js\";\nimport BlockInstance from \"./BlockInstance.js\";\nimport XML from \"./XML.js\";\nimport BlockItem from \"./BlockItem.js\";\nimport UndoGroup from \"./blockly/UndoGroup.js\";\n\nexport default class DevTools {\n  constructor(addon, msg, m, helpHTML) {\n    this.addon = addon;\n    this.msg = msg;\n    this.m = m;\n    /**\n     * @type {VirtualMachine}\n     */\n    this.vm = addon.tab.traps.vm;\n    this.utils = new Utils(addon);\n    this.domHelpers = new DomHelpers(addon);\n    this.multi = new Multi(this.utils);\n\n    this._helpHTML = helpHTML;\n    this.find = null;\n    this.findInp = null;\n    this.ddOut = null;\n    this.dd = null;\n    this.codeTab = null;\n    this.costTab = null;\n    this.costTabBody = null;\n    this.selVarID = null;\n    this.floatInp = null;\n    this.blockCursor = null;\n    this.canShare = false;\n\n    this.mouseXY = { x: 0, y: 0 };\n  }\n\n  init() {\n    setTimeout(() => this.initInner(), 500);\n  }\n\n  isScriptEditor() {\n    return this.codeTab.className.indexOf(\"gui_is-selected\") >= 0;\n  }\n\n  isCostumeEditor() {\n    return this.costTab.className.indexOf(\"gui_is-selected\") >= 0;\n  }\n\n  eventClickHelp(e) {\n    if (!document.getElementById(\"s3devHelpPop\")) {\n      document.body.insertAdjacentHTML(\"beforeend\", this._helpHTML);\n      document.getElementById(\"s3devHelpPop\").addEventListener(\"mousedown\", function (e) {\n        if (e.target.id === \"s3devHelpPop\") {\n          e.target.remove();\n        }\n      });\n      document.querySelector(\"#s3devHelpPop .close-button\").addEventListener(\"click\", function (e) {\n        document.getElementById(\"s3devHelpPop\").remove();\n      });\n    }\n    e.preventDefault();\n  }\n\n  getScratchCostumes() {\n    let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\n    // this.costTab[0].click();\n\n    let myBlocks = [];\n    let myBlocksByProcCode = {};\n\n    /**\n     * @param cls\n     * @param txt\n     * @param root\n     * @returns BlockItem\n     */\n    function addBlock(cls, txt, root) {\n      let id = root.className;\n      let items = new BlockItem(cls, txt, id, 0);\n      myBlocks.push(items);\n      myBlocksByProcCode[txt] = items;\n      return items;\n    }\n\n    let i = 0;\n    for (const costume of costumes) {\n      addBlock(\"costume\", costume.innerText, costume).y = i;\n      i++;\n    }\n\n    return { procs: myBlocks };\n  }\n\n  /**\n   * Fetch the scratch 3 block list\n   * @returns jsonFetch object\n   */\n  getScratchBlocks() {\n    // Access Blockly!\n\n    let myBlocks = [];\n    let myBlocksByProcCode = {};\n\n    // todo - get blockyly from an svg???\n\n    let wksp = this.utils.getWorkspace();\n    let topBlocks = wksp.getTopBlocks();\n\n    // console.log(topBlocks);\n\n    /**\n     * @param cls\n     * @param txt\n     * @param root\n     * @returns BlockItem\n     */\n    function addBlock(cls, txt, root) {\n      let id = root.id ? root.id : root.getId ? root.getId() : null;\n      let clone = myBlocksByProcCode[txt];\n      if (clone) {\n        if (!clone.clones) {\n          clone.clones = [];\n        }\n        clone.clones.push(id);\n        return clone;\n      }\n      let items = new BlockItem(cls, txt, id, 0);\n      items.y = root.getRelativeToSurfaceXY ? root.getRelativeToSurfaceXY().y : null;\n      myBlocks.push(items);\n      myBlocksByProcCode[txt] = items;\n      return items;\n    }\n\n    function getDescFromField(root) {\n      let fields = root.inputList[0];\n      let desc;\n      for (const fieldRow of fields.fieldRow) {\n        desc = (desc ? desc + \" \" : \"\") + fieldRow.getText();\n      }\n      return desc;\n    }\n\n    for (const root of topBlocks) {\n      if (root.type === \"procedures_definition\") {\n        let fields = root.inputList[0];\n        let typeDesc = fields.fieldRow[0].getText();\n        let label = root.getChildren()[0];\n        let procCode = label.getProcCode();\n        if (!procCode) {\n          continue;\n        }\n        addBlock(\"define\", typeDesc + \" \" + procCode, root);\n        continue;\n      }\n\n      if (root.type === \"event_whenflagclicked\") {\n        addBlock(\"flag\", getDescFromField(root), root); // \"When Flag Clicked\"\n        continue;\n      }\n\n      if (root.type === \"event_whenbroadcastreceived\") {\n        try {\n          // let wksp2 = Blockly.getMainWorkspace().getTopBlocks()[2].inputList[0].fieldRow[1];\n          let fields = root.inputList[0];\n          // let typeDesc = fields.fieldRow[0].getText();\n          let eventName = fields.fieldRow[1].getText();\n          // addBlock('receive', typeDesc + ' ' + eventName, root).eventName = eventName;\n          addBlock(\"receive\", \"event \" + eventName, root).eventName = eventName;\n        } catch (e) {\n          // eat\n        }\n        continue;\n      }\n\n      if (root.type.substr(0, 10) === \"event_when\") {\n        addBlock(\"event\", getDescFromField(root), root); // \"When Flag Clicked\"\n        continue;\n      }\n\n      if (root.type === \"control_start_as_clone\") {\n        addBlock(\"event\", getDescFromField(root), root); // \"when I start as a clone\"\n        continue;\n      }\n    }\n\n    let map = wksp.getVariableMap();\n\n    let vars = map.getVariablesOfType(\"\");\n    for (const row of vars) {\n      addBlock(row.isLocal ? \"var\" : \"VAR\", (row.isLocal ? \"var \" : \"VAR \") + row.name, row);\n    }\n\n    let lists = map.getVariablesOfType(\"list\");\n    for (const row of lists) {\n      addBlock(row.isLocal ? \"list\" : \"LIST\", (row.isLocal ? \"list \" : \"LIST \") + row.name, row);\n    }\n\n    const events = this.getCallsToEvents();\n    for (const event of events) {\n      addBlock(\"receive\", \"event \" + event.eventName, event.block).eventName = event.eventName;\n    }\n\n    /*\n                  const runtime = vm.runtime;\n                  // Now let's also add event broadcasts (not just hat blocks)\n                  const target = runtime.getEditingTarget();\n                  const blocks = target.blocks;\n                  if (blocks._blocks) {\n                      for (const id in blocks._blocks) {\n                          if (!blocks._blocks.hasOwnProperty(id)) {\n                              continue;\n                          }\n                          const block = blocks._blocks[id];\n                          if (block.opcode === 'event_broadcast_menu') {\n\n                              debugger;\n\n                              // Now get the parent block that is the actual broadcast or broadcast and wait\n                              const broadcastBlock = blocks.getBlock(block.parent);\n                              let b = new BlockInstance(target, broadcastBlock);\n\n                              const fieldName = block.fields.BROADCAST_OPTION.value;\n                              addBlock('receive', 'event ' + fieldName, b).eventName = broadcastBlock.eventName;\n\n                              //\n                              // let fields = root.inputList[0];\n                              // let typeDesc = fields.fieldRow[0].getText();\n                              // let eventName = fields.fieldRow[1].getText();\n                              // addBlock('receive', 'event ' + eventName, root).eventName = eventName;\n                          }\n                      }\n                  }\n          */\n\n    const clsOrder = { flag: 0, receive: 1, event: 2, define: 3, var: 4, VAR: 5, list: 6, LIST: 7 };\n\n    myBlocks.sort((a, b) => {\n      let t = clsOrder[a.cls] - clsOrder[b.cls];\n      if (t !== 0) {\n        return t;\n      }\n      if (a.lower < b.lower) {\n        return -1;\n      }\n      if (a.lower > b.lower) {\n        return 1;\n      }\n      return a.y - b.y;\n    });\n\n    return { procs: myBlocks };\n  }\n\n  showDropDown(e, focusID, instanceBlock) {\n    clearTimeout(rhdd);\n    rhdd = 0;\n\n    if (!focusID && this.ddOut.classList.contains(\"vis\")) {\n      return;\n    }\n\n    // special '' vs null... - null forces a reevaluation\n    prevVal = focusID ? \"\" : null; // Clear the previous value of the input search\n\n    this.ddOut.classList.add(\"vis\");\n    let scratchBlocks = this.isCostumeEditor() ? this.getScratchCostumes() : this.getScratchBlocks();\n\n    this.dom_removeChildren(this.dd);\n\n    let foundLi = null;\n    /**\n     * @type {[BlockItem]}\n     */\n    const procs = scratchBlocks.procs;\n    for (const proc of procs) {\n      let li = document.createElement(\"li\");\n      li.innerText = proc.procCode;\n      li.data = proc;\n      li.className = proc.cls;\n      if (focusID) {\n        if (proc.matchesID(focusID)) {\n          foundLi = li;\n          li.classList.add(\"sel\");\n        } else {\n          li.style.display = \"none\";\n        }\n      }\n      this.dd.appendChild(li);\n    }\n\n    let label = document.getElementById(\"s3devFindLabel\");\n    this.utils.offsetX = this.ddOut.getBoundingClientRect().right - label.getBoundingClientRect().left + 26;\n    this.utils.offsetY = 32;\n\n    if (foundLi) {\n      this.clickDropDownRow(foundLi, this.utils.getWorkspace(), instanceBlock);\n    }\n  }\n\n  hideDropDown() {\n    clearTimeout(rhdd);\n    rhdd = setTimeout(() => this.reallyHideDropDown(), 250);\n  }\n\n  reallyHideDropDown() {\n    // Check focus of find box\n    if (this.findInp === document.activeElement) {\n      this.hideDropDown();\n      return;\n    }\n\n    // document.getElementById('s3devReplace').classList.add('s3devHide');\n\n    this.ddOut.classList.remove(\"vis\");\n    rhdd = 0;\n  }\n\n  hideFloatDropDown() {\n    clearTimeout(rhdd2);\n    rhdd2 = setTimeout(() => this.reallyHideFloatDropDown(), 50);\n  }\n\n  reallyHideFloatDropDown(force) {\n    // Check focus of find box\n    if (!force && this.floatInp === document.activeElement) {\n      this.hideFloatDropDown();\n      return;\n    }\n\n    let float = document.getElementById(\"s3devFloatingBar\");\n    if (float) {\n      float.remove();\n    }\n    this.floatInp = null;\n    rhdd2 = 0;\n  }\n\n  dom_removeChildren(myNode) {\n    while (myNode.firstChild) {\n      myNode.removeChild(myNode.firstChild);\n    }\n  }\n\n  /**\n   * A nicely ordered version of the top blocks\n   * @returns {[Blockly.Block]}\n   */\n  getTopBlocks() {\n    let result = this.getOrderedTopBlockColumns();\n    let columns = result.cols;\n    /**\n     * @type {[[Blockly.Block]]}\n     */\n    let topBlocks = [];\n    for (const col of columns) {\n      topBlocks = topBlocks.concat(col.blocks);\n    }\n    return topBlocks;\n  }\n\n  hidePopups(wksp) {\n    // Fire fake mouse events to trick the popup into hiding.\n    const element = wksp.getToolbox().HtmlDiv;\n    element.dispatchEvent(new MouseEvent(\"mousedown\", { relatedTarget: element, bubbles: true }));\n    element.dispatchEvent(new MouseEvent(\"mouseup\", { relatedTarget: element, bubbles: true }));\n  }\n\n  /**\n   * A much nicer way of laying out the blocks into columns\n   */\n  doCleanUp(e, dataId) {\n    let workspace = this.utils.getWorkspace();\n    if (e) {\n      e.cancelBubble = true;\n      e.preventDefault();\n      this.hidePopups(workspace);\n      setTimeout(() => this.doCleanUp(undefined, dataId), 0);\n      return;\n    }\n\n    let makeSpaceForBlock = dataId && workspace.getBlockById(dataId);\n    makeSpaceForBlock = makeSpaceForBlock && makeSpaceForBlock.getRootBlock();\n\n    UndoGroup.startUndoGroup(workspace);\n\n    let result = this.getOrderedTopBlockColumns(true);\n    let columns = result.cols;\n    let orphanCount = result.orphans.blocks.length;\n    if (orphanCount > 0 && !dataId) {\n      let message = this.msg(\"orphaned\", {\n        count: orphanCount,\n      });\n      if (confirm(message)) {\n        for (const block of result.orphans.blocks) {\n          block.dispose();\n        }\n      } else {\n        columns.unshift(result.orphans);\n      }\n    }\n\n    let cursorX = 48;\n\n    let maxWidths = result.maxWidths;\n\n    for (const column of columns) {\n      let cursorY = 64;\n      let maxWidth = 0;\n\n      for (const block of column.blocks) {\n        let extraWidth = block === makeSpaceForBlock ? 380 : 0;\n        let extraHeight = block === makeSpaceForBlock ? 480 : 72;\n        let xy = block.getRelativeToSurfaceXY();\n        if (cursorX - xy.x !== 0 || cursorY - xy.y !== 0) {\n          block.moveBy(cursorX - xy.x, cursorY - xy.y);\n        }\n        let heightWidth = block.getHeightWidth();\n        cursorY += heightWidth.height + extraHeight;\n\n        let maxWidthWithComments = maxWidths[block.id] || 0;\n        maxWidth = Math.max(maxWidth, Math.max(heightWidth.width + extraWidth, maxWidthWithComments));\n      }\n\n      cursorX += maxWidth + 96;\n    }\n\n    let topComments = workspace.getTopComments();\n    for (const comment of topComments) {\n      if (comment.setVisible) {\n        comment.setVisible(false);\n        comment.needsAutoPositioning_ = true;\n        comment.setVisible(true);\n      }\n    }\n\n    setTimeout(() => {\n      // Locate unused local variables...\n      let workspace = this.utils.getWorkspace();\n      let map = workspace.getVariableMap();\n      let vars = map.getVariablesOfType(\"\");\n\n      let unusedLocals = [];\n\n      for (const row of vars) {\n        if (row.isLocal) {\n          let usages = map.getVariableUsesById(row.getId());\n          if (!usages || usages.length === 0) {\n            unusedLocals.push(row);\n          }\n        }\n      }\n\n      if (unusedLocals.length > 0 && !dataId) {\n        const unusedCount = unusedLocals.length;\n        let message = this.msg(\"unused-var\", {\n          count: unusedCount,\n        });\n        for (let i = 0; i < unusedLocals.length; i++) {\n          let orphan = unusedLocals[i];\n          if (i > 0) {\n            message += \", \";\n          }\n          message += orphan.name;\n        }\n        if (confirm(message)) {\n          for (const orphan of unusedLocals) {\n            workspace.deleteVariableById(orphan.getId());\n          }\n        }\n      }\n\n      UndoGroup.endUndoGroup(workspace);\n    }, 100);\n  }\n\n  /**\n   * Badly Ophaned - might want to delete these!\n   * @param topBlock\n   * @returns {boolean}\n   */\n  isBlockAnOrphan(topBlock) {\n    return !!topBlock.outputConnection;\n  }\n\n  /**\n   * Split the top blocks into ordered columns\n   * @param separateOrphans true to keep all orphans separate\n   * @returns {{orphans: {blocks: [Block], x: number, count: number}, cols: [Col]}}\n   */\n  getOrderedTopBlockColumns(separateOrphans) {\n    let w = this.utils.getWorkspace();\n    let topBlocks = w.getTopBlocks();\n    let maxWidths = {};\n\n    if (separateOrphans) {\n      let topComments = w.getTopComments();\n\n      // todo: tie comments to blocks... find widths and width of block stack row...\n      for (const comment of topComments) {\n        // comment.autoPosition_();\n        // Hiding and showing repositions the comment right next to it's block - nice!\n        if (comment.setVisible) {\n          comment.setVisible(false);\n          comment.needsAutoPositioning_ = true;\n          comment.setVisible(true);\n\n          // let bb = comment.block_.svgPath_.getBBox();\n          let right = comment.getBoundingRectangle().bottomRight.x;\n\n          // Get top block for stack...\n          let root = comment.block_.getRootBlock();\n          let left = root.getBoundingRectangle().topLeft.x;\n          maxWidths[root.id] = Math.max(right - left, maxWidths[root.id] || 0);\n        }\n      }\n    }\n\n    // Default scratch ordering is horrid... Lets try something more clever.\n\n    /**\n     * @type {Col[]}\n     */\n    let cols = [];\n    const TOLERANCE = 256;\n    let orphans = { x: -999999, count: 0, blocks: [] };\n\n    for (const topBlock of topBlocks) {\n      // let r = b.getBoundingRectangle();\n      let position = topBlock.getRelativeToSurfaceXY();\n      /**\n       * @type {Col}\n       */\n      let bestCol = null;\n      let bestError = TOLERANCE;\n\n      if (separateOrphans && this.isBlockAnOrphan(topBlock)) {\n        orphans.blocks.push(topBlock);\n        continue;\n      }\n\n      // Find best columns\n      for (const col of cols) {\n        let err = Math.abs(position.x - col.x);\n        if (err < bestError) {\n          bestError = err;\n          bestCol = col;\n        }\n      }\n\n      if (bestCol) {\n        // We found a column that we fitted into\n        bestCol.x = (bestCol.x * bestCol.count + position.x) / ++bestCol.count; // re-average the columns as more items get added...\n        bestCol.blocks.push(topBlock);\n      } else {\n        // Create a new column\n        cols.push(new Col(position.x, 1, [topBlock]));\n      }\n    }\n\n    // if (orphans.blocks.length > 0) {\n    //     cols.push(orphans);\n    // }\n\n    // Sort columns, then blocks inside the columns\n    cols.sort((a, b) => a.x - b.x);\n    for (const col of cols) {\n      col.blocks.sort((a, b) => a.getRelativeToSurfaceXY().y - b.getRelativeToSurfaceXY().y);\n    }\n\n    return { cols: cols, orphans: orphans, maxWidths: maxWidths };\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   * @param {string} id ID of the variable to find.\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\n   */\n  getVariableUsesById(id) {\n    let uses = [];\n\n    let topBlocks = this.getTopBlocks(true); // todo: Confirm this was the right getTopBlocks?\n    for (const topBlock of topBlocks) {\n      /** @type {!Array<!Blockly.Block>} */\n      let kids = topBlock.getDescendants();\n      for (const block of kids) {\n        /** @type {!Array<!Blockly.VariableModel>} */\n        let blockVariables = block.getVarModels();\n        if (blockVariables) {\n          for (const blockVar of blockVariables) {\n            if (blockVar.getId() === id) {\n              uses.push(block);\n            }\n          }\n        }\n      }\n    }\n\n    return uses;\n  }\n\n  /**\n   * Find all the uses of a named procedure.\n   * @param {string} id ID of the variable to find.\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\n   */\n  getCallsToProcedureById(id) {\n    let w = this.utils.getWorkspace();\n    let procBlock = w.getBlockById(id);\n    let label = procBlock.getChildren()[0];\n    let procCode = label.getProcCode();\n\n    let uses = [procBlock]; // Definition First, then calls to it\n    let topBlocks = this.getTopBlocks(true);\n    for (const topBlock of topBlocks) {\n      /** @type {!Array<!Blockly.Block>} */\n      let kids = topBlock.getDescendants();\n      for (const block of kids) {\n        if (block.type === \"procedures_call\") {\n          if (block.getProcCode() === procCode) {\n            uses.push(block);\n          }\n        }\n      }\n    }\n\n    return uses;\n  }\n\n  /**\n   * Find all the uses of a named procedure.\n   * @param {string} name name of the variable to find.\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\n   */\n  getCallsToEventsByName(name) {\n    let uses = []; // Definition First, then calls to it\n\n    const runtime = this.vm.runtime;\n    const targets = runtime.targets; // The sprites / stage\n\n    for (const target of targets) {\n      if (!target.isOriginal) {\n        continue; // Skip clones\n      }\n\n      const blocks = target.blocks;\n      if (!blocks._blocks) {\n        continue;\n      }\n\n      for (const id of Object.keys(blocks._blocks)) {\n        const block = blocks._blocks[id];\n        // To find event broadcaster blocks, we look for the nested \"event_broadcast_menu\" blocks first that match the event name\n        if (block.opcode === \"event_broadcast_menu\" && block.fields.BROADCAST_OPTION.value === name) {\n          // Now get the parent block that is the actual broadcast or broadcast and wait\n          const broadcastBlock = blocks.getBlock(block.parent);\n          uses.push(new BlockInstance(target, broadcastBlock));\n        } else if (block.opcode === \"event_whenbroadcastreceived\" && block.fields.BROADCAST_OPTION.value === name) {\n          uses.push(new BlockInstance(target, block));\n        }\n      }\n    }\n\n    return uses;\n  }\n\n  /**\n   * Find all the evern broadcasters.\n   * @return {[{eventName:string, block:Block}]} Array of event names and blocks.\n   */\n  getCallsToEvents() {\n    const uses = []; // Definition First, then calls to it\n    const found = {};\n\n    let topBlocks = this.getTopBlocks(true);\n    for (const topBlock of topBlocks) {\n      /** @type {!Array<!Blockly.Block>} */\n      let kids = topBlock.getDescendants();\n      for (const block of kids) {\n        if (block.type === \"event_broadcast\" || block.type === \"event_broadcastandwait\") {\n          const eventName = block.getChildren()[0].inputList[0].fieldRow[0].getText();\n          if (!found[eventName]) {\n            found[eventName] = block;\n            uses.push({ eventName: eventName, block: block });\n          }\n        }\n      }\n    }\n\n    return uses;\n  }\n\n  buildNavigationCarousel(nav, li, blocks, instanceBlock) {\n    if (nav && nav.parentNode === li) {\n      // Same control... click again to go to next\n      this.multi.navRight();\n    } else {\n      if (nav) {\n        nav.remove();\n      }\n      li.insertAdjacentHTML(\n        \"beforeend\",\n        `\n                    <span id=\"s3devMulti\" class=\"s3devMulti\">\n                        <span id=\"s3devMultiLeft\" class=\"s3devNav\">◀</span><span id=\"s3devMultiCount\"></span><span id=\"s3devMultiRight\" class=\"s3devNav\">▶</span>\n                    </span>\n                `\n      );\n      document.getElementById(\"s3devMultiLeft\").addEventListener(\"mousedown\", (...e) => this.multi.navLeft(...e));\n      document.getElementById(\"s3devMultiRight\").addEventListener(\"mousedown\", (...e) => this.multi.navRight(...e));\n\n      this.multi.idx = 0;\n\n      if (instanceBlock) {\n        for (let i = 0; i < blocks.length; i++) {\n          const block = blocks[i];\n          if (block.id === instanceBlock.id) {\n            this.multi.idx = i;\n            break;\n          }\n        }\n        // multi.idx = blocks.indexOf(instanceBlock);\n      }\n\n      this.multi.blocks = blocks;\n      this.multi.update();\n\n      if (this.multi.idx < blocks.length) {\n        this.centerTop(blocks[this.multi.idx]);\n      }\n    }\n  }\n\n  /**\n   * Move a costume to the top or bottom of the list\n   * @param top true for the top, false for the bottom\n   * @param selected optional parameter to pass in the costume div to be moved\n   */\n  moveCostumeTo(top, selected) {\n    let isSelected = !selected || selected.className.indexOf(\"sprite-selector-item_is-selected\") >= 0;\n    if (!selected) {\n      selected = this.costTabBody.querySelectorAll(\"div[class*='sprite-selector-item_is-selected']\");\n      if (selected.length === 0) {\n        return;\n      }\n      selected = selected[0].querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\")[0];\n    }\n    let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\n\n    // First scroll sprite view to reveal top or bottom otherwise this won't work.\n    let scroller = selected.closest(\"div[class*=selector_list-area]\");\n    let lastScroll = scroller.scrollTop;\n    scroller.scrollTop = top ? 0 : scroller.scrollHeight;\n\n    this.domHelpers.triggerDragAndDrop(selected, costumes[top ? 0 : costumes.length - 1], undefined);\n    if (!isSelected) {\n      // Restore Scroll position\n      scroller.scrollTop = lastScroll;\n    }\n  }\n\n  /**\n   *\n   * @param li\n   * @param workspace\n   * @param instanceBlock the instance to be highlighted (or null)\n   */\n  clickDropDownRow(li, workspace, instanceBlock) {\n    let nav = document.getElementById(\"s3devMulti\");\n\n    let cls = li.data.cls;\n    if (cls === \"costume\") {\n      // Viewing costumes - jump to selected costume\n      let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\n      let costume = costumes[li.data.y];\n      if (costume) {\n        costume.click();\n        setTimeout(() => {\n          let wrapper = costume.closest(\"div[class*=gui_flex-wrapper]\");\n          costume.parentElement.parentElement.scrollIntoView({\n            behavior: \"auto\",\n            block: \"center\",\n            inline: \"start\",\n          });\n          wrapper.scrollTop = 0;\n        }, 10);\n      }\n    } else if (cls === \"var\" || cls === \"VAR\" || cls === \"list\" || cls === \"LIST\") {\n      // Search now for all instances\n      // let wksp = getWorkspace();\n      // let blocks = wksp.getVariableUsesById(li.data.labelID);\n      let blocks = this.getVariableUsesById(li.data.labelID);\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\n    } else if (cls === \"define\") {\n      let blocks = this.getCallsToProcedureById(li.data.labelID);\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\n    } else if (cls === \"receive\") {\n      /*\n                          let blocks = [workspace.getBlockById(li.data.labelID)];\n                          if (li.data.clones) {\n                              for (const cloneID of li.data.clones) {\n                                  blocks.push(workspace.getBlockById(cloneID))\n                              }\n                          }\n                          blocks = blocks.concat(getCallsToEventsByName(li.data.eventName));\n              */\n      // Now, fetch the events from the scratch runtime instead of blockly\n      let blocks = this.getCallsToEventsByName(li.data.eventName);\n      if (!instanceBlock) {\n        // Can we start by selecting the first block on 'this' sprite\n        const currentTargetID = this.utils.getEditingTarget().id;\n        for (const block of blocks) {\n          if (block.targetId === currentTargetID) {\n            instanceBlock = block;\n            break;\n          }\n        }\n      }\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\n    } else if (li.data.clones) {\n      let blocks = [workspace.getBlockById(li.data.labelID)];\n      for (const cloneID of li.data.clones) {\n        blocks.push(workspace.getBlockById(cloneID));\n      }\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\n    } else {\n      this.multi.blocks = null;\n      this.centerTop(li.data.labelID);\n      if (nav) {\n        nav.remove();\n      }\n    }\n  }\n\n  dropDownClick(e) {\n    // console.log(e);\n    let workspace = this.utils.getWorkspace();\n\n    if (prevVal === null) {\n      prevVal = this.findInp.value; // Hack to stop filter change if not entered data into edt box, but clicked on row\n    }\n\n    let li = e.target;\n    for (;;) {\n      if (!li || li === this.dd) {\n        return;\n      }\n      if (li.data) {\n        break;\n      }\n      li = li.parentNode;\n    }\n\n    // If this was a mouse click, unselect the keyboard selection\n    // e.navKey is set when this is called from the keyboard handler...\n    if (!e.navKey) {\n      let sel = this.dd.getElementsByClassName(\"sel\");\n      sel = sel.length > 0 ? sel[0] : null;\n      if (sel && sel !== li) {\n        try {\n          sel.classList.remove(\"sel\");\n        } catch (e) {\n          console.log(sel);\n          console.error(e);\n        }\n      }\n      if (li !== sel) {\n        li.classList.add(\"sel\");\n      }\n    }\n\n    this.clickDropDownRow(li, workspace);\n    if (e && e.preventDefault) {\n      e.preventDefault();\n      e.cancelBubble = true;\n    }\n    return false;\n  }\n\n  /**\n   * Based on wksp.centerOnBlock(li.data.labelID);\n   * @param e\n   * @param force if true, the view always moves, otherwise only move if the selected element is not entirely visible\n   */\n  centerTop(e, force) {\n    this.utils.scrollBlockIntoView(e, force);\n  }\n\n  inputChange(e) {\n    if (!this.ddOut.classList.contains(\"vis\")) {\n      this.showDropDown();\n      this.hideDropDown(); // Start timer to hide if not got focus\n    }\n\n    // Filter the list...\n    let val = (this.findInp.value || \"\").toLowerCase();\n    if (val === prevVal) {\n      // No change so don't re-filter\n      return;\n    }\n\n    prevVal = val;\n    this.multi.blocks = null;\n\n    //\n    // Hide items in list that do not contain filter text, and highlight the parts of words that match the filter text\n\n    let listLI = this.dd.getElementsByTagName(\"li\");\n    for (const li of listLI) {\n      let procCode = li.data.procCode;\n      let i = li.data.lower.indexOf(val);\n      if (i >= 0) {\n        li.style.display = \"block\";\n        this.dom_removeChildren(li);\n        if (i > 0) {\n          li.appendChild(document.createTextNode(procCode.substring(0, i)));\n        }\n        let bText = document.createElement(\"b\");\n        bText.appendChild(document.createTextNode(procCode.substr(i, val.length)));\n        li.appendChild(bText);\n        if (i + val.length < procCode.length) {\n          li.appendChild(document.createTextNode(procCode.substr(i + val.length)));\n        }\n        // li.innerHTML = enc(procCode.substring(0, i)) + '<b>' + enc(procCode.substr(i, val.length)) + \"</b>\" + enc(procCode.substr(i + val.length));\n      } else {\n        li.style.display = \"none\";\n      }\n    }\n  }\n\n  /**\n   * Select previous or next item in the drop down filter list\n   * @param dir direction of navigation: -1=up, 1=down\n   */\n  navigateFilter(dir) {\n    let sel = this.dd.getElementsByClassName(\"sel\");\n    let nxt;\n    if (sel.length > 0 && sel[0].style.display !== \"none\") {\n      nxt = dir === -1 ? sel[0].previousSibling : sel[sel.length - 1].nextSibling;\n    } else {\n      nxt = this.dd.children[0];\n      dir = 1;\n    }\n    while (nxt && nxt.style.display === \"none\") {\n      nxt = dir === -1 ? nxt.previousSibling : nxt.nextSibling;\n    }\n    if (nxt) {\n      for (const i of sel) {\n        i.classList.remove(\"sel\");\n      }\n      nxt.classList.add(\"sel\");\n      this.dropDownClick({ target: nxt, navKey: true });\n      // centerTop(nxt.data.labelID);\n    }\n  }\n\n  inputKeyDown(e) {\n    // Up Arrow\n    if (e.keyCode === 38) {\n      this.navigateFilter(-1);\n      e.preventDefault();\n      return;\n    }\n\n    // Down Arrow\n    if (e.keyCode === 40) {\n      this.navigateFilter(1);\n      e.preventDefault();\n      return;\n    }\n\n    // Left Arrow\n    if (e.keyCode === 37) {\n      let sel = this.dd.getElementsByClassName(\"sel\");\n      if (sel && this.multi.blocks) {\n        this.multi.navLeft(e);\n      }\n    }\n\n    // Right Arrow\n    if (e.keyCode === 39) {\n      let sel = this.dd.getElementsByClassName(\"sel\");\n      if (sel && this.multi.blocks) {\n        this.multi.navRight(e);\n      }\n    }\n\n    // Enter\n    if (e.keyCode === 13) {\n      // Any selected on enter? if not select now\n      let sel = this.dd.getElementsByClassName(\"sel\");\n      if (sel.length === 0) {\n        this.navigateFilter(1);\n      }\n      // noinspection JSUnresolvedFunction\n      document.activeElement.blur();\n      e.preventDefault();\n      return;\n    }\n\n    // Escape\n    if (e.keyCode === 27) {\n      if (this.findInp.value.length > 0) {\n        this.findInp.value = \"\"; // Clear search first, then close on second press\n        this.inputChange(e);\n      } else {\n        // noinspection JSUnresolvedFunction\n        document.activeElement.blur();\n      }\n      e.preventDefault();\n      return;\n    }\n  }\n\n  /*\n    function deepSearch(e) {\n      document.body.insertAdjacentHTML(\n        \"beforeend\",\n        `\n              <div id=\"s3devOverlay\">\n              </div>\n          `\n      );\n\n      let overlay = document.getElementById(\"s3devOverlay\");\n      overlay.addEventListener(\"click\", function (e) {\n        overlay.remove();\n      });\n\n      // todo: use scratch runtime instead!\n\n      const runtime = vm.runtime;\n      const targets = runtime.targets; // The sprites / stage\n\n      let dict = {};\n\n      for (const target of targets) {\n        if (!target.isOriginal) {\n          continue; // Skip clones\n        }\n\n        const name = target.getName();\n        const isStage = target.isStage;\n        const blocks = target.blocks;\n        const scripts = blocks.getScripts();\n\n        let divElement = document.createElement(\"div\");\n        divElement.appendChild(document.createTextNode(\"Searching in \" + name));\n        divElement.appendChild(document.createTextNode(\", Top Scripts x\" + scripts.length));\n        overlay.appendChild(divElement);\n\n        const sprite = (dict[name] = {});\n        sprite.scripts = [];\n\n        for (const script of scripts) {\n          const block = blocks.getBlock(script);\n          const top = { id: script, opcode: block.opcode, block: block };\n          sprite.scripts.push(top);\n        }\n      }\n\n      e.preventDefault();\n      return true;\n    }\n  */\n\n  /**\n   * Quick and dirty replace all instances of one variable / list with another variable / list\n   * @param varId original variable name\n   * @param newVarName new variable name\n   * @param type type of variable (\"\" = variable, anything else is a list?\n   */\n  doReplaceVariable(varId, newVarName, type) {\n    let wksp = this.utils.getWorkspace();\n    let v = wksp.getVariable(newVarName, type);\n    if (!v) {\n      alert(this.msg(\"var-not-exist\"));\n      return;\n    }\n    let newVId = v.getId();\n\n    UndoGroup.startUndoGroup(wksp);\n    let blocks = this.getVariableUsesById(varId);\n    for (const block of blocks) {\n      try {\n        if (type === \"\") {\n          block.getField(\"VARIABLE\").setValue(newVId);\n        } else {\n          block.getField(\"LIST\").setValue(newVId);\n        }\n      } catch (e) {\n        // ignore\n      }\n    }\n    UndoGroup.endUndoGroup(wksp);\n  }\n\n  /*\n    function doInjectScripts(codeString) {\n      let w = getWorkspace();\n      let xml = new XML(); // document.implementation.createDocument(null, \"xml\");\n      let x = xml.xmlDoc.firstChild;\n\n      let tree = math.parse(codeString);\n      console.log(tree);\n\n      const binaryOperatorTypes = {\n        add: \"operator_add\",\n        subtract: \"operator_subtract\",\n        this.multiply: \"operator_multiply\",\n        divide: \"operator_divide\",\n      };\n\n      const BLOCK_TYPE = {\n        number: \"math_number\",\n        text: \"text\",\n      };\n\n      function translateMathToXml(x, tree, shadowType) {\n        let xShadowField = null;\n        if (shadowType) {\n          let xShadow = xml.newXml(x, \"shadow\", { type: shadowType });\n          if (shadowType === BLOCK_TYPE.number) {\n            xShadowField = xml.newXml(xShadow, \"field\", { name: \"NUM\" });\n          } else if (shadowType === BLOCK_TYPE.text) {\n            xShadowField = xml.newXml(xShadow, \"field\", { name: \"TEXT\" });\n          }\n        }\n\n        if (!tree || !tree.type) {\n          return;\n        }\n\n        if (tree.type === \"OperatorNode\") {\n          let operatorType = binaryOperatorTypes[tree.fn];\n          if (operatorType) {\n            let xOp = newXml(x, \"block\", { type: operatorType });\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"NUM1\" }), tree.args[0], BLOCK_TYPE.number);\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"NUM2\" }), tree.args[1], BLOCK_TYPE.number);\n            return;\n          }\n\n          return;\n        }\n\n        if (tree.type === \"ConstantNode\") {\n          // number or text in quotes\n          if (xShadowField) {\n            xml.setAttr(xShadowField, { text: tree.value });\n          }\n          return;\n        }\n\n        if (tree.type === \"SymbolNode\") {\n          // variable\n          let xVar = xml.newXml(x, \"block\", { type: \"data_variable\" });\n          xml.newXml(xVar, \"field\", { name: \"VARIABLE\", text: tree.name });\n          return;\n        }\n\n        if (tree.type === \"FunctionNode\") {\n          // Method Call\n          if (tree.fn.name === \"join\") {\n            let xOp = newXml(x, \"block\", { type: \"operator_join\" });\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"STRING1\" }), tree.args[0], BLOCK_TYPE.text);\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"STRING2\" }), tree.args[1], BLOCK_TYPE.text);\n            return;\n          }\n        }\n      }\n\n      translateMathToXml(x, tree);\n      console.log(x);\n\n      let ids = Blockly.Xml.domToWorkspace(x, w);\n      console.log(ids);\n    }\n     */\n\n  /*\n          function clickCleanUp(e) {\n              // if (window.confirm('Griffpatch: Tidy up your scripts?')) {\n                  doCleanUp();\n              // }\n              e.preventDefault();\n              return false;\n          }\n      */\n\n  /*\n    function clickInject(e) {\n      let codeString = window.prompt(\"Griffpatch: Enter an expression (i.e. a+2*3)\");\n      if (codeString) {\n        doInjectScripts(codeString);\n      }\n      e.preventDefault();\n      return false;\n    }\n    */\n\n  /**\n   * Click Event Handler - User has clicked the replace variable option - ask for the variable to replace with...\n   * @param e the event\n   * @returns {boolean} cancelled?\n   */\n  clickReplace(e) {\n    let wksp = this.utils.getWorkspace();\n    this.hidePopups(wksp);\n\n    setTimeout(() => {\n      let wksp = this.utils.getWorkspace();\n      let v = wksp.getVariableById(this.selVarID);\n      let varName = window.prompt(this.msg(\"replace\", { name: v.name }));\n      if (varName) {\n        this.doReplaceVariable(this.selVarID, varName, v.type);\n      }\n    }, 0);\n    e.preventDefault();\n    return false;\n  }\n\n  /**\n   * Returns a Set of the top blocks in this workspace / sprite\n   * @returns {Set<any>} Set of top blocks\n   */\n  getTopBlockIDs() {\n    let wksp = this.utils.getWorkspace();\n    let topBlocks = wksp.getTopBlocks();\n    let ids = new Set();\n    for (const block of topBlocks) {\n      ids.add(block.id);\n    }\n    return ids;\n  }\n\n  /**\n   * Initiates a drag event for all block stacks except those in the set of ids.\n   * But why? - Because we know all the ids of the existing stacks before we paste / duplicate - so we can find the\n   * new stack by excluding all the known ones.\n   * @param ids Set of previously known ids\n   */\n  beginDragOfNewBlocksNotInIDs(ids) {\n    if (!this.addon.settings.get(\"enablePasteBlocksAtMouse\")) {\n      return;\n    }\n    let wksp = this.utils.getWorkspace();\n    let topBlocks = wksp.getTopBlocks();\n    for (const block of topBlocks) {\n      if (!ids.has(block.id)) {\n        // console.log(\"I found a new block!!! - \" + block.id);\n        // todo: move the block to the mouse pointer?\n        let mouseXYClone = { x: this.mouseXY.x, y: this.mouseXY.y };\n        block.setIntersects(true); // fixes offscreen block pasting in TurboWarp\n        this.domHelpers.triggerDragAndDrop(block.svgPath_, null, mouseXYClone);\n      }\n    }\n  }\n\n  updateMousePosition(e) {\n    this.mouseXY.x = e.clientX;\n    this.mouseXY.y = e.clientY;\n  }\n\n  eventMouseMove(e) {\n    this.updateMousePosition(e);\n  }\n\n  eventKeyDown(e) {\n    function switchCostume(up) {\n      // todo: select previous costume\n      let selected = this.costTabBody.querySelector(\"div[class*='sprite-selector-item_is-selected']\");\n      let node = up ? selected.parentNode.previousSibling : selected.parentNode.nextSibling;\n      if (node) {\n        let wrapper = node.closest(\"div[class*=gui_flex-wrapper]\");\n        node.querySelector(\"div[class^='sprite-selector-item_sprite-name']\").click();\n        node.scrollIntoView({\n          behavior: \"auto\",\n          block: \"center\",\n          inline: \"start\",\n        });\n        wrapper.scrollTop = 0;\n      }\n    }\n\n    if (document.URL.indexOf(\"editor\") <= 0) {\n      return;\n    }\n\n    let ctrlKey = e.ctrlKey || e.metaKey;\n\n    if (e.key === \"f\" && ctrlKey && !e.shiftKey) {\n      // Ctrl + F (Override default Ctrl+F find)\n      this.findInp.focus();\n      this.findInp.select();\n      e.cancelBubble = true;\n      e.preventDefault();\n      return true;\n    }\n\n    if (e.key === \" \" && ctrlKey) {\n      // Ctrl + Space (Inject Code)\n      this.middleClickWorkspace(e);\n      e.cancelBubble = true;\n      e.preventDefault();\n      return true;\n    }\n\n    if (e.keyCode === 37 && ctrlKey) {\n      // Ctrl + Left Arrow Key\n      if (document.activeElement.tagName === \"INPUT\") {\n        return;\n      }\n      // todo: if (!this.addon.settings.get(\"enableCtrlLeftRightNav\")) {\n      //         return;\n      //       }\n      if (this.isScriptEditor()) {\n        this.utils.navigationHistory.goBack();\n      } else if (this.isCostumeEditor()) {\n        switchCostume(true);\n      }\n      e.cancelBubble = true;\n      e.preventDefault();\n      return true;\n    }\n\n    if (e.keyCode === 39 && ctrlKey) {\n      // Ctrl + Right Arrow Key\n      if (document.activeElement.tagName === \"INPUT\") {\n        return;\n      }\n      // todo: if (!this.addon.settings.get(\"enableCtrlLeftRightNav\")) {\n      //         return;\n      //       }\n      if (this.isScriptEditor()) {\n        this.utils.navigationHistory.goForward();\n      } else if (this.isCostumeEditor()) {\n        switchCostume(false);\n      }\n      e.cancelBubble = true;\n      e.preventDefault();\n      return true;\n    }\n\n    if (e.keyCode === 86 && ctrlKey && !e.griff) {\n      // Ctrl + V\n      // Set a timeout so we can take control of the paste after the event\n      let ids = this.getTopBlockIDs();\n      setTimeout(() => {\n        this.beginDragOfNewBlocksNotInIDs(ids);\n      }, 10);\n    }\n\n    // if (e.keyCode === 220 && (!document.activeElement || document.activeElement.tagName === 'INPUT')) {\n    //\n    // }\n  }\n\n  eventMouseDown(e) {\n    this.updateMousePosition(e);\n\n    if (this.ddOut && this.ddOut.classList.contains(\"vis\") && !e.target.closest(\"#s3devDDOut\")) {\n      // If we click outside the dropdown, then instigate the hide code...\n      this.hideDropDown();\n    }\n\n    if (this.floatInp && !e.target.closest(\"#s3devIDDOut\")) {\n      // If we click outside the dropdown, then instigate the hide code...\n      this.hideFloatDropDown();\n    }\n\n    if (e.button === 1) {\n      // Wheel button...\n      try {\n        this.middleClick(e);\n      } catch (x) {\n        console.error(x);\n      }\n    } else if (e.button === 2) {\n      // Right click...\n      let spriteSelector = e.target.closest(\"#react-tabs-3 div[class*='sprite-selector-item_sprite-selector-item']\");\n      if (spriteSelector) {\n        let contextMenu = spriteSelector.getElementsByTagName(\"nav\")[0];\n        if (!contextMenu.querySelector(\"div.s3devSTT\")) {\n          contextMenu.insertAdjacentHTML(\n            \"beforeend\",\n            `\n                            <div class=\"${this.addon.tab.scratchClass(\n                              \"context-menu_menu-item\",\n                              \"context-menu_menu-item-bordered\",\n                              {\n                                others: [\"react-contextmenu-item\", \"s3devSTT\"],\n                              }\n                            )}\" role=\"menuitem\"\n                                tabindex=\"-1\" aria-disabled=\"false\"><span>${this.m(\"top\")}</span></div>\n                            <div class=\"${this.addon.tab.scratchClass(\"context-menu_menu-item\", {\n                              others: [\"react-contextmenu-item\", \"s3devSTT\"],\n                            })}\" role=\"menuitem\"\n                                tabindex=\"-1\" aria-disabled=\"false\"><span>${this.m(\"bottom\")}</span></div>\n                        `\n          );\n        }\n      }\n\n      let blockSvg = e.target.closest(\"[data-id]\");\n      let isBackground = !blockSvg && e.target.closest(\"svg.blocklySvg\");\n      if (blockSvg || isBackground) {\n        let dataId = blockSvg && blockSvg.getAttribute(\"data-id\");\n        if (dataId || isBackground) {\n          setTimeout(async () => {\n            // Is there a popup menu to hi-jack?\n            let widget = document.querySelector(\"div.blocklyWidgetDiv\");\n            if (!widget) {\n              return;\n            }\n            let blocklyContextMenu = widget.querySelector(\"div.blocklyContextMenu\");\n            if (!blocklyContextMenu) {\n              return;\n            }\n            if (isBackground) {\n              let cleanupPlus = this.addon.settings.get(\"enableCleanUpPlus\");\n\n              let nodes = blocklyContextMenu.children;\n              const realBlockly = await this.addon.tab.traps.getBlockly();\n              if (cleanupPlus) {\n                for (const node of nodes) {\n                  if (node.textContent === realBlockly.Msg.CLEAN_UP) {\n                    node.remove();\n                    break;\n                  }\n                }\n              }\n              let html = cleanupPlus\n                ? `\n                  <div\n                    id=\"s3devCleanUp\"\n                    class=\"goog-menuitem s3dev-mi ${this.addon.tab.direction === \"rtl\" ? \"goog-menuitem-rtl\" : \"\"}\"\n                    role=\"menuitem\"\n                    style=\"user-select: none; border-top: 1px solid hsla(0, 0%, 0%, 0.15);\"\n                  >\n                      <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"clean-plus\")}</div>\n                  </div>\n              `\n                : \"\";\n\n              html += `\n                  <div\n                    id=\"s3devPaste\"\n                    class=\"goog-menuitem s3dev-mi ${this.addon.tab.direction === \"rtl\" ? \"goog-menuitem-rtl\" : \"\"}\"\n                    role=\"menuitem\"\n                    style=\"user-select: none;\"\n                  >\n                      <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"paste\")}</div>\n                  </div>\n              `;\n              blocklyContextMenu.insertAdjacentHTML(\"beforeend\", html);\n            } else {\n              let wksp = this.utils.getWorkspace();\n              let block = wksp.getBlockById(dataId);\n              let isFlyOut = block.workspace.isFlyout;\n\n              /* todo - look at this menu code ***** !!!!!\n                const BROADCAST_BLOCKS = [\"event_whenbroadcastreceived\", \"event_broadcast\", \"event_broadcastandwait\"];\n                if (BROADCAST_BLOCKS.includes(block.type)) {\n                  // Show Broadcast\n                  const broadcastId = showBroadcastSingleton.getAssociatedBroadcastId(dataId);\n                  if (broadcastId) {\n                    for (const showKey of [\"Senders\", \"Receivers\"]) {\n                      const googMenuItemContent = Object.assign(document.createElement(\"div\"), {\n                        textContent: this.msg(`show-${showKey}`.toLowerCase()),\n                        style: \"user-select: none;\",\n                        className: \"goog-menuitem-content\",\n                      });\n                      const googMenuItem = Object.assign(document.createElement(\"div\"), {\n                        id: `s3devShow${showKey}`,\n                        className: \"goog-menuitem s3dev-mi\",\n                        role: \"menuitem\",\n                        style: \"user-select: none;\",\n                      });\n                      googMenuItem.addEventListener(\"click\", () => {\n                        hidePopups(wksp);\n                        showBroadcastSingleton[`show${showKey}`](broadcastId);\n                      });\n                      googMenuItem.appendChild(googMenuItemContent);\n                      blocklyContextMenu.appendChild(googMenuItem);\n                    }\n                  }\n                }\n                */\n\n              if (!isFlyOut) {\n                blocklyContextMenu.insertAdjacentHTML(\n                  \"beforeend\",\n                  `\n                    <div id=\"s3devMakeSpace\" class=\"goog-menuitem s3dev-mi\" role=\"menuitem\" style=\"user-select: none; border-top: 1px solid hsla(0, 0%, 0%, 0.15);\">\n                        <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"make-space\")}</div>\n                    </div>\n                    <div id=\"s3devCopy\" class=\"goog-menuitem s3dev-mi\" role=\"menuitem\" style=\"user-select: none; border-top: 1px solid hsla(0, 0%, 0%, 0.15);\">\n                        <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"copy-all\")}</div>\n                    </div>\n                    <div id=\"s3devCopyBlock\" class=\"goog-menuitem s3dev-mi\" role=\"menuitem\" style=\"user-select: none;\">\n                        <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"copy-block\")}</div>\n                    </div>\n                    <div id=\"s3devCutBlock\" class=\"goog-menuitem s3dev-mi\" role=\"menuitem\" style=\"user-select: none;\">\n                        <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"cut-block\")}</div>\n                    </div>\n                  `\n                );\n              }\n\n              // Is this a variable or a list?\n              if (block && (block.getCategory() === \"data\" || block.getCategory() === \"data-lists\")) {\n                blocklyContextMenu.insertAdjacentHTML(\n                  \"beforeend\",\n                  `\n                        <div id=\"s3devReplaceAllVars\" class=\"goog-menuitem s3dev-mi\" role=\"menuitem\" style=\"user-select: none; border-top: 1px solid hsla(0, 0%, 0%, 0.15);\">\n                            <div class=\"goog-menuitem-content\" style=\"user-select: none;\">${this.m(\"swap\", {\n                              var: block.getCategory() === \"data\" ? this.m(\"variables\") : this.m(\"lists\"),\n                            })}</div>\n                        </div>\n                  `\n                );\n                this.selVarID = block.getVars()[0];\n              }\n            }\n\n            if (blocklyContextMenu.children.length < 15) {\n              blocklyContextMenu.style.maxHeight = \"none\";\n              widget.style.height = blocklyContextMenu.getBoundingClientRect().height + 12 + \"px\";\n              blocklyContextMenu.style.maxHeight = \"\";\n            }\n\n            let copyDiv = blocklyContextMenu.querySelector(\"div#s3devCleanUp\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (...e) => this.doCleanUp(...e));\n            }\n            copyDiv = blocklyContextMenu.querySelector(\"div#s3devMakeSpace\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (e) => this.doCleanUp(e, dataId));\n            }\n            copyDiv = blocklyContextMenu.querySelector(\"div#s3devCopy\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (...e) => eventCopyClick(...e));\n            }\n            copyDiv = blocklyContextMenu.querySelector(\"div#s3devCopyBlock\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (e) => {\n                eventCopyClick(e, 1);\n              });\n            }\n            copyDiv = blocklyContextMenu.querySelector(\"div#s3devCutBlock\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (e) => {\n                eventCopyClick(e, 2);\n              });\n            }\n            copyDiv = blocklyContextMenu.querySelector(\"div#s3devReplaceAllVars\");\n            if (copyDiv) {\n              copyDiv.addEventListener(\"click\", (...e) => this.clickReplace(...e));\n            }\n\n            let devTools = this;\n            function eventCopyClick(e, blockOnly) {\n              let wksp = devTools.utils.getWorkspace();\n              devTools.hidePopups(wksp);\n\n              let block = wksp.getBlockById(dataId);\n              if (block) {\n                block.select();\n                let next = blockOnly ? block.getNextBlock() : null;\n                if (next) {\n                  next.unplug(false); // setParent(null);\n                }\n\n                // separate child temporarily\n                document.dispatchEvent(new KeyboardEvent(\"keydown\", { keyCode: 67, ctrlKey: true }));\n                if (next || blockOnly === 2) {\n                  setTimeout(() => {\n                    if (next) {\n                      wksp.undo(); // undo the unplug above...\n                    }\n                    if (blockOnly === 2) {\n                      let block = wksp.getBlockById(dataId);\n                      UndoGroup.startUndoGroup(wksp);\n                      block.dispose(true);\n                      UndoGroup.endUndoGroup(wksp);\n                    }\n                  }, 0);\n                }\n              }\n            }\n\n            let pasteDiv = blocklyContextMenu.querySelector(\"div#s3devPaste\");\n            if (pasteDiv) {\n              pasteDiv.addEventListener(\"click\", function () {\n                let wksp = devTools.utils.getWorkspace();\n                devTools.hidePopups(wksp);\n\n                let ids = devTools.getTopBlockIDs();\n\n                document.dispatchEvent(\n                  new KeyboardEvent(\"keydown\", {\n                    keyCode: 86,\n                    ctrlKey: true,\n                    griff: true,\n                  })\n                );\n\n                setTimeout(() => {\n                  devTools.beginDragOfNewBlocksNotInIDs(ids);\n                }, 10);\n              });\n            }\n          }, 1);\n        }\n      }\n    } else {\n      let chk = e.target;\n      if (chk && chk.tagName !== \"BUTTON\" && chk.getAttribute && !chk.getAttribute(\"role\")) {\n        chk = chk.parentNode;\n        if (chk && chk.tagName !== \"BUTTON\" && chk.getAttribute && !chk.getAttribute(\"role\")) {\n          chk = chk.parentNode;\n        }\n      }\n\n      if (chk && chk.className && chk.className.indexOf) {\n        if (chk.className.indexOf(\"see-inside-button\") >= 0) {\n          // Try to re-inject GUI after rebuild\n          setTimeout(() => this.initInner(), 200);\n        }\n\n        if (!this.canShare && chk.className.indexOf(\"share-button\") >= 0) {\n          // Commented for ScratchAddons\n          /*e.cancelBubble = true;\n                      e.preventDefault();\n\n                      if (confirm(\"Griffpatch: Are you sure you want to share?\")) {\n                          // action the share!\n                          canShare = true;\n                          chk.click();\n                      }*/\n\n          return;\n        }\n      }\n\n      chk = e.target.tagName === \"SPAN\" ? e.target.parentNode : e.target;\n\n      if (chk.classList.contains(\"s3devSTT\")) {\n        if (chk.textContent === this.m(\"top\") || chk.textContent === this.m(\"bottom\")) {\n          let spriteSelector = e.target.closest(\"div[class*='sprite-selector-item_sprite-selector-item']\");\n          this.moveCostumeTo(chk.textContent === this.m(\"top\"), spriteSelector);\n          e.cancelBubble = true;\n          e.preventDefault();\n        }\n      }\n    }\n  }\n\n  eventMouseUp(e) {\n    this.updateMousePosition(e);\n\n    if (e.button === 1 && e.target.closest(\"svg.blocklySvg\")) {\n      // On Linux systems, middle click is often treated as a paste.\n      // We do not want this as we assign our own functionality to middle mouse.\n      e.preventDefault();\n    }\n  }\n\n  middleClickWorkspace(e) {\n    if (!this.isScriptEditor()) {\n      return;\n    }\n\n    // todo: if (!this.addon.settings.get(\"enableBlockInjector\")) {\n    //         return;\n    //       }\n\n    e.cancelBubble = true;\n    e.preventDefault();\n\n    let floatBar = document.getElementById(\"s3devFloatingBar\");\n    if (floatBar) {\n      floatBar.remove();\n    }\n\n    // Popup new input box for block injection\n    document.body.insertAdjacentHTML(\n      \"beforeend\",\n      `\n            <div id=\"s3devFloatingBar\" dir=\"${this.addon.tab.direction}\">\n                <label class='title s3devLabel' id=s3devInsertLabel>\n                    <span style=\"display:none;\">${this.m(\"insert\")} </span>\n                    <span id=s3devInsert class=\"s3devWrap\">\n                        <div id='s3devIDDOut' class=\"s3devDDOut\">\n                            <input id='s3devIInp' class=\"${this.addon.tab.scratchClass(\"input_input-form\", {\n                              others: \"s3devInp\",\n                            })}\" type='search' placeholder='${this.m(\"start-typing\")}' autocomplete='off'>\n                            <ul id='s3devIDD' class=\"s3devDD\"></ul>\n                        </div>\n                    </span>\n                </label>\n            </div>\n        `\n    );\n\n    floatBar = document.getElementById(\"s3devFloatingBar\");\n    floatBar.style.left = this.mouseXY.x + 16 + \"px\";\n    floatBar.style.top = this.mouseXY.y - 8 + \"px\";\n\n    this.floatInp = document.getElementById(\"s3devIInp\");\n    this.floatInp.focus();\n\n    // Build Filter List...\n\n    this.buildFloatingFilterList(e, floatBar);\n\n    const ddOut = document.getElementById(\"s3devIDDOut\");\n    ddOut.addEventListener(\"mousedown\", (...e) => this.dropDownFloatClick(...e));\n\n    this.floatInp.addEventListener(\"keyup\", (...e) => this.floatInputChange(...e));\n    this.floatInp.addEventListener(\"focus\", (...e) => this.floatInputChange(...e));\n    this.floatInp.addEventListener(\"keydown\", (...e) => this.floatInputKeyDown(...e));\n  }\n\n  middleClick(e) {\n    // Intercept clicks to allow jump to...?\n    let blockSvg = e.target.closest(\"[data-id]\");\n    if (!blockSvg) {\n      // Ok, so no selection... are we at least clicking on the workspace?\n      if (e.target.closest(\"svg.blocklySvg\")) {\n        this.blockCursor = null; // Clear the cursor if using the mouse\n        this.middleClickWorkspace(e);\n      }\n      return;\n    }\n\n    if (!this.addon.settings.get(\"enableMiddleClickFinder\")) {\n      return;\n    }\n\n    let w = this.utils.getWorkspace();\n    let dataId = blockSvg.getAttribute(\"data-id\");\n    let block = w.getBlockById(dataId);\n    if (!block) {\n      return;\n    }\n\n    // Move outwards until we reach a block we can take action on\n\n    for (; block; block = block.getSurroundParent()) {\n      if (block.type === \"procedures_call\") {\n        e.cancelBubble = true;\n        e.preventDefault();\n\n        // todo: navigate to definition\n        let findProcCode = block.getProcCode();\n\n        let wksp = this.utils.getWorkspace();\n        let topBlocks = wksp.getTopBlocks();\n        for (const root of topBlocks) {\n          if (root.type === \"procedures_definition\") {\n            let label = root.getChildren()[0];\n            let procCode = label.getProcCode();\n            if (procCode && procCode === findProcCode) {\n              // Found... navigate to it!\n              this.centerTop(root);\n              return;\n            }\n          }\n        }\n      }\n\n      if (block.type === \"procedures_definition\") {\n        let id = block.id ? block.id : block.getId ? block.getId() : null;\n\n        this.findInp.focus();\n        this.showDropDown(null, id);\n        // findInp.select();\n\n        e.cancelBubble = true;\n        e.preventDefault();\n        return;\n      }\n\n      if (\n        block.type === \"data_variable\" ||\n        block.type === \"data_changevariableby\" ||\n        block.type === \"data_setvariableto\"\n      ) {\n        let id = block.getVars()[0];\n\n        this.findInp.focus();\n        this.showDropDown(null, id, block);\n\n        // let button = document.getElementById('s3devReplace');\n\n        this.selVarID = id;\n        // button.classList.remove('s3devHide');\n\n        e.cancelBubble = true;\n        e.preventDefault();\n        return;\n      }\n\n      if (\n        block.type === \"event_whenbroadcastreceived\" ||\n        block.type === \"event_broadcastandwait\" ||\n        block.type === \"event_broadcast\"\n      ) {\n        // todo: actually index the broadcasts...!\n        let id = block.id;\n\n        this.findInp.focus();\n        this.showDropDown(null, id, block);\n\n        this.selVarID = id;\n\n        e.cancelBubble = true;\n        e.preventDefault();\n        return;\n      }\n    }\n\n    e.cancelBubble = true;\n    e.preventDefault();\n  }\n\n  getEdgeTypeClass(block) {\n    switch (block.edgeShape_) {\n      case 1:\n        return \"boolean\";\n      case 2:\n        return \"reporter\";\n      default:\n        return block.startHat_ ? \"hat\" : \"block\";\n    }\n  }\n\n  buildFloatingFilterList(e, floatBar) {\n    // todo: Iterate through the toolbox?\n\n    let options = [];\n\n    let t = this.utils.getWorkspace().getToolbox();\n\n    let blocks = t.flyout_.getWorkspace().getTopBlocks();\n    // 107 blocks, not in order... but we can sort by y value or description right :)\n\n    let fullDom = Blockly.Xml.workspaceToDom(t.flyout_.getWorkspace());\n    const doms = {};\n    for (const x of fullDom.children) {\n      if (x.tagName === \"BLOCK\") {\n        // let type = x.getAttribute('type');\n        let id = x.getAttribute(\"id\");\n        doms[id] = x;\n      }\n    }\n\n    for (const block of blocks) {\n      this.getBlockText(block, options, doms);\n    }\n\n    // Griffpatch - on second thoughts - lets sort blocks by length so that shortest ones appear at the top.\n    options.sort((a, b) =>\n      a.desc.length < b.desc.length ? -1 : a.desc.length > b.desc.length ? 1 : a.desc.localeCompare(b.desc)\n    );\n\n    // Previous sort was just alphabetical\n    // options.sort((a, b) => a.desc.localeCompare(b.desc));\n\n    const dd = document.getElementById(\"s3devIDD\");\n\n    let count = 0;\n    //DROPDOWN_BLOCK_LIST_MAX_ROWS\n\n    for (const option of options) {\n      const li = document.createElement(\"li\");\n      const desc = option.desc;\n\n      // bType = hat block reporter boolean\n\n      let bType = this.getEdgeTypeClass(option.block);\n\n      count++;\n\n      li.innerText = desc;\n      li.data = { text: desc, lower: \" \" + desc.toLowerCase(), option: option };\n      li.className =\n        \"var \" + (option.block.isScratchExtension ? \"extension\" : option.block.getCategory()) + \" \" + bType; // proc.cls;\n      if (count > DROPDOWN_BLOCK_LIST_MAX_ROWS) {\n        // Limit maximum number of rows to prevent lag when no filter is applied\n        li.style.display = \"none\";\n      }\n      dd.appendChild(li);\n    }\n\n    const ddOut = document.getElementById(\"s3devIDDOut\");\n    ddOut.classList.add(\"vis\");\n\n    // console.log(options);\n  }\n\n  /**\n   * Flesh out a blocks description - duplicate up blocks with contained picklists (like list drop downs)\n   * @param block\n   * @param options\n   * @param doms\n   * @returns {string}\n   */\n  getBlockText(block, options, doms) {\n    // block.type;  \"looks_nextbackdrop\"\n\n    let desc;\n    let picklist, pickField;\n\n    let dom = doms[block.id];\n\n    // dom = doms[block.type];\n\n    const process = (block) => {\n      for (const input of block.inputList) {\n        // input.name = \"\", input.type = 5\n        let fields = input.fieldRow;\n        for (const field of fields) {\n          // field --- Blockly.FieldLabel .className = \"blocklyText\"\n          // Blockly.FieldDropdown --- .className = \"blocklyText blocklyDropdownText\"\n\n          let text;\n\n          if (!picklist && field.className_ === \"blocklyText blocklyDropdownText\") {\n            picklist = field.getOptions();\n            pickField = field.name;\n            if (picklist && picklist.length > 0) {\n              text = \"^^\";\n            } else {\n              text = field.getText();\n            }\n          } else {\n            text = field.getText();\n          }\n\n          desc = (desc ? desc + \" \" : \"\") + text;\n        }\n\n        if (input.connection) {\n          let innerBlock = input.connection.targetBlock();\n          if (innerBlock) {\n            process(innerBlock); // Recursive process connected child blocks...\n          }\n        }\n      }\n    };\n\n    process(block);\n\n    if (picklist) {\n      for (const item of picklist) {\n        let code = item[1];\n        if (\n          typeof code !== \"string\" || // Audio Record is a function!\n          code === \"DELETE_VARIABLE_ID\" ||\n          code === \"RENAME_VARIABLE_ID\" ||\n          code === \"NEW_BROADCAST_MESSAGE_ID\" ||\n          code === \"NEW_BROADCAST_MESSAGE_ID\"\n        ) {\n          continue; // Skip these\n        }\n        options.push({\n          desc: desc.replace(\"^^\", item[0]),\n          block: block,\n          dom: dom,\n          option: item,\n          pickField: pickField,\n        });\n      }\n    } else {\n      options.push({ desc: desc, block: block, dom: dom });\n    }\n\n    return desc;\n  }\n\n  floatInputKeyDown(e) {\n    if (e.keyCode === 38) {\n      this.navigateFloatFilter(-1);\n      e.preventDefault();\n      return;\n    }\n    if (e.keyCode === 40) {\n      this.navigateFloatFilter(1);\n      e.preventDefault();\n      return;\n    }\n    if (e.keyCode === 13) {\n      // Enter\n      let dd = document.getElementById(\"s3devIDD\");\n      let sel = dd.querySelector(\".sel\");\n      if (sel) {\n        this.dropDownFloatClick(e);\n      }\n      e.cancelBubble = true;\n      e.preventDefault();\n      return;\n    }\n    if (e.keyCode === 27) {\n      // Escape\n      let findInp = document.getElementById(\"s3devIInp\");\n      if (findInp.value.length > 0) {\n        findInp.value = \"\"; // Clear search first, then close on second press\n        this.floatInputChange(e);\n      } else {\n        this.reallyHideFloatDropDown(true);\n      }\n      e.preventDefault();\n      return;\n    }\n  }\n\n  navigateFloatFilter(dir) {\n    let dd = document.getElementById(\"s3devIDD\");\n    let sel = dd.getElementsByClassName(\"sel\");\n    let nxt;\n    if (sel.length > 0 && sel[0].style.display !== \"none\") {\n      nxt = dir === -1 ? sel[0].previousSibling : sel[sel.length - 1].nextSibling;\n    } else {\n      nxt = dd.children[0];\n      dir = 1;\n    }\n    while (nxt && nxt.style.display === \"none\") {\n      nxt = dir === -1 ? nxt.previousSibling : nxt.nextSibling;\n    }\n    if (nxt) {\n      for (const i of sel) {\n        i.classList.remove(\"sel\");\n      }\n      nxt.classList.add(\"sel\");\n      // centerTop(nxt.data.labelID);\n    }\n  }\n\n  /**\n   * This is a feature in progress - can we have a virtual cursor that allows the next injected element position be automated\n   * @param block a blockly block\n   * @param typ type\n   */\n  findNextHole(block, typ) {\n    /*\n      const inputs = block.inputList;\n      if (inputs) {\n        /!** Blockly.Input *!/\n        for (const input of inputs) {\n          const fieldRow = input.fieldRow;\n          if (fieldRow) {\n            /!** Blockly.FieldNumber *!/\n            for (const field of fieldRow) {\n              if (field.argType_ && field.argType_.includes(typ)) {\n              }\n            }\n          }\n        }\n      }\n  */\n  }\n\n  /**\n   * Inject the selected block into the script\n   * @param e\n   */\n  dropDownFloatClick(e) {\n    e.cancelBubble = true;\n    if (!e.target.closest(\"input\")) {\n      e.preventDefault();\n    }\n\n    let wksp = this.utils.getWorkspace();\n\n    let sel = e && e.target;\n    if (sel.tagName === \"B\") {\n      sel = sel.parentNode;\n    }\n\n    if (e instanceof MouseEvent && sel.tagName !== \"LI\") {\n      // Mouse clicks need to be on a block...\n      return;\n    }\n\n    if (!sel || !sel.data) {\n      let dd = document.getElementById(\"s3devIDD\");\n      sel = dd.querySelector(\".sel\");\n    }\n\n    if (!sel) {\n      return;\n    }\n\n    const xml = new XML();\n    let x = xml.xmlDoc.firstChild;\n    let option = sel.data.option;\n    // block:option.block, dom:option.dom, option:option.option\n    if (option.option) {\n      // We need to tweak the dropdown in this xml...\n      let field = option.dom.querySelector(\"field[name=\" + option.pickField + \"]\");\n      if (field.getAttribute(\"id\")) {\n        field.innerText = option.option[0];\n        field.setAttribute(\"id\", option.option[1] + \"-\" + option.option[0]);\n      } else {\n        field.innerText = option.option[1]; // griffpatch - oops! option.option[1] not 0?\n      }\n    }\n\n    x.appendChild(option.dom);\n\n    let ids = Blockly.Xml.domToWorkspace(x, wksp);\n\n    this.reallyHideFloatDropDown(true);\n\n    let block = wksp.getBlockById(ids[0]);\n\n    if (this.blockCursor) {\n      // What sort of block did we just inject?\n      let typ = this.getEdgeTypeClass(option.block);\n      if (typ === \"boolean\") {\n        this.findNextHole(this.blockCursor, \"\");\n      } else if (typ === \"reporter\") {\n        this.findNextHole(this.blockCursor, typ);\n      }\n    }\n\n    this.domHelpers.triggerDragAndDrop(block.svgPath_, null, { x: this.mouseXY.x, y: this.mouseXY.y });\n\n    this.blockCursor = block;\n  }\n\n  floatInputChange(e) {\n    let ddOut = document.getElementById(\"s3devIDDOut\");\n\n    if (!ddOut.classList.contains(\"vis\")) {\n      // showDropDown();\n      // hideDropDown(); // Start timer to hide if not got focus\n    }\n\n    let findInp = document.getElementById(\"s3devIInp\");\n\n    // Filter the list...\n    let val = (findInp.value || \"\").toLowerCase();\n    if (val === prevVal) {\n      return;\n    }\n\n    prevVal = val;\n    this.multi.blocks = null;\n\n    let dd = document.getElementById(\"s3devIDD\");\n    let p = dd.parentNode;\n    dd.remove();\n\n    let count = 0;\n\n    let split = val.split(\" \");\n    let listLI = dd.getElementsByTagName(\"li\");\n    for (const li of listLI) {\n      const procCode = li.data.text;\n      const lower = li.data.lower;\n      // let i = li.data.lower.indexOf(val);\n      // let array = regExp.exec(li.data.lower);\n\n      let im = 0;\n      let match = [];\n      for (let si = 0; si < split.length; si++) {\n        let find = \" \" + split[si];\n        let idx = lower.indexOf(find, im);\n        if (idx === -1) {\n          match = null;\n          break;\n        }\n        match.push(idx);\n        im = idx + find.length;\n      }\n\n      if (count < DROPDOWN_BLOCK_LIST_MAX_ROWS && match) {\n        li.style.display = \"block\";\n        this.dom_removeChildren(li);\n\n        let i = 0;\n\n        for (let iM = 0; iM < match.length; iM++) {\n          let im = match[iM];\n          if (im > i) {\n            li.appendChild(document.createTextNode(procCode.substring(i, im)));\n            i = im;\n          }\n          let bText = document.createElement(\"b\");\n          let len = split[iM].length;\n          bText.appendChild(document.createTextNode(procCode.substr(i, len)));\n          li.appendChild(bText);\n          i += len;\n        }\n\n        if (i < procCode.length) {\n          li.appendChild(document.createTextNode(procCode.substr(i)));\n        }\n\n        if (count === 0) {\n          li.classList.add(\"sel\");\n        } else {\n          li.classList.remove(\"sel\");\n        }\n        count++;\n      } else {\n        li.style.display = \"none\";\n        li.classList.remove(\"sel\");\n      }\n    }\n    p.append(dd);\n  }\n\n  // Loop until the DOM is ready for us...\n  initInner() {\n    let root = document.querySelector(\"ul[class*=gui_tab-list_]\");\n    let guiTabs = root && root.childNodes;\n    if (!guiTabs || guiTabs.length < 3) {\n      setTimeout(() => this.initInner(), 1000);\n      return;\n    }\n\n    if (this.codeTab && guiTabs[0] !== this.codeTab) {\n      // We have been CHANGED!!! - Happens when going to project page, and then back inside again!!!\n      this.domHelpers.unbindAllEvents();\n    }\n\n    this.codeTab = guiTabs[0];\n    this.costTab = guiTabs[1];\n    this.costTabBody = document.querySelector(\"div[aria-labelledby=\" + this.costTab.id + \"]\");\n\n    if (!document.getElementById(\"s3devFind\")) {\n      // noinspection JSUnresolvedVariable\n      root.insertAdjacentHTML(\n        \"beforeend\",\n        `\n                <div id=\"s3devToolBar\">\n                    <label class='title s3devLabel' id=s3devFindLabel>\n                        <span>${this.m(\"find\")} ${\n          this.addon.self._isDevtoolsExtension\n            ? \"\"\n            : '<a href=\"#\" class=\"s3devAction\" id=\"s3devHelp\" style=\"/*s-a*/ margin-left: 0; font-size: 10px; /*s-a*/\">(?)</a>'\n        } </span>\n                        <span id=s3devFind class=\"s3devWrap\">\n                            <div id='s3devDDOut' class=\"s3devDDOut\">\n                                <input id='s3devInp' class=\"${this.addon.tab.scratchClass(\"input_input-form\", {\n                                  others: \"s3devInp\",\n                                })}\" type='search' placeholder='${this.m(\"find-placeholder\")}' autocomplete='off'>\n                                <ul id='s3devDD' class=\"s3devDD\"></ul>\n                            </div>\n                        </span>\n                        <a id=\"s3devDeep\" class=\"s3devAction s3devHide\" href=\"#\">${this.m(\"deep\")}</a>\n                        <div ${\n                          this.addon.self._isDevtoolsExtension ? \"\" : 'style=\"display: none;\"'\n                        }><a href=\"#\" class=\"s3devAction\" id=\"s3devHelp\"><b>${this.m(\"help\")}</b></a>\n                        <a href=\"https://www.youtube.com/griffpatch\" class=\"s3devAction\" target=\"_blank\" id=\"s3devHelp\" rel=\"noreferrer noopener\">${this.m(\n                          \"tutorials\"\n                        )}</a></div>\n                    </label>\n<!--                    <a id=\"s3devCleanUp\" class=\"s3devAction\" href=\"#\">Clean Up</a>-->\n<!--                    <a id=\"s3devReplace\" class=\"s3devAction s3devHide\" href=\"#\">Replace All</a>-->\n                </div>\n            `\n      );\n\n      this.find = document.getElementById(\"s3devFind\");\n      this.findInp = document.getElementById(\"s3devInp\");\n      this.ddOut = document.getElementById(\"s3devDDOut\");\n      this.domHelpers.bindOnce(this.ddOut, \"mousedown\", (...e) => this.dropDownClick(...e), undefined);\n      this.dd = document.getElementById(\"s3devDD\");\n\n      // bindOnce(find, 'mouseenter', showDropDown);\n      // bindOnce(find, 'mouseleave', hideDropDown);\n      this.domHelpers.bindOnce(this.findInp, \"keyup\", (...e) => this.inputChange(...e), undefined);\n      this.domHelpers.bindOnce(this.findInp, \"keydown\", (...e) => this.inputKeyDown(...e), undefined);\n      this.domHelpers.bindOnce(this.findInp, \"focus\", (...e) => this.inputChange(...e), undefined);\n\n      this.domHelpers.bindOnce(\n        document.getElementById(\"s3devHelp\"),\n        \"click\",\n        (...e) => this.eventClickHelp(...e),\n        undefined\n      );\n\n      this.domHelpers.bindOnce(document, \"keydown\", (...e) => this.eventKeyDown(...e), true);\n    }\n\n    this.domHelpers.bindOnce(document, \"mousemove\", (...e) => this.eventMouseMove(...e), true);\n    this.domHelpers.bindOnce(document, \"mousedown\", (...e) => this.eventMouseDown(...e), true); // true to capture all mouse downs 'before' the dom events handle them\n    this.domHelpers.bindOnce(document, \"mouseup\", (...e) => this.eventMouseUp(...e), true);\n    // bindOnce(document.getElementById(\"s3devDeep\"), \"click\", deepSearch);\n    // bindOnce(document.getElementById('s3devCleanUp'),'click', clickCleanUp);\n    // bindOnce(document.getElementById(\"s3devInject\"), \"click\", clickInject);\n    // bindOnce(document.getElementById('s3devReplace'), 'click', clickReplace);\n  }\n}\n\nclass Multi {\n  constructor(utils) {\n    this.idx = 0;\n    this.blocks = null;\n    this.selID = null;\n    /**\n     * @type {Utils}\n     */\n    this.utils = utils;\n  }\n\n  update() {\n    const count = document.getElementById(\"s3devMultiCount\");\n    count.innerText = this.blocks && this.blocks.length > 0 ? enc(this.idx + 1 + \" / \" + this.blocks.length) : \"0\";\n    this.selID = this.idx < this.blocks.length ? this.blocks[this.idx].id : null;\n  }\n\n  navLeft(e) {\n    return this.navSideways(e, -1);\n  }\n\n  navRight(e) {\n    return this.navSideways(e, 1);\n  }\n\n  navSideways(e, dir) {\n    if (this.blocks && this.blocks.length > 0) {\n      this.idx = (this.idx + dir + this.blocks.length) % this.blocks.length; // + length to fix negative modulo js issue.\n      this.update();\n      this.utils.scrollBlockIntoView(this.blocks[this.idx]);\n    }\n    if (e) {\n      e.cancelBubble = true;\n      e.preventDefault();\n    }\n    return false;\n  }\n}\n\nclass Col {\n  /**\n   * @param x {Number} x position (for ordering)\n   * @param count {Number}\n   * @param blocks {[Block]}\n   */\n  constructor(x, count, blocks) {\n    /**\n     * x position (for ordering)\n     * @type {Number}\n     */\n    this.x = x;\n    /**\n     * @type {Number}\n     */\n    this.count = count;\n    /**\n     * @type {[Blockly.Block]}\n     */\n    this.blocks = blocks;\n  }\n}\n\nconst DROPDOWN_BLOCK_LIST_MAX_ROWS = 25;\n\nlet rhdd = 0;\nlet rhdd2 = 0;\nlet prevVal = \"\";\n\nfunction enc(str) {\n  return String(str).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\");\n}\n","export default class DomHelpers {\n  constructor(addon) {\n    this.addon = addon;\n    this.vm = addon.tab.traps.vm;\n    /**\n     * @type {eventDetails[]}\n     */\n    this.events = [];\n  }\n\n  /**\n   * Simulate a drag and drop programmatically through javascript\n   * @param selectorDrag\n   * @param selectorDrop\n   * @param mouseXY\n   * @returns {boolean}\n   */\n  triggerDragAndDrop(selectorDrag, selectorDrop, mouseXY) {\n    // function for triggering mouse events\n    let fireMouseEvent = function (type, elem, centerX, centerY) {\n      let evt = document.createEvent(\"MouseEvents\");\n      evt.initMouseEvent(type, true, true, window, 1, 1, 1, centerX, centerY, false, false, false, false, 0, elem);\n      elem.dispatchEvent(evt);\n    };\n\n    // fetch target elements\n    let elemDrag = selectorDrag; // document.querySelector(selectorDrag);\n    let elemDrop = selectorDrop; // document.querySelector(selectorDrop);\n    if (!elemDrag /* || !elemDrop*/) {\n      return false;\n    }\n\n    // calculate positions\n    let pos = elemDrag.getBoundingClientRect();\n    let center1X = Math.floor((pos.left + pos.right) / 2);\n    let center1Y = Math.floor((pos.top + pos.bottom) / 2);\n\n    // mouse over dragged element and mousedown\n    fireMouseEvent(\"mouseover\", elemDrag, center1X, center1Y);\n    fireMouseEvent(\"mousedown\", elemDrag, center1X, center1Y);\n\n    // start dragging process over to drop target\n    fireMouseEvent(\"dragstart\", elemDrag, center1X, center1Y);\n    fireMouseEvent(\"drag\", elemDrag, center1X, center1Y);\n    fireMouseEvent(\"mousemove\", elemDrag, center1X, center1Y);\n\n    if (!elemDrop) {\n      if (mouseXY) {\n        // console.log(mouseXY);\n        let center2X = mouseXY.x;\n        let center2Y = mouseXY.y;\n        fireMouseEvent(\"drag\", elemDrag, center2X, center2Y);\n        fireMouseEvent(\"mousemove\", elemDrag, center2X, center2Y);\n      }\n      return false;\n    }\n\n    pos = elemDrop.getBoundingClientRect();\n    let center2X = Math.floor((pos.left + pos.right) / 2);\n    let center2Y = Math.floor((pos.top + pos.bottom) / 2);\n\n    fireMouseEvent(\"drag\", elemDrag, center2X, center2Y);\n    fireMouseEvent(\"mousemove\", elemDrop, center2X, center2Y);\n\n    // trigger dragging process on top of drop target\n    fireMouseEvent(\"mouseenter\", elemDrop, center2X, center2Y);\n    fireMouseEvent(\"dragenter\", elemDrop, center2X, center2Y);\n    fireMouseEvent(\"mouseover\", elemDrop, center2X, center2Y);\n    fireMouseEvent(\"dragover\", elemDrop, center2X, center2Y);\n\n    // release dragged element on top of drop target\n    fireMouseEvent(\"drop\", elemDrop, center2X, center2Y);\n    fireMouseEvent(\"dragend\", elemDrag, center2X, center2Y);\n    fireMouseEvent(\"mouseup\", elemDrag, center2X, center2Y);\n\n    return true;\n  }\n\n  bindOnce(dom, event, func, capture) {\n    capture = !!capture;\n    dom.removeEventListener(event, func, capture);\n    dom.addEventListener(event, func, capture);\n    this.events.push(new eventDetails(dom, event, func, capture));\n  }\n\n  unbindAllEvents() {\n    for (const event of this.events) {\n      event.dom.removeEventListener(event.event, event.func, event.capture);\n    }\n    this.events = [];\n  }\n}\n\n/**\n * A record of an event\n */\nclass eventDetails {\n  constructor(dom, event, func, capture) {\n    this.dom = dom;\n    this.event = event;\n    this.func = func;\n    this.capture = capture;\n  }\n}\n","/**\n * A fake XML class to use in place of the real XML for faking things?\n */\nexport default class XML {\n  constructor() {\n    this.xmlDoc = document.implementation.createDocument(null, \"xml\");\n  }\n\n  newXml(x, tagName, attrs) {\n    let xAdd = this.xmlDoc.createElement(tagName);\n    x.appendChild(xAdd);\n    return this.setAttr(xAdd, attrs);\n  }\n\n  setAttr(x, attrs) {\n    if (attrs) {\n      for (const key of Object.keys(attrs)) {\n        if (key === \"text\") {\n          x.appendChild(this.xmlDoc.createTextNode(attrs[key]));\n        } else {\n          x.setAttribute(key, attrs[key]);\n        }\n      }\n    }\n    return x;\n  }\n}\n","/**\n * Helper class to flash a Blockly scratch block in the users workspace\n */\nexport default class BlockFlasher {\n  /**\n   * FLash a block 3 times\n   * @param block the block to flash\n   */\n  static flash(block) {\n    if (myFlash.timerID > 0) {\n      clearTimeout(myFlash.timerID);\n      if (myFlash.block.svgPath_) {\n        myFlash.block.svgPath_.style.fill = \"\";\n      }\n    }\n\n    let count = 4;\n    let flashOn = true;\n    myFlash.block = block;\n\n    /**\n     * Internal method to switch the colour of a block between light yellow and it's original colour\n     * @private\n     */\n    function _flash() {\n      if (myFlash.block.svgPath_) {\n        myFlash.block.svgPath_.style.fill = flashOn ? \"#ffff80\" : \"\";\n      }\n      flashOn = !flashOn;\n      count--;\n      if (count > 0) {\n        myFlash.timerID = setTimeout(_flash, 200);\n      } else {\n        myFlash.timerID = 0;\n        myFlash.block = null;\n      }\n    }\n\n    _flash();\n  }\n}\n\nconst myFlash = { block: null, timerID: null };\n","/**\n * This class is dedicated to maintaining the Undo stack of Blockly\n * It allows us to initiate an undo group such that all subsequent operations are recorded as a single\n * undoable transaction.\n */\nexport default class UndoGroup {\n  /**\n   * Start an Undo group - begin recording\n   * @param workspace the workspace\n   */\n  static startUndoGroup(workspace) {\n    const undoStack = workspace.undoStack_;\n    if (undoStack.length) {\n      undoStack[undoStack.length - 1]._devtoolsLastUndo = true;\n    }\n  }\n\n  /**\n   * End an Undo group - stops recording\n   * @param workspace the workspace\n   */\n  static endUndoGroup(workspace) {\n    const undoStack = workspace.undoStack_;\n    // Events (responsible for undoStack updates) are delayed with a setTimeout(f, 0)\n    // https://github.com/LLK/scratch-blocks/blob/f159a1779e5391b502d374fb2fdd0cb5ca43d6a2/core/events.js#L182\n    setTimeout(() => {\n      const group = generateUID();\n      for (let i = undoStack.length - 1; i >= 0 && !undoStack[i]._devtoolsLastUndo; i--) {\n        undoStack[i].group = group;\n      }\n    }, 0);\n  }\n}\n\n/**\n * https://github.com/LLK/scratch-blocks/blob/f159a1779e5391b502d374fb2fdd0cb5ca43d6a2/core/events.js#L182\n * @returns {string}\n * @private\n */\nfunction generateUID() {\n  const CHARACTERS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%()*+,-./:;=?@[]^_`{|}~\";\n  let result = \"\";\n  for (let i = 0; i < 20; i++) {\n    result += CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];\n  }\n  return result;\n}\n","import BlockInstance from \"../BlockInstance.js\";\nimport BlockFlasher from \"./BlockFlasher.js\";\n\n// A file to split Editor Devtools by features.\n\nexport default class Utils {\n  constructor(addon) {\n    this.addon = addon;\n    /**\n     * Scratch Virtual Machine\n     * @type {null|*}\n     */\n    this.vm = this.addon.tab.traps.vm;\n    // this._myFlash = { block: null, timerID: null, colour: null };\n    this.offsetX = 32;\n    this.offsetY = 32;\n    this.navigationHistory = new NavigationHistory(this);\n    /**\n     * The workspace\n     */\n    this._workspace = null;\n  }\n\n  /**\n   * Get the Scratch Editing Target\n   * @returns {?Target} the scratch editing target\n   */\n  getEditingTarget() {\n    return this.vm.runtime.getEditingTarget();\n  }\n\n  /**\n   * Set the current workspace (switches sprites)\n   * @param targetID {string}\n   */\n  setEditingTarget(targetID) {\n    if (this.getEditingTarget().id !== targetID) {\n      this.vm.setEditingTarget(targetID);\n    }\n  }\n\n  /**\n   * Returns the main workspace\n   * @returns !Blockly.Workspace\n   */\n  getWorkspace() {\n    const currentWorkspace = Blockly.getMainWorkspace();\n    if (currentWorkspace.getToolbox()) {\n      // Sadly get get workspace does not always return the 'real' workspace... Not sure how to get that at the moment,\n      //  but we can work out whether it's the right one by whether it has a toolbox.\n      this._workspace = currentWorkspace;\n    }\n    return this._workspace;\n  }\n\n  /**\n   * Based on wksp.centerOnBlock(li.data.labelID);\n   * @param blockOrId {Blockly.Block|{id}|BlockInstance} A Blockly Block, a block id, or a BlockInstance\n   * @param [force] {boolean} if true, the view always moves, otherwise only move if the selected element is not entirely visible\n   */\n  scrollBlockIntoView(blockOrId, force) {\n    let workspace = this.getWorkspace();\n    /** @type {Blockly.Block} */\n    let block; // or is it really a Blockly.BlockSvg?\n\n    if (blockOrId instanceof BlockInstance) {\n      // Switch to sprite\n      this.setEditingTarget(blockOrId.targetId);\n      // Highlight the block!\n      block = workspace.getBlockById(blockOrId.id);\n    } else {\n      block = blockOrId && blockOrId.id ? blockOrId : workspace.getBlockById(blockOrId);\n    }\n\n    if (!block) {\n      return;\n    }\n\n    /**\n     * !Blockly.Block\n     */\n    let root = block.getRootBlock();\n    let base = this.getTopOfStackFor(block);\n    let ePos = base.getRelativeToSurfaceXY(), // Align with the top of the block\n      rPos = root.getRelativeToSurfaceXY(), // Align with the left of the block 'stack'\n      scale = workspace.scale,\n      x = rPos.x * scale,\n      y = ePos.y * scale,\n      xx = block.width + x, // Turns out they have their x & y stored locally, and they are the actual size rather than scaled or including children...\n      yy = block.height + y,\n      s = workspace.getMetrics();\n    if (\n      x < s.viewLeft + this.offsetX - 4 ||\n      xx > s.viewLeft + s.viewWidth ||\n      y < s.viewTop + this.offsetY - 4 ||\n      yy > s.viewTop + s.viewHeight\n    ) {\n      // sx = s.contentLeft + s.viewWidth / 2 - x,\n      let sx = x - s.contentLeft - this.offsetX,\n        // sy = s.contentTop - y + Math.max(Math.min(32, 32 * scale), (s.viewHeight - yh) / 2);\n        sy = y - s.contentTop - this.offsetY;\n\n      this.navigationHistory.storeView(this.navigationHistory.peek(), 64);\n\n      // workspace.hideChaff(),\n      workspace.scrollbar.set(sx, sy);\n      this.navigationHistory.storeView({ left: sx, top: sy }, 64);\n    }\n    BlockFlasher.flash(block);\n  }\n\n  /**\n   * Find the top stack block of a stack\n   * @param block a block in a stack\n   * @returns {*} a block that is the top of the stack of blocks\n   */\n  getTopOfStackFor(block) {\n    let base = block;\n    while (base.getOutputShape() && base.getSurroundParent()) {\n      base = base.getSurroundParent();\n    }\n    return base;\n  }\n}\n\nclass NavigationHistory {\n  constructor(utils) {\n    this.utils = utils;\n    this.views = [];\n    this.forward = [];\n  }\n\n  /**\n   * Keep a record of the scroll and zoom position\n   */\n  storeView(next, dist) {\n    this.forward = [];\n    let workspace = this.utils.getWorkspace(),\n      s = workspace.getMetrics();\n\n    let pos = { left: s.viewLeft, top: s.viewTop };\n    if (!next || distance(pos, next) > dist) {\n      this.views.push(pos);\n    }\n  }\n\n  peek() {\n    return this.views.length > 0 ? this.views[this.views.length - 1] : null;\n  }\n\n  goBack() {\n    const workspace = this.utils.getWorkspace(),\n      s = workspace.getMetrics();\n\n    let pos = { left: s.viewLeft, top: s.viewTop };\n    let view = this.peek();\n    if (!view) {\n      return;\n    }\n    if (distance(pos, view) < 64) {\n      // Go back to current if we are already far away from it\n      if (this.views.length > 1) {\n        this.views.pop();\n        this.forward.push(view);\n      }\n    }\n\n    view = this.peek();\n    if (!view) {\n      return;\n    }\n\n    let sx = view.left - s.contentLeft,\n      sy = view.top - s.contentTop;\n\n    // transform.setTranslate(-600,0);\n\n    workspace.scrollbar.set(sx, sy);\n\n    /*\n              let blocklySvg = document.getElementsByClassName('blocklySvg')[0];\n              let blocklyBlockCanvas = blocklySvg.getElementsByClassName('blocklyBlockCanvas')[0];\n              let transform = blocklyBlockCanvas.transform.baseVal.getItem(0);\n              let scale = blocklyBlockCanvas.transform.baseVal.getItem(1);\n\n              let transformMatrix = transform.matrix;\n              let scaleMatrix = scale.matrix;\n\n              console.log('Transform - getMetrics', s);\n              console.log('sx, sy: ', sx, sy);\n              console.log('left, top: ', view.left, view.top);\n              console.log('contentLeft, right:', s.contentLeft, s.contentTop);\n              console.log('transform, scale matrix: ', transformMatrix, scaleMatrix);\n  */\n  }\n\n  goForward() {\n    let view = this.forward.pop();\n    if (!view) {\n      return;\n    }\n    this.views.push(view);\n\n    let workspace = this.utils.getWorkspace(),\n      s = workspace.getMetrics();\n\n    let sx = view.left - s.contentLeft,\n      sy = view.top - s.contentTop;\n\n    workspace.scrollbar.set(sx, sy);\n  }\n}\n\nfunction distance(pos, next) {\n  return Math.sqrt(Math.pow(pos.left - next.left, 2) + Math.pow(pos.top - next.top, 2));\n}\n","module.exports = __webpack_public_path__ + \"static/assets/cb666b99d3528f91b52f985dfb102afa.svg\";","// A file to split Editor Devtools by features.\n// Unlike userscript.js, this file mainly interacts with VM.\nexport default class ShowBroadcast {\n  constructor(addon) {\n    this.addon = addon;\n    this.vm = this.addon.tab.traps.vm;\n    this.highlights = {\n      timeoutId: 0,\n      callback: () => {},\n    };\n  }\n\n  showSenders(broadcastId) {\n    this.highlightTargets(this.getTargetsWithSenders(broadcastId));\n  }\n\n  getTargetsWithSenders(broadcastId) {\n    const targetWithSenders = [];\n    for (const target of this.vm.runtime.targets) {\n      if (!target.isOriginal) return;\n      for (const blockId of Object.keys(target.blocks._blocks)) {\n        const block = target.blocks.getBlock(blockId);\n        if (block.inputs.BROADCAST_INPUT) {\n          const input = block.inputs.BROADCAST_INPUT;\n          // For results, blocks must NOT be inserted, for convenience.\n          if (\n            input.block === input.shadow &&\n            target.blocks.getBlock(input.shadow).fields.BROADCAST_OPTION.id === broadcastId\n          ) {\n            targetWithSenders.push(target);\n            break;\n          }\n        }\n      }\n    }\n    return targetWithSenders;\n  }\n\n  showReceivers(broadcastId) {\n    this.highlightTargets(this.getTargetsWithReceivers(broadcastId));\n  }\n\n  getTargetsWithReceivers(broadcastId) {\n    const targetWithReceivers = [];\n    for (const target of this.vm.runtime.targets) {\n      if (!target.isOriginal) return;\n      for (const blockId of Object.keys(target.blocks._blocks)) {\n        const block = target.blocks.getBlock(blockId);\n        if (block.opcode === \"event_whenbroadcastreceived\" && block.fields.BROADCAST_OPTION.id === broadcastId) {\n          targetWithReceivers.push(target);\n          break;\n        }\n      }\n    }\n    return targetWithReceivers;\n  }\n\n  highlightTargets(targets) {\n    if (this.highlights.timeoutId) {\n      this.highlights.callback();\n      clearTimeout(this.highlights.timeoutId);\n      this.highlights = {\n        timeoutId: 0,\n        callback: () => {},\n      };\n    }\n    const elemPendingToRemoveHighlights = [];\n    for (const target of targets) {\n      let elem = null;\n      if (target.isStage) {\n        elem = document.querySelector('div[class*=\"stage-selector_header\"]');\n      } else if (target.isOriginal) {\n        // This is one of the most ridiculous code I've ever written.\n        // This essentially comparses sprite names to textContent so that we can add CSS.\n        const possibleElements = document.querySelectorAll('div[class*=\"sprite-selector-item_sprite-name\"]');\n        const spriteNameElem = Array.prototype.find.call(\n          possibleElements,\n          (elem) => elem.textContent === target.getName()\n        );\n        if (!spriteNameElem) continue;\n        elem = spriteNameElem.parentElement;\n      }\n      elem.dataset.highlighted = \"true\";\n      elemPendingToRemoveHighlights.push(elem);\n    }\n    const callbackFactory = (elemToRemoveHighlights) => () => {\n      for (const removingElem of elemToRemoveHighlights) {\n        if (!removingElem.isConnected) continue;\n        removingElem.dataset.highlighted = \"false\";\n      }\n    };\n    const callback = callbackFactory(elemPendingToRemoveHighlights);\n    this.highlights = {\n      callback,\n      timeoutId: setTimeout(callback, 2000),\n    };\n  }\n\n  getAssociatedBroadcastId(blockId) {\n    const editingTarget = this.vm.editingTarget;\n    const block = editingTarget.blocks.getBlock(blockId);\n    if (block.opcode === \"event_whenbroadcastreceived\") {\n      return block.fields.BROADCAST_OPTION.id;\n    } else {\n      const input = block.inputs.BROADCAST_INPUT;\n      // Allow shadow blocks\n      return editingTarget.blocks.getBlock(input.shadow).fields.BROADCAST_OPTION.id;\n    }\n  }\n}\n","/* inserted by pull.js */\nimport _twAsset0 from \"./icon--close.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/icon--close.svg\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport DevTools from \"./DevTools.js\";\n\nexport default async function ({ addon, global, console, msg, safeMsg: m }) {\n  const untilInEditor = () => {\n    if (addon.tab.editorMode === \"editor\") return;\n    return new Promise((resolve, reject) => {\n      const handler = () => {\n        if (addon.tab.editorMode === \"editor\") {\n          resolve();\n          addon.tab.removeEventListener(\"urlChange\", handler);\n        }\n      };\n      addon.tab.addEventListener(\"urlChange\", handler);\n    });\n  };\n\n  await untilInEditor();\n\n  const guiDirection = addon.tab.direction;\n  const helpHTML = `\n<div id=\"s3devHelpPop\" class=\"${addon.tab.scratchClass(\"modal_modal-overlay\")}\" dir=\"${guiDirection}\">\n<div class=\"${addon.tab.scratchClass(\"modal_modal-content\")}\">\n<div class=\"${addon.tab.scratchClass(\"modal_header\")}\">\n  <div class=\"${addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-title\")}\">${m(\"help-title\")}</div>\n  <div class=\"${addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-close\")}\">\n    <div class=\"${addon.tab.scratchClass(\"close-button_close-button\", \"close-button_large\", {\n      others: \"close-button\",\n    })}\">\n\t  <img class=\"${addon.tab.scratchClass(\"close-button_close-icon\")}\" src=\"${_twGetAsset(\"/icon--close.svg\")}\">\n\t</div>\n  </div>\n</div>\n<div id=\"s3devHelpContent\">\n<!-- tw: we don't put this in because including \"Scratch Addons\" would probably violate BE/US policy :(\n<p>${m(\"help-title\")} ${m(\"help-by\", {\n    ndash: \"&ndash;\",\n    url: '<a target=\"_blank\" rel=\"noreferrer noopener\" href=\"https://www.youtube.com/griffpatch\">Griffpatch</a>',\n  })}</p>\n<hr />\n-->\n<h2><strong>${m(\"code-tab-features\")}</strong></h2>\n<p dir=\"auto\"><strong>${m(\"interactive-find-bar\")}</strong> &ndash; ${m(\"interactive-find-bar-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"improved-tidy-up\")}</strong> &ndash; ${m(\"improved-tidy-up-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"help-make-space\")} ${m(\"help-new\")}</strong> &ndash; ${m(\"help-make-space-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"copy-to-clipboard\")}</strong> &ndash; ${m(\"copy-to-clipboard-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"paste-from-clipboard\")}</strong> &ndash; ${m(\"paste-from-clipboard-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"swap-variable\")}</strong> &ndash; ${m(\"swap-variable-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"middleclick\")}</strong> &ndash; ${m(\"middleclick-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"ctrl-lr\")}</strong> &ndash; ${m(\"ctrl-lr-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"ctrl-space\")}</strong> &ndash; ${m(\"ctrl-space-desc\")}</p>\n<hr />\n<h2><strong>${m(\"costume-tab-features\")}</strong></h2>\n<p dir=\"auto\"><strong>${m(\"find-bar\")}</strong> &ndash; ${m(\"find-bar-costume-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"ctrl-lr\")}</strong> &ndash; ${m(\"ctrl-lr-costume-desc\")}</p>\n<p dir=\"auto\"><strong>${m(\"send-top-bottom\")}</strong> &ndash; ${m(\"send-top-bottom-desc\")}</p>\n<hr />\n<p>${m(\n    \"youtube\"\n  )} -&nbsp;<a target=\"_blank\" href=\"https://www.youtube.com/griffpatch\" rel=\"noopener noreferrer\">https://www.youtube.com/user/griffpatch</a></p>\n</div>\n</div>\n</div>\n`;\n\n  const devTools = new DevTools(addon, msg, m, helpHTML);\n  devTools.init();\n}\n","export default async function ({ addon, global, console }) {\n  // The hierarchy is:\n  // blocklyDropDownDiv (position, background color, etc.) -> blocklyDropDownContent (scrollbar) -> blocklyDropdownMenu (items)\n  // The capitalization of dropdown is inconsistent in blockly too.\n  let blocklyDropDownDiv = null;\n  let blocklyDropDownContent = null;\n  let blocklyDropdownMenu = null;\n\n  function createSearchBar(node) {\n    blocklyDropdownMenu = node;\n    blocklyDropdownMenu.focus = () => {}; // no-op focus() so it can't steal it from the search bar\n\n    // Lock the width of the dropdown before adding the search bar, as sometimes adding the searchbar changes the width.\n    blocklyDropDownContent.style.width = getComputedStyle(blocklyDropDownContent).width;\n\n    const searchBar = document.createElement(\"input\");\n    addon.tab.displayNoneWhileDisabled(searchBar);\n\n    searchBar.type = \"text\";\n    searchBar.addEventListener(\"input\", handleInputEvent);\n    searchBar.addEventListener(\"keydown\", handleKeyDownEvent);\n    searchBar.classList.add(\"u-dropdown-searchbar\");\n    blocklyDropdownMenu.insertBefore(searchBar, blocklyDropdownMenu.firstChild);\n\n    // Lock the height of the dropdown after adding the search bar.\n    blocklyDropDownContent.style.height = getComputedStyle(blocklyDropDownContent).height;\n\n    // Compensate for the scroll bar sometimes making the interface taller by pushing the whole dropdown up.\n    const hasScrollBar = blocklyDropDownContent.scrollHeight > blocklyDropDownContent.clientHeight;\n    if (!hasScrollBar) {\n      const blocklyDropDownArrow = blocklyDropDownDiv.querySelector(\".blocklyDropDownArrow\");\n      if (blocklyDropDownArrow.classList.contains(\"arrowBottom\")) {\n        const searchBarHeight = searchBar.offsetHeight;\n        blocklyDropDownDiv.style.transform += ` translateY(-${searchBarHeight}px)`;\n        blocklyDropDownArrow.style.transform = `translateY(${searchBarHeight}px) ${blocklyDropDownArrow.style.transform}`;\n      }\n    }\n\n    searchBar.focus();\n  }\n\n  function cleanup() {\n    blocklyDropdownMenu = null;\n    // Reset all the things we changed about the dropdown menu.\n    // This matters because there's other types of dropdowns such as angle selectors where a search bar doesn't make sense.\n    blocklyDropDownContent.style.width = \"\";\n    blocklyDropDownContent.style.height = \"\";\n  }\n\n  function closeDropDown() {\n    document.querySelector(\".blocklyToolboxDiv\").dispatchEvent(new MouseEvent(\"mousedown\"));\n  }\n\n  function selectItem(item, click) {\n    // You can't just use click() or focus() because Blockly uses mousedown and mouseup handlers, not click handlers.\n    item.dispatchEvent(new MouseEvent(\"mousedown\", { relatedTarget: item, bubbles: true }));\n    if (click) {\n      item.dispatchEvent(new MouseEvent(\"mouseup\", { relatedTarget: item, bubbles: true }));\n    }\n\n    // Scroll the item into view if it is offscreen.\n    const itemTop = item.offsetTop;\n    const itemEnd = itemTop + item.offsetHeight;\n\n    const scrollTop = blocklyDropDownContent.scrollTop;\n    const scrollHeight = blocklyDropDownContent.offsetHeight;\n    const scrollEnd = scrollTop + scrollHeight;\n\n    if (scrollTop > itemTop) {\n      blocklyDropDownContent.scrollTop = itemTop;\n    } else if (itemEnd > scrollEnd) {\n      blocklyDropDownContent.scrollTop = itemEnd - scrollHeight;\n    }\n  }\n\n  function handleInputEvent(event) {\n    const value = event.target.value.toLowerCase();\n    for (const item of getItems()) {\n      const text = item.textContent.toLowerCase();\n      const hidden = !text.includes(value);\n      item.hidden = hidden;\n    }\n  }\n\n  // This returns the Blockly block that is currently selected, or null.\n  function getSelectedBlock() {\n    const selected = document.querySelector(\".blocklySelected\");\n    if (!selected) {\n      return null;\n    }\n    const block = Blockly.getMainWorkspace().getBlockById(selected.dataset.id);\n    return block;\n  }\n\n  function handleKeyDownEvent(event) {\n    if (event.key === \"Enter\") {\n      // Reimplement enter to select item to account for hidden items and default to the top item.\n      event.stopPropagation();\n      event.preventDefault();\n\n      const selectedItem = blocklyDropdownMenu.querySelector(\".goog-menuitem-highlight\");\n      if (selectedItem && !selectedItem.hidden) {\n        selectItem(selectedItem, true);\n        return;\n      }\n\n      const selectedBlock = getSelectedBlock();\n      const items = getItems();\n      if (event.target.value === \"\" && selectedBlock) {\n        if (\n          selectedBlock.type === \"event_broadcast\" ||\n          selectedBlock.type === \"event_broadcastandwait\" ||\n          selectedBlock.type === \"event_whenbroadcastreceived\"\n        ) {\n          // The top item of these dropdowns is always \"New message\"\n          // When pressing enter on an empty search bar, we close the dropdown instead of making a new broadcast.\n          closeDropDown();\n          return;\n        }\n      }\n      for (const item of items) {\n        if (!item.hidden) {\n          selectItem(item, true);\n          break;\n        }\n      }\n      // If there is no top value, just leave the dropdown open.\n    } else if (event.key === \"Escape\") {\n      closeDropDown();\n    } else if (event.key === \"ArrowDown\" || event.key === \"ArrowUp\") {\n      // Reimplement keyboard navigation to account for hidden items.\n      event.preventDefault();\n      event.stopPropagation();\n\n      const items = getItems().filter((item) => !item.hidden);\n      if (items.length === 0) {\n        return;\n      }\n\n      let selectedIndex = -1;\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].classList.contains(\"goog-menuitem-highlight\")) {\n          selectedIndex = i;\n          break;\n        }\n      }\n\n      const lastIndex = items.length - 1;\n      let newIndex = 0;\n      if (event.key === \"ArrowDown\") {\n        if (selectedIndex === -1 || selectedIndex === lastIndex) {\n          newIndex = 0;\n        } else {\n          newIndex = selectedIndex + 1;\n        }\n      } else {\n        if (selectedIndex === -1 || selectedIndex === 0) {\n          newIndex = lastIndex;\n        } else {\n          newIndex = selectedIndex - 1;\n        }\n      }\n\n      selectItem(items[newIndex], false);\n    }\n  }\n\n  function getItems() {\n    if (blocklyDropdownMenu) {\n      return Array.from(blocklyDropdownMenu.children).filter((child) => child.tagName !== \"INPUT\");\n    }\n    return [];\n  }\n\n  function findBlocklyDropDownDiv() {\n    return addon.tab.waitForElement(\".blocklyDropDownDiv\", {\n      reduxCondition: (state) => state.scratchGui.editorTab.activeTabIndex === 0 && !state.scratchGui.mode.isPlayerOnly,\n    });\n  }\n\n  blocklyDropDownDiv = await findBlocklyDropDownDiv();\n  blocklyDropDownContent = blocklyDropDownDiv.querySelector(\".blocklyDropDownContent\");\n\n  const observer = new MutationObserver((mutationList) => {\n    for (const mutation of mutationList) {\n      if (mutation.type === \"childList\") {\n        // Look for a dropdown being created.\n        for (const node of mutation.addedNodes) {\n          if (node.classList && node.classList.contains(\"blocklyDropdownMenu\")) {\n            createSearchBar(node);\n            break;\n          }\n        }\n        // Look for a dropdown being removed.\n        for (const node of mutation.removedNodes) {\n          if (node.classList && node.classList.contains(\"blocklyDropdownMenu\")) {\n            cleanup();\n            break;\n          }\n        }\n      }\n    }\n  });\n  observer.observe(blocklyDropDownContent, {\n    childList: true,\n  });\n}\n","export default async function ({ addon, global, console }) {\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\n  const workspace = Blockly.getMainWorkspace();\n  // Add sounds to the current workspace\n  const pathToMedia = workspace.options.pathToMedia;\n  ScratchBlocks.inject.loadSounds_(pathToMedia, workspace);\n  // Add sounds to all future workspaces\n  const originalInit = ScratchBlocks.init_;\n  ScratchBlocks.init_ = function (...args) {\n    const wksp = args[0];\n    wksp.options.hasSounds = true;\n    return originalInit.call(this, ...args);\n  };\n}\n","export default async function ({ addon, global, console }) {\n  await addon.tab.traps.getBlockly();\n\n  window.dispatchEvent(new Event(\"resize\"));\n\n  let interval, injected;\n\n  addon.self.addEventListener(\"disabled\", () => {\n    clearInterval(interval);\n    Blockly.getMainWorkspace().recordCachedAreas();\n  });\n  addon.self.addEventListener(\"reenabled\", () => {\n    if (!injected) tryInjecting();\n    Blockly.getMainWorkspace().recordCachedAreas();\n  });\n\n  const inject = (workspace) => {\n    injected = true;\n    const originalGetClientRect = workspace.toolbox_.getClientRect;\n    workspace.toolbox_.getClientRect = function () {\n      // we are trying to undo the effect of BIG_NUM in https://github.com/LLK/scratch-blocks/blob/ab26fa2960643fa38fbc7b91ca2956be66055070/core/flyout_vertical.js#L739\n      const rect = originalGetClientRect.call(this);\n      if (!rect || addon.self.disabled) return rect;\n      if (rect.left > 0) return rect;\n      rect.left += 1000000000;\n      rect.width -= 1000000000;\n      return rect;\n    };\n  };\n\n  function tryInjecting() {\n    if (addon.tab.editorMode === \"editor\") {\n      interval = setInterval(() => {\n        if (Blockly.getMainWorkspace()) {\n          inject(Blockly.getMainWorkspace());\n          clearInterval(interval);\n        }\n      }, 100);\n    }\n\n    addon.tab.addEventListener(\"urlChange\", () => {\n      if (addon.tab.editorMode === \"editor\") {\n        // Inject even if addon is disabled, will pollute but not change function return value\n        inject(Blockly.getMainWorkspace());\n      }\n    });\n  }\n  tryInjecting();\n}\n","import { textColor, multiply } from \"../../libraries/common/cs/text-color.esm.js\";\n\nfunction updateSettings(addon, newStyle) {\n  var stylesheet = \"\";\n  const textMode = addon.settings.get(\"text\");\n  if (textMode === \"black\") {\n    stylesheet += `\n      .blocklyText {\n        fill: #575e75;\n      }\n      .blocklyDropdownText {\n        fill: #575e75 !important;\n      }\n      .blocklyDropDownDiv .goog-menuitem,\n      #s3devIDD > li {\n        color: #575e75;\n      }`;\n  }\n  var categories = {\n    motion: {\n      color: \"#4C97FF\",\n      tertiaryColor: \"#3373CC\",\n    },\n    looks: {\n      color: \"#9966FF\",\n      tertiaryColor: \"#774DCB\",\n    },\n    sounds: {\n      color: \"#CF63CF\",\n      tertiaryColor: \"#BD42BD\",\n      alt: \"sound\",\n    },\n    events: {\n      color: \"#DE9E2E\",\n      tertiaryColor: \"#CC9900\",\n    },\n    control: {\n      color: \"#FFBF00\",\n      tertiaryColor: \"#CF8B17\",\n    },\n    sensing: {\n      color: \"#5CB1D6\",\n      tertiaryColor: \"#2E8EB8\",\n    },\n    operators: {\n      color: \"#59C059\",\n      tertiaryColor: \"#389438\",\n    },\n    data: {\n      color: \"#FF8C1A\",\n      tertiaryColor: \"#DB6E00\",\n      alt: \"variables\",\n    },\n    \"data-lists\": {\n      color: \"#FF661A\",\n      tertiaryColor: \"#E64D00\",\n      alt: \"lists\",\n      var: \"dataLists\",\n    },\n    custom: {\n      color: \"#FF6680\",\n      tertiaryColor: \"#FF6355\",\n      alt: \"myBlocks\",\n    },\n    Pen: {\n      // For historical reasons, this is called \"Pen\".\n      color: \"#0FBD8C\",\n      tertiaryColor: \"#0B8E69\",\n      alt: \"pen\",\n    },\n    TurboWarp: {\n      color: \"#ff4c4c\",\n      tertiaryColor: \"#e64444\", // TODO fix\n      alt: \"tw\",\n      var: \"tw\",\n    },\n  };\n\n  for (var prop of Object.keys(categories)) {\n    var settingName = categories[prop].var ? categories[prop].var : prop;\n    if (textMode === \"white\" || textMode === \"black\") {\n      stylesheet += `g[data-category=\"${prop}\"] > path.blocklyBlockBackground {\n        fill: var(--editorTheme3-${settingName}Color);\n      }\n      .scratchCategoryId-${categories[prop].alt ? categories[prop].alt : prop} > .scratchCategoryItemBubble {\n        background-color: var(--editorTheme3-${settingName}Color) !important;\n      }\n      .blocklyDropDownDiv[data-category=\"${prop}\"] {\n        background-color: var(--editorTheme3-${settingName}Color) !important;\n        border-color: #0003 !important;\n      }\n      .blocklyBubbleCanvas [stroke=\"${categories[prop].tertiaryColor}\"] {\n        stroke: var(--editorTheme3-${settingName}Color);\n      }\n      #s3devIDD > li.${prop} {\n        background-color: var(--editorTheme3-${settingName}Color);\n      }\n      .console-variable[data-category=\"${prop}\"] {\n        background-color: var(--editorTheme3-${settingName}Color) !important;\n      }\n      `;\n      if (prop === \"custom\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#FF6680\"] {\n          fill: var(--editorTheme3-${prop}Color);\n        }`;\n      }\n      if (prop === \"sensing\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#5CB1D6\"] {\n          fill: var(--editorTheme3-${prop}Color);\n        }`;\n      }\n      if (prop === \"events\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#FFBF00\"] {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        .blocklyDropDownDiv[style*=\"rgb(255, 191, 0)\"] {\n          background-color: var(--editorTheme3-${prop}Color) !important;\n          border-color: #0003 !important;\n        }`;\n      }\n      if (prop === \"Pen\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#0FBD8C\"] {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        .blocklyDropDownDiv[style*=\"rgb(15, 189, 140)\"] {\n          background-color: var(--editorTheme3-${prop}Color) !important;\n          border-color: #0003 !important;\n        }`;\n      }\n    } else {\n      let background = { colorOnWhite: \"#fff\", colorOnBlack: \"#282828\" }[textMode];\n      let inputShadow = { colorOnWhite: \"#00000026\", colorOnBlack: \"#fff3\" }[textMode];\n      let secondary = multiply(addon.settings.get((prop === \"TurboWarp\" ? \"tw\" : prop) + \"-color\"), { a: 0.15 });\n      stylesheet += `g[data-category=\"${prop}\"] > path.blocklyBlockBackground,\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"dropdown\"] > rect,\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"variable\"] > rect {\n        fill: ${background};\n        stroke: var(--editorTheme3-${settingName}Color);\n      }\n      g[data-category=\"${prop}\"] > .blocklyText {\n        fill: var(--editorTheme3-${settingName}Color);\n      }\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"dropdown\"] > .blocklyDropdownText,\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"variable\"] > .blocklyDropdownText,\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"dropdown\"] > g > .blocklyDropdownText {\n        fill: var(--editorTheme3-${settingName}Color) !important;\n      }\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"dropdown\"] > path,\n      g[data-category=\"${prop}\"] > g[data-argument-type=\"variable\"] > path,\n      g[data-category=\"${prop}\"] > path[data-argument-type=\"boolean\"] {\n        fill: ${secondary};\n        stroke: var(--editorTheme3-${settingName}Color);\n      }\n      .scratchCategoryId-${categories[prop].alt ? categories[prop].alt : prop} > .scratchCategoryItemBubble {\n        background-color: var(--editorTheme3-${settingName}Color) !important;\n      }\n      .blocklyDropDownDiv[data-category=\"${prop}\"] {\n        background-color: ${background} !important;\n        border-color: var(--editorTheme3-${settingName}Color) !important;\n      }\n      .blocklyDropDownDiv[data-category=\"${prop}\"] .goog-menuitem {\n        color: var(--editorTheme3-${settingName}Color);\n      }\n      .blocklyBubbleCanvas [stroke=\"${categories[prop].tertiaryColor}\"],\n      g[data-category=${prop}] > g[data-argument-type*=\"text\"] > path,\n      g[data-category=${prop}] > g > line  {\n        stroke: var(--editorTheme3-${settingName}Color);\n      }\n      .blocklyWidgetDiv.fieldTextInput[style*=\"box-shadow\"] {\n        box-shadow: 0 0 0 4px ${inputShadow} !important;\n      }\n      #s3devIDD > li.${prop} {\n        background-color: ${background};\n        color: var(--editorTheme3-${settingName}Color);\n      }\n      #s3devIDD > li.${prop}:not(.boolean) {\n        border: 1px solid var(--editorTheme3-${settingName}Color);\n      }`;\n      if (prop === \"custom\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#FF6680\"] {\n          fill: ${background};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#FF6680\"] ~ .blocklyText,\n        g[data-shapes=\"c-block c-1 hat\"] > g[data-shapes=\"stack\"]:not(.blocklyDraggable) > .blocklyText,\n        .blocklyEditableText > rect[fill=\"#FF3355\"] ~ .blocklyText {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#FF6680\"] ~ [data-argument-type=\"text\"] > path {\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        g[data-shapes=\"c-block c-1 hat\"] > g[data-shapes=\"stack\"]:not(.blocklyDraggable) > path,\n        path[data-argument-type=\"boolean\"][fill=\"#FF3355\"] {\n          fill: ${secondary};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        .blocklyEditableText > rect[fill=\"#FF3355\"] {\n          fill: ${secondary};\n        }`;\n      }\n      if (prop === \"sensing\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#5CB1D6\"],\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#5CB1D6\"],\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#2E8EB8\"] {\n          fill: ${background};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#47A8D1\"],\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#2E8EB8\"] {\n          fill: ${secondary};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#5CB1D6\"] ~ .blocklyText {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#5CB1D6\"] ~ .blocklyText,\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#2E8EB8\"] ~ .blocklyText,\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#47A8D1\"] ~ * > .blocklyText,\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#2E8EB8\"] ~ * > .blocklyText {\n          fill: var(--editorTheme3-${prop}Color) !important;\n        }\n        .blocklyDropDownDiv[style*=\"rgb(92, 177, 214)\"] {\n          background-color: ${background} !important;\n          border-color: var(--editorTheme3-${settingName}Color) !important;\n        }\n        .blocklyDropDownDiv[style*=\"rgb(92, 177, 214)\"] .goog-menuitem {\n          color: var(--editorTheme3-${settingName}Color);\n        }`;\n      }\n      if (prop === \"events\") {\n        stylesheet += `path.blocklyBlockBackground[fill=\"#FFBF00\"],\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#FFBF00\"],\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#CC9900\"] {\n          fill: ${background};\n          stroke: var(--editorTheme3-${settingName}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#FFBF00\"] ~ .blocklyText {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#FFBF00\"] ~ g[data-argument-type=\"variable\"] > g > .blocklyDropdownText {\n          fill: var(--editorTheme3-${prop}Color) !important;\n        }\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#FFBF00\"] ~ .blocklyText,\n        g[data-argument-type=\"dropdown\"] > rect[fill=\"#CC9900\"] ~ .blocklyText {\n          fill: var(--editorTheme3-${prop}Color) !important;\n        }\n        .blocklyDropDownDiv[style*=\"rgb(255, 191, 0)\"] {\n          background-color: ${background} !important;\n          border-color: var(--editorTheme3-${settingName}Color) !important;\n        }\n        .blocklyDropDownDiv[style*=\"rgb(255, 191, 0)\"] .goog-menuitem {\n          color: var(--editorTheme3-${settingName}Color);\n        }`;\n      }\n      if (prop === \"Pen\") {\n        stylesheet += `g[data-category] /* specificity */ > path.blocklyBlockBackground[fill=\"#0FBD8C\"] {\n          fill: ${background};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#0FBD8C\"] ~ .blocklyText {\n          fill: var(--editorTheme3-${prop}Color);\n        }\n        path.blocklyBlockBackground[fill=\"#0FBD8C\"] ~ g[data-argument-type=\"dropdown\"] > g > .blocklyDropdownText {\n          fill: var(--editorTheme3-${prop}Color) !important;\n        }\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#0DA57A\"],\n        g[data-argument-type=\"dropdown\"] > path[fill=\"#0B8E69\"] {\n          fill: ${secondary};\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        .blocklyDropDownDiv[style*=\"rgb(15, 189, 140)\"] {\n          background-color: ${background} !important;\n          border-color: var(--editorTheme3-${settingName}Color) !important;\n        }\n        path.blocklyBlockBackground[fill=\"#0FBD8C\"] ~ [data-argument-type=\"text\"] > path,\n        path.blocklyBlockBackground[fill=\"#0FBD8C\"] ~ g > line  {\n          stroke: var(--editorTheme3-${prop}Color);\n        }\n        #s3devIDD > li.extension {\n          background-color: ${background};\n          color: var(--editorTheme3-${settingName}Color);\n        }\n        #s3devIDD > li.extension:not(.boolean) {\n          border: 1px solid var(--editorTheme3-${settingName}Color);\n        }`;\n      }\n    }\n  }\n\n  document.documentElement.style.setProperty(\n    \"--editorTheme3-inputColor-text\",\n    textColor(addon.settings.get(\"input-color\"))\n  );\n  newStyle.textContent = stylesheet;\n}\n\nexport default async function ({ addon, global, console }) {\n  const otherStyle = document.querySelector(`[data-addon-id='${addon.self.id}']`);\n  const newStyle = document.createElement(\"style\");\n  updateSettings(addon, newStyle);\n  addon.settings.addEventListener(\"change\", () => {\n    updateSettings(addon, newStyle);\n  });\n  newStyle.className = \"scratch-addons-style\";\n  newStyle.setAttribute(\"data-addon-id\", addon.self.id);\n  newStyle.setAttribute(\"data-addon-index\", otherStyle.getAttribute(\"data-addon-index\"));\n\n  otherStyle.parentElement.insertBefore(newStyle, otherStyle.nextSibling);\n\n  // Look for reenable event to enable the style. cs.js cannot handle an appended style.\n  addon.self.addEventListener(\"reenabled\", () => (newStyle.disabled = false));\n}\n","module.exports = __webpack_public_path__ + \"static/assets/b1943d453bad1292a0fdc148c85094bf.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./folder.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/folder.svg\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console, msg }) {\n  // The basic premise of how this addon works is relative simple.\n  // scratch-gui renders the sprite selectors and asset selectors in a hierarchy like this:\n  // <SelectorHOC>\n  //   <SpriteSelectorItem />\n  //   <SpriteSelectorItem />\n  //   <SpriteSelectorItem />\n  //   <SpriteSelectorItem />\n  //   ...\n  // </SelectorHOC>\n  // It's obviously more complicated than that, but there are two important parts:\n  // SelectorHOC - We override this to change which items are displayed\n  // SpriteSelectorItem - We override this to change how items are displayed.\n  //    Folders are just items rendered differently\n  // These two components communicate through the `name` property of the items.\n  // We touch some things on the VM to make dragging items work properly.\n\n  const REACT_INTERNAL_PREFIX = \"__reactInternalInstance$\";\n\n  const SVG_NS = \"http://www.w3.org/2000/svg\";\n\n  const TYPE_SPRITES = 1;\n  const TYPE_ASSETS = 2;\n\n  // We run too early, will be set later\n  let vm;\n\n  let reactInternalKey;\n\n  let currentSpriteFolder;\n  let currentAssetFolder;\n\n  let currentSpriteItems;\n  let currentAssetItems;\n\n  const DIVIDER = \"//\";\n\n  /**\n   * getFolderFromName(\"B\") === null\n   * getFolderFromName(\"A//b\") === \"A\"\n   */\n  const getFolderFromName = (name) => {\n    const idx = name.indexOf(DIVIDER);\n    if (idx === -1 || idx === 0) {\n      return null;\n    }\n    return name.substr(0, idx);\n  };\n\n  /**\n   * getNameWithoutFolder(\"B\") === \"B\"\n   * getNameWithoutFolder(\"A//b\") === \"b\"\n   */\n  const getNameWithoutFolder = (name) => {\n    const idx = name.indexOf(DIVIDER);\n    if (idx === -1 || idx === 0) {\n      return name;\n    }\n    return name.substr(idx + DIVIDER.length);\n  };\n\n  /**\n   * setFolderOfName(\"B\", \"y\") === \"y//B\"\n   * setFolderOfName(\"c//B\", \"y\") === \"y//B\"\n   * setFolderOfName(\"B\", null) === \"B\"\n   * setFolderOfName(\"c//B\", null) === \"B\"\n   */\n  const setFolderOfName = (name, folder) => {\n    const basename = getNameWithoutFolder(name);\n    if (folder) {\n      return `${folder}${DIVIDER}${basename}`;\n    }\n    return basename;\n  };\n\n  const isValidFolderName = (name) => {\n    return !name.includes(DIVIDER) && !name.endsWith(\"/\");\n  };\n\n  const RESERVED_NAMES = [\"_mouse_\", \"_stage_\", \"_edge_\", \"_myself_\", \"_random_\"];\n  const ensureNotReserved = (name) => {\n    if (name === \"\") return \"2\";\n    if (RESERVED_NAMES.includes(name)) return `${name}2`;\n    return name;\n  };\n\n  const untilInEditor = () => {\n    if (addon.tab.editorMode === \"editor\") return;\n    return new Promise((resolve, reject) => {\n      const handler = () => {\n        if (addon.tab.editorMode === \"editor\") {\n          resolve();\n          addon.tab.removeEventListener(\"urlChange\", handler);\n        }\n      };\n      addon.tab.addEventListener(\"urlChange\", handler);\n    });\n  };\n\n  const getSortableHOCFromElement = (el) => {\n    const nearestSpriteSelector = el.closest(\"[class*='sprite-selector_sprite-selector']\");\n    if (nearestSpriteSelector) {\n      return nearestSpriteSelector[reactInternalKey].child.sibling.child.stateNode;\n    }\n    const nearestAssetPanelWrapper = el.closest('[class*=\"asset-panel_wrapper\"]');\n    if (nearestAssetPanelWrapper) {\n      return nearestAssetPanelWrapper[reactInternalKey].child.child.stateNode;\n    }\n    throw new Error(\"cannot find SortableHOC\");\n  };\n\n  const getBackpackFromElement = (el) => {\n    const gui = el.closest('[class*=\"gui_editor-wrapper\"]');\n    if (!gui) throw new Error(\"cannot find Backpack\");\n    return gui[reactInternalKey].child.sibling.child.child.stateNode;\n  };\n\n  const clamp = (n, min, max) => {\n    return Math.min(Math.max(n, min), max);\n  };\n\n  /**\n   * @typedef {Object} ItemData\n   * @property {string} realName\n   * @property {number} realIndex\n   * @property {string} inFolder\n   * @property {string} folder\n   * @property {boolean} folderOpen\n   */\n\n  /**\n   * @returns {ItemData|null}\n   */\n  const getItemData = (item) => {\n    if (item && item.name && typeof item.name === \"object\") {\n      return item.name;\n    }\n    return null;\n  };\n\n  const openFolderAsset = {\n    assetId: \"&__sa_folders_folder\",\n    encodeDataURI() {\n      // Doesn't actually need to be a data: URI\n      return _twGetAsset(\"/folder.svg\");\n    },\n  };\n\n  // https://github.com/LLK/scratch-gui/blob/develop/src/components/asset-panel/icon--sound.svg\n  const imageIconSource = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg width=\"100px\" height=\"100px\" viewBox=\"0 0 20 20\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Sound\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <path d=\"M12.4785058,12.6666667 C12.3144947,12.6666667 12.1458852,12.6272044 11.9926038,12.5440517 C11.537358,12.2960031 11.3856094,11.7562156 11.6553847,11.3376335 C12.1688774,10.5371131 12.1688774,9.54491867 11.6553847,8.74580756 C11.3856094,8.32581618 11.537358,7.78602861 11.9926038,7.53798001 C12.452448,7.29275014 13.0379829,7.43086811 13.3046926,7.84804076 C14.1737981,9.20103311 14.1737981,10.8809986 13.3046926,12.233991 C13.1268862,12.5130457 12.806528,12.6666667 12.4785058,12.6666667 Z M15.3806784,13.8333333 C15.2408902,13.8333333 15.0958763,13.796281 14.9665396,13.7182064 C14.5785295,13.485306 14.4491928,12.9784829 14.6791247,12.5854634 C15.5949331,11.0160321 15.5949331,9.065491 14.6791247,7.49738299 C14.4491928,7.10436352 14.5785295,6.59621712 14.9665396,6.36331669 C15.3558562,6.13438616 15.8549129,6.26274605 16.0848448,6.65444223 C17.3050517,8.74260632 17.3050517,11.3389168 16.0848448,13.4270809 C15.9319924,13.6890939 15.6602547,13.8333333 15.3806784,13.8333333 Z M10.3043478,5.62501557 L10.3043478,13.873675 C10.3043478,14.850934 9.10969849,15.3625101 8.36478311,14.7038052 L6.7566013,13.2797607 C6.18712394,12.7762834 5.44499329,12.4968737 4.67362297,12.4968737 L4.3923652,12.4968737 C3.62377961,12.4968737 3,11.8935108 3,11.1470686 L3,8.36646989 C3,7.62137743 3.62377961,7.01666471 4.3923652,7.01666471 L4.65830695,7.01666471 C5.42967727,7.01666471 6.17180792,6.73725504 6.74128529,6.23377771 L8.36478311,4.79623519 C9.10969849,4.13753026 10.3043478,4.64910643 10.3043478,5.62501557 Z\" id=\"Combined-Shape\" fill=\"#575E75\"></path>\n    </g>\n</svg>`;\n  const soundIconHref = `data:image/svg+xml;base64,${btoa(imageIconSource)}`;\n\n  let folderColorStylesheet = null;\n  const folderColors = Object.create(null);\n  const getFolderColorClass = (folderName) => {\n    const mulberry32 = (a) => {\n      // https://stackoverflow.com/a/47593316\n      return function () {\n        var t = (a += 0x6d2b79f5);\n        t = Math.imul(t ^ (t >>> 15), t | 1);\n        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);\n        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n      };\n    };\n\n    const hashCode = (str) => {\n      // Based on Java's String.hashCode\n      // https://hg.openjdk.java.net/jdk8/jdk8/jdk/file/687fd7c7986d/src/share/classes/java/lang/String.java#l1452\n      let hash = 0;\n      for (let i = 0; i < str.length; i++) {\n        hash = 31 * hash + str.charCodeAt(i);\n        hash = hash | 0;\n      }\n      return hash;\n    };\n\n    const random = (str) => {\n      const seed = hashCode(str);\n      const rng = mulberry32(seed);\n      // Run RNG a few times to get more random numbers, otherwise similar seeds tend to give somewhat similar results\n      rng();\n      rng();\n      rng();\n      rng();\n      return rng();\n    };\n\n    if (!folderColors[folderName]) {\n      if (!folderColorStylesheet) {\n        folderColorStylesheet = document.createElement(\"style\");\n        document.head.appendChild(folderColorStylesheet);\n      }\n      const hue = random(folderName) * 360;\n      const color = `hsla(${hue}deg, 100%, 85%, 0.5)`;\n      const id = Object.keys(folderColors).length;\n      const className = `sa-folders-color-${id}`;\n      folderColors[folderName] = className;\n      folderColorStylesheet.textContent += `.${className}{background-color:${color} !important;}`;\n      folderColorStylesheet.textContent += `.${className}[class*=\"sprite-selector_raised\"]:not([class*=\"sa-folders-folder\"]){background-color:hsla(${hue}deg, 100%, 77%, 1) !important;}`;\n    }\n    return folderColors[folderName];\n  };\n\n  const fixOrderOfItemsInFolders = (items) => {\n    const folders = Object.create(null);\n    const result = [];\n    for (const item of items) {\n      const name = item.getName ? item.getName() : item.name;\n      const folder = getFolderFromName(name);\n      if (typeof folder === \"string\") {\n        if (!folders[folder]) {\n          folders[folder] = [];\n          result.push(folders[folder]);\n        }\n        folders[folder].push(item);\n      } else {\n        result.push(item);\n      }\n    }\n    const flatResult = result.flat();\n    for (let i = 0; i < items.length; i++) {\n      if (result[i] !== items[i]) {\n        return { items: flatResult, changed: true };\n      }\n    }\n    return { items: flatResult, changed: false };\n  };\n\n  const fixTargetOrder = () => {\n    const { items, changed } = fixOrderOfItemsInFolders(vm.runtime.targets);\n    if (changed) {\n      vm.runtime.targets = items;\n      vm.emitTargetsUpdate();\n    }\n  };\n\n  const fixCostumeOrder = (target = vm.editingTarget) => {\n    const { items, changed } = fixOrderOfItemsInFolders(target.sprite.costumes);\n    if (changed) {\n      target.sprite.costumes = items;\n      vm.emitTargetsUpdate();\n    }\n  };\n\n  const fixSoundOrder = (target = vm.editingTarget) => {\n    const { items, changed } = fixOrderOfItemsInFolders(target.sprite.sounds);\n    if (changed) {\n      target.sprite.sounds = items;\n      vm.emitTargetsUpdate();\n    }\n  };\n\n  const verifySortableHOC = (sortableHOCInstance) => {\n    const SortableHOC = sortableHOCInstance.constructor;\n    if (\n      Array.isArray(sortableHOCInstance.props.items) &&\n      (typeof sortableHOCInstance.props.selectedId === \"string\" ||\n        typeof sortableHOCInstance.props.selectedItemIndex === \"number\") &&\n      typeof sortableHOCInstance.containerBox !== \"undefined\" &&\n      typeof SortableHOC.prototype.componentDidMount === \"undefined\" &&\n      typeof SortableHOC.prototype.componentDidUpdate === \"undefined\" &&\n      typeof SortableHOC.prototype.handleAddSortable === \"function\" &&\n      typeof SortableHOC.prototype.handleRemoveSortable === \"function\" &&\n      typeof SortableHOC.prototype.setRef === \"function\"\n    )\n      return;\n    throw new Error(\"Can not comprehend SortableHOC\");\n  };\n\n  const verifySpriteSelectorItem = (spriteSelectorItemInstance) => {\n    const SpriteSelectorItem = spriteSelectorItemInstance.constructor;\n    if (\n      typeof spriteSelectorItemInstance.props.asset === \"object\" &&\n      typeof spriteSelectorItemInstance.props.name === \"string\" &&\n      typeof spriteSelectorItemInstance.props.dragType === \"string\" &&\n      typeof SpriteSelectorItem.prototype.handleClick === \"function\" &&\n      typeof SpriteSelectorItem.prototype.setRef === \"function\" &&\n      typeof SpriteSelectorItem.prototype.handleDrag === \"function\" &&\n      typeof SpriteSelectorItem.prototype.handleDragEnd === \"function\" &&\n      typeof SpriteSelectorItem.prototype.handleDelete === \"function\" &&\n      typeof SpriteSelectorItem.prototype.handleDuplicate === \"function\" &&\n      typeof SpriteSelectorItem.prototype.handleExport === \"function\"\n    )\n      return;\n    throw new Error(\"Can not comprehend SpriteSelectorItem\");\n  };\n\n  const verifyVM = (vm) => {\n    const target = vm.runtime.targets[0];\n    if (\n      typeof vm.installTargets === \"function\" &&\n      typeof vm.reorderTarget === \"function\" &&\n      typeof target.reorderCostume === \"function\" &&\n      typeof target.reorderSound === \"function\" &&\n      typeof target.addCostume === \"function\" &&\n      typeof target.addSound === \"function\"\n    )\n      return;\n    throw new Error(\"Can not comprehend VM\");\n  };\n\n  const verifyBackpack = (backpackInstance) => {\n    const Backpack = backpackInstance.constructor;\n    if (\n      typeof Backpack.prototype.handleDrop === \"function\" &&\n      typeof Backpack.prototype.componentDidUpdate === \"undefined\"\n    ) {\n      return;\n    }\n    throw new Error(\"Can not comprehend Backpack\");\n  };\n\n  class Cache {\n    constructor() {\n      this.map = new Map();\n      this.used = [];\n    }\n\n    has(id) {\n      return this.map.has(id);\n    }\n\n    get(id) {\n      this.used.push(id);\n      return this.map.get(id);\n    }\n\n    set(id, value) {\n      this.used.push(id);\n      this.map.set(id, value);\n    }\n\n    start() {\n      this.used = [];\n    }\n\n    end() {\n      for (const id of Array.from(this.map.keys())) {\n        if (!this.used.includes(id)) {\n          this.map.delete(id);\n        }\n      }\n    }\n\n    clear() {\n      this.start();\n      this.map.clear();\n    }\n  }\n\n  const patchSortableHOC = (SortableHOC, type) => {\n    // SortableHOC should be: https://github.com/LLK/scratch-gui/blob/29d9851778febe4e69fa5111bf7559160611e366/src/lib/sortable-hoc.jsx#L8\n\n    const itemCache = new Cache();\n    const folderItemCache = new Cache();\n    const folderAssetCache = new Cache();\n\n    const PREVIEW_SIZE = 80;\n    const PREVIEW_POSITIONS = [\n      // x, y\n      [0, 0],\n      [PREVIEW_SIZE / 2, 0],\n      [0, PREVIEW_SIZE / 2],\n      [PREVIEW_SIZE / 2, PREVIEW_SIZE / 2],\n    ];\n\n    const createFolderPreview = (items) => {\n      const svg = document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", PREVIEW_SIZE);\n      svg.setAttribute(\"height\", PREVIEW_SIZE);\n      for (let i = 0; i < Math.min(PREVIEW_POSITIONS.length, items.length); i++) {\n        const item = items[i];\n        const image = document.createElementNS(SVG_NS, \"image\");\n        image.setAttribute(\"width\", PREVIEW_SIZE / 2);\n        image.setAttribute(\"height\", PREVIEW_SIZE / 2);\n        image.setAttribute(\"x\", PREVIEW_POSITIONS[i][0]);\n        image.setAttribute(\"y\", PREVIEW_POSITIONS[i][1]);\n        if (item.asset) {\n          image.setAttribute(\"href\", item.asset.encodeDataURI());\n        } else if (item.costume && item.costume.asset) {\n          image.setAttribute(\"href\", item.costume.asset.encodeDataURI());\n        } else if (item.url) {\n          image.setAttribute(\"href\", soundIconHref);\n        }\n        svg.appendChild(image);\n      }\n      return \"data:image/svg+xml;,\" + new XMLSerializer().serializeToString(svg);\n    };\n\n    const getUniqueIdOfFolderItems = (items) => {\n      let id = \"sa_folder&&\";\n      for (let i = 0; i < Math.min(PREVIEW_POSITIONS.length, items.length); i++) {\n        const item = items[i];\n        if (item.asset) {\n          id += item.asset.assetId;\n        } else if (item.costume && item.costume.asset) {\n          id += item.costume.asset.assetId;\n        } else if (item.url) {\n          id += item.url;\n        }\n        id += \"&&\";\n      }\n      return id;\n    };\n\n    const processItems = (openFolders, props) => {\n      const processItem = (item) => {\n        const itemId = item.name;\n\n        let newItem;\n        let itemData;\n        if (itemCache.has(itemId)) {\n          newItem = itemCache.get(itemId);\n          itemData = newItem.name;\n        } else {\n          itemData = {\n            toString() {\n              return `_${item.name}`;\n            },\n          };\n          newItem = {};\n          itemCache.set(itemId, newItem);\n        }\n\n        const itemFolderName = getFolderFromName(item.name);\n\n        Object.assign(newItem, item);\n        itemData.realName = item.name;\n        itemData.realIndex = i;\n        itemData.inFolder = itemFolderName;\n        newItem.name = itemData;\n\n        return {\n          newItem,\n          itemData,\n        };\n      };\n\n      itemCache.start();\n      folderItemCache.start();\n      folderAssetCache.start();\n\n      const folderOccurrences = new Map();\n      const items = [];\n      const result = {\n        items,\n      };\n\n      let i = 0;\n      while (i < props.items.length) {\n        const item = props.items[i];\n        const folderName = getFolderFromName(item.name);\n\n        if (folderName === null) {\n          items.push(processItem(item).newItem);\n          if (type === TYPE_ASSETS) {\n            const isSelected = props.selectedItemIndex === i;\n            if (isSelected) {\n              result.selectedItemIndex = items.length - 1;\n            }\n          }\n        } else {\n          const isOpen = openFolders.indexOf(folderName) !== -1;\n          const folderItems = [];\n          while (i < props.items.length) {\n            const childItem = props.items[i];\n            const processedItem = processItem(childItem);\n            if (getFolderFromName(childItem.name) !== folderName) {\n              break;\n            }\n            folderItems.push(processedItem.newItem);\n            if (type === TYPE_ASSETS) {\n              const isSelected = props.selectedItemIndex === i;\n              if (isSelected) {\n                if (isOpen) {\n                  result.selectedItemIndex = items.length + folderItems.length;\n                } else {\n                  result.selectedItemIndex = -1;\n                }\n              }\n            }\n            i++;\n          }\n          i--;\n\n          const occurrence = folderOccurrences.get(folderName) || 0;\n          folderOccurrences.set(folderName, occurrence + 1);\n          const baseUniqueId = getUniqueIdOfFolderItems(folderItems);\n          const itemUniqueId = `${isOpen}&${occurrence}&${folderName}&${baseUniqueId}&`;\n          const reactKey = `&__${occurrence}_${folderName}`;\n          const assetUniqueId = baseUniqueId;\n\n          let folderItem;\n          let folderData;\n          if (folderItemCache.has(itemUniqueId)) {\n            folderItem = folderItemCache.get(itemUniqueId);\n            folderData = folderItem.name;\n          } else {\n            folderItem = {\n              // Can be used as a react key\n              id: {\n                toString() {\n                  return reactKey;\n                },\n              },\n            };\n            folderData = {\n              // Can be used as a react key\n              toString() {\n                return reactKey;\n              },\n            };\n            folderItemCache.set(itemUniqueId, folderItem);\n          }\n\n          folderData.folder = folderName;\n          folderData.folderOpen = isOpen;\n          folderItem.items = folderItems;\n          folderItem.name = folderData;\n\n          let folderAsset;\n          if (isOpen) {\n            folderAsset = openFolderAsset;\n          } else {\n            if (folderAssetCache.has(assetUniqueId)) {\n              folderAsset = folderAssetCache.get(assetUniqueId);\n            } else {\n              folderAsset = {\n                assetId: assetUniqueId,\n                encodeDataURI() {\n                  return createFolderPreview(folderItems);\n                },\n              };\n              folderAssetCache.set(assetUniqueId, folderAsset);\n            }\n          }\n\n          if (type === TYPE_SPRITES) {\n            if (!folderItem.costume) folderItem.costume = {};\n            folderItem.costume.asset = folderAsset;\n            // For sprite items, `id` is used as the drag payload and toString is used as a React key\n            if (!folderItem.id) folderItem.id = {};\n            folderItem.id.sa_folder_items = folderItems;\n            folderItem.id.toString = () => reactKey;\n          } else {\n            folderItem.asset = folderAsset;\n            if (!folderItem.dragPayload) folderItem.dragPayload = {};\n            folderItem.dragPayload.sa_folder_items = folderItems;\n          }\n\n          items.push(folderItem);\n          if (isOpen) {\n            for (const item of folderItems) {\n              items.push(item);\n            }\n          }\n        }\n\n        i++;\n      }\n\n      itemCache.end();\n      folderItemCache.end();\n      folderAssetCache.end();\n\n      return result;\n    };\n\n    const getSelectedItem = (sortable) => {\n      if (type === TYPE_SPRITES) {\n        const selectedItem = sortable.props.items.find((i) => i.id === sortable.props.selectedId);\n        return selectedItem;\n      } else if (type === TYPE_ASSETS) {\n        const selectedItem = sortable.props.items[sortable.props.selectedItemIndex];\n        return selectedItem;\n      }\n      return null;\n    };\n\n    SortableHOC.prototype.saInitialSetup = function () {\n      itemCache.clear();\n      folderItemCache.clear();\n      folderAssetCache.clear();\n      const folders = [];\n      const selectedItem = getSelectedItem(this);\n      if (selectedItem && !selectedItem.isStage) {\n        const folder = getFolderFromName(selectedItem.name);\n        folders.push(folder);\n        if (type === TYPE_SPRITES) {\n          currentSpriteFolder = folder;\n        } else if (type === TYPE_ASSETS) {\n          currentAssetFolder = folder;\n        }\n      }\n      this.setState({\n        folders,\n      });\n    };\n\n    SortableHOC.prototype.componentDidMount = function () {\n      // Do part of componentDidUpdate on mount as well\n      const selectedItem = getSelectedItem(this);\n      if (selectedItem) {\n        const folder = getFolderFromName(selectedItem.name);\n        if (type === TYPE_SPRITES) {\n          currentSpriteFolder = folder;\n        } else if (type === TYPE_ASSETS) {\n          currentAssetFolder = folder;\n        }\n      }\n      this.saInitialSetup();\n    };\n\n    SortableHOC.prototype.componentDidUpdate = function (prevProps, prevState) {\n      const selectedItem = getSelectedItem(this);\n      if (selectedItem) {\n        const folder = getFolderFromName(selectedItem.name);\n        const currentFolder = this.state.folders.includes(folder) ? folder : null;\n        if (type === TYPE_SPRITES) {\n          currentSpriteFolder = currentFolder;\n        } else if (type === TYPE_ASSETS) {\n          currentAssetFolder = currentFolder;\n        }\n        let selectedItemChanged;\n        if (this.props.selectedId) {\n          selectedItemChanged = this.props.selectedId !== prevProps.selectedId;\n        } else {\n          selectedItemChanged =\n            this.props.items[this.props.selectedItemIndex] &&\n            prevProps.items[prevProps.selectedItemIndex] &&\n            this.props.items[this.props.selectedItemIndex].name !== prevProps.items[prevProps.selectedItemIndex].name;\n        }\n        if (selectedItemChanged) {\n          if (!selectedItem.isStage) {\n            if (typeof folder === \"string\" && !this.state.folders.includes(folder)) {\n              this.setState((prevState) => ({\n                folders: [...prevState.folders, folder],\n              }));\n            }\n          }\n        }\n      }\n    };\n\n    const originalSortableHOCRender = SortableHOC.prototype.render;\n    SortableHOC.prototype.render = function () {\n      const originalProps = this.props;\n      this.props = {\n        ...this.props,\n        ...processItems((this.state && this.state.folders) || [], this.props),\n      };\n\n      if (type === TYPE_SPRITES) {\n        currentSpriteItems = this.props.items;\n      } else if (type === TYPE_ASSETS) {\n        currentAssetItems = this.props.items;\n      }\n      const result = originalSortableHOCRender.call(this);\n      this.props = originalProps;\n      return result;\n    };\n  };\n\n  const patchSpriteSelectorItem = (SpriteSelectorItem) => {\n    // SpriteSelectorItem should be: https://github.com/LLK/scratch-gui/blob/29d9851778febe4e69fa5111bf7559160611e366/src/containers/sprite-selector-item.jsx#L16\n\n    const closeContextMenu = () => {\n      document.body.dispatchEvent(new MouseEvent(\"mousedown\", { relatedTarget: document.body, bubbles: true }));\n    };\n\n    const createMenuItem = (text, callback, border) => {\n      const el = document.createElement(\"div\");\n      el.className = addon.tab.scratchClass(\n        \"context-menu_menu-item\",\n        border ? \"context-menu_menu-item-bordered\" : null,\n        {\n          others: [\"react-contextmenu-item\", \"sa-folders-contextmenu-item\"],\n        }\n      );\n      el.setAttribute(\"role\", \"menuitem\");\n      el.setAttribute(\"tabindex\", \"-1\");\n      el.setAttribute(\"aria-disabled\", \"false\");\n      el.textContent = text;\n      el.addEventListener(\n        \"click\",\n        (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          closeContextMenu();\n          callback();\n        },\n        true\n      );\n      return el;\n    };\n\n    const getAllFolders = (component) => {\n      const result = new Set();\n      let items;\n      if (component.props.dragType === \"SPRITE\") {\n        items = currentSpriteItems;\n      } else {\n        items = currentAssetItems;\n      }\n      for (const item of items) {\n        const data = getItemData(item);\n        if (typeof data.folder === \"string\") {\n          result.add(data.folder);\n        }\n      }\n      return Array.from(result);\n    };\n\n    const addContextMenuItems = (component) => {\n      const data = getItemData(component.props);\n      if (!data) {\n        return;\n      }\n\n      const menu = component.ref.querySelector(\"nav[role=menu]\");\n      if (!menu) {\n        return;\n      }\n\n      const oldContainer = menu.querySelector(\".sa-folders-contextmenu-container\");\n      if (oldContainer) {\n        oldContainer.remove();\n      }\n      const container = document.createElement(\"div\");\n      container.className = \"sa-folders-contextmenu-container\";\n      menu.appendChild(container);\n\n      if (typeof data.folder === \"string\") {\n        menu.setAttribute(\"sa-folders-context-type\", \"folder\");\n\n        const renameItems = (newName) => {\n          const isOpen = isFolderOpen(component, data.folder);\n          setFolderOpen(component, data.folder, false);\n          if (isOpen && typeof newName === \"string\") {\n            setFolderOpen(component, newName, true);\n          }\n          if (component.props.dragType === \"SPRITE\") {\n            for (const target of vm.runtime.targets) {\n              if (target.isOriginal) {\n                if (getFolderFromName(target.getName()) === data.folder) {\n                  vm.renameSprite(target.id, ensureNotReserved(setFolderOfName(target.getName(), newName)));\n                }\n              }\n            }\n            vm.emitWorkspaceUpdate();\n            fixTargetOrder();\n          } else if (component.props.dragType === \"COSTUME\") {\n            for (let i = 0; i < vm.editingTarget.sprite.costumes.length; i++) {\n              const costume = vm.editingTarget.sprite.costumes[i];\n              if (getFolderFromName(costume.name) === data.folder) {\n                vm.renameCostume(i, setFolderOfName(costume.name, newName));\n              }\n            }\n            fixCostumeOrder();\n          } else if (component.props.dragType === \"SOUND\") {\n            for (let i = 0; i < vm.editingTarget.sprite.sounds.length; i++) {\n              const sound = vm.editingTarget.sprite.sounds[i];\n              if (getFolderFromName(sound.name) === data.folder) {\n                vm.renameSound(i, setFolderOfName(sound.name, newName));\n              }\n            }\n            fixSoundOrder();\n          }\n        };\n\n        const renameFolder = () => {\n          let newName = prompt(msg(\"rename-folder-prompt\"), data.folder);\n          // Prompt cancelled, do not rename\n          if (newName === null) {\n            return;\n          }\n          if (!isValidFolderName(newName)) {\n            alert(msg(\"name-not-allowed\"));\n            return;\n          }\n          // Empty name will remove the folder\n          if (!newName) {\n            newName = null;\n          }\n          renameItems(newName);\n        };\n\n        const removeFolder = () => {\n          renameItems(null);\n        };\n\n        container.appendChild(createMenuItem(msg(\"rename-folder\"), renameFolder));\n        container.appendChild(createMenuItem(msg(\"remove-folder\"), removeFolder));\n      } else {\n        menu.setAttribute(\"sa-folders-context-type\", \"asset\");\n\n        const setFolder = (folder) => {\n          if (component.props.dragType === \"SPRITE\") {\n            const target = vm.runtime.getTargetById(component.props.id);\n            vm.renameSprite(component.props.id, ensureNotReserved(setFolderOfName(target.getName(), folder)));\n            fixTargetOrder();\n            vm.emitWorkspaceUpdate();\n          } else if (component.props.dragType === \"COSTUME\") {\n            const data = getItemData(component.props);\n            const index = data.realIndex;\n            const asset = vm.editingTarget.sprite.costumes[index];\n            vm.renameCostume(vm.editingTarget.sprite.costumes.indexOf(asset), setFolderOfName(asset.name, folder));\n            fixCostumeOrder();\n          } else if (component.props.dragType === \"SOUND\") {\n            const data = getItemData(component.props);\n            const index = data.realIndex;\n            const asset = vm.editingTarget.sprite.sounds[index];\n            vm.renameSound(vm.editingTarget.sprite.sounds.indexOf(asset), setFolderOfName(asset.name, folder));\n            fixSoundOrder();\n          }\n        };\n\n        const createFolder = () => {\n          const name = prompt(msg(\"name-prompt\"), getNameWithoutFolder(data.realName));\n          if (name === null) {\n            return;\n          }\n          if (!isValidFolderName(name)) {\n            alert(msg(\"name-not-allowed\"));\n            return;\n          }\n          setFolder(name);\n        };\n\n        container.appendChild(createMenuItem(msg(\"create-folder\"), createFolder, true));\n\n        const currentFolder = data.inFolder;\n        if (typeof currentFolder === \"string\") {\n          container.appendChild(createMenuItem(msg(\"remove-from-folder\"), () => setFolder(null)));\n        }\n        for (const folder of getAllFolders(component)) {\n          if (folder !== currentFolder) {\n            container.appendChild(\n              createMenuItem(\n                msg(\"add-to-folder\", {\n                  folder,\n                }),\n                () => setFolder(folder)\n              )\n            );\n          }\n        }\n      }\n    };\n\n    const isFolderOpen = (component, folder) => {\n      const sortableHOCInstance = getSortableHOCFromElement(component.ref);\n      const folders = (sortableHOCInstance.state && sortableHOCInstance.state.folders) || [];\n      return folders.includes(folder);\n    };\n\n    const setFolderOpen = (component, folder, open) => {\n      const sortableHOCInstance = getSortableHOCFromElement(component.ref);\n      sortableHOCInstance.setState((prevState) => {\n        let folders = (prevState && prevState.folders) || [];\n        folders = folders.filter((i) => i !== folder);\n        if (open) {\n          return {\n            folders: [...folders, folder],\n          };\n        }\n        return {\n          folders,\n        };\n      });\n    };\n\n    for (const method of [\"handleDelete\", \"handleDuplicate\", \"handleExport\"]) {\n      const original = SpriteSelectorItem.prototype[method];\n      SpriteSelectorItem.prototype[method] = function (...args) {\n        if (typeof this.props.id === \"number\") {\n          const itemData = getItemData(this.props);\n          if (itemData) {\n            const originalProps = this.props;\n            this.props = {\n              ...originalProps,\n              id: itemData.realIndex,\n            };\n            const ret = original.call(this, ...args);\n            this.props = originalProps;\n            return ret;\n          }\n        }\n        return original.call(this, ...args);\n      };\n    }\n\n    const originalHandleDragEnd = SpriteSelectorItem.prototype.handleDragEnd;\n    SpriteSelectorItem.prototype.handleDragEnd = function (...args) {\n      const itemData = getItemData(this.props);\n      if (itemData) {\n        if (typeof itemData.realIndex === \"number\" && this.props.dragging) {\n          // If the item is being dragged onto another group (eg. costume list -> sprite list)\n          // then we fake a drag event to make the `index` be the real index\n          const originalIndex = this.props.index;\n          const realIndex = itemData.realIndex;\n          if (originalIndex !== realIndex) {\n            const currentOffset = addon.tab.redux.state.scratchGui.assetDrag.currentOffset;\n            const sortableHOCInstance = getSortableHOCFromElement(this.ref);\n            if (currentOffset && sortableHOCInstance && sortableHOCInstance.getMouseOverIndex() === null) {\n              this.props.index = realIndex;\n              this.handleDrag(currentOffset);\n              this.props.index = originalIndex;\n            }\n          }\n        }\n      }\n      return originalHandleDragEnd.call(this, ...args);\n    };\n\n    const originalHandleClick = SpriteSelectorItem.prototype.handleClick;\n    SpriteSelectorItem.prototype.handleClick = function (...args) {\n      const e = args[0];\n      if (e && !this.noClick) {\n        const itemData = getItemData(this.props);\n        if (itemData) {\n          if (typeof itemData.folder === \"string\") {\n            e.preventDefault();\n            setFolderOpen(this, itemData.folder, !isFolderOpen(this, itemData.folder));\n            return;\n          }\n          if (typeof this.props.number === \"number\" && typeof itemData.realIndex === \"number\") {\n            e.preventDefault();\n            if (this.props.onClick) {\n              this.props.onClick(itemData.realIndex);\n            }\n            return;\n          }\n        }\n      }\n      return originalHandleClick.call(this, ...args);\n    };\n\n    const originalSetRef = SpriteSelectorItem.prototype.setRef;\n    SpriteSelectorItem.prototype.setRef = function (ref) {\n      originalSetRef.call(this, ref);\n      if (ref) {\n        ref.elem.addEventListener(\"contextmenu\", (e) => {\n          addContextMenuItems(this);\n        });\n      }\n    };\n\n    const originalRender = SpriteSelectorItem.prototype.render;\n    SpriteSelectorItem.prototype.render = function () {\n      const itemData = getItemData(this.props);\n      if (itemData) {\n        const originalProps = this.props;\n        this.props = {\n          ...this.props,\n        };\n\n        if (typeof itemData.realName === \"string\") {\n          this.props.name = getNameWithoutFolder(itemData.realName);\n        }\n        if (typeof this.props.number === \"number\" && typeof itemData.realIndex === \"number\") {\n          // Convert 0-indexed to 1-indexed\n          this.props.number = itemData.realIndex + 1;\n        }\n        if (typeof itemData.folder === \"string\") {\n          this.props.name = itemData.folder;\n          if (itemData.folderOpen) {\n            this.props.details = msg(\"open-folder\");\n          } else {\n            this.props.details = msg(\"closed-folder\");\n          }\n          this.props.selected = false;\n          this.props.number = null;\n          this.props.className += ` ${getFolderColorClass(itemData.folder)} sa-folders-folder`;\n        }\n        if (typeof itemData.inFolder === \"string\") {\n          this.props.className += ` ${getFolderColorClass(itemData.inFolder)}`;\n        }\n\n        const result = originalRender.call(this);\n\n        this.props = originalProps;\n        return result;\n      }\n      return originalRender.call(this);\n    };\n  };\n\n  const patchVM = () => {\n    const RenderedTarget = vm.runtime.targets[0].constructor;\n\n    const originalInstallTargets = vm.installTargets;\n    vm.installTargets = function (...args) {\n      if (currentSpriteFolder !== null) {\n        const targets = args[0];\n        const wholeProject = args[2];\n        if (Array.isArray(targets) && !wholeProject) {\n          for (const target of targets) {\n            if (target.sprite) {\n              target.sprite.name = setFolderOfName(target.sprite.name, currentSpriteFolder);\n            }\n          }\n        }\n      }\n      return originalInstallTargets.call(this, ...args).then((r) => {\n        fixTargetOrder();\n        return r;\n      });\n    };\n\n    const originalAddCostume = RenderedTarget.prototype.addCostume;\n    RenderedTarget.prototype.addCostume = function (...args) {\n      if (currentAssetFolder !== null) {\n        const costume = args[0];\n        if (costume && typeof getFolderFromName(costume.name) !== \"string\") {\n          costume.name = setFolderOfName(costume.name, currentAssetFolder);\n        }\n      }\n      const r = originalAddCostume.call(this, ...args);\n      fixCostumeOrder(this);\n      return r;\n    };\n\n    const originalAddSound = RenderedTarget.prototype.addSound;\n    RenderedTarget.prototype.addSound = function (...args) {\n      if (currentAssetFolder !== null) {\n        const sound = args[0];\n        if (sound && typeof getFolderFromName(sound.name) !== \"string\") {\n          sound.name = setFolderOfName(sound.name, currentAssetFolder);\n        }\n      }\n      const r = originalAddSound.call(this, ...args);\n      fixSoundOrder(this);\n      return r;\n    };\n\n    const abstractReorder = (\n      { guiItems, getAll, set, rename, getVMItemFromGUIItem, zeroIndexed, onFolderChanged },\n      itemIndex,\n      newIndex\n    ) => {\n      itemIndex = clamp(itemIndex, 0, guiItems.length);\n      newIndex = clamp(newIndex, 0, guiItems.length);\n      if (itemIndex === newIndex) {\n        return false;\n      }\n\n      let assets = getAll();\n      const originalAssets = getAll();\n\n      const targetItem = guiItems[itemIndex - (zeroIndexed ? 0 : 1)];\n      const itemAtNewIndex = guiItems[newIndex - (zeroIndexed ? 0 : 1)];\n      const targetItemData = getItemData(targetItem);\n      const itemAtNewIndexData = getItemData(itemAtNewIndex);\n\n      if (!targetItemData || !itemAtNewIndexData) {\n        console.warn(\"should never happen\");\n        return false;\n      }\n\n      const reorderingItems = typeof targetItemData.folder === \"string\" ? targetItem.items : [targetItem];\n      const reorderingAssets = reorderingItems.map((i) => getVMItemFromGUIItem(i, assets)).filter((i) => i);\n      if (typeof itemAtNewIndexData.realIndex === \"number\") {\n        const newTarget = getVMItemFromGUIItem(itemAtNewIndex, assets);\n        if (!newTarget || reorderingAssets.includes(newTarget)) {\n          // Dragging folder into itself or target doesn't exist. Ignore.\n          return false;\n        }\n      }\n\n      let newFolder = null;\n\n      assets = assets.filter((i) => !reorderingAssets.includes(i));\n\n      let realNewIndex;\n      if (newIndex === (zeroIndexed ? 0 : 1)) {\n        realNewIndex = zeroIndexed ? 0 : 1;\n      } else if (newIndex === guiItems.length - (zeroIndexed ? 1 : 0)) {\n        realNewIndex = assets.length;\n      } else if (typeof itemAtNewIndexData.realIndex === \"number\") {\n        newFolder = typeof itemAtNewIndexData.inFolder === \"string\" ? itemAtNewIndexData.inFolder : null;\n        let newAsset = getVMItemFromGUIItem(itemAtNewIndex, assets);\n        if (!newAsset) {\n          console.warn(\"should never happen\");\n          return false;\n        }\n        realNewIndex = assets.indexOf(newAsset);\n        if (newIndex > itemIndex) {\n          realNewIndex++;\n        }\n      } else if (typeof itemAtNewIndexData.folder === \"string\") {\n        let item;\n        let offset = 0;\n        if (newIndex < itemIndex) {\n          // A B [C D E] F G\n          //    ^----------*\n          // A B C [D] E F G\n          //      ^--------*\n          item = itemAtNewIndex.items[0];\n        } else if (itemAtNewIndexData.folderOpen) {\n          // A B [C D E] F G\n          //   *---^\n          item = itemAtNewIndex.items[0];\n          newFolder = itemAtNewIndexData.folder;\n        } else {\n          // A B [C] D E F G\n          //   *----^\n          item = itemAtNewIndex.items[itemAtNewIndex.items.length - 1];\n          offset = 1;\n        }\n        let newAsset = getVMItemFromGUIItem(item, assets);\n        if (newAsset) {\n          realNewIndex = assets.indexOf(newAsset) + offset;\n        } else {\n          // Edge case: Dragging the first item of a list on top of the folder item\n          // A B [C D E] F G\n          //    ^---*\n          newAsset = getVMItemFromGUIItem(item, originalAssets);\n          if (!newAsset) {\n            console.warn(\"should never happen\");\n            return false;\n          }\n          realNewIndex = originalAssets.indexOf(newAsset) + offset;\n        }\n      } else {\n        console.warn(\"should never happen\");\n        return false;\n      }\n\n      if (typeof targetItemData.folder === \"string\" && newFolder !== null) {\n        // Cannot drag a folder into another folder\n        return;\n      }\n\n      if (realNewIndex < (zeroIndexed ? 0 : 1) || realNewIndex > assets.length) {\n        console.warn(\"should never happen\");\n        return false;\n      }\n\n      assets.splice(realNewIndex, 0, ...reorderingAssets);\n      set(assets);\n\n      // If the folder has changed, update item names to match.\n      if (typeof targetItemData.folder !== \"string\" && targetItemData.inFolder !== newFolder) {\n        for (const asset of reorderingAssets) {\n          const name = asset.getName ? asset.getName() : asset.name;\n          rename(asset, setFolderOfName(name, newFolder));\n        }\n        if (onFolderChanged) {\n          onFolderChanged();\n        }\n      }\n\n      return true;\n    };\n\n    vm.constructor.prototype.reorderTarget = function (targetIndex, newIndex) {\n      return abstractReorder(\n        {\n          getAll: () => {\n            return this.runtime.targets;\n          },\n          set: (targets) => {\n            this.runtime.targets = targets;\n            this.emitTargetsUpdate();\n          },\n          rename: (item, name) => {\n            this.renameSprite(item.id, ensureNotReserved(name));\n          },\n          getVMItemFromGUIItem: (item, targets) => {\n            return targets.find((i) => i.id === item.id);\n          },\n          onFolderChanged: () => {\n            this.emitWorkspaceUpdate();\n          },\n          guiItems: currentSpriteItems,\n          zeroIndexed: false,\n        },\n        targetIndex,\n        newIndex\n      );\n    };\n\n    RenderedTarget.prototype.reorderCostume = function (costumeIndex, newIndex) {\n      return abstractReorder(\n        {\n          getAll: () => {\n            return this.sprite.costumes;\n          },\n          set: (assets) => {\n            this.sprite.costumes = assets;\n          },\n          rename: (item, name) => {\n            this.renameCostume(this.sprite.costumes.indexOf(item), name);\n          },\n          getVMItemFromGUIItem: (item, costumes) => {\n            const itemData = getItemData(item);\n            return costumes.find((c) => c.name === itemData.realName);\n          },\n          guiItems: currentAssetItems,\n          zeroIndexed: true,\n        },\n        costumeIndex,\n        newIndex\n      );\n    };\n\n    RenderedTarget.prototype.reorderSound = function (soundIndex, newIndex) {\n      return abstractReorder(\n        {\n          getAll: () => {\n            return this.sprite.sounds;\n          },\n          set: (assets) => {\n            this.sprite.sounds = assets;\n          },\n          rename: (item, name) => {\n            this.renameSound(this.sprite.sounds.indexOf(item), name);\n          },\n          getVMItemFromGUIItem: (item, sounds) => {\n            const itemData = getItemData(item);\n            return sounds.find((c) => c.name === itemData.realName);\n          },\n          guiItems: currentAssetItems,\n          zeroIndexed: true,\n        },\n        soundIndex,\n        newIndex\n      );\n    };\n  };\n\n  const patchBackpack = (backpackInstance) => {\n    const Backpack = backpackInstance.constructor;\n    Backpack.prototype.sa_loadNextItem = function () {\n      if (!this.sa_queuedItems) return;\n      const item = this.sa_queuedItems.pop();\n      if (item) {\n        let payload;\n        let type;\n        if (item.dragPayload) {\n          if (item.url) {\n            type = \"SOUND\";\n          } else {\n            type = \"COSTUME\";\n          }\n          payload = item.dragPayload;\n        } else if (item.id) {\n          type = \"SPRITE\";\n          payload = item.id;\n        }\n        if (type && payload) {\n          originalHandleDrop.call(this, {\n            dragType: type,\n            payload: payload,\n          });\n        }\n      }\n    };\n\n    Backpack.prototype.componentDidUpdate = function (prevProps, prevState) {\n      if (!this.state.loading && prevState.loading && !this.state.error) {\n        this.sa_loadNextItem();\n      }\n    };\n\n    const originalHandleDrop = Backpack.prototype.handleDrop;\n    Backpack.prototype.handleDrop = function (...args) {\n      // When a folder is dropped into the backpack, upload all the items in the folder.\n      const dragInfo = args[0];\n      const folderItems = dragInfo && dragInfo.payload && dragInfo.payload.sa_folder_items;\n      if (Array.isArray(folderItems)) {\n        if (confirm(msg(\"confirm-backpack-folder\"))) {\n          this.sa_queuedItems = folderItems;\n          this.sa_loadNextItem();\n        }\n        return;\n      }\n      return originalHandleDrop.call(this, ...args);\n    };\n    backpackInstance.handleDrop = Backpack.prototype.handleDrop.bind(backpackInstance);\n  };\n\n  await untilInEditor();\n\n  // Backpack\n  {\n    const clickListener = (e) => {\n      if (!e.target.closest('[class*=\"backpack_backpack-header_\"]')) {\n        return;\n      }\n      setTimeout(() => {\n        const backpackContainer = document.querySelector(\"[class^='backpack_backpack-list_']\");\n        if (!backpackContainer) {\n          return;\n        }\n        document.removeEventListener(\"click\", clickListener);\n        const backpackInstance = getBackpackFromElement(backpackContainer);\n        verifyBackpack(backpackInstance);\n        patchBackpack(backpackInstance);\n      });\n    };\n    document.addEventListener(\"click\", clickListener, true);\n  }\n\n  // Sprite list\n  {\n    const spriteSelectorItemElement = await addon.tab.waitForElement(\"[class^='sprite-selector_sprite-wrapper']\", {\n      reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\n    });\n    vm = addon.tab.traps.vm;\n    reactInternalKey = Object.keys(spriteSelectorItemElement).find((i) => i.startsWith(REACT_INTERNAL_PREFIX));\n    const sortableHOCInstance = getSortableHOCFromElement(spriteSelectorItemElement);\n    const spriteSelectorItemInstance = spriteSelectorItemElement[reactInternalKey].child.child.child.stateNode;\n    verifySortableHOC(sortableHOCInstance);\n    verifySpriteSelectorItem(spriteSelectorItemInstance);\n    verifyVM(vm);\n    patchSortableHOC(sortableHOCInstance.constructor, TYPE_SPRITES);\n    patchSpriteSelectorItem(spriteSelectorItemInstance.constructor);\n    sortableHOCInstance.saInitialSetup();\n    patchVM();\n  }\n\n  // Costume and sound list\n  {\n    const selectorListItem = await addon.tab.waitForElement(\"[class*='selector_list-item']\", {\n      reduxCondition: (state) => state.scratchGui.editorTab.activeTabIndex !== 0 && !state.scratchGui.mode.isPlayerOnly,\n    });\n    const sortableHOCInstance = getSortableHOCFromElement(selectorListItem);\n    verifySortableHOC(sortableHOCInstance);\n    patchSortableHOC(sortableHOCInstance.constructor, TYPE_ASSETS);\n    sortableHOCInstance.saInitialSetup();\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/bb253918c345ecd72e87fdde9b57c41a.png\";","module.exports = __webpack_public_path__ + \"static/assets/7ccb0253b8f853a83465bfc2a1c68294.svg\";","module.exports = __webpack_public_path__ + \"static/assets/8cd418f8f584076a4ee8497b0534f45c.png\";","module.exports = __webpack_public_path__ + \"static/assets/dc05dad5bd29cfb425a6315c61be3193.svg\";","module.exports = __webpack_public_path__ + \"static/assets/cf2bdd182f62aaf82abdc3df183d5229.svg\";","let console = window.console;\n\n/*\nMapping types:\n\ntype: \"key\" maps a button to a keyboard key\nAll key names will be interpreted as a KeyboardEvent.key value (https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values)\nhigh: \"KeyName\" is the name of the key to dispatch when a button reads a HIGH value\nlow: \"KeyName\" is the name of the key to dispatch when a button reads a LOW value\ndeadZone: 0.5 controls the minimum value necessary to be read in either + or - to trigger either high or low\nThe high/low distinction is necessary for axes. Buttons will only use high\n\ntype: \"mousedown\" maps a button to control whether the mouse is down or not\ndeadZone: 0.5 controls the minimum value to trigger a mousedown\n\ntype: \"virtual_cursor\" maps a button to control the \"virtual cursor\"\ndeadZone: 0.5 again controls the minimum value to trigger a movement\nsensitivity: 10 controls the speed\nhigh: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads high\nlow: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads low\n+y increases y, -y decreases y, +x increases x, -x decreases x.\n*/\n\nconst defaultAxesMappings = {\n  arrows: [\n    {\n      type: \"key\",\n      high: \"ArrowRight\",\n      low: \"ArrowLeft\",\n      deadZone: 0.5,\n    },\n    {\n      type: \"key\",\n      high: \"ArrowDown\",\n      low: \"ArrowUp\",\n      deadZone: 0.5,\n    },\n  ],\n  wasd: [\n    {\n      type: \"key\",\n      high: \"d\",\n      low: \"a\",\n      deadZone: 0.5,\n    },\n    {\n      type: \"key\",\n      high: \"s\",\n      low: \"w\",\n      deadZone: 0.5,\n    },\n  ],\n  cursor: [\n    {\n      type: \"virtual_cursor\",\n      high: \"+x\",\n      low: \"-x\",\n      sensitivity: 0.6,\n      deadZone: 0.2,\n    },\n    {\n      type: \"virtual_cursor\",\n      high: \"-y\",\n      low: \"+y\",\n      sensitivity: 0.6,\n      deadZone: 0.2,\n    },\n  ],\n};\n\nconst emptyMapping = () => ({\n  type: \"key\",\n  high: null,\n  low: null,\n});\nconst transformAndCopyMapping = (mapping) => {\n  if (typeof mapping !== \"object\" || !mapping) {\n    console.warn(\"invalid mapping\", mapping);\n    return emptyMapping();\n  }\n  const copy = Object.assign({}, mapping);\n  if (copy.type === \"key\") {\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n    if (typeof copy.high === \"undefined\") {\n      copy.high = \"\";\n    }\n    if (typeof copy.low === \"undefined\") {\n      copy.low = \"\";\n    }\n  } else if (copy.type === \"mousedown\") {\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n  } else if (copy.type === \"virtual_cursor\") {\n    if (typeof copy.high === \"undefined\") {\n      copy.high = \"\";\n    }\n    if (typeof copy.low === \"undefined\") {\n      copy.low = \"\";\n    }\n    if (typeof copy.sensitivity === \"undefined\") {\n      copy.sensitivity = 10;\n    }\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n  } else {\n    console.warn(\"unknown mapping type\", copy.type);\n    return emptyMapping();\n  }\n  return copy;\n};\nconst prepareMappingForExport = (mapping) => Object.assign({}, mapping);\nconst prepareAxisMappingForExport = prepareMappingForExport;\nconst prepareButtonMappingForExport = (mapping) => {\n  const copy = prepareMappingForExport(mapping);\n  delete copy.deadZone;\n  delete copy.low;\n  return copy;\n};\n\nconst padWithEmptyMappings = (array, length) => {\n  // Keep adding empty mappings until the list is full\n  while (array.length < length) {\n    array.push(emptyMapping());\n  }\n  // In case the input array is longer than the desired length\n  array.length = length;\n  return array;\n};\n\nconst getMovementConfiguration = (usedKeys) => ({\n  usesArrows:\n    usedKeys.has(\"ArrowUp\") || usedKeys.has(\"ArrowDown\") || usedKeys.has(\"ArrowRight\") || usedKeys.has(\"ArrowLeft\"),\n  usesWASD: (usedKeys.has(\"w\") && usedKeys.has(\"s\")) || (usedKeys.has(\"a\") && usedKeys.has(\"d\")),\n});\n\nconst getGamepadId = (gamepad) => `${gamepad.id} (${gamepad.index})`;\n\nclass GamepadData {\n  /**\n   * @param {Gamepad} gamepad Source Gamepad\n   * @param {GamepadLib} gamepadLib Parent GamepadLib\n   */\n  constructor(gamepad, gamepadLib) {\n    this.gamepad = gamepad;\n    this.gamepadLib = gamepadLib;\n    this.buttonMappings = this.getDefaultButtonMappings().map(transformAndCopyMapping);\n    this.axesMappings = this.getDefaultAxisMappings().map(transformAndCopyMapping);\n  }\n\n  getDefaultButtonMappings() {\n    let buttons;\n    if (this.gamepadLib.hints.importedSettings) {\n      buttons = this.gamepadLib.hints.importedSettings.buttons;\n    } else {\n      const usedKeys = this.gamepadLib.hints.usedKeys;\n      const alreadyUsedKeys = new Set();\n      const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\n      if (usesWASD) {\n        alreadyUsedKeys.add(\"w\");\n        alreadyUsedKeys.add(\"a\");\n        alreadyUsedKeys.add(\"s\");\n        alreadyUsedKeys.add(\"d\");\n      }\n      const possiblePauseKeys = [\n        // Restart keys, pause keys, other potentially dangerous keys\n        \"p\",\n        \"q\",\n        \"r\",\n      ];\n      const possibleActionKeys = [\n        \" \",\n        \"Enter\",\n        \"e\",\n        \"f\",\n        \"z\",\n        \"x\",\n        \"c\",\n        ...Array.from(usedKeys).filter((i) => i.length === 1 && !possiblePauseKeys.includes(i)),\n      ];\n\n      const findKey = (keys) => {\n        for (const key of keys) {\n          if (usedKeys.has(key) && !alreadyUsedKeys.has(key)) {\n            alreadyUsedKeys.add(key);\n            return key;\n          }\n        }\n        return null;\n      };\n      const getPrimaryAction = () => {\n        if (usesArrows && usedKeys.has(\"ArrowUp\")) {\n          return \"ArrowUp\";\n        }\n        if (usesWASD && usedKeys.has(\"w\")) {\n          return \"w\";\n        }\n        return findKey(possibleActionKeys);\n      };\n      const getSecondaryAction = () => findKey(possibleActionKeys);\n      const getPauseKey = () => findKey(possiblePauseKeys);\n      const getUp = () => {\n        if (usesArrows || !usesWASD) return \"ArrowUp\";\n        return \"w\";\n      };\n      const getDown = () => {\n        if (usesArrows || !usesWASD) return \"ArrowDown\";\n        return \"s\";\n      };\n      const getRight = () => {\n        if (usesArrows || !usesWASD) return \"ArrowRight\";\n        return \"d\";\n      };\n      const getLeft = () => {\n        if (usesArrows || !usesWASD) return \"ArrowLeft\";\n        return \"a\";\n      };\n\n      const action1 = getPrimaryAction();\n      let action2 = getSecondaryAction();\n      let action3 = getSecondaryAction();\n      let action4 = getSecondaryAction();\n      // When only 1 or 2 action keys are detected, bind the other buttons to the same things.\n      if (action1 && !action2 && !action3 && !action4) {\n        action2 = action1;\n        action3 = action1;\n        action4 = action1;\n      }\n      if (action1 && action2 && !action3 && !action4) {\n        action3 = action1;\n        action4 = action2;\n      }\n\n      // Set indices \"manually\" because we don't evaluate them in order.\n      buttons = [];\n      buttons[0] = {\n        /*\n        Xbox: A\n        SNES-like: B\n        */\n        type: \"key\",\n        high: action1,\n      };\n      buttons[1] = {\n        /*\n        Xbox: B\n        SNES-like: A\n        */\n        type: \"key\",\n        high: action2,\n      };\n      buttons[2] = {\n        /*\n        Xbox: X\n        SNES-like: Y\n        */\n        type: \"key\",\n        high: action3,\n      };\n      buttons[3] = {\n        /*\n        Xbox: Y\n        SNES-like: X\n        */\n        type: \"key\",\n        high: action4,\n      };\n      buttons[4] = {\n        /*\n        Xbox: LB\n        SNES-like: Left trigger\n        */\n        type: \"mousedown\",\n      };\n      buttons[5] = {\n        /*\n        Xbox: RB\n        */\n        type: \"mousedown\",\n      };\n      buttons[6] = {\n        /*\n        Xbox: LT\n        */\n        type: \"mousedown\",\n      };\n      buttons[7] = {\n        /*\n        Xbox: RT\n        SNES-like: Right trigger\n        */\n        type: \"mousedown\",\n      };\n      buttons[9] = {\n        /*\n        Xbox: Menu\n        SNES-like: Start\n        */\n        type: \"key\",\n        high: getPauseKey(),\n      };\n      buttons[8] = {\n        /*\n        Xbox: Change view\n        SNES-like: Select\n        */\n        type: \"key\",\n        high: getPauseKey(),\n      };\n      // Xbox: Left analog press\n      buttons[10] = emptyMapping();\n      // Xbox: Right analog press\n      buttons[11] = emptyMapping();\n      buttons[12] = {\n        /*\n        Xbox: D-pad up\n        */\n        type: \"key\",\n        high: getUp(),\n      };\n      buttons[13] = {\n        /*\n        Xbox: D-pad down\n        */\n        type: \"key\",\n        high: getDown(),\n      };\n      buttons[14] = {\n        /*\n        Xbox: D-pad left\n        */\n        type: \"key\",\n        high: getLeft(),\n      };\n      buttons[15] = {\n        /*\n        Xbox: D-pad right\n        */\n        type: \"key\",\n        high: getRight(),\n      };\n    }\n    return padWithEmptyMappings(buttons, this.gamepad.buttons.length);\n  }\n\n  getDefaultAxisMappings() {\n    let axes = [];\n    if (this.gamepadLib.hints.importedSettings) {\n      axes = this.gamepadLib.hints.importedSettings.axes;\n    } else {\n      // Only return default axis mappings when there are 4 axes, like an xbox controller\n      // If there isn't exactly 4, we can't really predict what the axes mean\n      // Some controllers map the dpad to *both* buttons and axes at the same time, which would cause conflicts.\n      if (this.gamepad.axes.length === 4) {\n        const usedKeys = this.gamepadLib.hints.usedKeys;\n        const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\n        if (usesWASD) {\n          axes.push(defaultAxesMappings.wasd[0]);\n          axes.push(defaultAxesMappings.wasd[1]);\n        } else if (usesArrows) {\n          axes.push(defaultAxesMappings.arrows[0]);\n          axes.push(defaultAxesMappings.arrows[1]);\n        } else {\n          axes.push(defaultAxesMappings.cursor[0]);\n          axes.push(defaultAxesMappings.cursor[1]);\n        }\n        axes.push(defaultAxesMappings.cursor[0]);\n        axes.push(defaultAxesMappings.cursor[1]);\n      }\n    }\n    return padWithEmptyMappings(axes, this.gamepad.axes.length);\n  }\n}\n\nclass GamepadLib extends EventTarget {\n  constructor() {\n    super();\n\n    /** @type {Map<string, GamepadData>} */\n    this.gamepads = new Map();\n\n    this.handleConnect = this.handleConnect.bind(this);\n    this.handleDisconnect = this.handleDisconnect.bind(this);\n    this.update = this.update.bind(this);\n\n    this.animationFrame = null;\n    this.currentTime = null;\n    this.deltaTime = 0;\n\n    this.virtualCursor = {\n      x: 0,\n      y: 0,\n      maxX: Infinity,\n      minX: -Infinity,\n      maxY: Infinity,\n      minY: -Infinity,\n      modified: false,\n    };\n\n    this._editor = null;\n\n    this.connectCallbacks = [];\n\n    this.hints = {\n      usedKeys: new Set(),\n      importedSettings: null,\n      generated: false,\n    };\n\n    this.keysPressedThisFrame = new Set();\n    this.oldKeysPressed = new Set();\n\n    this.mouseDownThisFrame = false;\n    this.oldMouseDown = false;\n\n    this.addEventHandlers();\n  }\n\n  addEventHandlers() {\n    window.addEventListener(\"gamepadconnected\", this.handleConnect);\n    window.addEventListener(\"gamepaddisconnected\", this.handleDisconnect);\n  }\n\n  removeEventHandlers() {\n    window.removeEventListener(\"gamepadconnected\", this.handleConnect);\n    window.removeEventListener(\"gamepaddisconnected\", this.handleDisconnect);\n  }\n\n  gamepadConnected() {\n    if (this.gamepads.size > 0) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve) => {\n      this.connectCallbacks.push(resolve);\n    });\n  }\n\n  ensureHintsGenerated() {\n    if (this.hints.generated) {\n      return;\n    }\n    if (this.getHintsLazily) {\n      Object.assign(this.hints, this.getHintsLazily());\n    }\n    this.hints.generated = true;\n  }\n\n  handleConnect(e) {\n    this.ensureHintsGenerated();\n    for (const callback of this.connectCallbacks) {\n      callback();\n    }\n    this.connectCallbacks = [];\n    const gamepad = e.gamepad;\n    const id = getGamepadId(gamepad);\n    console.log(\"connected\", gamepad);\n    const gamepadData = new GamepadData(gamepad, this);\n    this.gamepads.set(id, gamepadData);\n    if (this.animationFrame === null) {\n      this.animationFrame = requestAnimationFrame(this.update);\n    }\n    this.dispatchEvent(new CustomEvent(\"gamepadconnected\", { detail: gamepadData }));\n  }\n\n  handleDisconnect(e) {\n    const gamepad = e.gamepad;\n    const id = getGamepadId(gamepad);\n    console.log(\"disconnected\", gamepad);\n    const gamepadData = this.gamepads.get(id);\n    this.gamepads.delete(id);\n    this.dispatchEvent(new CustomEvent(\"gamepaddisconnected\", { detail: gamepadData }));\n    if (this.gamepads.size === 0) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n      this.currentTime = null;\n    }\n  }\n\n  dispatchKey(key, pressed) {\n    if (pressed) {\n      this.dispatchEvent(new CustomEvent(\"keydown\", { detail: key }));\n    } else {\n      this.dispatchEvent(new CustomEvent(\"keyup\", { detail: key }));\n    }\n  }\n\n  dispatchMouseDown(down) {\n    if (down) {\n      this.dispatchEvent(new CustomEvent(\"mousedown\"));\n    } else {\n      this.dispatchEvent(new CustomEvent(\"mouseup\"));\n    }\n  }\n\n  dispatchMouseMove(x, y) {\n    this.dispatchEvent(new CustomEvent(\"mousemove\", { detail: { x, y } }));\n  }\n\n  updateButton(value, mapping) {\n    if (mapping.type === \"key\") {\n      if (value >= mapping.deadZone) {\n        if (mapping.high) {\n          this.keysPressedThisFrame.add(mapping.high);\n        }\n      } else if (value <= -mapping.deadZone) {\n        if (mapping.low) {\n          this.keysPressedThisFrame.add(mapping.low);\n        }\n      }\n    } else if (mapping.type === \"mousedown\") {\n      const isDown = Math.abs(value) >= mapping.deadZone;\n      if (isDown) {\n        this.mouseDownThisFrame = true;\n      }\n    } else if (mapping.type === \"virtual_cursor\") {\n      const deadZone = mapping.deadZone;\n      let action;\n      if (value >= deadZone) action = mapping.high;\n      if (value <= -deadZone) action = mapping.low;\n      if (action) {\n        // an axis value just beyond the deadzone should have a multiplier near 0, a high value should have a multiplier of 1\n        const multiplier = (Math.abs(value) - deadZone) / (1 - deadZone);\n        const speed = multiplier * multiplier * mapping.sensitivity * this.deltaTime;\n        if (action === \"+x\") {\n          this.virtualCursor.x += speed;\n        } else if (action === \"-x\") {\n          this.virtualCursor.x -= speed;\n        } else if (action === \"+y\") {\n          this.virtualCursor.y += speed;\n        } else if (action === \"-y\") {\n          this.virtualCursor.y -= speed;\n        }\n        this.virtualCursor.modified = true;\n      }\n    }\n  }\n\n  update(time) {\n    this.oldKeysPressed = this.keysPressedThisFrame;\n    this.oldMouseDown = this.mouseDownThisFrame;\n    this.keysPressedThisFrame = new Set();\n    this.mouseDownThisFrame = false;\n\n    if (this.currentTime === null) {\n      this.deltaTime = 0; // doesn't matter what this is, it's just the first frame\n    } else {\n      this.deltaTime = time - this.currentTime;\n    }\n    this.deltaTime = Math.max(Math.min(this.deltaTime, 1000), 0);\n    this.currentTime = time;\n\n    this.animationFrame = requestAnimationFrame(this.update);\n\n    const gamepads = navigator.getGamepads();\n    for (const gamepad of gamepads) {\n      if (gamepad === null) {\n        continue;\n      }\n\n      const id = getGamepadId(gamepad);\n      const data = this.gamepads.get(id);\n\n      for (let i = 0; i < gamepad.buttons.length; i++) {\n        const button = gamepad.buttons[i];\n        const value = button.value;\n        const mapping = data.buttonMappings[i];\n        this.updateButton(value, mapping);\n      }\n\n      for (let i = 0; i < gamepad.axes.length; i++) {\n        const axis = gamepad.axes[i];\n        const mapping = data.axesMappings[i];\n        this.updateButton(axis, mapping);\n      }\n    }\n\n    if (this._editor) {\n      this._editor.update(gamepads);\n    }\n\n    for (const key of this.keysPressedThisFrame) {\n      if (!this.oldKeysPressed.has(key)) {\n        this.dispatchKey(key, true);\n      }\n    }\n    for (const key of this.oldKeysPressed) {\n      if (!this.keysPressedThisFrame.has(key)) {\n        this.dispatchKey(key, false);\n      }\n    }\n    if (this.mouseDownThisFrame && !this.oldMouseDown) {\n      this.dispatchMouseDown(true);\n    } else if (!this.mouseDownThisFrame && this.oldMouseDown) {\n      this.dispatchMouseDown(false);\n    }\n    if (this.virtualCursor.modified) {\n      this.virtualCursor.modified = false;\n      if (this.virtualCursor.x > this.virtualCursor.maxX) {\n        this.virtualCursor.x = this.virtualCursor.maxX;\n      }\n      if (this.virtualCursor.x < this.virtualCursor.minX) {\n        this.virtualCursor.x = this.virtualCursor.minX;\n      }\n      if (this.virtualCursor.y > this.virtualCursor.maxY) {\n        this.virtualCursor.y = this.virtualCursor.maxY;\n      }\n      if (this.virtualCursor.y < this.virtualCursor.minY) {\n        this.virtualCursor.y = this.virtualCursor.minY;\n      }\n      this.dispatchMouseMove(this.virtualCursor.x, this.virtualCursor.y);\n    }\n  }\n\n  editor() {\n    if (!this._editor) {\n      this._editor = new GamepadEditor(this);\n    }\n    return this._editor;\n  }\n}\n\nGamepadLib.browserHasBrokenGamepadAPI = () => {\n  // Check that the gamepad API is supported at all\n  if (!navigator.getGamepads) {\n    return true;\n  }\n  // Firefox on Linux has a broken gamepad API implementation that results in strange and sometimes unusable mappings\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643358\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643835\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Linux\")) {\n    return true;\n  }\n  // Firefox on macOS has other bugs that result in strange and unusable mappings\n  // eg. https://bugzilla.mozilla.org/show_bug.cgi?id=1434408\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Mac OS\")) {\n    return true;\n  }\n  return false;\n};\n\nGamepadLib.setConsole = (n) => (console = n);\n\nconst removeAllChildren = (el) => {\n  while (el.firstChild) {\n    el.removeChild(el.firstChild);\n  }\n};\nconst buttonHtmlId = (index) => `gamepadlib-button-${index}`;\nconst axisHtmlId = (n) => `gamepadlib-axis-${n}`;\n\nclass GamepadEditor extends EventTarget {\n  constructor(gamepadLib) {\n    super();\n\n    /** @type {GamepadLib} */\n    this.gamepadLib = gamepadLib;\n\n    this.root = Object.assign(document.createElement(\"div\"), {\n      className: \"gamepadlib-root\",\n    });\n    this.selector = Object.assign(document.createElement(\"select\"), {\n      className: \"gamepadlib-selector\",\n    });\n    this.content = Object.assign(document.createElement(\"div\"), {\n      className: \"gamepadlib-content\",\n    });\n\n    this.root.appendChild(this.selector);\n    this.root.appendChild(this.content);\n\n    this.onSelectorChange = this.onSelectorChange.bind(this);\n    this.onGamepadsChange = this.onGamepadsChange.bind(this);\n\n    this.selector.onchange = this.onSelectorChange;\n    this.gamepadLib.addEventListener(\"gamepadconnected\", this.onGamepadsChange);\n    this.gamepadLib.addEventListener(\"gamepaddisconnected\", this.onGamepadsChange);\n\n    this.buttonIdToElement = new Map();\n    this.axisIdToElement = new Map();\n\n    this.hidden = false;\n\n    // should be overridden later\n    this.msg = (id, opts) => id;\n  }\n\n  onSelectorChange() {\n    this.updateContent();\n    this.dispatchEvent(new CustomEvent(\"gamepad-changed\"));\n  }\n\n  onGamepadsChange() {\n    this.updateAllContent();\n    this.dispatchEvent(new CustomEvent(\"gamepad-changed\"));\n  }\n\n  updateAllContent() {\n    this.updateDropdown();\n    this.updateContent();\n    this.focus();\n  }\n\n  updateDropdown() {\n    removeAllChildren(this.selector);\n\n    const gamepads = Array.from(this.gamepadLib.gamepads.entries());\n    if (gamepads.length === 0) {\n      this.selector.hidden = true;\n      return;\n    }\n    this.selector.hidden = false;\n    for (const [id, _] of gamepads) {\n      const option = document.createElement(\"option\");\n      option.textContent = id;\n      option.value = id;\n      this.selector.appendChild(option);\n    }\n  }\n\n  keyToString(key) {\n    if (key === \" \") return this.msg(\"key-space\");\n    if (key === \"ArrowUp\") return this.msg(\"key-up\");\n    if (key === \"ArrowDown\") return this.msg(\"key-down\");\n    if (key === \"ArrowLeft\") return this.msg(\"key-left\");\n    if (key === \"ArrowRight\") return this.msg(\"key-right\");\n    if (key === \"Enter\") return this.msg(\"key-enter\");\n    return key.toUpperCase();\n  }\n\n  createButtonMapping(mappingList, index, { property = \"high\", allowClick = true } = {}) {\n    const input = document.createElement(\"input\");\n    input.readOnly = true;\n    input.className = \"gamepadlib-keyinput\";\n    input.title = this.msg(\"keyinput-title\");\n    input.dataset.index = index;\n\n    const update = () => {\n      const mapping = mappingList[index];\n      input.dataset.empty = false;\n      if (mapping.type === \"key\") {\n        if (mapping[property] === null) {\n          input.value = this.msg(\"key-none\");\n          input.dataset.empty = true;\n        } else {\n          input.value = this.keyToString(mapping[property]);\n        }\n      } else if (mapping.type === \"mousedown\") {\n        input.value = this.msg(\"key-click\");\n      } else {\n        // should never happen\n        input.value = `??? ${mapping.type}`;\n      }\n    };\n\n    const changedMapping = () => {\n      mappingList[index] = transformAndCopyMapping(mappingList[index]);\n      isAcceptingInput = false;\n      input.blur();\n      update();\n      input.dispatchEvent(new CustomEvent(\"mapping-changed\"));\n      this.changed();\n    };\n\n    let isAcceptingInput = false;\n\n    const handleClick = (e) => {\n      e.preventDefault();\n      if (isAcceptingInput) {\n        if (allowClick) {\n          const mapping = mappingList[index];\n          mapping.type = \"mousedown\";\n          changedMapping();\n        } else {\n          handleBlur();\n        }\n      } else {\n        input.value = \"...\";\n        input.dataset.acceptingInput = true;\n        isAcceptingInput = true;\n      }\n    };\n\n    const handleKeyDown = (e) => {\n      if (isAcceptingInput) {\n        e.preventDefault();\n        const key = e.key;\n        if ([\"Alt\", \"Shift\", \"Control\"].includes(key)) {\n          return;\n        }\n        const mapping = mappingList[index];\n        if (key.length === 1 || [\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Enter\"].includes(key)) {\n          mapping.type = \"key\";\n          mapping[property] = key;\n        } else if (key !== \"Escape\") {\n          mapping.type = \"key\";\n          mapping[property] = null;\n        }\n        changedMapping();\n      } else if (e.key === \"Enter\") {\n        e.preventDefault();\n        e.target.click();\n      }\n    };\n\n    const handleBlur = () => {\n      input.dataset.acceptingInput = false;\n      if (isAcceptingInput) {\n        isAcceptingInput = false;\n        update();\n      }\n    };\n\n    input.addEventListener(\"click\", handleClick);\n    input.addEventListener(\"keydown\", handleKeyDown);\n    input.addEventListener(\"blur\", handleBlur);\n    update();\n\n    return input;\n  }\n\n  createAxisMapping(mappingList, index) {\n    const selector = document.createElement(\"select\");\n    selector.className = \"gamepadlib-axis-mapping\";\n    selector.id = axisHtmlId(index);\n    selector.appendChild(\n      Object.assign(document.createElement(\"option\"), {\n        textContent: this.msg(\"axis-none\"),\n        value: \"none\",\n      })\n    );\n    selector.appendChild(\n      Object.assign(document.createElement(\"option\"), {\n        textContent: this.msg(\"axis-cursor\"),\n        value: \"cursor\",\n      })\n    );\n    selector.appendChild(\n      Object.assign(document.createElement(\"option\"), {\n        // doesn't really make sense to translate\n        textContent: \"WASD\",\n        value: \"wasd\",\n      })\n    );\n    selector.appendChild(\n      Object.assign(document.createElement(\"option\"), {\n        textContent: this.msg(\"axis-arrows\"),\n        value: \"arrows\",\n      })\n    );\n    selector.appendChild(\n      Object.assign(document.createElement(\"option\"), {\n        textContent: this.msg(\"axis-custom\"),\n        value: \"custom\",\n      })\n    );\n\n    const updateDropdownValue = () => {\n      if (mappingList[index].type === \"key\" || mappingList[index].type === \"mousedown\") {\n        if (\n          mappingList[index].high === null &&\n          mappingList[index].low === null &&\n          mappingList[index + 1].high === null &&\n          mappingList[index + 1].low === null\n        ) {\n          selector.value = \"none\";\n        } else if (\n          mappingList[index].high === defaultAxesMappings.wasd[0].high &&\n          mappingList[index].low === defaultAxesMappings.wasd[0].low &&\n          mappingList[index + 1].high === defaultAxesMappings.wasd[1].high &&\n          mappingList[index + 1].low === defaultAxesMappings.wasd[1].low\n        ) {\n          selector.value = \"wasd\";\n        } else if (\n          mappingList[index].high === defaultAxesMappings.arrows[0].high &&\n          mappingList[index].low === defaultAxesMappings.arrows[0].low &&\n          mappingList[index + 1].high === defaultAxesMappings.arrows[1].high &&\n          mappingList[index + 1].low === defaultAxesMappings.arrows[1].low\n        ) {\n          selector.value = \"arrows\";\n        } else {\n          selector.value = \"custom\";\n        }\n      } else if (mappingList[index].type === \"virtual_cursor\") {\n        selector.value = \"cursor\";\n      } else {\n        // should never happen\n        selector.value = \"none\";\n      }\n    };\n    updateDropdownValue();\n\n    const circleOverlay = document.createElement(\"div\");\n    circleOverlay.className = \"gamepadlib-axis-circle-overlay\";\n    const updateOverlay = () => {\n      removeAllChildren(circleOverlay);\n      if (mappingList[index].type === \"key\") {\n        const buttons = [\n          this.createButtonMapping(mappingList, index + 1, { property: \"low\", allowClick: false }),\n          this.createButtonMapping(mappingList, index, { property: \"low\", allowClick: false }),\n          this.createButtonMapping(mappingList, index, { property: \"high\", allowClick: false }),\n          this.createButtonMapping(mappingList, index + 1, { property: \"high\", allowClick: false }),\n        ];\n        for (const button of buttons) {\n          button.classList.add(\"gamepadlib-axis-mapper\");\n          button.addEventListener(\"mapping-changed\", updateDropdownValue);\n          circleOverlay.appendChild(button);\n        }\n      }\n    };\n    updateOverlay();\n\n    selector.addEventListener(\"change\", () => {\n      if (selector.value === \"custom\") {\n        // If key mappings already exist, leave them as-is\n        if (mappingList[index].type !== \"key\") {\n          mappingList[index] = transformAndCopyMapping(defaultAxesMappings.arrows[0]);\n          mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.arrows[1]);\n        }\n      } else if (selector.value === \"arrows\") {\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.arrows[0]);\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.arrows[1]);\n      } else if (selector.value === \"wasd\") {\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.wasd[0]);\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.wasd[1]);\n      } else if (selector.value === \"cursor\") {\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.cursor[0]);\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.cursor[1]);\n      } else {\n        mappingList[index] = transformAndCopyMapping(emptyMapping());\n        mappingList[index + 1] = transformAndCopyMapping(emptyMapping());\n      }\n      updateOverlay();\n      this.changed();\n    });\n\n    return {\n      circleOverlay,\n      selector,\n    };\n  }\n\n  hasControllerSelected() {\n    return !!this.selector.value;\n  }\n\n  updateContent() {\n    removeAllChildren(this.content);\n\n    if (this.hidden) {\n      return;\n    }\n\n    const selectedId = this.selector.value;\n    if (!selectedId) {\n      const message = document.createElement(\"div\");\n      message.textContent = this.msg(\"no-controllers\");\n      this.content.appendChild(message);\n      return;\n    }\n\n    const gamepadData = this.gamepadLib.gamepads.get(selectedId);\n    if (!gamepadData) {\n      // Users should never be able to see this\n      const message = document.createElement(\"div\");\n      message.textContent = `Cannot find controller: ${selectedId}`;\n      this.content.appendChild(message);\n      return;\n    }\n\n    this.buttonIdToElement.clear();\n    this.axisIdToElement.clear();\n\n    const mappingsContainer = document.createElement(\"div\");\n    mappingsContainer.className = \"gamepadlib-content-buttons\";\n    const buttonMappings = gamepadData.buttonMappings;\n    for (let i = 0; i < buttonMappings.length; i++) {\n      const container = document.createElement(\"div\");\n      container.className = \"gamepadlib-mapping\";\n      container.dataset.id = i;\n      const label = document.createElement(\"label\");\n      label.className = \"gamepadlib-mapping-label\";\n      label.textContent = this.msg(\"button-n\", { n: i });\n      const id = buttonHtmlId(i);\n      label.htmlFor = id;\n      const options = document.createElement(\"div\");\n      options.className = \"gamepadlib-mapping-options\";\n      const mappingInput = this.createButtonMapping(buttonMappings, i);\n      mappingInput.id = id;\n      options.appendChild(mappingInput);\n      container.appendChild(label);\n      container.appendChild(options);\n      mappingsContainer.appendChild(container);\n      this.buttonIdToElement.set(i, container);\n    }\n\n    const axesContainer = document.createElement(\"div\");\n    axesContainer.className = \"gamepadlib-content-axes\";\n    const axesMappings = gamepadData.axesMappings;\n    for (let i = 0; i < axesMappings.length; i += 2) {\n      const container = document.createElement(\"div\");\n      container.className = \"gamepadlib-axis\";\n      const label = document.createElement(\"label\");\n      label.textContent = this.msg(\"axes-a-b\", { a: i, b: i + 1 });\n      label.htmlFor = axisHtmlId(i);\n      const circle = document.createElement(\"div\");\n      circle.className = \"gamepadlib-axis-circle\";\n      const { circleOverlay, selector } = this.createAxisMapping(axesMappings, i);\n      circle.appendChild(circleOverlay);\n      const dot = document.createElement(\"div\");\n      dot.className = \"gamepadlib-axis-dot\";\n      circle.appendChild(dot);\n      container.appendChild(label);\n      container.appendChild(circle);\n      container.appendChild(selector);\n      axesContainer.appendChild(container);\n      this.axisIdToElement.set(i, dot);\n    }\n\n    this.content.appendChild(mappingsContainer);\n    this.content.appendChild(axesContainer);\n  }\n\n  update(gamepads) {\n    if (this.hidden) {\n      return;\n    }\n    const selectedId = this.selector.value;\n    if (!selectedId) {\n      return;\n    }\n    const gamepad = Array.from(gamepads).find((i) => i && getGamepadId(i) === this.selector.value);\n    if (!gamepad) {\n      return;\n    }\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const element = this.buttonIdToElement.get(i);\n      if (element) {\n        const button = gamepad.buttons[i];\n        const value = button.value.toString();\n        if (value !== element.dataset.value) {\n          element.dataset.value = value;\n        }\n      }\n    }\n    for (let i = 0; i < gamepad.axes.length; i += 2) {\n      const element = this.axisIdToElement.get(i);\n      if (element) {\n        const x = gamepad.axes[i];\n        const y = gamepad.axes[i + 1] || 0;\n        const size = 150 / 2;\n        element.style.transform = `translate(-50%, -50%) translate(${x * size}px, ${y * size}px)`;\n      }\n    }\n  }\n\n  export() {\n    const selectedId = this.selector.value;\n    if (!selectedId) {\n      return null;\n    }\n    const gamepadData = this.gamepadLib.gamepads.get(selectedId);\n    if (!gamepadData) {\n      return null;\n    }\n    return {\n      axes: gamepadData.axesMappings.map(prepareAxisMappingForExport),\n      buttons: gamepadData.buttonMappings.map(prepareButtonMappingForExport),\n    };\n  }\n\n  changed() {\n    this.dispatchEvent(new CustomEvent(\"mapping-changed\"));\n  }\n\n  hide() {\n    this.hidden = true;\n    this.updateContent();\n  }\n\n  focus() {\n    if (this.selector.value) {\n      this.selector.focus();\n    }\n  }\n\n  generateEditor() {\n    this.hidden = false;\n    this.updateAllContent();\n    return this.root;\n  }\n}\n\nexport default GamepadLib;\n","/* inserted by pull.js */\nimport _twAsset0 from \"./active.png\";\nimport _twAsset1 from \"./close.svg\";\nimport _twAsset2 from \"./cursor.png\";\nimport _twAsset3 from \"./dot.svg\";\nimport _twAsset4 from \"./gamepad.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/active.png\") return _twAsset0;\n  if (path === \"/close.svg\") return _twAsset1;\n  if (path === \"/cursor.png\") return _twAsset2;\n  if (path === \"/dot.svg\") return _twAsset3;\n  if (path === \"/gamepad.svg\") return _twAsset4;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport GamepadLib from \"./gamepadlib.js\";\n\nexport default async function ({ addon, global, console, msg }) {\n  const vm = addon.tab.traps.vm;\n\n  // Wait for the project to finish loading. Renderer and scripts will not be fully available until this happens.\n  await new Promise((resolve) => {\n    if (vm.editingTarget) return resolve();\n    vm.runtime.once(\"PROJECT_LOADED\", resolve);\n  });\n\n  const vmStarted = () => vm.runtime._steppingInterval !== null;\n\n  const scratchKeyToKey = (key) => {\n    switch (key) {\n      case \"right arrow\":\n        return \"ArrowRight\";\n      case \"up arrow\":\n        return \"ArrowUp\";\n      case \"left arrow\":\n        return \"ArrowLeft\";\n      case \"down arrow\":\n        return \"ArrowDown\";\n      case \"enter\":\n        return \"Enter\";\n      case \"space\":\n        return \" \";\n    }\n    return key.toLowerCase().charAt(0);\n  };\n  const getKeysUsedByProject = () => {\n    const allBlocks = [vm.runtime.getTargetForStage(), ...vm.runtime.targets]\n      .filter((i) => i.isOriginal)\n      .map((i) => i.blocks);\n    const result = new Set();\n    for (const blocks of allBlocks) {\n      for (const block of Object.values(blocks._blocks)) {\n        if (block.opcode === \"event_whenkeypressed\" || block.opcode === \"sensing_keyoptions\") {\n          // For blocks like \"key (my variable) pressed?\", the sensing_keyoptions still exists but has a null parent.\n          if (block.opcode === \"sensing_keyoptions\" && !block.parent) {\n            continue;\n          }\n          const key = block.fields.KEY_OPTION.value;\n          result.add(scratchKeyToKey(key));\n        }\n      }\n    }\n    return result;\n  };\n\n  const GAMEPAD_CONFIG_MAGIC = \" // _gamepad_\";\n  const findOptionsComment = () => {\n    const target = vm.runtime.getTargetForStage();\n    const comments = target.comments;\n    for (const comment of Object.values(comments)) {\n      if (comment.text.includes(GAMEPAD_CONFIG_MAGIC)) {\n        return comment;\n      }\n    }\n    return null;\n  };\n  const parseOptionsComment = () => {\n    const comment = findOptionsComment();\n    if (!comment) {\n      return null;\n    }\n    const lineWithMagic = comment.text.split(\"\\n\").find((i) => i.endsWith(GAMEPAD_CONFIG_MAGIC));\n    if (!lineWithMagic) {\n      console.warn(\"Gamepad comment does not contain valid line\");\n      return null;\n    }\n    const jsonText = lineWithMagic.substr(0, lineWithMagic.length - GAMEPAD_CONFIG_MAGIC.length);\n    let parsed;\n    try {\n      parsed = JSON.parse(jsonText);\n      if (!parsed || typeof parsed !== \"object\" || !Array.isArray(parsed.buttons) || !Array.isArray(parsed.axes)) {\n        throw new Error(\"Invalid data\");\n      }\n    } catch (e) {\n      console.warn(\"Gamepad comment has invalid JSON\", e);\n      return null;\n    }\n    return parsed;\n  };\n\n  GamepadLib.setConsole(console);\n  const gamepad = new GamepadLib();\n\n  const parsedOptions = parseOptionsComment();\n  gamepad.getHintsLazily = () => {\n    if (parsedOptions) {\n      return {\n        importedSettings: parsedOptions,\n      };\n    }\n    return {\n      usedKeys: getKeysUsedByProject(),\n    };\n  };\n\n  if (addon.settings.get(\"hide\")) {\n    await new Promise((resolve) => {\n      const end = () => {\n        addon.settings.removeEventListener(\"change\", listener);\n        resolve();\n      };\n      const listener = () => {\n        if (!addon.settings.get(\"hide\")) {\n          end();\n        }\n      };\n      gamepad.gamepadConnected().then(end);\n      addon.settings.addEventListener(\"change\", listener);\n    });\n  }\n\n  const renderer = vm.runtime.renderer;\n  const width = renderer._xRight - renderer._xLeft;\n  const height = renderer._yTop - renderer._yBottom;\n  const canvas = renderer.canvas;\n\n  const container = document.createElement(\"div\");\n  container.className = \"sa-gamepad-container\";\n  addon.tab.displayNoneWhileDisabled(container, { display: \"flex\" });\n  const buttonContainer = document.createElement(\"span\");\n  buttonContainer.className = addon.tab.scratchClass(\"button_outlined-button\", \"stage-header_stage-button\");\n  const buttonContent = document.createElement(\"div\");\n  buttonContent.className = addon.tab.scratchClass(\"button_content\");\n  const buttonImage = document.createElement(\"img\");\n  buttonImage.className = addon.tab.scratchClass(\"stage-header_stage-button-icon\");\n  buttonImage.draggable = false;\n  buttonImage.src = _twGetAsset(\"/gamepad.svg\");\n  buttonContent.appendChild(buttonImage);\n  buttonContainer.appendChild(buttonContent);\n  container.appendChild(buttonContainer);\n\n  const spacer = document.createElement(\"div\");\n  spacer.className = \"sa-gamepad-spacer\";\n\n  let editor;\n  let shouldStoreSettingsInProject = false;\n  const didChangeProject = () => {\n    vm.runtime.emitProjectChanged();\n    if (vm.editingTarget === vm.runtime.getTargetForStage()) {\n      vm.emitWorkspaceUpdate();\n    }\n  };\n  const storeMappings = () => {\n    const exported = editor.export();\n    if (!exported) {\n      console.warn(\"Could not export gamepad settings\");\n      return;\n    }\n    const text = `${msg(\"config-header\")}\\n${JSON.stringify(exported)}${GAMEPAD_CONFIG_MAGIC}`;\n    const existingComment = findOptionsComment();\n    if (existingComment) {\n      existingComment.text = text;\n    } else {\n      const target = vm.runtime.getTargetForStage();\n      target.createComment(\n        // comment ID, just has to be a random string\n        Math.random() + \"\",\n        // block ID\n        null,\n        // text\n        text,\n        // x, y, width, height\n        50,\n        50,\n        350,\n        150,\n        // minimized\n        false\n      );\n    }\n    didChangeProject();\n  };\n  const removeMappings = () => {\n    const comment = findOptionsComment();\n    if (comment) {\n      const target = vm.runtime.getTargetForStage();\n      delete target.comments[comment.id];\n      didChangeProject();\n    }\n  };\n  const handleEditorChanged = () => {\n    if (shouldStoreSettingsInProject) {\n      storeMappings();\n    }\n  };\n  const handleStoreSettingsCheckboxChanged = (e) => {\n    shouldStoreSettingsInProject = !!e.target.checked;\n    if (shouldStoreSettingsInProject) {\n      storeMappings();\n    } else {\n      removeMappings();\n    }\n  };\n  const handleEditorControllerChanged = () => {\n    document.body.classList.toggle(\"sa-gamepad-has-controller\", editor.hasControllerSelected());\n    handleEditorChanged();\n  };\n  buttonContainer.addEventListener(\"click\", () => {\n    if (!editor) {\n      editor = gamepad.editor();\n      editor.msg = msg;\n      editor.addEventListener(\"mapping-changed\", handleEditorChanged);\n      editor.addEventListener(\"gamepad-changed\", handleEditorControllerChanged);\n    }\n    const editorEl = editor.generateEditor();\n    handleEditorControllerChanged();\n\n    const close = () => {\n      modalOverlay.remove();\n      document.body.removeEventListener(\"click\", handleClickOutside, true);\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      addon.self.removeEventListener(\"disabled\", close);\n      editor.hide();\n    };\n    const handleClickOutside = (e) => {\n      if (!modalContentContainer.contains(e.target)) {\n        close();\n      }\n    };\n    const handleKeyDown = (e) => {\n      if (e.key === \"Escape\" && !e.target.closest(\"[data-accepting-input]\")) {\n        close();\n      }\n    };\n    document.body.addEventListener(\"click\", handleClickOutside, true);\n    window.addEventListener(\"keydown\", handleKeyDown);\n    addon.self.addEventListener(\"disabled\", close);\n\n    const modalOverlay = document.createElement(\"div\");\n    modalOverlay.className = addon.tab.scratchClass(\"modal_modal-overlay\", { others: \"sa-gamepad-popup-outer\" });\n    const modalContentContainer = document.createElement(\"div\");\n    modalContentContainer.className = addon.tab.scratchClass(\"modal_modal-content\", { others: \"sa-gamepad-popup\" });\n\n    const modalHeaderContainer = document.createElement(\"div\");\n    modalHeaderContainer.className = addon.tab.scratchClass(\"modal_header\");\n    const modalHeaderText = document.createElement(\"div\");\n    modalHeaderText.className = addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-title\");\n    modalHeaderText.textContent = msg(\"settings\");\n    modalHeaderContainer.appendChild(modalHeaderText);\n\n    const closeContainer = document.createElement(\"div\");\n    closeContainer.className = addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-close\");\n    const closeButton = document.createElement(\"div\");\n    closeButton.className = addon.tab.scratchClass(\"close-button_close-button\", \"close-button_large\");\n    closeButton.tabIndex = \"0\";\n    closeButton.setAttribute(\"role\", \"button\");\n    const closeImage = document.createElement(\"img\");\n    closeImage.className = addon.tab.scratchClass(\"close-button_close-icon\");\n    closeImage.src = _twGetAsset(\"/close.svg\");\n    closeButton.appendChild(closeImage);\n    closeContainer.appendChild(closeButton);\n    modalHeaderContainer.appendChild(closeContainer);\n    closeButton.addEventListener(\"click\", close);\n\n    const modalContent = document.createElement(\"div\");\n    modalContent.className = \"sa-gamepad-popup-content\";\n    if (GamepadLib.browserHasBrokenGamepadAPI()) {\n      const warning = document.createElement(\"div\");\n      warning.textContent = msg(\"browser-support\");\n      warning.className = \"sa-gamepad-browser-support-warning\";\n      modalContent.appendChild(warning);\n    }\n    modalContent.appendChild(editorEl);\n\n    const storeSettingsLabel = document.createElement(\"label\");\n    storeSettingsLabel.className = \"sa-gamepad-store-settings\";\n    storeSettingsLabel.textContent = msg(\"store-in-project\");\n    const storeSettingsCheckbox = document.createElement(\"input\");\n    storeSettingsCheckbox.type = \"checkbox\";\n    storeSettingsCheckbox.checked = shouldStoreSettingsInProject;\n    storeSettingsCheckbox.addEventListener(\"change\", handleStoreSettingsCheckboxChanged);\n    storeSettingsLabel.prepend(storeSettingsCheckbox);\n    modalContent.appendChild(storeSettingsLabel);\n\n    modalContentContainer.appendChild(modalHeaderContainer);\n    modalContentContainer.appendChild(modalContent);\n    modalOverlay.appendChild(modalContentContainer);\n    document.body.appendChild(modalOverlay);\n\n    editor.focus();\n  });\n\n  if (addon.tab.redux.state && addon.tab.redux.state.scratchGui.stageSize.stageSize === \"small\") {\n    document.body.classList.add(\"sa-gamepad-small\");\n  }\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      if (e.target.closest(\"[class*='stage-header_stage-button-first']\")) {\n        document.body.classList.add(\"sa-gamepad-small\");\n      } else if (e.target.closest(\"[class*='stage-header_stage-button-last']\")) {\n        document.body.classList.remove(\"sa-gamepad-small\");\n      }\n    },\n    { capture: true }\n  );\n\n  const virtualCursorElement = document.createElement(\"img\");\n  virtualCursorElement.hidden = true;\n  virtualCursorElement.className = \"sa-gamepad-cursor\";\n  virtualCursorElement.src = _twGetAsset(\"/cursor.png\");\n  addon.self.addEventListener(\"disabled\", () => {\n    virtualCursorElement.hidden = true;\n  });\n\n  let hideCursorTimeout;\n\n  const hideRealCursor = () => {\n    document.body.classList.add(\"sa-gamepad-hide-cursor\");\n  };\n  const showRealCursor = () => {\n    document.body.classList.remove(\"sa-gamepad-hide-cursor\");\n  };\n  const virtualCursorSetVisible = (visible) => {\n    virtualCursorElement.hidden = !visible;\n    clearTimeout(hideCursorTimeout);\n    if (visible) {\n      hideRealCursor();\n      hideCursorTimeout = setTimeout(virtualCursorHide, 8000);\n    }\n  };\n  const virtualCursorHide = () => {\n    virtualCursorSetVisible(false);\n  };\n  const virtualCursorSetDown = (down) => {\n    virtualCursorSetVisible(true);\n    virtualCursorElement.classList.toggle(\"sa-gamepad-cursor-down\", down);\n  };\n  const virtualCursorSetPosition = (x, y) => {\n    virtualCursorSetVisible(true);\n    const CURSOR_SIZE = 6;\n    const stageX = width / 2 + x - CURSOR_SIZE / 2;\n    const stageY = height / 2 - y - CURSOR_SIZE / 2;\n    virtualCursorElement.style.transform = `translate(${stageX}px, ${stageY}px)`;\n  };\n\n  document.addEventListener(\"mousemove\", () => {\n    virtualCursorSetVisible(false);\n    showRealCursor();\n  });\n\n  let getCanvasSize;\n  // Support modern ResizeObserver and slow getBoundingClientRect version for improved browser support (matters for TurboWarp)\n  if (window.ResizeObserver) {\n    let canvasWidth = width;\n    let canvasHeight = height;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        canvasWidth = entry.contentRect.width;\n        canvasHeight = entry.contentRect.height;\n      }\n    });\n    resizeObserver.observe(canvas);\n    getCanvasSize = () => [canvasWidth, canvasHeight];\n  } else {\n    getCanvasSize = () => {\n      const rect = canvas.getBoundingClientRect();\n      return [rect.width, rect.height];\n    };\n  }\n\n  // Both in Scratch space\n  let virtualX = 0;\n  let virtualY = 0;\n  const postMouseData = (data) => {\n    if (addon.self.disabled || !vmStarted()) return;\n    const [rectWidth, rectHeight] = getCanvasSize();\n    vm.postIOData(\"mouse\", {\n      ...data,\n      canvasWidth: rectWidth,\n      canvasHeight: rectHeight,\n      x: (virtualX + width / 2) * (rectWidth / width),\n      y: (height / 2 - virtualY) * (rectHeight / height),\n    });\n  };\n  const postKeyboardData = (key, isDown) => {\n    if (addon.self.disabled || !vmStarted()) return;\n    vm.postIOData(\"keyboard\", {\n      key,\n      isDown,\n    });\n  };\n  const handleGamepadButtonDown = (e) => postKeyboardData(e.detail, true);\n  const handleGamepadButtonUp = (e) => postKeyboardData(e.detail, false);\n  const handleGamepadMouseDown = () => {\n    virtualCursorSetDown(true);\n    postMouseData({\n      isDown: true,\n    });\n  };\n  const handleGamepadMouseUp = () => {\n    virtualCursorSetDown(false);\n    postMouseData({\n      isDown: false,\n    });\n  };\n  const handleGamepadMouseMove = (e) => {\n    virtualX = e.detail.x;\n    virtualY = e.detail.y;\n    virtualCursorSetPosition(virtualX, virtualY);\n    postMouseData({});\n  };\n\n  gamepad.virtualCursor.maxX = renderer._xRight;\n  gamepad.virtualCursor.minX = renderer._xLeft;\n  gamepad.virtualCursor.maxY = renderer._yTop;\n  gamepad.virtualCursor.minY = renderer._yBottom;\n  gamepad.addEventListener(\"keydown\", handleGamepadButtonDown);\n  gamepad.addEventListener(\"keyup\", handleGamepadButtonUp);\n  gamepad.addEventListener(\"mousedown\", handleGamepadMouseDown);\n  gamepad.addEventListener(\"mouseup\", handleGamepadMouseUp);\n  gamepad.addEventListener(\"mousemove\", handleGamepadMouseMove);\n\n  while (true) {\n    const target = await addon.tab.waitForElement(\n      '[class^=\"stage-header_stage-size-row\"], [class^=\"stage-header_stage-menu-wrapper\"] > [class^=\"button_outlined-button\"]',\n      {\n        markAsSeen: true,\n        reduxEvents: [\n          \"scratch-gui/mode/SET_PLAYER\",\n          \"scratch-gui/mode/SET_FULL_SCREEN\",\n          \"fontsLoaded/SET_FONTS_LOADED\",\n          \"scratch-gui/locales/SELECT_LOCALE\",\n        ],\n      }\n    );\n    container.dataset.editorMode = addon.tab.editorMode;\n    if (target.className.includes(\"stage-size-row\")) {\n      target.insertBefore(container, target.firstChild);\n      spacer.remove();\n    } else {\n      spacer.appendChild(container);\n      target.parentElement.insertBefore(spacer, target);\n    }\n\n    const monitorListScaler = document.querySelector(\"[class^='monitor-list_monitor-list-scaler']\");\n    monitorListScaler.appendChild(virtualCursorElement);\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/0bf9d7356bf6bc4fb28a7e4e8338757a.svg\";","module.exports = __webpack_public_path__ + \"static/assets/b45bc220e004b6343d1a2e1abd9e313a.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./lock.svg\";\nimport _twAsset1 from \"./unlock.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/lock.svg\") return _twAsset0;\n  if (path === \"/unlock.svg\") return _twAsset1;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console }) {\n  let placeHolderDiv = null;\n  let lockDisplay = null;\n  let flyOut = null;\n  let scrollBar = null;\n  let toggle = true;\n  let selectedCategory = null;\n  let toggleSetting = addon.settings.get(\"toggle\");\n  let flyoutLock = false;\n\n  function getSpeedValue() {\n    let data = {\n      none: \"0\",\n      short: \"0.25\",\n      default: \"0.5\",\n      long: \"1\",\n    };\n    return data[addon.settings.get(\"speed\")];\n  }\n  function onmouseenter(speed = {}) {\n    speed = typeof speed === \"object\" ? getSpeedValue() : speed;\n    flyOut.classList.remove(\"sa-flyoutClose\");\n    flyOut.style.transitionDuration = `${speed}s`;\n    scrollBar.classList.remove(\"sa-flyoutClose\");\n    scrollBar.style.transitionDuration = `${speed}s`;\n    lockDisplay.classList.remove(\"sa-flyoutClose\");\n    lockDisplay.style.transitionDuration = `${speed}s`;\n    setTimeout(() => Blockly.getMainWorkspace().recordCachedAreas(), speed * 1000);\n  }\n  function onmouseleave(e, speed = getSpeedValue()) {\n    // If we go behind the flyout or the user has locked it, let's return\n    if ((toggleSetting !== \"cathover\" && e && e.clientX <= scrollBar.getBoundingClientRect().left) || flyoutLock)\n      return;\n    flyOut.classList.add(\"sa-flyoutClose\");\n    flyOut.style.transitionDuration = `${speed}s`;\n    scrollBar.classList.add(\"sa-flyoutClose\");\n    scrollBar.style.transitionDuration = `${speed}s`;\n    lockDisplay.classList.add(\"sa-flyoutClose\");\n    lockDisplay.style.transitionDuration = `${speed}s`;\n    setTimeout(() => Blockly.getMainWorkspace().recordCachedAreas(), speed * 1000);\n  }\n\n  let didOneTimeSetup = false;\n  function doOneTimeSetup() {\n    if (didOneTimeSetup) {\n      return;\n    }\n    didOneTimeSetup = true;\n    addon.tab.redux.initialize();\n    addon.tab.redux.addEventListener(\"statechanged\", (e) => {\n      switch (e.detail.action.type) {\n        // Event casted when you switch between tabs\n        case \"scratch-gui/navigation/ACTIVATE_TAB\":\n          // always 0, 1, 2\n          lockDisplay.style.display = e.detail.action.activeTabIndex === 0 ? \"block\" : \"none\";\n          placeHolderDiv.style.display = e.detail.action.activeTabIndex === 0 ? \"block\" : \"none\";\n          if (e.detail.action.activeTabIndex === 0) {\n            onmouseenter(0);\n            toggle = true;\n          }\n          break;\n        // Event casted when you switch between tabs\n        case \"scratch-gui/mode/SET_PLAYER\":\n          // always true or false\n          lockDisplay.style.display = e.detail.action.isPlayerOnly ? \"none\" : \"block\";\n          placeHolderDiv.style.display = e.detail.action.activeTabIndex === 0 ? \"block\" : \"none\";\n          break;\n      }\n    });\n    if (toggleSetting === \"category\" || toggleSetting === \"cathover\") {\n      (async () => {\n        while (true) {\n          let category = await addon.tab.waitForElement(\".scratchCategoryMenuItem\", {\n            markAsSeen: true,\n            condition: () => !addon.tab.redux.state.scratchGui.mode.isPlayerOnly,\n          });\n          category.onclick = () => {\n            if (toggle && selectedCategory === category && toggleSetting === \"category\") {\n              onmouseleave();\n              selectedCategory = category;\n            } else if (!toggle) {\n              onmouseenter();\n              selectedCategory = category;\n            } else {\n              selectedCategory = category;\n              return;\n            }\n            if (toggleSetting === \"category\") toggle = !toggle;\n          };\n          if (toggleSetting === \"cathover\") {\n            category.onmouseover = onmouseenter;\n            flyOut.onmouseleave = onmouseleave;\n          }\n        }\n      })();\n    }\n  }\n\n  while (true) {\n    flyOut = await addon.tab.waitForElement(\".blocklyFlyout\", {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n      reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\n    });\n    let blocklySvg = document.querySelector(\".blocklySvg\");\n    scrollBar = document.querySelector(\".blocklyFlyoutScrollbar\");\n    const tabs = document.querySelector('[class^=\"gui_tabs\"]');\n\n    // Placeholder Div\n    if (placeHolderDiv) placeHolderDiv.remove();\n    placeHolderDiv = document.createElement(\"div\");\n    if (toggleSetting === \"hover\") tabs.appendChild(placeHolderDiv);\n    placeHolderDiv.className = \"sa-flyout-placeHolder\";\n\n    // Lock Img\n    if (lockDisplay) lockDisplay.remove();\n    lockDisplay = document.createElement(\"img\");\n    lockDisplay.src = _twGetAsset(`/${flyoutLock ? \"\" : \"un\"}lock.svg`);\n    lockDisplay.className = \"sa-lock-image\";\n    lockDisplay.onclick = () => {\n      flyoutLock = !flyoutLock;\n      lockDisplay.src = _twGetAsset(`/${flyoutLock ? \"\" : \"un\"}lock.svg`);\n    };\n\n    // Only append if we don't have \"categoryclick\" on\n    if (toggleSetting === \"hover\") tabs.appendChild(lockDisplay);\n\n    if (toggleSetting === \"hover\") {\n      placeHolderDiv.onmouseenter = onmouseenter;\n      blocklySvg.onmouseenter = onmouseleave;\n    }\n\n    if (toggleSetting === \"cathover\") onmouseleave(null, 0);\n\n    doOneTimeSetup();\n  }\n}\n","export default async function ({ addon }) {\n  let vm = addon.tab.traps.vm;\n  let oldAddSprite = vm.constructor.prototype.addSprite;\n  vm.constructor.prototype.addSprite = function (input) {\n    let spriteObj,\n      stringify = true;\n    if (typeof input === \"object\") [spriteObj, stringify] = [input, false];\n    else spriteObj = JSON.parse(input);\n    let isEmpty = spriteObj.costumes?.[0]?.baseLayerMD5 === \"cd21514d0531fdffb22204e0ec5ed84a.svg\";\n    if (isEmpty || !spriteObj.tags || !addon.settings.get(\"library\")) {\n      if (spriteObj.scratchX) {\n        spriteObj.scratchX = addon.settings.get(\"x\");\n        spriteObj.scratchY = addon.settings.get(\"y\");\n      }\n      if (spriteObj.x) {\n        spriteObj.x = addon.settings.get(\"x\");\n        spriteObj.y = addon.settings.get(\"y\");\n      }\n    }\n    return oldAddSprite.call(this, stringify ? JSON.stringify(spriteObj) : spriteObj);\n  };\n}\n","export default async function ({ addon, global, console }) {\n  // IDs are taken from https://github.com/LLK/scratch-vm/blob/ffa78b91b8645b6a8c80f698a3637bb73abf2931/src/extension-support/extension-manager.js#L11\n  const Extensions = [\"music\", \"pen\", \"text2speech\", \"translate\"];\n  for (let ext of Extensions) {\n    // Check if setting enabled and it's not already loaded\n    if (addon.settings.get(ext) && !addon.tab.traps.vm.extensionManager.isExtensionLoaded(ext)) {\n      addon.tab.traps.vm.extensionManager.loadExtensionIdSync(ext);\n    }\n  }\n}\n","import downloadBlob from \"../../libraries/common/cs/download-blob.js\";\n\nexport default async ({ addon, console, msg }) => {\n  // Safari supports mp4 but not webm\n  const CHECK_TYPES = [\"video/webm\", \"video/mp4\"];\n  const supportedVideoType = CHECK_TYPES.find((i) => MediaRecorder.isTypeSupported(i));\n  if (!supportedVideoType) throw new Error(\"no video types supported\");\n\n  let recordElem;\n  let isRecording = false;\n  let isWaitingForFlag = false;\n  let waitingForFlagFunc = null;\n  let abortController = null;\n  let stopSignFunc = null;\n  let recordBuffer = [];\n  let recorder;\n  let timeout;\n  while (true) {\n    const elem = await addon.tab.waitForElement('div[class*=\"menu-bar_file-group\"] > div:last-child:not(.sa-record)', {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n    });\n    const getOptions = () => {\n      const recordOption = Object.assign(document.createElement(\"div\"), {\n        className: addon.tab.scratchClass(\"modal_modal-overlay\"),\n      });\n      const recordOptionPopup = Object.assign(document.createElement(\"div\"), {\n        className: addon.tab.scratchClass(\"modal_modal-content\", { others: \"mediaRecorderPopup\" }),\n        dir: addon.tab.direction,\n      });\n      const recordOptionHeader = Object.assign(document.createElement(\"div\"), {\n        className: addon.tab.scratchClass(\"modal_header\"),\n      });\n      recordOptionHeader.appendChild(\n        Object.assign(document.createElement(\"div\"), {\n          className: addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-title\"),\n          textContent: msg(\"option-title\"),\n        })\n      );\n      recordOptionPopup.appendChild(recordOptionHeader);\n      const recordOptionInner = Object.assign(document.createElement(\"div\"), {\n        className: \"mediaRecorderPopupContent\",\n      });\n\n      recordOptionInner.appendChild(\n        Object.assign(document.createElement(\"p\"), {\n          textContent:\n            supportedVideoType === \"video/webm\"\n              ? msg(\"record-description\")\n              : msg(\"record-description\").replace(\"WebM\", \"MP4\"),\n          className: \"recordOptionDescription\",\n        })\n      );\n\n      // Seconds\n      const recordOptionSeconds = document.createElement(\"p\");\n      const recordOptionSecondsInput = Object.assign(document.createElement(\"input\"), {\n        type: \"number\",\n        min: 1,\n        max: 300,\n        defaultValue: 30,\n        id: \"recordOptionSecondsInput\",\n        className: addon.tab.scratchClass(\"prompt_variable-name-text-input\"),\n      });\n      const recordOptionSecondsLabel = Object.assign(document.createElement(\"label\"), {\n        htmlFor: \"recordOptionSecondsInput\",\n        textContent: msg(\"record-duration\"),\n      });\n      recordOptionSeconds.appendChild(recordOptionSecondsLabel);\n      recordOptionSeconds.appendChild(recordOptionSecondsInput);\n      recordOptionInner.appendChild(recordOptionSeconds);\n\n      // Audio\n      const recordOptionAudio = document.createElement(\"p\");\n      const recordOptionAudioInput = Object.assign(document.createElement(\"input\"), {\n        type: \"checkbox\",\n        defaultChecked: true,\n        id: \"recordOptionAudioInput\",\n      });\n      const recordOptionAudioLabel = Object.assign(document.createElement(\"label\"), {\n        htmlFor: \"recordOptionAudioInput\",\n        textContent: msg(\"record-audio\"),\n        title: msg(\"record-audio-description\"),\n      });\n      recordOptionAudio.appendChild(recordOptionAudioInput);\n      recordOptionAudio.appendChild(recordOptionAudioLabel);\n      recordOptionInner.appendChild(recordOptionAudio);\n\n      // Mic\n      const recordOptionMic = document.createElement(\"p\");\n      const recordOptionMicInput = Object.assign(document.createElement(\"input\"), {\n        type: \"checkbox\",\n        defaultChecked: false,\n        id: \"recordOptionMicInput\",\n      });\n      const recordOptionMicLabel = Object.assign(document.createElement(\"label\"), {\n        htmlFor: \"recordOptionMicInput\",\n        textContent: msg(\"record-mic\"),\n      });\n      recordOptionMic.appendChild(recordOptionMicInput);\n      recordOptionMic.appendChild(recordOptionMicLabel);\n      recordOptionInner.appendChild(recordOptionMic);\n\n      // Green flag\n      const recordOptionFlag = document.createElement(\"p\");\n      const recordOptionFlagInput = Object.assign(document.createElement(\"input\"), {\n        type: \"checkbox\",\n        defaultChecked: true,\n        id: \"recordOptionFlagInput\",\n      });\n      const recordOptionFlagLabel = Object.assign(document.createElement(\"label\"), {\n        htmlFor: \"recordOptionFlagInput\",\n        textContent: msg(\"record-after-flag\"),\n      });\n      recordOptionFlag.appendChild(recordOptionFlagInput);\n      recordOptionFlag.appendChild(recordOptionFlagLabel);\n      recordOptionInner.appendChild(recordOptionFlag);\n\n      // Stop sign\n      const recordOptionStop = document.createElement(\"p\");\n      const recordOptionStopInput = Object.assign(document.createElement(\"input\"), {\n        type: \"checkbox\",\n        defaultChecked: true,\n        id: \"recordOptionStopInput\",\n      });\n      const recordOptionStopLabel = Object.assign(document.createElement(\"label\"), {\n        htmlFor: \"recordOptionStopInput\",\n        textContent: msg(\"record-until-stop\"),\n      });\n      recordOptionFlagInput.addEventListener(\"change\", () => {\n        const disabled = (recordOptionStopInput.disabled = !recordOptionFlagInput.checked);\n        if (disabled) {\n          recordOptionStopLabel.title = msg(\"record-until-stop-disabled\", {\n            afterFlagOption: msg(\"record-after-flag\"),\n          });\n        }\n      });\n      recordOptionStop.appendChild(recordOptionStopInput);\n      recordOptionStop.appendChild(recordOptionStopLabel);\n      recordOptionInner.appendChild(recordOptionStop);\n\n      let resolvePromise = null;\n      const optionPromise = new Promise((resolve) => {\n        resolvePromise = resolve;\n      });\n      let handleOptionClose = null;\n\n      const handleClickOutside = (e) => {\n        if (recordOptionPopup.contains(e.target)) return;\n        handleOptionClose(null);\n      };\n\n      document.body.addEventListener(\"click\", handleClickOutside, {\n        capture: true,\n      });\n\n      handleOptionClose = (value) => {\n        resolvePromise(value);\n        document.body.removeEventListener(\"click\", handleClickOutside, {\n          capture: true,\n        });\n        recordOption.remove();\n      };\n\n      const buttonRow = Object.assign(document.createElement(\"div\"), {\n        className: addon.tab.scratchClass(\"prompt_button-row\", { others: \"mediaRecorderPopupButtons\" }),\n      });\n      const cancelButton = Object.assign(document.createElement(\"button\"), {\n        textContent: msg(\"cancel\"),\n      });\n      cancelButton.addEventListener(\"click\", () => handleOptionClose(null), { once: true });\n      buttonRow.appendChild(cancelButton);\n      const startButton = Object.assign(document.createElement(\"button\"), {\n        textContent: msg(\"start\"),\n        className: addon.tab.scratchClass(\"prompt_ok-button\"),\n      });\n      startButton.addEventListener(\n        \"click\",\n        () =>\n          handleOptionClose({\n            secs: Number(recordOptionSecondsInput.value),\n            audioEnabled: recordOptionAudioInput.checked,\n            micEnabled: recordOptionMicInput.checked,\n            waitUntilFlag: recordOptionFlagInput.checked,\n            useStopSign: !recordOptionStopInput.disabled && recordOptionStopInput.checked,\n          }),\n        { once: true }\n      );\n      buttonRow.appendChild(startButton);\n      recordOptionInner.appendChild(buttonRow);\n\n      recordOptionPopup.appendChild(recordOptionInner);\n      recordOption.appendChild(recordOptionPopup);\n      document.body.appendChild(recordOption);\n\n      return optionPromise;\n    };\n    const disposeRecorder = () => {\n      isRecording = false;\n      recordElem.textContent = msg(\"record\");\n      recordElem.title = \"\";\n      recorder = null;\n      recordBuffer = [];\n      clearTimeout(timeout);\n      timeout = 0;\n      if (stopSignFunc) {\n        addon.tab.traps.vm.runtime.off(\"PROJECT_STOP_ALL\", stopSignFunc);\n        stopSignFunc = null;\n      }\n    };\n    const stopRecording = (force) => {\n      if (isWaitingForFlag) {\n        addon.tab.traps.vm.runtime.off(\"PROJECT_START\", waitingForFlagFunc);\n        isWaitingForFlag = false;\n        waitingForFlagFunc = null;\n        abortController.abort();\n        abortController = null;\n        disposeRecorder();\n        return;\n      }\n      if (!isRecording || !recorder || recorder.state === \"inactive\") return;\n      if (force) {\n        disposeRecorder();\n      } else {\n        recorder.onstop = () => {\n          const blob = new Blob(recordBuffer, { type: supportedVideoType });\n          downloadBlob(\"video.\" + supportedVideoType.split(\"/\")[1], blob);\n          disposeRecorder();\n        };\n        recorder.stop();\n      }\n    };\n    const startRecording = async (opts) => {\n      // Timer\n      const secs = Math.min(300, Math.max(1, opts.secs));\n\n      // Initialize MediaRecorder\n      recordBuffer = [];\n      isRecording = true;\n      const vm = addon.tab.traps.vm;\n      let micStream;\n      if (opts.micEnabled) {\n        // Show permission dialog before green flag is clicked\n        try {\n          micStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        } catch (e) {\n          if (e.name !== \"NotAllowedError\" && e.name !== \"NotFoundError\") throw e;\n          opts.micEnabled = false;\n        }\n      }\n      if (opts.waitUntilFlag) {\n        isWaitingForFlag = true;\n        Object.assign(recordElem, {\n          textContent: msg(\"click-flag\"),\n          title: msg(\"click-flag-description\"),\n        });\n        abortController = new AbortController();\n        try {\n          await Promise.race([\n            new Promise((resolve) => {\n              waitingForFlagFunc = () => resolve();\n              vm.runtime.once(\"PROJECT_START\", waitingForFlagFunc);\n            }),\n            new Promise((_, reject) => {\n              abortController.signal.addEventListener(\"abort\", () => reject(\"aborted\"), { once: true });\n            }),\n          ]);\n        } catch (e) {\n          if (e.message === \"aborted\") return;\n          throw e;\n        }\n      }\n      recordElem.textContent = msg(\"stop\");\n      isWaitingForFlag = false;\n      waitingForFlagFunc = abortController = null;\n      const stream = new MediaStream();\n      const videoStream = vm.runtime.renderer.canvas.captureStream();\n      stream.addTrack(videoStream.getVideoTracks()[0]);\n\n      const ctx = new (window.AudioContext || window.webkitAudioContext)();\n      const dest = ctx.createMediaStreamDestination();\n      if (opts.audioEnabled) {\n        const mediaStreamDestination = vm.runtime.audioEngine.audioContext.createMediaStreamDestination();\n        vm.runtime.audioEngine.inputNode.connect(mediaStreamDestination);\n        const audioSource = ctx.createMediaStreamSource(mediaStreamDestination.stream);\n        audioSource.connect(dest);\n      }\n      if (opts.micEnabled) {\n        const micSource = ctx.createMediaStreamSource(micStream);\n        micSource.connect(dest);\n      }\n      if (opts.audioEnabled || opts.micEnabled) {\n        stream.addTrack(dest.stream.getAudioTracks()[0]);\n      }\n      recorder = new MediaRecorder(stream, { mimeType: supportedVideoType });\n      recorder.ondataavailable = (e) => {\n        recordBuffer.push(e.data);\n      };\n      recorder.onerror = (e) => {\n        console.warn(\"Recorder error:\", e.error);\n        stopRecording(true);\n      };\n      timeout = setTimeout(() => stopRecording(false), secs * 1000);\n      if (opts.useStopSign) {\n        stopSignFunc = () => stopRecording();\n        vm.runtime.once(\"PROJECT_STOP_ALL\", stopSignFunc);\n      }\n      recorder.start(1000);\n    };\n    if (!recordElem) {\n      recordElem = Object.assign(document.createElement(\"div\"), {\n        className: \"sa-record \" + elem.className,\n        textContent: msg(\"record\"),\n      });\n      recordElem.addEventListener(\"click\", async () => {\n        if (isRecording) {\n          stopRecording();\n        } else {\n          const opts = await getOptions();\n          if (!opts) {\n            console.log(\"Canceled\");\n            return;\n          }\n          startRecording(opts);\n        }\n      });\n    }\n    elem.parentElement.appendChild(recordElem);\n  }\n};\n","export default async function ({ addon, global, console }) {\n  var posContainerContainer = document.createElement(\"div\");\n  addon.tab.displayNoneWhileDisabled(posContainerContainer, { display: \"flex\" });\n\n  var posContainer = document.createElement(\"div\");\n  var pos = document.createElement(\"span\");\n\n  posContainerContainer.className = \"pos-container-container\";\n  posContainer.className = \"pos-container\";\n\n  posContainerContainer.appendChild(posContainer);\n  posContainer.appendChild(pos);\n\n  const vm = addon.tab.traps.vm;\n\n  vm.runtime.ioDevices.mouse.__scratchX = vm.runtime.ioDevices.mouse._scratchX;\n  vm.runtime.ioDevices.mouse.__scratchY = vm.runtime.ioDevices.mouse._scratchY;\n\n  var x = vm.runtime.ioDevices.mouse.__scratchX ? vm.runtime.ioDevices.mouse.__scratchX : 0;\n  var y = vm.runtime.ioDevices.mouse.__scratchY ? vm.runtime.ioDevices.mouse.__scratchY : 0;\n\n  const showUpdatedValue = () => pos.setAttribute(\"data-content\", `${x}, ${y}`);\n\n  Object.defineProperty(vm.runtime.ioDevices.mouse, \"_scratchX\", {\n    get: function () {\n      return this.__scratchX;\n    },\n    set: function (setx) {\n      x = setx;\n      showUpdatedValue();\n      this.__scratchX = setx;\n    },\n  });\n\n  Object.defineProperty(vm.runtime.ioDevices.mouse, \"_scratchY\", {\n    get: function () {\n      return this.__scratchY;\n    },\n    set: function (sety) {\n      y = sety;\n      showUpdatedValue();\n      this.__scratchY = sety;\n    },\n  });\n\n  if (addon.tab.redux.state && addon.tab.redux.state.scratchGui.stageSize.stageSize === \"small\") {\n    document.body.classList.add(\"sa-mouse-pos-small\");\n  }\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      if (e.target.closest(\"[class*='stage-header_stage-button-first']\")) {\n        document.body.classList.add(\"sa-mouse-pos-small\");\n      } else if (e.target.closest(\"[class*='stage-header_stage-button-last']\")) {\n        document.body.classList.remove(\"sa-mouse-pos-small\");\n      }\n    },\n    { capture: true }\n  );\n\n  while (true) {\n    let bar = await addon.tab.waitForElement('[class*=\"controls_controls-container\"]', {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n    });\n\n    if (addon.tab.editorMode === \"editor\") {\n      bar.appendChild(posContainerContainer);\n    }\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/ae4b22decf2fde68ad23fd36c48c455e.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./icon--mute.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/icon--mute.svg\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console }) {\n  const vm = addon.tab.traps.vm;\n  let muted = false;\n  let icon = document.createElement(\"img\");\n  icon.loading = \"lazy\";\n  icon.src = _twGetAsset(\"/icon--mute.svg\");\n  icon.style.display = \"none\";\n  const toggleMute = (e) => {\n    if (e.ctrlKey) {\n      e.cancelBubble = true;\n      e.preventDefault();\n      if (e.type === \"contextmenu\" && window.safari) {\n        return;\n      }\n      muted = !muted;\n      if (muted) {\n        vm.runtime.audioEngine.inputNode.gain.value = 0;\n        icon.style.display = \"block\";\n      } else {\n        vm.runtime.audioEngine.inputNode.gain.value = 1;\n        icon.style.display = \"none\";\n      }\n    }\n  };\n  while (true) {\n    let button = await addon.tab.waitForElement(\"[class^='green-flag_green-flag']\", {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n    });\n    let container = button.parentElement;\n    container.appendChild(icon);\n    button.addEventListener(\"click\", toggleMute);\n    button.addEventListener(\"contextmenu\", toggleMute);\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/assets/d1b20b63da0e8727a5af2aa5768c0b1a.svg\";","module.exports = __webpack_public_path__ + \"static/assets/05259a52e79f7f0a1bad7bef71d3bbbb.svg\";","module.exports = __webpack_public_path__ + \"static/assets/845fea9bdf5fa6c5de3934d64db8adba.svg\";","module.exports = __webpack_public_path__ + \"static/assets/8b63eff046ba87acfd02c86e631a2d6d.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./decrement.svg\";\nimport _twAsset1 from \"./increment.svg\";\nimport _twAsset2 from \"./settings.svg\";\nimport _twAsset3 from \"./toggle.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/decrement.svg\") return _twAsset0;\n  if (path === \"/increment.svg\") return _twAsset1;\n  if (path === \"/settings.svg\") return _twAsset2;\n  if (path === \"/toggle.svg\") return _twAsset3;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console, msg }) {\n  let paper = null;\n  let paperCenter;\n  const storedOnionLayers = [];\n\n  const parseHexColor = (color) => {\n    const hexString = color.substr(1);\n    const hexNumber = parseInt(hexString, 16);\n    return [\n      (hexNumber >> 16) & 0xff, // R\n      (hexNumber >> 8) & 0xff, // G\n      hexNumber & 0xff, // B\n    ];\n  };\n\n  const settings = {\n    enabled: addon.settings.get(\"default\"),\n    previous: +addon.settings.get(\"previous\"),\n    next: +addon.settings.get(\"next\"),\n    opacity: +addon.settings.get(\"opacity\"),\n    opacityStep: +addon.settings.get(\"opacityStep\"),\n    layering: addon.settings.get(\"layering\"),\n    mode: addon.settings.get(\"mode\"),\n    beforeTint: parseHexColor(addon.settings.get(\"beforeTint\")),\n    afterTint: parseHexColor(addon.settings.get(\"afterTint\")),\n  };\n\n  const getProject = () => paper && paper.project;\n\n  const foundPaper = (_paper) => {\n    paper = _paper;\n\n    const backgroundGuideLayer = paper.project.layers.find((i) => i.data.isBackgroundGuideLayer);\n    paperCenter = backgroundGuideLayer.children[0].position;\n\n    // When background guide layer is added, show onion layers.\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/layer.js#L145\n    const originalAddLayer = paper.Project.prototype.addLayer;\n    paper.Project.prototype.addLayer = function (layer) {\n      const result = originalAddLayer.call(this, layer);\n      if (layer.data.isBackgroundGuideLayer) {\n        let onion;\n        while ((onion = storedOnionLayers.shift())) {\n          originalAddLayer.call(this, onion);\n        }\n        relayerOnionLayers();\n      }\n      return result;\n    };\n\n    // Scratch uses importJSON to undo or redo\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/undo.js#L37\n    // The code prior to this will remove our onion layers, so we have to manually add them back.\n    const originalImportJSON = paper.Project.prototype.importJSON;\n    paper.Project.prototype.importJSON = function (json) {\n      const result = originalImportJSON.call(this, json);\n      if (settings.enabled) {\n        updateOnionLayers();\n      }\n      return result;\n    };\n\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/layer.js#L114\n    // When background guide layer is removed, hide onion layers.\n    const originalRemoveLayer = paper.Layer.prototype.remove;\n    paper.Layer.prototype.remove = function () {\n      if (this.data.isBackgroundGuideLayer) {\n        for (const layer of paper.project.layers) {\n          if (layer.data.sa_isOnionLayer) {\n            storedOnionLayers.push(layer);\n          }\n        }\n        for (const layer of storedOnionLayers) {\n          layer.remove();\n        }\n      }\n      return originalRemoveLayer.call(this);\n    };\n  };\n\n  const foundPaperCanvas = (paperCanvas) => {\n    let expectingImport = false;\n\n    const PaperCanvas = paperCanvas.constructor;\n\n    // importImage is called to start loading an image.\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L124\n    const originalImportImage = PaperCanvas.prototype.importImage;\n    PaperCanvas.prototype.importImage = function (...args) {\n      expectingImport = true;\n      removeOnionLayers();\n      return originalImportImage.call(this, ...args);\n    };\n\n    // recalibrateSize is called when the canvas finishes loading an image.\n    // all paths of importImage will result in a call to this method.\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L310-L327\n    // We use this to know when to add layers.\n    const originalRecalibrateSize = PaperCanvas.prototype.recalibrateSize;\n    PaperCanvas.prototype.recalibrateSize = function (callback) {\n      return originalRecalibrateSize.call(this, () => {\n        if (callback) callback();\n        if (expectingImport) {\n          expectingImport = false;\n          if (settings.enabled) {\n            updateOnionLayers();\n          }\n        }\n      });\n    };\n\n    // Prototype overrides will work for all future instances, but Scratch manually binds some methods to `this`\n    // so we have to manually copy them for the current instance (but not future instances)\n    paperCanvas.recalibrateSize = PaperCanvas.prototype.recalibrateSize.bind(paperCanvas);\n    paperCanvas.importImage = PaperCanvas.prototype.importImage.bind(paperCanvas);\n  };\n\n  const createCanvas = (width, height) => {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    canvas.getContext(\"2d\").imageSmoothingEnabled = false;\n    return canvas;\n  };\n\n  const createOnionLayer = () => {\n    const layer = new paper.Layer();\n    layer.locked = true;\n    layer.guide = true;\n    layer.data.sa_isOnionLayer = true;\n    return layer;\n  };\n\n  const removeOnionLayers = () => {\n    const project = getProject();\n    if (!project) {\n      return;\n    }\n\n    storedOnionLayers.length = 0;\n    const layers = project.layers;\n    // Iterate downward because we remove items mid-iteration\n    for (let i = layers.length - 1; i >= 0; i--) {\n      const layer = layers[i];\n      if (layer.data.sa_isOnionLayer) {\n        layer.remove();\n      }\n    }\n  };\n\n  const relayerOnionLayers = () => {\n    const project = getProject();\n    if (!project) {\n      return;\n    }\n    const onions = [];\n    for (const layer of project.layers) {\n      if (layer.data.sa_isOnionLayer) {\n        onions.push(layer);\n      }\n    }\n    onions.sort((a, b) => a.data.sa_onionIndex - b.data.sa_onionIndex);\n    if (settings.layering === \"front\") {\n      for (const layer of onions) {\n        project.addLayer(layer);\n      }\n    } else {\n      const rasterLayer = project.layers.find((i) => i.data.isRasterLayer);\n      if (rasterLayer.index === 0) {\n        for (const layer of onions) {\n          project.insertLayer(0, layer);\n        }\n      } else {\n        for (const layer of onions) {\n          project.insertLayer(1, layer);\n        }\n      }\n    }\n  };\n\n  const recursePaperItem = (item, callback) => {\n    if (item.children) {\n      for (const child of item.children) {\n        recursePaperItem(child, callback);\n      }\n    }\n    callback(item);\n  };\n\n  const getTint = (red, green, blue, isBefore) => {\n    const referenceColor = isBefore ? settings.beforeTint : settings.afterTint;\n    const colorAverage = (red + green + blue) / 3 / 255;\n    const WEIGHT = 1.5;\n    const weighted = colorAverage / WEIGHT + (1 - 1 / WEIGHT);\n    return [referenceColor[0] * weighted, referenceColor[1] * weighted, referenceColor[2] * weighted];\n  };\n\n  const toHexColor = ([red, green, blue]) => {\n    const r = Math.round(red).toString(16).padStart(2, \"0\");\n    const g = Math.round(green).toString(16).padStart(2, \"0\");\n    const b = Math.round(blue).toString(16).padStart(2, \"0\");\n    return `#${r}${g}${b}`;\n  };\n\n  const getPaperColorTint = (color, isBefore) =>\n    toHexColor(getTint(color.red * 255, color.green * 255, color.blue * 255, isBefore));\n\n  const tintRaster = (raster, isBefore) => {\n    const { width, height } = raster.canvas;\n    const context = raster.context;\n    // TODO: check to see if this is a performance issue\n    const imageData = context.getImageData(0, 0, width, height);\n    const data = imageData.data;\n    for (let i = 0; i < data.length; i += 4 /* RGBA */) {\n      const red = data[i + 0];\n      const green = data[i + 1];\n      const blue = data[i + 2];\n      const alpha = data[i + 3];\n      if (alpha === 0) {\n        continue;\n      }\n      const [newRed, newGreen, newBlue] = getTint(red, green, blue, isBefore);\n      data[i + 0] = newRed;\n      data[i + 1] = newGreen;\n      data[i + 2] = newBlue;\n    }\n    context.putImageData(imageData, 0, 0);\n  };\n\n  const makeVectorLayer = (layer, costume, asset, isBefore) =>\n    new Promise((resolve, reject) => {\n      const { rotationCenterX, rotationCenterY } = costume;\n      // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L196-L218\n      asset = asset.split(/<\\s*svg:/).join(\"<\");\n      asset = asset.split(/<\\/\\s*svg:/).join(\"</\");\n      const svgAttrs = asset.match(/<svg [^>]*>/);\n      if (svgAttrs && svgAttrs[0].indexOf(\"xmlns=\") === -1) {\n        asset = asset.replace(\"<svg \", '<svg xmlns=\"http://www.w3.org/2000/svg\" ');\n      }\n      const parser = new DOMParser();\n      const svgDom = parser.parseFromString(asset, \"text/xml\");\n      const viewBox = svgDom.documentElement.attributes.viewBox\n        ? svgDom.documentElement.attributes.viewBox.value.match(/\\S+/g)\n        : null;\n      if (viewBox) {\n        for (let i = 0; i < viewBox.length; i++) {\n          viewBox[i] = parseFloat(viewBox[i]);\n        }\n      }\n\n      getProject().importSVG(asset, {\n        expandShapes: true,\n        onLoad: (root) => {\n          if (!root) {\n            reject(new Error(\"could not load onion skin\"));\n            return;\n          }\n\n          root.remove();\n\n          // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L274-L275\n          recursePaperItem(root, (i) => {\n            if (i.className === \"PathItem\") {\n              i.clockwise = true;\n            }\n            if (i.className !== \"PointText\" && !i.children) {\n              if (i.strokeWidth) {\n                i.strokeWidth = i.strokeWidth * 2;\n              }\n            }\n            i.locked = true;\n            i.guide = true;\n          });\n          root.scale(2, new paper.Point(0, 0));\n\n          if (settings.mode === \"tint\") {\n            const gradients = new Set();\n            recursePaperItem(root, (i) => {\n              if (i.strokeColor) {\n                i.strokeColor = getPaperColorTint(i.strokeColor, isBefore);\n              }\n              if (i.fillColor) {\n                const gradient = i.fillColor.gradient;\n                if (gradient) {\n                  if (gradients.has(gradient)) return;\n                  gradients.add(gradient);\n                  for (const stop of gradient.stops) {\n                    stop.color = getPaperColorTint(stop.color, isBefore);\n                  }\n                } else {\n                  i.fillColor = getPaperColorTint(i.fillColor, isBefore);\n                }\n              }\n              if (i.canvas) {\n                tintRaster(i, isBefore);\n              }\n            });\n          }\n\n          // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L277-L287\n          if (typeof rotationCenterX !== \"undefined\" && typeof rotationCenterY !== \"undefined\") {\n            let rotationPoint = new paper.Point(rotationCenterX, rotationCenterY);\n            if (viewBox && viewBox.length >= 2 && !isNaN(viewBox[0]) && !isNaN(viewBox[1])) {\n              rotationPoint = rotationPoint.subtract(viewBox[0], viewBox[1]);\n            }\n            root.translate(paperCenter.subtract(rotationPoint.multiply(2)));\n          } else {\n            root.translate(paperCenter.subtract(root.bounds.width, root.bounds.height));\n          }\n\n          layer.addChild(root);\n          resolve();\n        },\n      });\n    });\n\n  const makeRasterLayer = (layer, costume, asset, isBefore) =>\n    new Promise((resolve, reject) => {\n      let { rotationCenterX, rotationCenterY } = costume;\n\n      const image = new Image();\n      image.onload = () => {\n        const width = Math.min(paperCenter.x * 2, image.width);\n        const height = Math.min(paperCenter.y * 2, image.height);\n\n        // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L151-L156\n        if (typeof rotationCenterX === \"undefined\") {\n          rotationCenterX = width / 2;\n        }\n        if (typeof rotationCenterY === \"undefined\") {\n          rotationCenterY = height / 2;\n        }\n\n        const raster = new paper.Raster(createCanvas(width, height));\n        raster.parent = layer;\n        raster.guide = true;\n        raster.locked = true;\n        const x = width / 2 + (paperCenter.x - rotationCenterX);\n        const y = height / 2 + (paperCenter.y - rotationCenterY);\n        raster.position = new paper.Point(x, y);\n\n        raster.drawImage(image, 0, 0);\n\n        if (settings.mode === \"tint\") {\n          tintRaster(raster, isBefore);\n        }\n\n        resolve();\n      };\n      image.onerror = () => {\n        reject(new Error(\"could not load image\"));\n      };\n      image.src = asset;\n    });\n\n  const getSelectedCostumeIndex = () => {\n    const item = document.querySelector(\"[class*='selector_list-item'][class*='sprite-selector-item_is-selected']\");\n    if (!item) return -1;\n    const numberEl = item.querySelector(\"[class*='sprite-selector-item_number']\");\n    if (!numberEl) return -1;\n    return +numberEl.textContent - 1;\n  };\n\n  const updateOnionLayers = async () => {\n    const project = getProject();\n    if (!project) {\n      return;\n    }\n\n    const selectedCostumeIndex = getSelectedCostumeIndex();\n    if (selectedCostumeIndex === -1) {\n      return;\n    }\n\n    removeOnionLayers();\n\n    const vm = addon.tab.traps.vm;\n    if (!vm) {\n      return;\n    }\n    const activeLayer = project.activeLayer;\n    const costumes = vm.editingTarget.sprite.costumes;\n\n    const startIndex = Math.max(0, selectedCostumeIndex - settings.previous);\n    const endIndex = Math.min(costumes.length - 1, selectedCostumeIndex + settings.next);\n\n    try {\n      for (let i = startIndex; i <= endIndex; i++) {\n        if (i === selectedCostumeIndex) {\n          continue;\n        }\n\n        const isBefore = i < selectedCostumeIndex;\n        const distance = Math.abs(i - selectedCostumeIndex) - 1;\n        const opacity = settings.opacity - settings.opacityStep * distance;\n\n        if (opacity <= 0) {\n          continue;\n        }\n\n        const layer = createOnionLayer();\n        layer.data.sa_onionIndex = i;\n        layer.opacity = opacity / 100;\n        relayerOnionLayers();\n\n        // Important: Make sure that we do not change the active layer of the editor as doing so can cause corruption.\n        activeLayer.activate();\n\n        const onionCostume = costumes[i];\n        const onionAsset = vm.getCostume(i);\n\n        if (onionCostume.dataFormat === \"svg\") {\n          await makeVectorLayer(layer, onionCostume, onionAsset, isBefore);\n        } else if (onionCostume.dataFormat === \"png\" || onionCostume.dataFormat === \"jpg\") {\n          await makeRasterLayer(layer, onionCostume, onionAsset, isBefore);\n        } else {\n          throw new Error(`Unknown data format: ${onionCostume.dataFormat}`);\n        }\n      }\n    } catch (e) {\n      console.error(e);\n    }\n\n    // Important: Regardless of any errors, we need to make sure the original active layer is still active.\n    activeLayer.activate();\n  };\n\n  const setEnabled = (_enabled) => {\n    if (settings.enabled === _enabled) {\n      return;\n    }\n    settings.enabled = _enabled;\n    if (settings.enabled) {\n      if (settings.next === 0 && settings.previous === 0) {\n        settings.previous = 1;\n        layerInputs.previous.value = settings.previous;\n      }\n      if (settings.opacity === 0) {\n        settings.opacity = 25;\n        layerInputs.opacity.value = settings.opacity;\n      }\n      updateOnionLayers();\n    } else {\n      removeOnionLayers();\n    }\n    toggleButton.dataset.enabled = settings.enabled;\n  };\n\n  const untilInEditor = () => {\n    if (addon.tab.editorMode !== \"editor\") {\n      return new Promise((resolve, reject) => {\n        const handler = () => {\n          if (addon.tab.editorMode === \"editor\") {\n            resolve();\n            addon.tab.removeEventListener(\"urlChange\", handler);\n          }\n        };\n        addon.tab.addEventListener(\"urlChange\", handler);\n      });\n    }\n  };\n\n  const accessScratchInternals = () => {\n    if (paper) {\n      return;\n    }\n\n    const REACT_INTERNAL_PREFIX = \"__reactInternalInstance$\";\n\n    // We can access paper through .tool on tools, for example:\n    // https://github.com/LLK/scratch-paint/blob/develop/src/containers/bit-brush-mode.jsx#L60-L62\n    // It happens that paper's Tool objects contain a reference to the entirety of paper's scope.\n    const modeSelector = document.querySelector(\"[class*='paint-editor_mode-selector']\");\n    const reactInternalKey = Object.keys(modeSelector).find((i) => i.startsWith(REACT_INTERNAL_PREFIX));\n    const internalState = modeSelector[reactInternalKey].child;\n\n    // .tool only exists on the selected tool\n    let toolState = internalState;\n    let tool;\n    while (!(tool = toolState.child.stateNode.tool)) {\n      toolState = toolState.sibling;\n    }\n    const paperScope = tool._scope;\n\n    const paintEditorCanvasContainer = document.querySelector(\"[class^='paint-editor_canvas-container']\");\n    const paperCanvas = paintEditorCanvasContainer[reactInternalKey].child.child.child.stateNode;\n\n    if (paperScope && paperCanvas) {\n      foundPaper(paperScope);\n      foundPaperCanvas(paperCanvas);\n    }\n  };\n\n  const settingsChanged = (onlyRelayerNeeded) => {\n    if ((settings.previous === 0 && settings.next === 0) || settings.opacity === 0) {\n      setEnabled(false);\n      return;\n    }\n    if (settings.enabled) {\n      if (onlyRelayerNeeded) {\n        relayerOnionLayers();\n      } else {\n        updateOnionLayers();\n      }\n    } else if (settings.previous > 0 || settings.next > 0) {\n      setEnabled(true);\n    }\n  };\n\n  const createGroup = () => {\n    const el = document.createElement(\"div\");\n    el.className = \"sa-onion-group\";\n    return el;\n  };\n\n  const createButton = () => {\n    const el = document.createElement(\"span\");\n    el.className = \"sa-onion-button\";\n    el.setAttribute(\"role\", \"button\");\n    return el;\n  };\n\n  const createButtonImage = (name) => {\n    const el = document.createElement(\"img\");\n    el.className = \"sa-onion-image\";\n    el.draggable = false;\n    el.dataset.image = name;\n    el.loading = \"lazy\";\n    el.src = _twGetAsset(\"/\" + name + \".svg\");\n    return el;\n  };\n\n  //\n  // Controls below editor\n  //\n\n  const paintEditorControlsContainer = document.createElement(\"div\");\n  paintEditorControlsContainer.className = \"sa-onion-controls-container\";\n  paintEditorControlsContainer.dir = \"\";\n\n  const toggleControlsGroup = createGroup();\n\n  const toggleButton = createButton();\n  toggleButton.dataset.enabled = settings.enabled;\n  toggleButton.addEventListener(\"click\", () => setEnabled(!settings.enabled));\n  toggleButton.title = msg(\"toggle\");\n  toggleButton.appendChild(createButtonImage(\"toggle\"));\n  toggleControlsGroup.appendChild(toggleButton);\n\n  const settingButton = createButton();\n  settingButton.addEventListener(\"click\", () => setSettingsOpen(!areSettingsOpen()));\n  settingButton.title = msg(\"settings\");\n  settingButton.appendChild(createButtonImage(\"settings\"));\n  toggleControlsGroup.appendChild(settingButton);\n\n  paintEditorControlsContainer.appendChild(toggleControlsGroup);\n\n  //\n  // Settings page\n  //\n\n  const settingsPage = document.createElement(\"div\");\n  settingsPage.className = \"sa-onion-settings\";\n\n  const setSettingsOpen = (open) => {\n    settingButton.dataset.enabled = open;\n    settingsPage.dataset.visible = open;\n  };\n  const areSettingsOpen = () => settingsPage.dataset.visible === \"true\";\n\n  const layerInputs = {};\n  for (const type of [\"previous\", \"next\", \"opacity\", \"opacityStep\"]) {\n    const container = document.createElement(\"div\");\n    container.className = \"sa-onion-settings-line\";\n\n    const label = document.createElement(\"div\");\n    label.className = \"sa-onion-settings-label\";\n    label.textContent = msg(type);\n    container.appendChild(label);\n\n    const group = createGroup();\n    const currentButton = createButton();\n\n    const filler = document.createElement(\"div\");\n    filler.style.width = \"20px\";\n    currentButton.appendChild(filler);\n\n    const currentInput = document.createElement(\"input\");\n    layerInputs[type] = currentInput;\n    currentInput.className = \"sa-onion-settings-input\";\n    currentInput.type = \"number\";\n    currentInput.step = \"1\";\n    currentInput.min = \"0\";\n    currentInput.max = \"100\";\n    currentInput.value = settings[type];\n    currentInput.addEventListener(\"input\", (e) => {\n      if (currentInput.value.length === 0) {\n        settings[type] = 0;\n        settingsChanged();\n        return;\n      }\n      let value = +currentInput.value;\n      if (value > +currentInput.max) {\n        value = +currentInput.max;\n      } else if (value < 0) {\n        value = 0;\n      }\n      currentInput.value = value;\n      settings[type] = value;\n      settingsChanged();\n    });\n    currentInput.addEventListener(\"blur\", () => {\n      if (!currentInput.value) {\n        currentInput.value = \"0\";\n      }\n    });\n    currentButton.appendChild(currentInput);\n\n    const decrementButton = createButton();\n    decrementButton.appendChild(createButtonImage(\"decrement\"));\n    decrementButton.addEventListener(\"click\", () => {\n      if (settings[type] > 0) {\n        settings[type]--;\n        currentInput.value = settings[type];\n        settingsChanged();\n      }\n    });\n\n    const incrementButton = createButton();\n    incrementButton.appendChild(createButtonImage(\"increment\"));\n    incrementButton.addEventListener(\"click\", () => {\n      if (settings[type] < +currentInput.max) {\n        settings[type]++;\n        currentInput.value = settings[type];\n        settingsChanged();\n      }\n    });\n\n    group.appendChild(decrementButton);\n    group.appendChild(currentButton);\n    group.appendChild(incrementButton);\n    container.appendChild(group);\n    settingsPage.appendChild(container);\n  }\n\n  const modeContainer = document.createElement(\"div\");\n  modeContainer.className = \"sa-onion-settings-line\";\n  const modeLabel = document.createElement(\"div\");\n  modeLabel.className = \"sa-onion-settings-label\";\n  modeLabel.textContent = msg(\"mode\");\n  const modeGroup = createGroup();\n  modeContainer.appendChild(modeLabel);\n  const modeMergeButton = createButton();\n  modeMergeButton.appendChild(document.createTextNode(msg(\"merge\")));\n  modeGroup.appendChild(modeMergeButton);\n  modeMergeButton.addEventListener(\"click\", (e) => {\n    settings.mode = \"merge\";\n    modeTintButton.dataset.enabled = false;\n    modeMergeButton.dataset.enabled = true;\n    settingsChanged();\n  });\n  modeMergeButton.dataset.enabled = settings.mode === \"merge\";\n  const modeTintButton = createButton();\n  modeTintButton.appendChild(document.createTextNode(msg(\"tint\")));\n  modeGroup.appendChild(modeTintButton);\n  modeTintButton.addEventListener(\"click\", (e) => {\n    settings.mode = \"tint\";\n    modeTintButton.dataset.enabled = true;\n    modeMergeButton.dataset.enabled = false;\n    settingsChanged();\n  });\n  modeTintButton.dataset.enabled = settings.mode === \"tint\";\n  modeContainer.appendChild(modeGroup);\n  settingsPage.appendChild(modeContainer);\n\n  const layeringContainer = document.createElement(\"div\");\n  layeringContainer.className = \"sa-onion-settings-line\";\n  const layeringLabel = document.createElement(\"div\");\n  layeringLabel.className = \"sa-onion-settings-label\";\n  layeringLabel.textContent = msg(\"layering\");\n  const layeringGroup = createGroup();\n  layeringContainer.appendChild(layeringLabel);\n  const layeringFrontButton = createButton();\n  layeringFrontButton.appendChild(document.createTextNode(msg(\"front\")));\n  layeringGroup.appendChild(layeringFrontButton);\n  layeringFrontButton.addEventListener(\"click\", (e) => {\n    settings.layering = \"front\";\n    layeringBehindButton.dataset.enabled = false;\n    layeringFrontButton.dataset.enabled = true;\n    settingsChanged(true);\n  });\n  layeringFrontButton.dataset.enabled = settings.layering === \"front\";\n  const layeringBehindButton = createButton();\n  layeringBehindButton.appendChild(document.createTextNode(msg(\"behind\")));\n  layeringGroup.appendChild(layeringBehindButton);\n  layeringBehindButton.addEventListener(\"click\", (e) => {\n    settings.layering = \"behind\";\n    layeringBehindButton.dataset.enabled = true;\n    layeringFrontButton.dataset.enabled = false;\n    settingsChanged(true);\n  });\n  layeringBehindButton.dataset.enabled = settings.layering === \"behind\";\n  layeringContainer.appendChild(layeringGroup);\n  settingsPage.appendChild(layeringContainer);\n\n  const SVG_NS = \"http://www.w3.org/2000/svg\";\n  const settingsTip = document.createElementNS(SVG_NS, \"svg\");\n  settingsTip.setAttribute(\"class\", \"sa-onion-settings-tip\");\n  settingsTip.setAttribute(\"width\", \"14\");\n  settingsTip.setAttribute(\"height\", \"7\");\n  const settingsTipShape = document.createElementNS(SVG_NS, \"polygon\");\n  settingsTipShape.setAttribute(\"class\", \"sa-onion-settings-polygon\");\n  settingsTipShape.setAttribute(\"points\", \"0,0 7,7, 14,0\");\n  settingsTip.appendChild(settingsTipShape);\n  settingsPage.appendChild(settingsTip);\n\n  const controlsLoop = async () => {\n    let hasRunOnce = false;\n    while (true) {\n      const canvasControls = await addon.tab.waitForElement(\"[class^='paint-editor_canvas-controls']\", {\n        markAsSeen: true,\n        reduxCondition: (state) =>\n          state.scratchGui.editorTab.activeTabIndex === 1 && !state.scratchGui.mode.isPlayerOnly,\n      });\n      accessScratchInternals();\n      const zoomControlsContainer = canvasControls.querySelector(\"[class^='paint-editor_zoom-controls']\");\n      const canvasContainer = document.querySelector(\"[class^='paint-editor_canvas-container']\");\n\n      // TODO: when leaving the paint editor, references to the old zoom controls are kept around by our DOM\n      // Need to investigate whether this leaks memory or other issues.\n      const oldZoomControlsContainer = paintEditorControlsContainer.querySelector(\n        \"[class^='paint-editor_zoom-controls']\"\n      );\n      if (oldZoomControlsContainer) {\n        oldZoomControlsContainer.parentNode.removeChild(oldZoomControlsContainer);\n      }\n\n      paintEditorControlsContainer.appendChild(zoomControlsContainer);\n      canvasControls.appendChild(paintEditorControlsContainer);\n      canvasContainer.appendChild(settingsPage);\n\n      if (!hasRunOnce) {\n        hasRunOnce = true;\n        const groupClass = zoomControlsContainer.firstChild.className;\n        const buttonClass = zoomControlsContainer.firstChild.firstChild.className;\n        const imageClass = zoomControlsContainer.firstChild.firstChild.firstChild.className;\n        for (const el of document.querySelectorAll(\".sa-onion-group\")) {\n          el.className += \" \" + groupClass;\n        }\n        for (const el of document.querySelectorAll(\".sa-onion-button\")) {\n          el.className += \" \" + buttonClass;\n        }\n        for (const el of document.querySelectorAll(\".sa-onion-image\")) {\n          el.className += \" \" + imageClass;\n        }\n      }\n\n      if (settings.enabled) {\n        updateOnionLayers();\n      }\n    }\n  };\n\n  await untilInEditor();\n  controlsLoop();\n}\n","const vm = window.vm;\n\nexport let paused = false;\nlet pausedThreadState = new WeakMap();\nlet eventTarget = new EventTarget();\n\nexport const onPauseChanged = (listener) => {\n  eventTarget.addEventListener(\"change\", () => listener(paused));\n};\n\nexport const setPaused = (_paused) => {\n  paused = _paused;\n\n  if (paused) {\n    vm.runtime.audioEngine.audioContext.suspend();\n    if (!vm.runtime.ioDevices.clock._paused) {\n      vm.runtime.ioDevices.clock.pause();\n    }\n\n    for (const thread of vm.runtime.threads) {\n      if (!thread.updateMonitor && !pausedThreadState.has(thread)) {\n        const pauseState = {\n          pauseTime: vm.runtime.currentMSecs,\n          status: thread.status,\n        };\n        pausedThreadState.set(thread, pauseState);\n        // Make sure that paused threads will always be paused.\n        // Setting thread.status is not enough for blocks like \"ask and wait\"\n        Object.defineProperty(thread, \"status\", {\n          get() {\n            return /* STATUS_PROMISE_WAIT */ 1;\n          },\n          set(status) {\n            // Status will be set when the thread is unpaused.\n            pauseState.status = status;\n          },\n          configurable: true,\n          enumerable: true,\n        });\n      }\n    }\n\n    // Immediately emit project stop\n    // Scratch will do this automatically, but there may be a slight delay.\n    vm.runtime.emit(\"PROJECT_RUN_STOP\");\n  } else {\n    vm.runtime.audioEngine.audioContext.resume();\n    vm.runtime.ioDevices.clock.resume();\n\n    const now = Date.now();\n    for (const thread of vm.runtime.threads) {\n      const pauseState = pausedThreadState.get(thread);\n      if (pauseState) {\n        const stackFrame = thread.peekStackFrame();\n        if (stackFrame && stackFrame.executionContext && stackFrame.executionContext.timer) {\n          const dt = now - pauseState.pauseTime;\n          stackFrame.executionContext.timer.startTime += dt;\n        }\n        // Compiler state is stored differently\n        if (thread.timer) {\n          const dt = now - pauseState.pauseTime;\n          thread.timer.startTime += dt;\n        }\n        Object.defineProperty(thread, \"status\", {\n          value: pauseState.status,\n          configurable: true,\n          enumerable: true,\n          writable: true,\n        });\n      }\n    }\n    pausedThreadState = new WeakMap();\n  }\n\n  eventTarget.dispatchEvent(new CustomEvent(\"change\"));\n};\n\nconst originalGreenFlag = vm.runtime.greenFlag;\nvm.runtime.greenFlag = function () {\n  setPaused(false);\n  return originalGreenFlag.call(this);\n};\n\n// Disable edge-activated hats and hats like \"when key pressed\" while paused.\nconst originalStartHats = vm.runtime.startHats;\nvm.runtime.startHats = function (...args) {\n  if (paused) {\n    const hat = args[0];\n    // The project can still be edited and the user might manually trigger some events. Let these run.\n    if (hat !== \"event_whenbroadcastreceived\" && hat !== \"control_start_as_clone\") {\n      return [];\n    }\n  }\n  return originalStartHats.apply(this, args);\n};\n\n// Paused threads should not be counted as running when updating GUI state.\nconst originalGetMonitorThreadCount = vm.runtime._getMonitorThreadCount;\nvm.runtime._getMonitorThreadCount = function (threads) {\n  let count = originalGetMonitorThreadCount.call(this, threads);\n  if (paused) {\n    for (const thread of threads) {\n      if (pausedThreadState.has(thread)) {\n        count++;\n      }\n    }\n  }\n  return count;\n};\n","module.exports = __webpack_public_path__ + \"static/assets/e079d14437a5d486830af3dc75b9e806.svg\";","module.exports = __webpack_public_path__ + \"static/assets/7980c63844b66a9a01a32a70b3e7ca8a.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./pause.svg\";\nimport _twAsset1 from \"./play.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/pause.svg\") return _twAsset0;\n  if (path === \"/play.svg\") return _twAsset1;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport { paused, setPaused, onPauseChanged } from \"./module.js\";\n\nexport default async function ({ addon, global, console, msg }) {\n  const img = document.createElement(\"img\");\n  img.className = \"pause-btn\";\n  img.draggable = false;\n  img.title = msg(\"pause\");\n\n  const setSrc = () => (img.src = _twGetAsset((paused ? \"/play.svg\" : \"/pause.svg\")));\n  img.addEventListener(\"click\", () => setPaused(!paused));\n  addon.tab.displayNoneWhileDisabled(img);\n  addon.self.addEventListener(\"disabled\", () => setPaused(false));\n  setSrc();\n  onPauseChanged(setSrc);\n\n  while (true) {\n    const flag = await addon.tab.waitForElement(\"[class^='green-flag']\", {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n    });\n    flag.insertAdjacentElement(\"afterend\", img);\n  }\n}\n","export default async ({ addon, console, msg }) => {\n  if (!addon.tab.redux.state) return console.warn(\"Redux is not available!\");\n  const vm = addon.tab.traps.vm;\n  if (!vm) return;\n  const oldDeleteSprite = vm.deleteSprite;\n  vm.deleteSprite = function (...args) {\n    const canDelete = confirm(msg(\"confirm\"));\n    if (canDelete) return oldDeleteSprite.apply(this, args);\n    const restoreDeletionState = Object.assign({}, addon.tab.redux.state.scratchGui.restoreDeletion);\n    setTimeout(\n      () =>\n        addon.tab.redux.dispatch({\n          type: \"scratch-gui/restore-deletion/RESTORE_UPDATE\",\n          state: restoreDeletionState,\n        }),\n      100\n    );\n    return Promise.resolve();\n  };\n};\n","export default async function () {\n  // Trigger a resize so that Blockly knows that the backpack is gone\n  window.dispatchEvent(new Event(\"resize\"));\n}\n","export default async function ({ addon, console, msg }) {\n  const vm = addon.tab.traps.vm;\n\n  const getBlockCount = () => {\n    let blockCount = 0;\n    let scriptCount = 0;\n    let sprites = new Set(vm.runtime.targets.map((i) => i.sprite.blocks._blocks));\n    sprites.forEach((sprite, i) => {\n      scriptCount += Object.values(sprite).filter((o) => !o.parent).length; // Filter blocks that don't have a parent (meaning it's the top of a stack)\n      blockCount += Object.values(sprite).filter((o) => !o.shadow).length; // shadow blocks should be filtered out\n    });\n    return {\n      blockCount,\n      scriptCount,\n      spriteCount: sprites.size - 1, // Backdrop counts as a target so we can subtract it\n    };\n  };\n\n  const addLiveBlockCount = async () => {\n    if (vm.editingTarget) {\n      while (true) {\n        const topBar = await addon.tab.waitForElement(\"[class^='menu-bar_main-menu']\", {\n          markAsSeen: true,\n          reduxEvents: [\"scratch-gui/mode/SET_PLAYER\"],\n        });\n        let display = topBar.appendChild(document.createElement(\"span\"));\n        addon.tab.displayNoneWhileDisabled(display);\n        display.style.order = 1;\n        display.style.padding = \"9px\";\n        display.innerText = msg(\"blocks\", { num: getBlockCount().blockCount });\n        let debounce; // debouncing values because of the way 'PROJECT_CHANGED' works\n        vm.on(\"PROJECT_CHANGED\", () => {\n          clearTimeout(debounce);\n          debounce = setTimeout(() => {\n            display.innerText = msg(\"blocks\", { num: getBlockCount().blockCount });\n          }, 1000);\n        });\n      }\n    } else {\n      let timeout = setTimeout(function () {\n        addLiveBlockCount();\n        clearTimeout(timeout);\n      }, 1000);\n    }\n  };\n\n  addLiveBlockCount();\n}\n","module.exports = __webpack_public_path__ + \"static/assets/0c99c0eae1be54ccd90e2a77165b1d81.svg\";","module.exports = __webpack_public_path__ + \"static/assets/1821649bb254ff5d93bb397ad646a23f.svg\";","/* inserted by pull.js */\nimport _twAsset0 from \"./icon.svg\";\nimport _twAsset1 from \"./search.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/icon.svg\") return _twAsset0;\n  if (path === \"/search.svg\") return _twAsset1;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console, msg }) {\n  const vm = addon.tab.traps.vm;\n\n  let localVariables = [];\n  let globalVariables = [];\n  let preventUpdate = false;\n\n  const manager = document.createElement(\"div\");\n  manager.classList.add(addon.tab.scratchClass(\"asset-panel_wrapper\"), \"sa-var-manager\");\n\n  const searchBox = document.createElement(\"input\");\n  searchBox.placeholder = msg(\"search\");\n  searchBox.className = addon.tab.scratchClass(\"input_input-form\", { others: \"sa-var-manager-searchbox\" });\n\n  searchBox.addEventListener(\"input\", (e) => {\n    for (const variable of localVariables) {\n      variable.handleSearch(searchBox.value);\n    }\n    for (const variable of globalVariables) {\n      variable.handleSearch(searchBox.value);\n    }\n    updateHeadingVisibility();\n  });\n\n  manager.appendChild(searchBox);\n\n  const localVars = document.createElement(\"div\");\n  const localHeading = document.createElement(\"span\");\n  const localList = document.createElement(\"table\");\n  localHeading.className = \"sa-var-manager-heading\";\n  localHeading.innerText = msg(\"for-this-sprite\");\n  localVars.appendChild(localHeading);\n  localVars.appendChild(localList);\n\n  const globalVars = document.createElement(\"div\");\n  const globalHeading = document.createElement(\"span\");\n  const globalList = document.createElement(\"table\");\n  globalHeading.className = \"sa-var-manager-heading\";\n  globalHeading.innerText = msg(\"for-all-sprites\");\n  globalVars.appendChild(globalHeading);\n  globalVars.appendChild(globalList);\n\n  manager.appendChild(localVars);\n  manager.appendChild(globalVars);\n\n  const varTab = document.createElement(\"li\");\n  varTab.classList.add(addon.tab.scratchClass(\"react-tabs_react-tabs__tab\"), addon.tab.scratchClass(\"gui_tab\"));\n  varTab.id = \"react-tabs-7\";\n\n  const varTabIcon = document.createElement(\"img\");\n  varTabIcon.draggable = false;\n  varTabIcon.src = _twGetAsset(\"/icon.svg\");\n\n  const varTabText = document.createElement(\"span\");\n  varTabText.innerText = msg(\"variables\");\n\n  varTab.appendChild(varTabIcon);\n  varTab.appendChild(varTabText);\n\n  function updateHeadingVisibility() {\n    // used to hide the headings if there are no variables\n    let filteredLocals = localVariables.filter((v) => v.row.style.display !== \"none\");\n    let filteredGlobals = globalVariables.filter((v) => v.row.style.display !== \"none\");\n    localHeading.style.display = filteredLocals.length === 0 ? \"none\" : \"\";\n    globalHeading.style.display = filteredGlobals.length === 0 ? \"none\" : \"\";\n  }\n\n  const rowToVariableMap = new WeakMap();\n  const observer = new IntersectionObserver(\n    (changes) => {\n      for (const change of changes) {\n        const variable = rowToVariableMap.get(change.target);\n        variable.setVisible(change.intersectionRatio > 0);\n      }\n    },\n    {\n      rootMargin: \"100px\",\n    }\n  );\n\n  class WrappedVariable {\n    constructor(scratchVariable, target) {\n      this.scratchVariable = scratchVariable;\n      this.target = target;\n      this.visible = false;\n      this.buildDOM();\n    }\n\n    updateValue(force) {\n      if (!this.visible && !force) return;\n      let newValue;\n      if (this.scratchVariable.type === \"list\") {\n        newValue = this.scratchVariable.value.join(\"\\n\");\n      } else {\n        newValue = this.scratchVariable.value;\n      }\n      if (newValue !== this.input.value) {\n        this.input.value = newValue;\n      }\n    }\n\n    handleSearch(search) {\n      // this doesn't check if this.visible is true or whatever. maybe that would improve performance while typing into the search box but it's probably fine™\n      if (this.scratchVariable.name.toLowerCase().includes(search.toLowerCase()) || !search) {\n        // fuzzy searches are lame we are too cool for fuzzy searches (& i doubt they're even the right thing to use here, this should work fine enough)\n        this.row.style.display = \"\"; // make the row normal\n        this.updateValue(true); // force it to update because its hidden and it wouldnt be able to otherwise\n      } else {\n        this.row.style.display = \"none\"; // set the entire row as hidden\n      }\n    }\n\n    resizeInputIfList() {\n      if (this.scratchVariable.type === \"list\") {\n        this.input.style.height = \"auto\";\n        const height = Math.min(1000, this.input.scrollHeight);\n        if (height > 0) {\n          this.input.style.height = height + \"px\";\n        }\n      }\n    }\n\n    setVisible(visible) {\n      if (this.visible === visible) return;\n      this.visible = visible;\n      if (visible) {\n        this.updateValue();\n      }\n    }\n\n    buildDOM() {\n      const id = `sa-variable-manager-${this.scratchVariable.id}`;\n\n      const row = document.createElement(\"tr\");\n      this.row = row;\n      const labelCell = document.createElement(\"td\");\n      labelCell.className = \"sa-var-manager-name\";\n\n      const label = document.createElement(\"input\");\n      label.value = this.scratchVariable.name;\n      label.htmlFor = id;\n      const onLabelOut = (e) => {\n        e.preventDefault();\n        const workspace = Blockly.getMainWorkspace();\n        const existingVariableWithNewName = workspace.getVariable(label.value, this.scratchVariable.type);\n        if (existingVariableWithNewName) {\n          label.value = this.scratchVariable.name;\n        } else {\n          workspace.renameVariableById(this.scratchVariable.id, label.value);\n        }\n        label.blur();\n      };\n      label.addEventListener(\"keydown\", (e) => {\n        if (e.key === \"Enter\" && !e.shiftKey) e.target.blur();\n      });\n      label.addEventListener(\"focusout\", onLabelOut);\n\n      label.addEventListener(\"focus\", (e) => {\n        preventUpdate = true;\n        manager.classList.add(\"freeze\");\n      });\n\n      label.addEventListener(\"blur\", (e) => {\n        preventUpdate = false;\n        manager.classList.remove(\"freeze\");\n      });\n      labelCell.appendChild(label);\n\n      rowToVariableMap.set(row, this);\n      observer.observe(row);\n\n      const valueCell = document.createElement(\"td\");\n      valueCell.className = \"sa-var-manager-value\";\n\n      let input;\n      if (this.scratchVariable.type === \"list\") {\n        input = document.createElement(\"textarea\");\n      } else {\n        input = document.createElement(\"input\");\n      }\n      input.id = id;\n      this.input = input;\n\n      this.updateValue(true);\n      if (this.scratchVariable.type === \"list\") {\n        this.input.addEventListener(\"input\", () => this.resizeInputIfList(), false);\n      }\n\n      const onInputOut = (e) => {\n        e.preventDefault();\n        if (this.scratchVariable.type === \"list\") {\n          vm.setVariableValue(this.target.id, this.scratchVariable.id, input.value.split(\"\\n\"));\n        } else {\n          vm.setVariableValue(this.target.id, this.scratchVariable.id, input.value);\n        }\n        input.blur();\n      };\n\n      input.addEventListener(\"keydown\", (e) => {\n        if (e.key === \"Enter\" && !e.shiftKey) e.target.blur();\n      });\n      input.addEventListener(\"focusout\", onInputOut);\n\n      input.addEventListener(\"focus\", (e) => {\n        preventUpdate = true;\n        manager.classList.add(\"freeze\");\n      });\n\n      input.addEventListener(\"blur\", (e) => {\n        preventUpdate = false;\n        manager.classList.remove(\"freeze\");\n      });\n\n      valueCell.appendChild(input);\n      row.appendChild(labelCell);\n      row.appendChild(valueCell);\n\n      this.handleSearch(searchBox.value);\n    }\n  }\n\n  function fullReload() {\n    if (addon.tab.redux.state.scratchGui.editorTab.activeTabIndex !== 3 || preventUpdate) return;\n\n    const editingTarget = vm.runtime.getEditingTarget();\n    const stage = vm.runtime.getTargetForStage();\n    localVariables = editingTarget.isStage\n      ? []\n      : Object.values(editingTarget.variables)\n          .filter((i) => i.type === \"\" || i.type === \"list\")\n          .map((i) => new WrappedVariable(i, editingTarget));\n    globalVariables = Object.values(stage.variables)\n      .filter((i) => i.type === \"\" || i.type === \"list\")\n      .map((i) => new WrappedVariable(i, stage));\n\n    updateHeadingVisibility();\n\n    while (localList.firstChild) {\n      localList.removeChild(localList.firstChild);\n    }\n    while (globalList.firstChild) {\n      globalList.removeChild(globalList.firstChild);\n    }\n\n    for (const variable of localVariables) {\n      localList.appendChild(variable.row);\n      variable.resizeInputIfList();\n    }\n    for (const variable of globalVariables) {\n      globalList.appendChild(variable.row);\n      variable.resizeInputIfList();\n    }\n  }\n\n  function quickReload() {\n    if (addon.tab.redux.state.scratchGui.editorTab.activeTabIndex !== 3 || preventUpdate) return;\n\n    for (const variable of localVariables) {\n      variable.updateValue();\n    }\n    for (const variable of globalVariables) {\n      variable.updateValue();\n    }\n  }\n\n  function cleanup() {\n    localVariables = [];\n    globalVariables = [];\n  }\n\n  varTab.addEventListener(\"click\", (e) => {\n    addon.tab.redux.dispatch({ type: \"scratch-gui/navigation/ACTIVATE_TAB\", activeTabIndex: 3 });\n  });\n\n  function setVisible(visible) {\n    if (visible) {\n      varTab.classList.add(\n        addon.tab.scratchClass(\"react-tabs_react-tabs__tab--selected\"),\n        addon.tab.scratchClass(\"gui_is-selected\")\n      );\n      const contentArea = document.querySelector(\"[class^=gui_tabs]\");\n      contentArea.insertAdjacentElement(\"beforeend\", manager);\n      fullReload();\n    } else {\n      varTab.classList.remove(\n        addon.tab.scratchClass(\"react-tabs_react-tabs__tab--selected\"),\n        addon.tab.scratchClass(\"gui_is-selected\")\n      );\n      manager.remove();\n      cleanup();\n    }\n  }\n\n  addon.tab.redux.initialize();\n  addon.tab.redux.addEventListener(\"statechanged\", ({ detail }) => {\n    if (detail.action.type === \"scratch-gui/navigation/ACTIVATE_TAB\") {\n      setVisible(detail.action.activeTabIndex === 3);\n    } else if (detail.action.type === \"scratch-gui/mode/SET_PLAYER\") {\n      if (!detail.action.isPlayerOnly && addon.tab.redux.state.scratchGui.editorTab.activeTabIndex === 3) {\n        // DOM doesn't actually exist yet\n        queueMicrotask(() => setVisible(true));\n      }\n    }\n  });\n\n  vm.runtime.on(\"PROJECT_LOADED\", () => fullReload());\n  vm.runtime.on(\"TOOLBOX_EXTENSIONS_NEED_UPDATE\", () => fullReload());\n\n  const oldStep = vm.runtime.constructor.prototype._step;\n  vm.runtime.constructor.prototype._step = function (...args) {\n    const ret = oldStep.call(this, ...args);\n    quickReload();\n    return ret;\n  };\n\n  while (true) {\n    const tabs = await addon.tab.waitForElement(\"[class^='react-tabs_react-tabs__tab-list']\", {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n      reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\n    });\n    const soundTab = tabs.children[2];\n    soundTab.insertAdjacentElement(\"afterend\", varTab);\n  }\n}\n","/**\n * Copyright (C) 2021 Thomas Weber\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as\n * published by the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport IntlMessageFormat from 'intl-messageformat';\nimport SettingsStore from './settings-store-singleton';\nimport getAddonTranslations from './get-addon-translations';\nimport dataURLToBlob from '../lib/data-uri-to-blob';\nimport EventTargetShim from './event-target';\nimport AddonHooks from './hooks';\nimport addons from './addon-manifests';\nimport './polyfill';\n\n/* eslint-disable no-console */\n\nconst escapeHTML = str => str.replace(/([<>'\"&])/g, (_, l) => `&#${l.charCodeAt(0)};`);\nconst kebabCaseToCamelCase = str => str.replace(/-([a-z])/g, g => g[1].toUpperCase());\nconst createStylesheet = css => {\n    const style = document.createElement('style');\n    style.textContent = css;\n    return style;\n};\n\nlet _scratchClassNames = null;\nconst getScratchClassNames = () => {\n    if (_scratchClassNames) {\n        return _scratchClassNames;\n    }\n    const cssRules = Array.from(document.styleSheets)\n        // Ignore some scratch-paint stylesheets\n        .filter(styleSheet => (\n            !(\n                styleSheet.ownerNode.textContent.startsWith(\n                    '/* DO NOT EDIT\\n@todo This file is copied from GUI and should be pulled out into a shared library.'\n                ) &&\n                (\n                    styleSheet.ownerNode.textContent.includes('input_input-form') ||\n                    styleSheet.ownerNode.textContent.includes('label_input-group_')\n                )\n            )\n        ))\n        .map(e => {\n            try {\n                return [...e.cssRules];\n            } catch (_e) {\n                return [];\n            }\n        })\n        .flat();\n    const classes = cssRules\n        .map(e => e.selectorText)\n        .filter(e => e)\n        .map(e => e.match(/(([\\w-]+?)_([\\w-]+)_([\\w\\d-]+))/g))\n        .filter(e => e)\n        .flat();\n    _scratchClassNames = [...new Set(classes)];\n    const observer = new MutationObserver(mutationList => {\n        for (const mutation of mutationList) {\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'STYLE') {\n                    _scratchClassNames = null;\n                    observer.disconnect();\n                    return;\n                }\n            }\n        }\n    });\n    observer.observe(document.head, {\n        childList: true\n    });\n    return _scratchClassNames;\n};\n\nlet _mutationObserver;\nlet _mutationObserverCallbacks = [];\nconst addMutationObserverCallback = newCallback => {\n    if (!_mutationObserver) {\n        _mutationObserver = new MutationObserver(() => {\n            for (const cb of _mutationObserverCallbacks) {\n                cb();\n            }\n        });\n        _mutationObserver.observe(document.documentElement, {\n            attributes: false,\n            childList: true,\n            subtree: true\n        });\n    }\n    _mutationObserverCallbacks.push(newCallback);\n};\nconst removeMutationObserverCallback = callback => {\n    _mutationObserverCallbacks = _mutationObserverCallbacks.filter(i => i !== callback);\n};\n\nclass Redux extends EventTargetShim {\n    constructor () {\n        super();\n        this._initialized = false;\n        this._nextState = null;\n    }\n\n    initialize () {\n        if (!this._initialized) {\n            AddonHooks.appStateReducer = (action, next) => {\n                this._nextState = next;\n                this.dispatchEvent(new CustomEvent('statechanged', {\n                    detail: {\n                        action,\n                        next\n                    }\n                }));\n                this._nextState = null;\n            };\n\n            this._initialized = true;\n        }\n    }\n\n    dispatch (m) {\n        return AddonHooks.appStateStore.dispatch(m);\n    }\n\n    get state () {\n        if (this._nextState) return this._nextState;\n        return AddonHooks.appStateStore.getState();\n    }\n}\n\nconst getEditorMode = () => {\n    // eslint-disable-next-line no-use-before-define\n    const mode = tabReduxInstance.state.scratchGui.mode;\n    if (mode.isEmbedded) return 'embed';\n    if (mode.isFullScreen) return 'fullscreen';\n    if (mode.isPlayerOnly) return 'projectpage';\n    return 'editor';\n};\n\nconst tabReduxInstance = new Redux();\nconst language = tabReduxInstance.state.locales.locale.split('-')[0];\nconst translations = getAddonTranslations(language);\n\nconst getDisplayNoneWhileDisabledClass = id => `addons-display-none-${id}`;\n\nlet _firstAddBlockRan = false;\n\nclass Tab extends EventTargetShim {\n    constructor (id) {\n        super();\n        this._id = id;\n        this._seenElements = new WeakSet();\n        // traps is public API\n        this.traps = {\n            get vm () {\n                // We expose VM on window\n                return window.vm;\n            },\n            getBlockly: () => {\n                // The real Blockly is exposed on window. It may not exist until the user enters the editor.\n                if (window.ScratchBlocks) {\n                    return Promise.resolve(window.ScratchBlocks);\n                }\n                return new Promise(resolve => {\n                    const handler = () => {\n                        if (window.ScratchBlocks) {\n                            this.removeEventListener('urlChange', handler);\n                            resolve(window.ScratchBlocks);\n                        }\n                    };\n                    this.addEventListener('urlChange', handler);\n                });\n            }\n        };\n    }\n\n    get redux () {\n        return tabReduxInstance;\n    }\n\n    loadScript () {\n        throw new Error('loadScript is not supported');\n    }\n\n    waitForElement (selector, {markAsSeen = false, condition, reduxCondition, reduxEvents} = {}) {\n        let externalEventSatisfied = true;\n        const evaluateCondition = () => {\n            if (!externalEventSatisfied) return false;\n            if (condition && !condition()) return false;\n            if (reduxCondition && !reduxCondition(tabReduxInstance.state)) return false;\n            return true;\n        };\n\n        if (evaluateCondition()) {\n            const firstQuery = document.querySelectorAll(selector);\n            for (const element of firstQuery) {\n                if (this._seenElements.has(element)) continue;\n                if (markAsSeen) this._seenElements.add(element);\n                return Promise.resolve(element);\n            }\n        }\n\n        let reduxListener;\n        if (reduxEvents) {\n            externalEventSatisfied = false;\n            reduxListener = ({detail}) => {\n                const type = detail.action.type;\n                // As addons can't run before DOM exists here, ignore fontsLoaded/SET_FONTS_LOADED\n                // Otherwise, as our font loading is very async, we could activate more often than required.\n                if (reduxEvents.includes(type) && type !== 'fontsLoaded/SET_FONTS_LOADED') {\n                    externalEventSatisfied = true;\n                }\n            };\n            this.redux.initialize();\n            this.redux.addEventListener('statechanged', reduxListener);\n        }\n\n        return new Promise(resolve => {\n            const callback = () => {\n                if (!evaluateCondition()) {\n                    return;\n                }\n                const elements = document.querySelectorAll(selector);\n                for (const element of elements) {\n                    if (this._seenElements.has(element)) continue;\n                    resolve(element);\n                    removeMutationObserverCallback(callback);\n                    if (markAsSeen) this._seenElements.add(element);\n                    if (reduxListener) {\n                        this.redux.removeEventListener('statechanged', reduxListener);\n                    }\n                    break;\n                }\n            };\n            addMutationObserverCallback(callback);\n        });\n    }\n\n    addBlock (procedureCode, args, callback) {\n        const vm = this.traps.vm;\n        vm.addAddonBlock({\n            procedureCode,\n            arguments: args,\n            callback,\n            color: '#29beb8',\n            secondaryColor: '#3aa8a4'\n        });\n\n        if (!_firstAddBlockRan) {\n            _firstAddBlockRan = true;\n\n            this.traps.getBlockly().then(ScratchBlocks => {\n                const BlockSvg = ScratchBlocks.BlockSvg;\n                const oldUpdateColour = BlockSvg.prototype.updateColour;\n                BlockSvg.prototype.updateColour = function (...args2) {\n                    // procedures_prototype also has a procedure code but we do not want to color them.\n                    if (this.type === 'procedures_call') {\n                        const block = this.procCode_ && vm.runtime.getAddonBlock(this.procCode_);\n                        if (block) {\n                            this.colour_ = '#29beb8';\n                            this.colourSecondary_ = '#3aa8a4';\n                            this.colourTertiary_ = '#3aa8a4';\n                            this.customContextMenu = null;\n                        }\n                    }\n                    return oldUpdateColour.call(this, ...args2);\n                };\n                if (vm.editingTarget) {\n                    vm.emitWorkspaceUpdate();\n                }\n            });\n        }\n    }\n\n    removeBlock () {\n        throw new Error('not implemented');\n    }\n\n    copyImage (dataURL) {\n        if (!navigator.clipboard.write) {\n            return Promise.reject(new Error('Clipboard API not supported'));\n        }\n        const items = [\n            // eslint-disable-next-line no-undef\n            new ClipboardItem({\n                'image/png': dataURLToBlob(dataURL)\n            })\n        ];\n        return navigator.clipboard.write(items);\n    }\n\n    scratchClass (...args) {\n        const scratchClasses = getScratchClassNames();\n        const classes = [];\n        for (const arg of args) {\n            if (typeof arg === 'string') {\n                for (const scratchClass of scratchClasses) {\n                    if (scratchClass.startsWith(`${arg}_`) && scratchClass.length === arg.length + 6) {\n                        classes.push(scratchClass);\n                        break;\n                    }\n                }\n            }\n        }\n        const options = args[args.length - 1];\n        if (typeof options === 'object') {\n            const others = Array.isArray(options.others) ? options.others : [options.others];\n            for (const className of others) {\n                classes.push(className);\n            }\n        }\n        return classes.join(' ');\n    }\n\n    get editorMode () {\n        return getEditorMode();\n    }\n\n    displayNoneWhileDisabled (el) {\n        el.classList.add(getDisplayNoneWhileDisabledClass(this._id));\n    }\n\n    get direction () {\n        return this.redux.state.locales.isRtl ? 'rtl' : 'ltr';\n    }\n}\n\nclass Settings extends EventTargetShim {\n    constructor (addonId, manifest) {\n        super();\n        this._addonId = addonId;\n        this._manifest = manifest;\n    }\n\n    get (id) {\n        return SettingsStore.getAddonSetting(this._addonId, id);\n    }\n}\n\nclass Self extends EventTargetShim {\n    constructor (id) {\n        super();\n        this.id = id;\n        this.disabled = false;\n    }\n    // These are removed at build-time by pull.js. Throw if attempting to access them at runtime.\n    get dir () {\n        throw new Error(`Addon tried to access addon.self.dir`);\n    }\n    get lib () {\n        throw new Error(`Addon tried to access addon.self.lib`);\n    }\n}\n\nclass AddonRunner {\n    constructor (id) {\n        AddonRunner.instances.push(this);\n        const manifest = addons[id];\n\n        this.id = id;\n        this.manifest = manifest;\n        this.messageCache = {};\n        this.stylesheets = [];\n        this.disabledStylesheet = null;\n\n        this.publicAPI = {\n            global,\n            console,\n            addon: {\n                tab: new Tab(id),\n                settings: new Settings(id, manifest),\n                self: new Self(id)\n            },\n            msg: this.msg.bind(this),\n            safeMsg: this.safeMsg.bind(this)\n        };\n    }\n\n    _msg (key, vars, handler) {\n        const namespacedKey = `${this.id}/${key}`;\n        if (this.messageCache[namespacedKey]) {\n            return this.messageCache[namespacedKey].format(vars);\n        }\n        let translation = translations[namespacedKey];\n        if (!translation) {\n            return namespacedKey;\n        }\n        if (handler) {\n            translation = handler(translation);\n        }\n        const messageFormat = new IntlMessageFormat(translation, language);\n        this.messageCache[namespacedKey] = messageFormat;\n        return messageFormat.format(vars);\n    }\n\n    msg (key, vars) {\n        return this._msg(key, vars, null);\n    }\n\n    safeMsg (key, vars) {\n        return this._msg(key, vars, escapeHTML);\n    }\n\n    settingsChanged () {\n        this.publicAPI.addon.settings.dispatchEvent(new CustomEvent('change'));\n        this.updateCSSVariables();\n    }\n\n    updateCSSVariables () {\n        if (this.manifest.settings) {\n            const kebabCaseId = kebabCaseToCamelCase(this.id);\n            for (const setting of this.manifest.settings) {\n                const settingId = setting.id;\n                const variable = `--${kebabCaseId}-${kebabCaseToCamelCase(settingId)}`;\n                const value = this.publicAPI.addon.settings.get(settingId);\n                document.documentElement.style.setProperty(variable, value);\n            }\n        }\n    }\n\n    settingsMatch (settingMatch) {\n        if (!settingMatch) {\n            // No settings to match.\n            return true;\n        }\n        const settingValue = this.publicAPI.addon.settings.get(settingMatch.id);\n        return settingValue === settingMatch.value;\n    }\n\n    dynamicEnable () {\n        this.publicAPI.addon.self.dispatchEvent(new CustomEvent('reenabled'));\n        this.publicAPI.addon.self.disabled = false;\n        this.appendStylesheets();\n        if (this.disabledStylesheet) {\n            this.disabledStylesheet.remove();\n            this.disabledStylesheet = null;\n        }\n    }\n\n    dynamicDisable () {\n        this.publicAPI.addon.self.dispatchEvent(new CustomEvent('disabled'));\n        this.publicAPI.addon.self.disabled = true;\n        this.removeStylesheets();\n        const disabledCSS = `.${getDisplayNoneWhileDisabledClass(this.id)}{display:none !important;}`;\n        this.disabledStylesheet = createStylesheet(disabledCSS);\n        document.body.insertBefore(this.disabledStylesheet, document.body.firstChild);\n    }\n\n    removeStylesheets () {\n        for (const style of this.stylesheets) {\n            style.remove();\n        }\n    }\n\n    appendStylesheets () {\n        for (const style of this.stylesheets) {\n            // Insert styles at the start of the body so that they have higher precedence than those in <head>\n            document.body.insertBefore(style, document.body.firstChild);\n        }\n    }\n\n    async run () {\n        this.updateCSSVariables();\n\n        if (this.manifest.userstyles) {\n            for (const userstyle of this.manifest.userstyles) {\n                if (!this.settingsMatch(userstyle.settingMatch)) {\n                    continue;\n                }\n                const m = await import(\n                    /* webpackInclude: /\\.css$/ */\n                    /* webpackMode: \"eager\" */\n                    `!css-loader!./addons/${this.id}/${userstyle.url}`\n                );\n                const source = m.default[0][1];\n                const style = createStylesheet(source);\n                style.className = 'scratch-addons-theme';\n                style.dataset.addonId = this.id;\n                this.stylesheets.push(style);\n            }\n        }\n        this.appendStylesheets();\n\n        if (this.manifest.userscripts) {\n            for (const userscript of this.manifest.userscripts) {\n                if (!this.settingsMatch(userscript.settingMatch)) {\n                    continue;\n                }\n                const m = await import(\n                    /* webpackInclude: /\\.js$/ */\n                    /* webpackMode: \"eager\" */\n                    `./addons/${this.id}/${userscript.url}`\n                );\n                m.default(this.publicAPI);\n            }\n        }\n    }\n}\nAddonRunner.instances = [];\n\nconst runAddon = addonId => {\n    const runner = new AddonRunner(addonId);\n    runner.run();\n};\n\nlet oldMode = getEditorMode();\nconst emitUrlChange = () => {\n    // In Scratch, URL changes usually mean someone went from editor to fullscreen or something like that.\n    // This is not the case in TW -- the URL can change for many other reasons that addons probably aren't prepared\n    // to handle.\n    const newMode = getEditorMode();\n    if (newMode !== oldMode) {\n        oldMode = newMode;\n        setTimeout(() => {\n            for (const addon of AddonRunner.instances) {\n                addon.publicAPI.addon.tab.dispatchEvent(new CustomEvent('urlChange'));\n            }\n        });\n    }\n};\nconst originalReplaceState = history.replaceState;\nhistory.replaceState = function (...args) {\n    originalReplaceState.apply(this, args);\n    emitUrlChange();\n};\nconst originalPushState = history.pushState;\nhistory.pushState = function (...args) {\n    originalPushState.apply(this, args);\n    emitUrlChange();\n};\n\nSettingsStore.addEventListener('addon-changed', e => {\n    const addonId = e.detail.addonId;\n    const runner = AddonRunner.instances.find(i => i.id === addonId);\n    if (e.detail.dynamicEnable) {\n        if (runner) {\n            runner.dynamicEnable();\n        } else {\n            runAddon(addonId);\n        }\n    } else if (e.detail.dynamicDisable) {\n        if (runner) {\n            runner.dynamicDisable();\n        }\n    }\n    if (runner) {\n        runner.settingsChanged();\n    }\n});\n\nfor (const id of Object.keys(addons)) {\n    if (!SettingsStore.getAddonEnabled(id)) {\n        continue;\n    }\n    runAddon(id);\n}\n","import './api';\n","// From https://github.com/LLK/scratch-gui/blob/develop/src/lib/download-blob.js\nexport default (filename, blob) => {\n  const downloadLink = document.createElement(\"a\");\n  document.body.appendChild(downloadLink);\n\n  // Use special ms version if available to get it working on Edge.\n  if (navigator.msSaveOrOpenBlob) {\n    navigator.msSaveOrOpenBlob(blob, filename);\n    return;\n  }\n\n  if (\"download\" in HTMLAnchorElement.prototype) {\n    const url = window.URL.createObjectURL(blob);\n    downloadLink.href = url;\n    downloadLink.download = filename;\n    downloadLink.type = blob.type;\n    downloadLink.click();\n    // remove the link after a timeout to prevent a crash on iOS 13 Safari\n    window.setTimeout(() => {\n      document.body.removeChild(downloadLink);\n      window.URL.revokeObjectURL(url);\n    }, 1000);\n  } else {\n    // iOS 12 Safari, open a new page and set href to data-uri\n    let popup = window.open(\"\", \"_blank\");\n    const reader = new FileReader();\n    reader.onloadend = function () {\n      popup.location.href = reader.result;\n      popup = null;\n    };\n    reader.readAsDataURL(blob);\n  }\n};\n","export const getHexRegex = () => /^#?[0-9a-fA-F]{3,8}$/;\n\nexport const normalizeHex = (input) => {\n  let hex = String(input);\n  if (!getHexRegex().test(hex)) return \"#000000\";\n  if (!hex.startsWith(\"#\")) hex = `#${hex}`;\n  if (hex.length === 4) {\n    const [_, r, g, b] = hex;\n    hex = `#${r}${r}${g}${g}${b}${b}`;\n  }\n  return hex.toLowerCase();\n};\n","export default class RateLimiter {\n  constructor(wait) {\n    this.timeout = null;\n    this.callback = null;\n    this.wait = wait;\n  }\n\n  abort(call = true) {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n      if (call) this.callback();\n      this.timeout = this.callback = null;\n    }\n  }\n\n  limit(callback) {\n    this.abort(false);\n    this.callback = callback;\n    this.timeout = setTimeout(() => {\n      this.timeout = this.callback = null;\n      callback();\n    }, this.wait);\n  }\n}\n","function parseHex(hex) {\n  return {\n    r: parseInt(hex.substring(1, 3), 16),\n    g: parseInt(hex.substring(3, 5), 16),\n    b: parseInt(hex.substring(5, 7), 16),\n    a: hex.length >= 9 ? parseInt(hex.substring(7, 9), 16) / 255 : 1,\n  };\n}\n\nfunction convertComponentToHex(a) {\n  a = Math.round(a).toString(16);\n  if (a.length === 1) return `0${a}`;\n  return a;\n}\n\nfunction convertToHex(obj) {\n  const r = convertComponentToHex(obj.r);\n  const g = convertComponentToHex(obj.g);\n  const b = convertComponentToHex(obj.b);\n  const a = obj.a !== undefined ? convertComponentToHex(255 * obj.a) : \"\";\n  return `#${r}${g}${b}${a}`;\n}\n\nfunction textColor(hex, black, white, threshold) {\n  const { r, g, b } = parseHex(hex);\n  threshold = threshold !== undefined ? threshold : 170;\n  if (r * 0.299 + g * 0.587 + b * 0.114 > threshold) {\n    // https://stackoverflow.com/a/3943023\n    return black !== undefined ? black : \"#575e75\";\n  } else {\n    return white !== undefined ? white : \"#ffffff\";\n  }\n}\n\nfunction multiply(hex, c) {\n  const { r, g, b, a } = parseHex(hex);\n  if (c.r === undefined) c.r = 1;\n  if (c.g === undefined) c.g = 1;\n  if (c.b === undefined) c.b = 1;\n  if (c.a === undefined) c.a = 1;\n  return convertToHex({ r: c.r * r, g: c.g * g, b: c.b * b, a: c.a * a });\n}\n\nfunction brighten(hex, c) {\n  const { r, g, b, a } = parseHex(hex);\n  if (c.r === undefined) c.r = 1;\n  if (c.g === undefined) c.g = 1;\n  if (c.b === undefined) c.b = 1;\n  if (c.a === undefined) c.a = 1;\n  return convertToHex({\n    r: (1 - c.r) * 255 + c.r * r,\n    g: (1 - c.g) * 255 + c.g * g,\n    b: (1 - c.b) * 255 + c.b * b,\n    a: (1 - c.a) * 255 + c.a * a,\n  });\n}\n\nfunction alphaBlend(opaqueHex, transparentHex) {\n  const { r: r1, g: g1, b: b1 } = parseHex(opaqueHex);\n  const { r: r2, g: g2, b: b2, a } = parseHex(transparentHex);\n  return convertToHex({\n    r: (1 - a) * r1 + a * r2,\n    g: (1 - a) * g1 + a * g2,\n    b: (1 - a) * b1 + a * b2,\n  });\n}\n\nfunction recolorFilter(hex) {\n  const { r, g, b } = parseHex(hex);\n  return `url(\"data:image/svg+xml,\n    <svg xmlns='http://www.w3.org/2000/svg'>\n      <filter id='recolor'>\n        <feColorMatrix values='\n          0 0 0 0 ${r / 255}\n          0 0 0 0 ${g / 255}\n          0 0 0 0 ${b / 255}\n          0 0 0 1 0\n        '/>\n      </filter>\n    </svg>#recolor\n  \")`\n    .split(\"\\n\")\n    .join(\"\");\n}\n\nexport { textColor, multiply, brighten, alphaBlend, recolorFilter };\n","// TinyColor v1.4.2\n// https://github.com/bgrins/TinyColor\n// Brian Grinstead, MIT License\n// Modified to use ES6 export\n\nconst tinycolor = (function(Math) {\n\nvar trimLeft = /^\\s+/,\n    trimRight = /\\s+$/,\n    tinyCounter = 0,\n    mathRound = Math.round,\n    mathMin = Math.min,\n    mathMax = Math.max,\n    mathRandom = Math.random;\n\nfunction tinycolor (color, opts) {\n\n    color = (color) ? color : '';\n    opts = opts || { };\n\n    // If input is already a tinycolor, return itself\n    if (color instanceof tinycolor) {\n       return color;\n    }\n    // If we are called as a function, call using new instead\n    if (!(this instanceof tinycolor)) {\n        return new tinycolor(color, opts);\n    }\n\n    var rgb = inputToRGB(color);\n    this._originalInput = color,\n    this._r = rgb.r,\n    this._g = rgb.g,\n    this._b = rgb.b,\n    this._a = rgb.a,\n    this._roundA = mathRound(100*this._a) / 100,\n    this._format = opts.format || rgb.format;\n    this._gradientType = opts.gradientType;\n\n    // Don't let the range of [0,255] come back in [0,1].\n    // Potentially lose a little bit of precision here, but will fix issues where\n    // .5 gets interpreted as half of the total, instead of half of 1\n    // If it was supposed to be 128, this was already taken care of by `inputToRgb`\n    if (this._r < 1) { this._r = mathRound(this._r); }\n    if (this._g < 1) { this._g = mathRound(this._g); }\n    if (this._b < 1) { this._b = mathRound(this._b); }\n\n    this._ok = rgb.ok;\n    this._tc_id = tinyCounter++;\n}\n\ntinycolor.prototype = {\n    isDark: function() {\n        return this.getBrightness() < 128;\n    },\n    isLight: function() {\n        return !this.isDark();\n    },\n    isValid: function() {\n        return this._ok;\n    },\n    getOriginalInput: function() {\n      return this._originalInput;\n    },\n    getFormat: function() {\n        return this._format;\n    },\n    getAlpha: function() {\n        return this._a;\n    },\n    getBrightness: function() {\n        //http://www.w3.org/TR/AERT#color-contrast\n        var rgb = this.toRgb();\n        return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\n    },\n    getLuminance: function() {\n        //http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n        var rgb = this.toRgb();\n        var RsRGB, GsRGB, BsRGB, R, G, B;\n        RsRGB = rgb.r/255;\n        GsRGB = rgb.g/255;\n        BsRGB = rgb.b/255;\n\n        if (RsRGB <= 0.03928) {R = RsRGB / 12.92;} else {R = Math.pow(((RsRGB + 0.055) / 1.055), 2.4);}\n        if (GsRGB <= 0.03928) {G = GsRGB / 12.92;} else {G = Math.pow(((GsRGB + 0.055) / 1.055), 2.4);}\n        if (BsRGB <= 0.03928) {B = BsRGB / 12.92;} else {B = Math.pow(((BsRGB + 0.055) / 1.055), 2.4);}\n        return (0.2126 * R) + (0.7152 * G) + (0.0722 * B);\n    },\n    setAlpha: function(value) {\n        this._a = boundAlpha(value);\n        this._roundA = mathRound(100*this._a) / 100;\n        return this;\n    },\n    toHsv: function() {\n        var hsv = rgbToHsv(this._r, this._g, this._b);\n        return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };\n    },\n    toHsvString: function() {\n        var hsv = rgbToHsv(this._r, this._g, this._b);\n        var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);\n        return (this._a == 1) ?\n          \"hsv(\"  + h + \", \" + s + \"%, \" + v + \"%)\" :\n          \"hsva(\" + h + \", \" + s + \"%, \" + v + \"%, \"+ this._roundA + \")\";\n    },\n    toHsl: function() {\n        var hsl = rgbToHsl(this._r, this._g, this._b);\n        return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };\n    },\n    toHslString: function() {\n        var hsl = rgbToHsl(this._r, this._g, this._b);\n        var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);\n        return (this._a == 1) ?\n          \"hsl(\"  + h + \", \" + s + \"%, \" + l + \"%)\" :\n          \"hsla(\" + h + \", \" + s + \"%, \" + l + \"%, \"+ this._roundA + \")\";\n    },\n    toHex: function(allow3Char) {\n        return rgbToHex(this._r, this._g, this._b, allow3Char);\n    },\n    toHexString: function(allow3Char) {\n        return '#' + this.toHex(allow3Char);\n    },\n    toHex8: function(allow4Char) {\n        return rgbaToHex(this._r, this._g, this._b, this._a, allow4Char);\n    },\n    toHex8String: function(allow4Char) {\n        return '#' + this.toHex8(allow4Char);\n    },\n    toRgb: function() {\n        return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };\n    },\n    toRgbString: function() {\n        return (this._a == 1) ?\n          \"rgb(\"  + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \")\" :\n          \"rgba(\" + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \", \" + this._roundA + \")\";\n    },\n    toPercentageRgb: function() {\n        return { r: mathRound(bound01(this._r, 255) * 100) + \"%\", g: mathRound(bound01(this._g, 255) * 100) + \"%\", b: mathRound(bound01(this._b, 255) * 100) + \"%\", a: this._a };\n    },\n    toPercentageRgbString: function() {\n        return (this._a == 1) ?\n          \"rgb(\"  + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%)\" :\n          \"rgba(\" + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%, \" + this._roundA + \")\";\n    },\n    toName: function() {\n        if (this._a === 0) {\n            return \"transparent\";\n        }\n\n        if (this._a < 1) {\n            return false;\n        }\n\n        return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;\n    },\n    toFilter: function(secondColor) {\n        var hex8String = '#' + rgbaToArgbHex(this._r, this._g, this._b, this._a);\n        var secondHex8String = hex8String;\n        var gradientType = this._gradientType ? \"GradientType = 1, \" : \"\";\n\n        if (secondColor) {\n            var s = tinycolor(secondColor);\n            secondHex8String = '#' + rgbaToArgbHex(s._r, s._g, s._b, s._a);\n        }\n\n        return \"progid:DXImageTransform.Microsoft.gradient(\"+gradientType+\"startColorstr=\"+hex8String+\",endColorstr=\"+secondHex8String+\")\";\n    },\n    toString: function(format) {\n        var formatSet = !!format;\n        format = format || this._format;\n\n        var formattedString = false;\n        var hasAlpha = this._a < 1 && this._a >= 0;\n        var needsAlphaFormat = !formatSet && hasAlpha && (format === \"hex\" || format === \"hex6\" || format === \"hex3\" || format === \"hex4\" || format === \"hex8\" || format === \"name\");\n\n        if (needsAlphaFormat) {\n            // Special case for \"transparent\", all other non-alpha formats\n            // will return rgba when there is transparency.\n            if (format === \"name\" && this._a === 0) {\n                return this.toName();\n            }\n            return this.toRgbString();\n        }\n        if (format === \"rgb\") {\n            formattedString = this.toRgbString();\n        }\n        if (format === \"prgb\") {\n            formattedString = this.toPercentageRgbString();\n        }\n        if (format === \"hex\" || format === \"hex6\") {\n            formattedString = this.toHexString();\n        }\n        if (format === \"hex3\") {\n            formattedString = this.toHexString(true);\n        }\n        if (format === \"hex4\") {\n            formattedString = this.toHex8String(true);\n        }\n        if (format === \"hex8\") {\n            formattedString = this.toHex8String();\n        }\n        if (format === \"name\") {\n            formattedString = this.toName();\n        }\n        if (format === \"hsl\") {\n            formattedString = this.toHslString();\n        }\n        if (format === \"hsv\") {\n            formattedString = this.toHsvString();\n        }\n\n        return formattedString || this.toHexString();\n    },\n    clone: function() {\n        return tinycolor(this.toString());\n    },\n\n    _applyModification: function(fn, args) {\n        var color = fn.apply(null, [this].concat([].slice.call(args)));\n        this._r = color._r;\n        this._g = color._g;\n        this._b = color._b;\n        this.setAlpha(color._a);\n        return this;\n    },\n    lighten: function() {\n        return this._applyModification(lighten, arguments);\n    },\n    brighten: function() {\n        return this._applyModification(brighten, arguments);\n    },\n    darken: function() {\n        return this._applyModification(darken, arguments);\n    },\n    desaturate: function() {\n        return this._applyModification(desaturate, arguments);\n    },\n    saturate: function() {\n        return this._applyModification(saturate, arguments);\n    },\n    greyscale: function() {\n        return this._applyModification(greyscale, arguments);\n    },\n    spin: function() {\n        return this._applyModification(spin, arguments);\n    },\n\n    _applyCombination: function(fn, args) {\n        return fn.apply(null, [this].concat([].slice.call(args)));\n    },\n    analogous: function() {\n        return this._applyCombination(analogous, arguments);\n    },\n    complement: function() {\n        return this._applyCombination(complement, arguments);\n    },\n    monochromatic: function() {\n        return this._applyCombination(monochromatic, arguments);\n    },\n    splitcomplement: function() {\n        return this._applyCombination(splitcomplement, arguments);\n    },\n    triad: function() {\n        return this._applyCombination(triad, arguments);\n    },\n    tetrad: function() {\n        return this._applyCombination(tetrad, arguments);\n    }\n};\n\n// If input is an object, force 1 into \"1.0\" to handle ratios properly\n// String input requires \"1.0\" as input, so 1 will be treated as 1\ntinycolor.fromRatio = function(color, opts) {\n    if (typeof color == \"object\") {\n        var newColor = {};\n        for (var i in color) {\n            if (color.hasOwnProperty(i)) {\n                if (i === \"a\") {\n                    newColor[i] = color[i];\n                }\n                else {\n                    newColor[i] = convertToPercentage(color[i]);\n                }\n            }\n        }\n        color = newColor;\n    }\n\n    return tinycolor(color, opts);\n};\n\n// Given a string or object, convert that input to RGB\n// Possible string inputs:\n//\n//     \"red\"\n//     \"#f00\" or \"f00\"\n//     \"#ff0000\" or \"ff0000\"\n//     \"#ff000000\" or \"ff000000\"\n//     \"rgb 255 0 0\" or \"rgb (255, 0, 0)\"\n//     \"rgb 1.0 0 0\" or \"rgb (1, 0, 0)\"\n//     \"rgba (255, 0, 0, 1)\" or \"rgba 255, 0, 0, 1\"\n//     \"rgba (1.0, 0, 0, 1)\" or \"rgba 1.0, 0, 0, 1\"\n//     \"hsl(0, 100%, 50%)\" or \"hsl 0 100% 50%\"\n//     \"hsla(0, 100%, 50%, 1)\" or \"hsla 0 100% 50%, 1\"\n//     \"hsv(0, 100%, 100%)\" or \"hsv 0 100% 100%\"\n//\nfunction inputToRGB(color) {\n\n    var rgb = { r: 0, g: 0, b: 0 };\n    var a = 1;\n    var s = null;\n    var v = null;\n    var l = null;\n    var ok = false;\n    var format = false;\n\n    if (typeof color == \"string\") {\n        color = stringInputToObject(color);\n    }\n\n    if (typeof color == \"object\") {\n        if (isValidCSSUnit(color.r) && isValidCSSUnit(color.g) && isValidCSSUnit(color.b)) {\n            rgb = rgbToRgb(color.r, color.g, color.b);\n            ok = true;\n            format = String(color.r).substr(-1) === \"%\" ? \"prgb\" : \"rgb\";\n        }\n        else if (isValidCSSUnit(color.h) && isValidCSSUnit(color.s) && isValidCSSUnit(color.v)) {\n            s = convertToPercentage(color.s);\n            v = convertToPercentage(color.v);\n            rgb = hsvToRgb(color.h, s, v);\n            ok = true;\n            format = \"hsv\";\n        }\n        else if (isValidCSSUnit(color.h) && isValidCSSUnit(color.s) && isValidCSSUnit(color.l)) {\n            s = convertToPercentage(color.s);\n            l = convertToPercentage(color.l);\n            rgb = hslToRgb(color.h, s, l);\n            ok = true;\n            format = \"hsl\";\n        }\n\n        if (color.hasOwnProperty(\"a\")) {\n            a = color.a;\n        }\n    }\n\n    a = boundAlpha(a);\n\n    return {\n        ok: ok,\n        format: color.format || format,\n        r: mathMin(255, mathMax(rgb.r, 0)),\n        g: mathMin(255, mathMax(rgb.g, 0)),\n        b: mathMin(255, mathMax(rgb.b, 0)),\n        a: a\n    };\n}\n\n\n// Conversion Functions\n// --------------------\n\n// `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:\n// <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>\n\n// `rgbToRgb`\n// Handle bounds / percentage checking to conform to CSS color spec\n// <http://www.w3.org/TR/css3-color/>\n// *Assumes:* r, g, b in [0, 255] or [0, 1]\n// *Returns:* { r, g, b } in [0, 255]\nfunction rgbToRgb(r, g, b){\n    return {\n        r: bound01(r, 255) * 255,\n        g: bound01(g, 255) * 255,\n        b: bound01(b, 255) * 255\n    };\n}\n\n// `rgbToHsl`\n// Converts an RGB color value to HSL.\n// *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]\n// *Returns:* { h, s, l } in [0,1]\nfunction rgbToHsl(r, g, b) {\n\n    r = bound01(r, 255);\n    g = bound01(g, 255);\n    b = bound01(b, 255);\n\n    var max = mathMax(r, g, b), min = mathMin(r, g, b);\n    var h, s, l = (max + min) / 2;\n\n    if(max == min) {\n        h = s = 0; // achromatic\n    }\n    else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch(max) {\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n            case g: h = (b - r) / d + 2; break;\n            case b: h = (r - g) / d + 4; break;\n        }\n\n        h /= 6;\n    }\n\n    return { h: h, s: s, l: l };\n}\n\n// `hslToRgb`\n// Converts an HSL color value to RGB.\n// *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]\n// *Returns:* { r, g, b } in the set [0, 255]\nfunction hslToRgb(h, s, l) {\n    var r, g, b;\n\n    h = bound01(h, 360);\n    s = bound01(s, 100);\n    l = bound01(l, 100);\n\n    function hue2rgb(p, q, t) {\n        if(t < 0) t += 1;\n        if(t > 1) t -= 1;\n        if(t < 1/6) return p + (q - p) * 6 * t;\n        if(t < 1/2) return q;\n        if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n        return p;\n    }\n\n    if(s === 0) {\n        r = g = b = l; // achromatic\n    }\n    else {\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1/3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1/3);\n    }\n\n    return { r: r * 255, g: g * 255, b: b * 255 };\n}\n\n// `rgbToHsv`\n// Converts an RGB color value to HSV\n// *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]\n// *Returns:* { h, s, v } in [0,1]\nfunction rgbToHsv(r, g, b) {\n\n    r = bound01(r, 255);\n    g = bound01(g, 255);\n    b = bound01(b, 255);\n\n    var max = mathMax(r, g, b), min = mathMin(r, g, b);\n    var h, s, v = max;\n\n    var d = max - min;\n    s = max === 0 ? 0 : d / max;\n\n    if(max == min) {\n        h = 0; // achromatic\n    }\n    else {\n        switch(max) {\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n            case g: h = (b - r) / d + 2; break;\n            case b: h = (r - g) / d + 4; break;\n        }\n        h /= 6;\n    }\n    return { h: h, s: s, v: v };\n}\n\n// `hsvToRgb`\n// Converts an HSV color value to RGB.\n// *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]\n// *Returns:* { r, g, b } in the set [0, 255]\n function hsvToRgb(h, s, v) {\n\n    h = bound01(h, 360) * 6;\n    s = bound01(s, 100);\n    v = bound01(v, 100);\n\n    var i = Math.floor(h),\n        f = h - i,\n        p = v * (1 - s),\n        q = v * (1 - f * s),\n        t = v * (1 - (1 - f) * s),\n        mod = i % 6,\n        r = [v, q, p, p, t, v][mod],\n        g = [t, v, v, q, p, p][mod],\n        b = [p, p, t, v, v, q][mod];\n\n    return { r: r * 255, g: g * 255, b: b * 255 };\n}\n\n// `rgbToHex`\n// Converts an RGB color to hex\n// Assumes r, g, and b are contained in the set [0, 255]\n// Returns a 3 or 6 character hex\nfunction rgbToHex(r, g, b, allow3Char) {\n\n    var hex = [\n        pad2(mathRound(r).toString(16)),\n        pad2(mathRound(g).toString(16)),\n        pad2(mathRound(b).toString(16))\n    ];\n\n    // Return a 3 character hex if possible\n    if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {\n        return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);\n    }\n\n    return hex.join(\"\");\n}\n\n// `rgbaToHex`\n// Converts an RGBA color plus alpha transparency to hex\n// Assumes r, g, b are contained in the set [0, 255] and\n// a in [0, 1]. Returns a 4 or 8 character rgba hex\nfunction rgbaToHex(r, g, b, a, allow4Char) {\n\n    var hex = [\n        pad2(mathRound(r).toString(16)),\n        pad2(mathRound(g).toString(16)),\n        pad2(mathRound(b).toString(16)),\n        pad2(convertDecimalToHex(a))\n    ];\n\n    // Return a 4 character hex if possible\n    if (allow4Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1) && hex[3].charAt(0) == hex[3].charAt(1)) {\n        return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0) + hex[3].charAt(0);\n    }\n\n    return hex.join(\"\");\n}\n\n// `rgbaToArgbHex`\n// Converts an RGBA color to an ARGB Hex8 string\n// Rarely used, but required for \"toFilter()\"\nfunction rgbaToArgbHex(r, g, b, a) {\n\n    var hex = [\n        pad2(convertDecimalToHex(a)),\n        pad2(mathRound(r).toString(16)),\n        pad2(mathRound(g).toString(16)),\n        pad2(mathRound(b).toString(16))\n    ];\n\n    return hex.join(\"\");\n}\n\n// `equals`\n// Can be called with any tinycolor input\ntinycolor.equals = function (color1, color2) {\n    if (!color1 || !color2) { return false; }\n    return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();\n};\n\ntinycolor.random = function() {\n    return tinycolor.fromRatio({\n        r: mathRandom(),\n        g: mathRandom(),\n        b: mathRandom()\n    });\n};\n\n\n// Modification Functions\n// ----------------------\n// Thanks to less.js for some of the basics here\n// <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>\n\nfunction desaturate(color, amount) {\n    amount = (amount === 0) ? 0 : (amount || 10);\n    var hsl = tinycolor(color).toHsl();\n    hsl.s -= amount / 100;\n    hsl.s = clamp01(hsl.s);\n    return tinycolor(hsl);\n}\n\nfunction saturate(color, amount) {\n    amount = (amount === 0) ? 0 : (amount || 10);\n    var hsl = tinycolor(color).toHsl();\n    hsl.s += amount / 100;\n    hsl.s = clamp01(hsl.s);\n    return tinycolor(hsl);\n}\n\nfunction greyscale(color) {\n    return tinycolor(color).desaturate(100);\n}\n\nfunction lighten (color, amount) {\n    amount = (amount === 0) ? 0 : (amount || 10);\n    var hsl = tinycolor(color).toHsl();\n    hsl.l += amount / 100;\n    hsl.l = clamp01(hsl.l);\n    return tinycolor(hsl);\n}\n\nfunction brighten(color, amount) {\n    amount = (amount === 0) ? 0 : (amount || 10);\n    var rgb = tinycolor(color).toRgb();\n    rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));\n    rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));\n    rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));\n    return tinycolor(rgb);\n}\n\nfunction darken (color, amount) {\n    amount = (amount === 0) ? 0 : (amount || 10);\n    var hsl = tinycolor(color).toHsl();\n    hsl.l -= amount / 100;\n    hsl.l = clamp01(hsl.l);\n    return tinycolor(hsl);\n}\n\n// Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.\n// Values outside of this range will be wrapped into this range.\nfunction spin(color, amount) {\n    var hsl = tinycolor(color).toHsl();\n    var hue = (hsl.h + amount) % 360;\n    hsl.h = hue < 0 ? 360 + hue : hue;\n    return tinycolor(hsl);\n}\n\n// Combination Functions\n// ---------------------\n// Thanks to jQuery xColor for some of the ideas behind these\n// <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>\n\nfunction complement(color) {\n    var hsl = tinycolor(color).toHsl();\n    hsl.h = (hsl.h + 180) % 360;\n    return tinycolor(hsl);\n}\n\nfunction triad(color) {\n    var hsl = tinycolor(color).toHsl();\n    var h = hsl.h;\n    return [\n        tinycolor(color),\n        tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),\n        tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })\n    ];\n}\n\nfunction tetrad(color) {\n    var hsl = tinycolor(color).toHsl();\n    var h = hsl.h;\n    return [\n        tinycolor(color),\n        tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),\n        tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),\n        tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })\n    ];\n}\n\nfunction splitcomplement(color) {\n    var hsl = tinycolor(color).toHsl();\n    var h = hsl.h;\n    return [\n        tinycolor(color),\n        tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),\n        tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})\n    ];\n}\n\nfunction analogous(color, results, slices) {\n    results = results || 6;\n    slices = slices || 30;\n\n    var hsl = tinycolor(color).toHsl();\n    var part = 360 / slices;\n    var ret = [tinycolor(color)];\n\n    for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {\n        hsl.h = (hsl.h + part) % 360;\n        ret.push(tinycolor(hsl));\n    }\n    return ret;\n}\n\nfunction monochromatic(color, results) {\n    results = results || 6;\n    var hsv = tinycolor(color).toHsv();\n    var h = hsv.h, s = hsv.s, v = hsv.v;\n    var ret = [];\n    var modification = 1 / results;\n\n    while (results--) {\n        ret.push(tinycolor({ h: h, s: s, v: v}));\n        v = (v + modification) % 1;\n    }\n\n    return ret;\n}\n\n// Utility Functions\n// ---------------------\n\ntinycolor.mix = function(color1, color2, amount) {\n    amount = (amount === 0) ? 0 : (amount || 50);\n\n    var rgb1 = tinycolor(color1).toRgb();\n    var rgb2 = tinycolor(color2).toRgb();\n\n    var p = amount / 100;\n\n    var rgba = {\n        r: ((rgb2.r - rgb1.r) * p) + rgb1.r,\n        g: ((rgb2.g - rgb1.g) * p) + rgb1.g,\n        b: ((rgb2.b - rgb1.b) * p) + rgb1.b,\n        a: ((rgb2.a - rgb1.a) * p) + rgb1.a\n    };\n\n    return tinycolor(rgba);\n};\n\n\n// Readability Functions\n// ---------------------\n// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)\n\n// `contrast`\n// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)\ntinycolor.readability = function(color1, color2) {\n    var c1 = tinycolor(color1);\n    var c2 = tinycolor(color2);\n    return (Math.max(c1.getLuminance(),c2.getLuminance())+0.05) / (Math.min(c1.getLuminance(),c2.getLuminance())+0.05);\n};\n\n// `isReadable`\n// Ensure that foreground and background color combinations meet WCAG2 guidelines.\n// The third argument is an optional Object.\n//      the 'level' property states 'AA' or 'AAA' - if missing or invalid, it defaults to 'AA';\n//      the 'size' property states 'large' or 'small' - if missing or invalid, it defaults to 'small'.\n// If the entire object is absent, isReadable defaults to {level:\"AA\",size:\"small\"}.\n\n// *Example*\n//    tinycolor.isReadable(\"#000\", \"#111\") => false\n//    tinycolor.isReadable(\"#000\", \"#111\",{level:\"AA\",size:\"large\"}) => false\ntinycolor.isReadable = function(color1, color2, wcag2) {\n    var readability = tinycolor.readability(color1, color2);\n    var wcag2Parms, out;\n\n    out = false;\n\n    wcag2Parms = validateWCAG2Parms(wcag2);\n    switch (wcag2Parms.level + wcag2Parms.size) {\n        case \"AAsmall\":\n        case \"AAAlarge\":\n            out = readability >= 4.5;\n            break;\n        case \"AAlarge\":\n            out = readability >= 3;\n            break;\n        case \"AAAsmall\":\n            out = readability >= 7;\n            break;\n    }\n    return out;\n\n};\n\n// `mostReadable`\n// Given a base color and a list of possible foreground or background\n// colors for that base, returns the most readable color.\n// Optionally returns Black or White if the most readable color is unreadable.\n// *Example*\n//    tinycolor.mostReadable(tinycolor.mostReadable(\"#123\", [\"#124\", \"#125\"],{includeFallbackColors:false}).toHexString(); // \"#112255\"\n//    tinycolor.mostReadable(tinycolor.mostReadable(\"#123\", [\"#124\", \"#125\"],{includeFallbackColors:true}).toHexString();  // \"#ffffff\"\n//    tinycolor.mostReadable(\"#a8015a\", [\"#faf3f3\"],{includeFallbackColors:true,level:\"AAA\",size:\"large\"}).toHexString(); // \"#faf3f3\"\n//    tinycolor.mostReadable(\"#a8015a\", [\"#faf3f3\"],{includeFallbackColors:true,level:\"AAA\",size:\"small\"}).toHexString(); // \"#ffffff\"\ntinycolor.mostReadable = function(baseColor, colorList, args) {\n    var bestColor = null;\n    var bestScore = 0;\n    var readability;\n    var includeFallbackColors, level, size ;\n    args = args || {};\n    includeFallbackColors = args.includeFallbackColors ;\n    level = args.level;\n    size = args.size;\n\n    for (var i= 0; i < colorList.length ; i++) {\n        readability = tinycolor.readability(baseColor, colorList[i]);\n        if (readability > bestScore) {\n            bestScore = readability;\n            bestColor = tinycolor(colorList[i]);\n        }\n    }\n\n    if (tinycolor.isReadable(baseColor, bestColor, {\"level\":level,\"size\":size}) || !includeFallbackColors) {\n        return bestColor;\n    }\n    else {\n        args.includeFallbackColors=false;\n        return tinycolor.mostReadable(baseColor,[\"#fff\", \"#000\"],args);\n    }\n};\n\n\n// Big List of Colors\n// ------------------\n// <http://www.w3.org/TR/css3-color/#svg-color>\nvar names = tinycolor.names = {\n    aliceblue: \"f0f8ff\",\n    antiquewhite: \"faebd7\",\n    aqua: \"0ff\",\n    aquamarine: \"7fffd4\",\n    azure: \"f0ffff\",\n    beige: \"f5f5dc\",\n    bisque: \"ffe4c4\",\n    black: \"000\",\n    blanchedalmond: \"ffebcd\",\n    blue: \"00f\",\n    blueviolet: \"8a2be2\",\n    brown: \"a52a2a\",\n    burlywood: \"deb887\",\n    burntsienna: \"ea7e5d\",\n    cadetblue: \"5f9ea0\",\n    chartreuse: \"7fff00\",\n    chocolate: \"d2691e\",\n    coral: \"ff7f50\",\n    cornflowerblue: \"6495ed\",\n    cornsilk: \"fff8dc\",\n    crimson: \"dc143c\",\n    cyan: \"0ff\",\n    darkblue: \"00008b\",\n    darkcyan: \"008b8b\",\n    darkgoldenrod: \"b8860b\",\n    darkgray: \"a9a9a9\",\n    darkgreen: \"006400\",\n    darkgrey: \"a9a9a9\",\n    darkkhaki: \"bdb76b\",\n    darkmagenta: \"8b008b\",\n    darkolivegreen: \"556b2f\",\n    darkorange: \"ff8c00\",\n    darkorchid: \"9932cc\",\n    darkred: \"8b0000\",\n    darksalmon: \"e9967a\",\n    darkseagreen: \"8fbc8f\",\n    darkslateblue: \"483d8b\",\n    darkslategray: \"2f4f4f\",\n    darkslategrey: \"2f4f4f\",\n    darkturquoise: \"00ced1\",\n    darkviolet: \"9400d3\",\n    deeppink: \"ff1493\",\n    deepskyblue: \"00bfff\",\n    dimgray: \"696969\",\n    dimgrey: \"696969\",\n    dodgerblue: \"1e90ff\",\n    firebrick: \"b22222\",\n    floralwhite: \"fffaf0\",\n    forestgreen: \"228b22\",\n    fuchsia: \"f0f\",\n    gainsboro: \"dcdcdc\",\n    ghostwhite: \"f8f8ff\",\n    gold: \"ffd700\",\n    goldenrod: \"daa520\",\n    gray: \"808080\",\n    green: \"008000\",\n    greenyellow: \"adff2f\",\n    grey: \"808080\",\n    honeydew: \"f0fff0\",\n    hotpink: \"ff69b4\",\n    indianred: \"cd5c5c\",\n    indigo: \"4b0082\",\n    ivory: \"fffff0\",\n    khaki: \"f0e68c\",\n    lavender: \"e6e6fa\",\n    lavenderblush: \"fff0f5\",\n    lawngreen: \"7cfc00\",\n    lemonchiffon: \"fffacd\",\n    lightblue: \"add8e6\",\n    lightcoral: \"f08080\",\n    lightcyan: \"e0ffff\",\n    lightgoldenrodyellow: \"fafad2\",\n    lightgray: \"d3d3d3\",\n    lightgreen: \"90ee90\",\n    lightgrey: \"d3d3d3\",\n    lightpink: \"ffb6c1\",\n    lightsalmon: \"ffa07a\",\n    lightseagreen: \"20b2aa\",\n    lightskyblue: \"87cefa\",\n    lightslategray: \"789\",\n    lightslategrey: \"789\",\n    lightsteelblue: \"b0c4de\",\n    lightyellow: \"ffffe0\",\n    lime: \"0f0\",\n    limegreen: \"32cd32\",\n    linen: \"faf0e6\",\n    magenta: \"f0f\",\n    maroon: \"800000\",\n    mediumaquamarine: \"66cdaa\",\n    mediumblue: \"0000cd\",\n    mediumorchid: \"ba55d3\",\n    mediumpurple: \"9370db\",\n    mediumseagreen: \"3cb371\",\n    mediumslateblue: \"7b68ee\",\n    mediumspringgreen: \"00fa9a\",\n    mediumturquoise: \"48d1cc\",\n    mediumvioletred: \"c71585\",\n    midnightblue: \"191970\",\n    mintcream: \"f5fffa\",\n    mistyrose: \"ffe4e1\",\n    moccasin: \"ffe4b5\",\n    navajowhite: \"ffdead\",\n    navy: \"000080\",\n    oldlace: \"fdf5e6\",\n    olive: \"808000\",\n    olivedrab: \"6b8e23\",\n    orange: \"ffa500\",\n    orangered: \"ff4500\",\n    orchid: \"da70d6\",\n    palegoldenrod: \"eee8aa\",\n    palegreen: \"98fb98\",\n    paleturquoise: \"afeeee\",\n    palevioletred: \"db7093\",\n    papayawhip: \"ffefd5\",\n    peachpuff: \"ffdab9\",\n    peru: \"cd853f\",\n    pink: \"ffc0cb\",\n    plum: \"dda0dd\",\n    powderblue: \"b0e0e6\",\n    purple: \"800080\",\n    rebeccapurple: \"663399\",\n    red: \"f00\",\n    rosybrown: \"bc8f8f\",\n    royalblue: \"4169e1\",\n    saddlebrown: \"8b4513\",\n    salmon: \"fa8072\",\n    sandybrown: \"f4a460\",\n    seagreen: \"2e8b57\",\n    seashell: \"fff5ee\",\n    sienna: \"a0522d\",\n    silver: \"c0c0c0\",\n    skyblue: \"87ceeb\",\n    slateblue: \"6a5acd\",\n    slategray: \"708090\",\n    slategrey: \"708090\",\n    snow: \"fffafa\",\n    springgreen: \"00ff7f\",\n    steelblue: \"4682b4\",\n    tan: \"d2b48c\",\n    teal: \"008080\",\n    thistle: \"d8bfd8\",\n    tomato: \"ff6347\",\n    turquoise: \"40e0d0\",\n    violet: \"ee82ee\",\n    wheat: \"f5deb3\",\n    white: \"fff\",\n    whitesmoke: \"f5f5f5\",\n    yellow: \"ff0\",\n    yellowgreen: \"9acd32\"\n};\n\n// Make it easy to access colors via `hexNames[hex]`\nvar hexNames = tinycolor.hexNames = flip(names);\n\n\n// Utilities\n// ---------\n\n// `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`\nfunction flip(o) {\n    var flipped = { };\n    for (var i in o) {\n        if (o.hasOwnProperty(i)) {\n            flipped[o[i]] = i;\n        }\n    }\n    return flipped;\n}\n\n// Return a valid alpha value [0,1] with all invalid values being set to 1\nfunction boundAlpha(a) {\n    a = parseFloat(a);\n\n    if (isNaN(a) || a < 0 || a > 1) {\n        a = 1;\n    }\n\n    return a;\n}\n\n// Take input from [0, n] and return it as [0, 1]\nfunction bound01(n, max) {\n    if (isOnePointZero(n)) { n = \"100%\"; }\n\n    var processPercent = isPercentage(n);\n    n = mathMin(max, mathMax(0, parseFloat(n)));\n\n    // Automatically convert percentage into number\n    if (processPercent) {\n        n = parseInt(n * max, 10) / 100;\n    }\n\n    // Handle floating point rounding errors\n    if ((Math.abs(n - max) < 0.000001)) {\n        return 1;\n    }\n\n    // Convert into [0, 1] range if it isn't already\n    return (n % max) / parseFloat(max);\n}\n\n// Force a number between 0 and 1\nfunction clamp01(val) {\n    return mathMin(1, mathMax(0, val));\n}\n\n// Parse a base-16 hex value into a base-10 integer\nfunction parseIntFromHex(val) {\n    return parseInt(val, 16);\n}\n\n// Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1\n// <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>\nfunction isOnePointZero(n) {\n    return typeof n == \"string\" && n.indexOf('.') != -1 && parseFloat(n) === 1;\n}\n\n// Check to see if string passed in is a percentage\nfunction isPercentage(n) {\n    return typeof n === \"string\" && n.indexOf('%') != -1;\n}\n\n// Force a hex value to have 2 characters\nfunction pad2(c) {\n    return c.length == 1 ? '0' + c : '' + c;\n}\n\n// Replace a decimal with it's percentage value\nfunction convertToPercentage(n) {\n    if (n <= 1) {\n        n = (n * 100) + \"%\";\n    }\n\n    return n;\n}\n\n// Converts a decimal to a hex value\nfunction convertDecimalToHex(d) {\n    return Math.round(parseFloat(d) * 255).toString(16);\n}\n// Converts a hex value to a decimal\nfunction convertHexToDecimal(h) {\n    return (parseIntFromHex(h) / 255);\n}\n\nvar matchers = (function() {\n\n    // <http://www.w3.org/TR/css3-values/#integers>\n    var CSS_INTEGER = \"[-\\\\+]?\\\\d+%?\";\n\n    // <http://www.w3.org/TR/css3-values/#number-value>\n    var CSS_NUMBER = \"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\";\n\n    // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.\n    var CSS_UNIT = \"(?:\" + CSS_NUMBER + \")|(?:\" + CSS_INTEGER + \")\";\n\n    // Actual matching.\n    // Parentheses and commas are optional, but not required.\n    // Whitespace can take the place of commas or opening paren\n    var PERMISSIVE_MATCH3 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n    var PERMISSIVE_MATCH4 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n\n    return {\n        CSS_UNIT: new RegExp(CSS_UNIT),\n        rgb: new RegExp(\"rgb\" + PERMISSIVE_MATCH3),\n        rgba: new RegExp(\"rgba\" + PERMISSIVE_MATCH4),\n        hsl: new RegExp(\"hsl\" + PERMISSIVE_MATCH3),\n        hsla: new RegExp(\"hsla\" + PERMISSIVE_MATCH4),\n        hsv: new RegExp(\"hsv\" + PERMISSIVE_MATCH3),\n        hsva: new RegExp(\"hsva\" + PERMISSIVE_MATCH4),\n        hex3: /^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\n        hex6: /^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,\n        hex4: /^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\n        hex8: /^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/\n    };\n})();\n\n// `isValidCSSUnit`\n// Take in a single string / number and check to see if it looks like a CSS unit\n// (see `matchers` above for definition).\nfunction isValidCSSUnit(color) {\n    return !!matchers.CSS_UNIT.exec(color);\n}\n\n// `stringInputToObject`\n// Permissive string parsing.  Take in a number of formats, and output an object\n// based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`\nfunction stringInputToObject(color) {\n\n    color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();\n    var named = false;\n    if (names[color]) {\n        color = names[color];\n        named = true;\n    }\n    else if (color == 'transparent') {\n        return { r: 0, g: 0, b: 0, a: 0, format: \"name\" };\n    }\n\n    // Try to match string input using regular expressions.\n    // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]\n    // Just return an object and let the conversion functions handle that.\n    // This way the result will be the same whether the tinycolor is initialized with string or object.\n    var match;\n    if ((match = matchers.rgb.exec(color))) {\n        return { r: match[1], g: match[2], b: match[3] };\n    }\n    if ((match = matchers.rgba.exec(color))) {\n        return { r: match[1], g: match[2], b: match[3], a: match[4] };\n    }\n    if ((match = matchers.hsl.exec(color))) {\n        return { h: match[1], s: match[2], l: match[3] };\n    }\n    if ((match = matchers.hsla.exec(color))) {\n        return { h: match[1], s: match[2], l: match[3], a: match[4] };\n    }\n    if ((match = matchers.hsv.exec(color))) {\n        return { h: match[1], s: match[2], v: match[3] };\n    }\n    if ((match = matchers.hsva.exec(color))) {\n        return { h: match[1], s: match[2], v: match[3], a: match[4] };\n    }\n    if ((match = matchers.hex8.exec(color))) {\n        return {\n            r: parseIntFromHex(match[1]),\n            g: parseIntFromHex(match[2]),\n            b: parseIntFromHex(match[3]),\n            a: convertHexToDecimal(match[4]),\n            format: named ? \"name\" : \"hex8\"\n        };\n    }\n    if ((match = matchers.hex6.exec(color))) {\n        return {\n            r: parseIntFromHex(match[1]),\n            g: parseIntFromHex(match[2]),\n            b: parseIntFromHex(match[3]),\n            format: named ? \"name\" : \"hex\"\n        };\n    }\n    if ((match = matchers.hex4.exec(color))) {\n        return {\n            r: parseIntFromHex(match[1] + '' + match[1]),\n            g: parseIntFromHex(match[2] + '' + match[2]),\n            b: parseIntFromHex(match[3] + '' + match[3]),\n            a: convertHexToDecimal(match[4] + '' + match[4]),\n            format: named ? \"name\" : \"hex8\"\n        };\n    }\n    if ((match = matchers.hex3.exec(color))) {\n        return {\n            r: parseIntFromHex(match[1] + '' + match[1]),\n            g: parseIntFromHex(match[2] + '' + match[2]),\n            b: parseIntFromHex(match[3] + '' + match[3]),\n            format: named ? \"name\" : \"hex\"\n        };\n    }\n\n    return false;\n}\n\nfunction validateWCAG2Parms(parms) {\n    // return valid WCAG2 parms for isReadable.\n    // If input parms are invalid, return {\"level\":\"AA\", \"size\":\"small\"}\n    var level, size;\n    parms = parms || {\"level\":\"AA\", \"size\":\"small\"};\n    level = (parms.level || \"AA\").toUpperCase();\n    size = (parms.size || \"small\").toLowerCase();\n    if (level !== \"AA\" && level !== \"AAA\") {\n        level = \"AA\";\n    }\n    if (size !== \"small\" && size !== \"large\") {\n        size = \"small\";\n    }\n    return {\"level\":level, \"size\":size};\n}\n\n/*// Node: Export function\nif (typeof module !== \"undefined\" && module.exports) {\n    module.exports = tinycolor;\n}\n// AMD/requirejs: Define the module\nelse if (typeof define === 'function' && define.amd) {\n    define(function () {return tinycolor;});\n}\n// Browser: Expose to window\nelse {\n    window.tinycolor = tinycolor;\n}*/\n\nreturn tinycolor;\n\n})(Math);\n\nexport default tinycolor;\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACtHA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AADA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChQA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;;;;;;;;;;;ACjBA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9PA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AADA;AACA;AAGA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AADA;AAKA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAEA;AADA;AAKA;AADA;AAIA;AAGA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAKA;AAGA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAKA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAKA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAIA;AADA;AAKA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;AC1wBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAIA;AAIA;AAIA;AAIA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzQA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAEA;AAMA;AACA;AAIA;AACA;AAEA;AACA;AAMA;AACA;AAEA;AACA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAWA;AAEA;AAMA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACvVA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAPA;AASA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClGA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AA+BA;AAiCA;AAyBA;AACA;AAqBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AAUA;AAUA;AAUA;AAUA;AAUA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;ACtQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAkBA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACrMA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AACA;AAGA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AAAA;AAAA;AAMA;AANA;AACA;AAOA;AAMA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AAAA;AAAA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAHA;AAQA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAKA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AAGA;AADA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACveA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAGA;AACA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AATA;AACA;AAUA;AAEA;AACA;;;;;;;;;;;;AC/FA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAjCA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAQA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAOA;AADA;AAMA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAaA;AAUA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiBA;AACA;AACA;AACA;AACA;AAKA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAHA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AASA;AADA;AAWA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AANA;AAQA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AADA;AAoBA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAlvEA;AACA;AAmvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AArCA;AACA;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AArBA;AACA;AAsBA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACl0EA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AA3FA;AA6FA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;;;;;AChGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAvBA;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAuCA;AAAA;AAAA;AAAA;;;;;;;;;;;;AC1CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AA3BA;AA6BA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AAAA;AAAA;AAMA;AANA;AACA;AAOA;AAMA;AACA;AAAA;AAEA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAtHA;AACA;AAuHA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AAGA;AACA;AACA;AAtFA;AACA;AAuFA;AACA;AACA;;;;;;;;;;;ACvNA;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3GA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAOA;AADA;AAUA;AACA;AAFA;AA8BA;AACA;AACA;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AADA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;;;;;;;;;;;;AC9MA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;AChDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAWA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AACA;AAJA;AApDA;AACA;AA2DA;AACA;AACA;AAAA;AACA;AACA;AAmBA;AACA;AAGA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AAOA;AACA;AAAA;AACA;AAOA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AA4CA;AACA;AAoBA;AACA;AAAA;AACA;AA2BA;AACA;AAAA;AACA;AAuBA;AACA;AAAA;AACA;AA8BA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;;;;;;;;;;;ACvTA;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AANA;AACA;AAQA;AAMA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AACA;AACA;AACA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApCA;AACA;AAqCA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAIA;AADA;AAIA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAGA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;AAuBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAoBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAoBA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACj0CA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AALA;AArCA;AACA;AA8CA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAHA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAIA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AA1OA;AACA;AA2OA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAEA;AAEA;AACA;AACA;AACA;AAHA;AAMA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AArPA;AACA;AAsPA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AACA;AAHA;AAMA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AAFA;AACA;AAKA;AACA;AACA;AAMA;AACA;AAMA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxbA;AACA;AAybA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvkCA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAZA;AACA;AAaA;AACA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAKA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAFA;AAUA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC1cA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAhBA;AAkBA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;ACjJA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACTA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AADA;AAGA;AACA;AAAA;AAAA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AAEA;AACA;AAFA;AAKA;AACA;AACA;AADA;AAIA;AAEA;AAIA;AALA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AADA;AAGA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAIA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;ACzUA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAUA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACtEA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACzCA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAWA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9DA;AAgEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC1wBA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AATA;AAWA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;AC5GA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AAFA;AAMA;AACA;AACA;;;;;;;;;;;;ACnBA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC/CA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AADA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA3IA;AACA;AA4IA;AACA;AAEA;AACA;AACA;AAKA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;;;;;;;;;;;;AC7UA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAcA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhCA;AACA;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAnBA;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlLA;AACA;AAmLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAbA;AACA;AAcA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AATA;AAWA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,wJAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,8GAAA;AAKA;AACA;AACA;AACA;AACA;AA/IA;AACA;AA+IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;;ACrjBA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;ACXA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvBA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAcA;AACA;;;;;;;;;;;;;ACpFA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAOA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvNA;AA2NA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAHA;AACA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAHA;AACA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AADA;AAEA;AAOA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAVA;AACA;AAWA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArJA;AACA;AAwJA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;AAGA;AACA;AACA;AACA;AADA;AACA;AACA;AAGA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;;;;A","sourceRoot":""}